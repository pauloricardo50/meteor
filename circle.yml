machine:
  timezone: Europe/Zurich
  node:
    version: 4.8.0

dependencies:
  override:
    - curl https://install.meteor.com | /bin/sh
    - npm install
    - npm install fbjs
    - meteor remove bundle-visualizer
  cache-directories:
    - "~/.meteor"
    - "~/.npm"
    - "~/node_modules"
    - "/usr/local/bin"
    - "/bin/sh"

test:
  override:
    - echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf && sudo sysctl -p
    - yarn run test-CI
  post:
    - yarn global add mup

deployment:
  staging:
    branch: staging
    commands:
      - yarn run deploy:staging
  production:
    branch: master
    commands:
      - yarn run deploy:production
