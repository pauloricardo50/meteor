{"code":"!function(){var e=Package.meteor.Meteor,n=Package.meteor.global,t=Package.meteor.meteorEnv,o=Package.underscore._,r=Package.ejson.EJSON,i=Package.minimongo.LocalCollection,a=Package.minimongo.Minimongo,c=Package.mongo.Mongo,s=Package.random.Random,u=Package[\"diff-sequence\"].DiffSequence,l=Package[\"mongo-id\"].MongoID,f=Package.modules.meteorInstall,d=Package[\"babel-runtime\"].meteorBabelHelpers,m=Package.promise.Promise,g=Package[\"ddp-client\"].DDP,p=Package[\"ecmascript-runtime-client\"].Symbol,E=Package[\"ecmascript-runtime-client\"].Map,P=Package[\"ecmascript-runtime-client\"].Set,h,v=f({node_modules:{meteor:{\"cultofcoders:redis-oplog\":{\"redis-oplog.client.js\":function(e,n,t){var o;t.export({Vent:function(){return r}}),t.link(\"./lib/vent/VentClient\",{default:function(e){o=e}},0);var r=new o},lib:{\"constants.js\":function(e,n,t){t.export({Events:function(){return r},Strategy:function(){return i},RedisPipe:function(){return o},VentConstants:function(){return a}});var o={EVENT:\"e\",DOC:\"d\",FIELDS:\"f\",MODIFIER:\"m\",DOCUMENT_ID:\"id\",SYNTHETIC:\"s\",UID:\"u\",MODIFIED_TOP_LEVEL_FIELDS:\"mt\"};t.exportDefault(o);var r={INSERT:\"i\",UPDATE:\"u\",REMOVE:\"r\"},i={DEFAULT:\"D\",DEDICATED_CHANNELS:\"DC\",LIMIT_SORT:\"LS\"},a={ID:\"i\",EVENT_VARIABLE:\"e\",PREFIX:\"__vent\",getPrefix:function(e,n){return e+\".\"+n}}},vent:{\"VentClient.js\":function(n,t,r){var i,a=n(\"@babel/runtime/helpers/interopRequireDefault\")(n(\"@babel/runtime/helpers/createClass\")),c,s,u;r.export({default:function(){return l}}),r.link(\"../constants\",{VentConstants:function(e){c=e}},0),r.link(\"meteor/random\",{Random:function(e){s=e}},1),r.link(\"meteor/ddp-common\",{DDPCommon:function(e){u=e}},2);var l=function(){function n(){this.store={},this.listen(e.connection)}var t=n.prototype;return t.subscribe=function(){function e(e){var n=new f(this,e);this.add(n);for(var t=arguments.length,o=new Array(t>1?t-1:0),r=1;r<t;r++)o[r-1]=arguments[r];return n.subscribe.apply(n,o)}return e}(),t.listen=function(){function e(e){var n=this;e._stream.on(\"message\",function(e){var t='{\"msg\":\"changed\",\"'+c.PREFIX+'\":\"1';if(e.substr(0,t.length)===t){var o=u.parseDDP(e),r=n.store[o.id];r&&r.handle(o[c.EVENT_VARIABLE])}})}return e}(),t.add=function(){function e(e){this.store[e.id]=e}return e}(),t.remove=function(){function e(e){delete this.store[e.id]}return e}(),n}(),f=function(){function n(e,n){this.client=e,this._name=n,this._id=s.id()}var t=n.prototype;return t.subscribe=function(){function n(){for(var n,t=this,r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];var c=(n=e).subscribe.apply(n,[this._name,this._id].concat(i)),s=c.stop;return Object.assign(c,{listen:function(n){if(!o.isFunction(n))throw new e.Error(\"invalid-argument\",\"You should pass a function to listen()\");t._eventHandler=n},stop:function(){return t.client.remove(t),s.call(c)}}),c}return n}(),t.handle=function(){function e(e){this._eventHandler&&this._eventHandler(e)}return e}(),(0,a.default)(n,[{key:\"id\",get:function(){return c.getPrefix(this._id,this._name)}}]),n}()}}}}}}},{extensions:[\".js\",\".json\"]})(\"/node_modules/meteor/cultofcoders:redis-oplog/redis-oplog.client.js\");Package._define(\"cultofcoders:redis-oplog\",v)}();","sourcemap":"{\"version\":3,\"sources\":[\"packages/cultofcoders:redis-oplog/redis-oplog.client.js\",\"packages/cultofcoders:redis-oplog/lib/constants.js\",\"packages/cultofcoders:redis-oplog/lib/vent/VentClient.js\"],\"names\":[\"VentClient\",\"module\",\"export\",\"Vent\",\"link\",\"default\",\"v\",\"Events\",\"Strategy\",\"RedisPipe\",\"VentConstants\",\"EVENT\",\"DOC\",\"FIELDS\",\"MODIFIER\",\"DOCUMENT_ID\",\"SYNTHETIC\",\"UID\",\"MODIFIED_TOP_LEVEL_FIELDS\",\"exportDefault\",\"INSERT\",\"UPDATE\",\"REMOVE\",\"DEFAULT\",\"DEDICATED_CHANNELS\",\"LIMIT_SORT\",\"ID\",\"EVENT_VARIABLE\",\"PREFIX\",\"getPrefix\",\"id\",\"name\",\"Random\",\"DDPCommon\",\"this\",\"store\",\"listen\",\"Meteor\",\"connection\",\"subscribe\",\"subscription\",\"VentClientSubscription\",\"add\",\"_len\",\"arguments\",\"length\",\"args\",\"Array\",\"_key\",\"apply\",\"ddpConnection\",\"_this\",\"_stream\",\"on\",\"raw_msg\",\"search\",\"substr\",\"msg\",\"parseDDP\",\"handle\",\"remove\",\"client\",\"_name\",\"_id\",\"_Meteor\",\"self\",\"_len2\",\"_key2\",\"handler\",\"concat\",\"oldStop\",\"stop\",\"Object\",\"assign\",\"eventHandler\",\"_\",\"isFunction\",\"Error\",\"_eventHandler\",\"call\",\"event\"],\"mappings\":\"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\",\"sourcesContent\":[\"import VentClient from './lib/vent/VentClient';\\n\\nconst Vent = new VentClient();\\n\\nexport { Vent };\\n\",\"const RedisPipe = {\\n    EVENT: 'e',\\n    DOC: 'd',\\n    FIELDS: 'f',\\n    MODIFIER: 'm',\\n    DOCUMENT_ID: 'id',\\n    SYNTHETIC: 's',\\n    UID: 'u', // this is the unique identity of a change request\\n    MODIFIED_TOP_LEVEL_FIELDS: 'mt'\\n};\\n\\nexport default RedisPipe;\\n\\nconst Events = {\\n    INSERT: 'i',\\n    UPDATE: 'u',\\n    REMOVE: 'r'\\n};\\n\\nconst Strategy = {\\n    DEFAULT: 'D',\\n    DEDICATED_CHANNELS: 'DC',\\n    LIMIT_SORT: 'LS'\\n};\\n\\nconst VentConstants = {\\n    ID: 'i',\\n    EVENT_VARIABLE: 'e',\\n    PREFIX: '__vent',\\n    getPrefix(id, name) {\\n        return `${id}.${name}`;\\n    }\\n};\\n\\nexport {\\n    Events,\\n    Strategy,\\n    RedisPipe,\\n    VentConstants\\n};\\n\",\"import {VentConstants} from '../constants';\\nimport {Random} from 'meteor/random';\\nimport {DDPCommon} from 'meteor/ddp-common';\\n\\n/**\\n * Handles vents inside Meteor\\n */\\nexport default class VentClient {\\n    constructor() {\\n        this.store = {};\\n        this.listen(Meteor.connection);\\n    }\\n\\n    subscribe(name, ...args) {\\n        const subscription = new VentClientSubscription(this, name);\\n        this.add(subscription);\\n\\n        return subscription.subscribe(...args);\\n    }\\n\\n    listen(ddpConnection) {\\n        ddpConnection._stream.on('message', (raw_msg) => {\\n            // avoid parsing unnecessary ddp events\\n            const search = `{\\\"msg\\\":\\\"changed\\\",\\\"${VentConstants.PREFIX}\\\":\\\"1`;\\n            if (raw_msg.substr(0, search.length) !== search) {\\n                return;\\n            }\\n\\n            const msg = DDPCommon.parseDDP(raw_msg);\\n            const subscription = this.store[msg.id];\\n            if (subscription) {\\n                subscription.handle(msg[VentConstants.EVENT_VARIABLE]);\\n            }\\n        });\\n    }\\n\\n    /**\\n     * {VentClientSubscription}\\n     * @param subscription\\n     */\\n    add(subscription) {\\n        this.store[subscription.id] = subscription;\\n    }\\n\\n    /**\\n     * @param {VentClientSubscription} subscription\\n     */\\n    remove(subscription) {\\n        delete this.store[subscription.id];\\n    }\\n}\\n\\n/**\\n * Handles Vent subscription\\n */\\nclass VentClientSubscription {\\n    constructor(client, name) {\\n        this.client = client;\\n        this._name = name;\\n        this._id = Random.id();\\n    }\\n\\n    get id() {\\n        return VentConstants.getPrefix(this._id, this._name);\\n    }\\n\\n    /**\\n     * Subscribes to Meteor\\n     *\\n     * @param args\\n     * @returns {*}\\n     */\\n    subscribe(...args) {\\n        const self = this;\\n\\n        const handler = Meteor.subscribe(this._name, this._id, ...args);\\n\\n        const oldStop = handler.stop;\\n        Object.assign(handler, {\\n            listen(eventHandler) {\\n                if (!_.isFunction(eventHandler)) {\\n                    throw new Meteor.Error('invalid-argument', 'You should pass a function to listen()');\\n                }\\n\\n                self._eventHandler = eventHandler;\\n            },\\n            stop() {\\n                self.client.remove(self);\\n\\n                return oldStop.call(handler);\\n            }\\n        });\\n\\n        return handler;\\n    }\\n\\n    /**\\n     * Watches the incomming events\\n     */\\n    handle(event) {\\n        if (this._eventHandler) {\\n            this._eventHandler(event);\\n        } else {\\n\\n        }\\n    }\\n}\"]}","minifier":"terser"}