{"code":"!function(){var e=Package.meteor.Meteor,t=Package.meteor.global,a=Package.meteor.meteorEnv,o=Package.check.check,n=Package.check.Match,c=Package.modules.meteorInstall,r=Package[\"babel-runtime\"].meteorBabelHelpers,s=Package.promise.Promise,i,l=c({node_modules:{meteor:{\"cultofcoders:mutations\":{\"main.js\":function(e,t,a){let o,n;a.export({Mutation:()=>n,wrap:()=>o}),a.link(\"./lib/wrap\",{default(e){o=e}},0),a.link(\"./lib/mutation.class\",{default(e){n=e}},1),a.link(\"./lib/debug\")},lib:{\"aop.js\":function(e,t,a){class n{constructor(){this.befores=[],this.afters=[]}addBefore(e){o(e,Function),this.befores.push(e)}addAfter(e){o(e,Function),this.afters.push(e)}executeBefores(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];this.befores.forEach(e=>e.call(null,...t))}executeAfters(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];this.afters.forEach(e=>e.call(null,...t))}}a.exportDefault(n)},\"debug.js\":function(t,a,o){let n;o.link(\"./mutation.class\",{default(e){n=e}},0),Object.assign(n,{isDebugEnabled:e.isDevelopment||process.env.MUTATION_DEBUG_ENABLED});const c=e=>!!n.isDebugEnabled&&(!n.isDebugEnabled.omit||!n.isDebugEnabled.omit.includes(e.name));n.addBeforeCall(e=>{let{config:t,params:a,context:o}=e;c(t)&&console.log(\"[mutations][\".concat(t.name,\"] Calling with params:\"),a)}),n.addAfterCall(e=>{let{config:t,params:a,context:o,result:n,error:r}=e;if(c(t)){const e=new Date;r?console.error(\"[mutations][\".concat(t.name,\"] Received error:\"),r):console.log(\"[mutations][\".concat(t.name,\"] Received result:\"),n)}}),n.addBeforeExecution(e=>{let{config:t,params:a,context:o}=e;if(c(t)){const e=new Date;console.log(\"[mutations][\".concat(t.name,\"] Received call with params: \").concat(JSON.stringify(a)))}})},\"mutation.class.js\":function(e,t,a){let o,n,c,r;a.export({default:()=>i}),a.link(\"meteor/meteor\",{Meteor(e){o=e}},0),a.link(\"./aop\",{default(e){n=e}},1),a.link(\"meteor/check\",{check(e){c=e},Match(e){r=e}},2);class i{constructor(e){i.checkDefaultConfig(e),this.config=e,this.callAOP=new n,this.executionAOP=new n}static addBeforeCall(e){this.callAOP.addBefore(e)}static addAfterCall(e){this.callAOP.addAfter(e)}static addBeforeExecution(e){this.executionAOP.addBefore(e)}static addAfterExecution(e){this.executionAOP.addAfter(e)}static checkDefaultConfig(e){if(c(e,Object),\"string\"!=typeof e.name)throw new o.Error(\"invalid-config\",'You must provide a \"name\" property to your mutation config.')}addBeforeCall(e){this.callAOP.addBefore(e)}addAfterCall(e){this.callAOP.addAfter(e)}addBeforeExecution(e){this.executionAOP.addBefore(e)}addAfterExecution(e){this.executionAOP.addAfter(e)}run(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=this.config,n={config:a,params:e};i.callAOP.executeBefores(n),this.callAOP.executeBefores(n);const{name:c,params:r}=a;return new s((n,r)=>{o.apply(c,[e],t,(t,o)=>{const c={config:a,params:e,result:o,error:t};i.callAOP.executeAfters(c),this.callAOP.executeAfters(c),t?r(t):n(o)})})}setHandler(e){const t=this.config,{name:a,params:n}=t,r=this;o.methods({[a](){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.params&&c(a,t.params);let o={context:this,config:t,params:a},n,s;i.executionAOP.executeBefores(o),r.executionAOP.executeBefores(o);try{s=e.call(null,this,a)}catch(e){n=e}if(o={context:this,config:t,params:a,result:s,error:n},i.executionAOP.executeAfters(o),r.executionAOP.executeAfters(o),n)throw n;return s}})}}i.callAOP=new n,i.executionAOP=new n},\"wrap.js\":function(e,t,a){let o;function n(e){return new o(e)}a.export({default:()=>n}),a.link(\"./mutation.class\",{default(e){o=e}},0)}}}}}},{extensions:[\".js\",\".json\"]})(\"/node_modules/meteor/cultofcoders:mutations/main.js\");Package._define(\"cultofcoders:mutations\",l)}();","sourcemap":"{\"version\":3,\"sources\":[\"packages/cultofcoders:mutations/main.js\",\"packages/cultofcoders:mutations/lib/aop.js\",\"packages/cultofcoders:mutations/lib/debug.js\",\"packages/cultofcoders:mutations/lib/mutation.class.js\",\"packages/cultofcoders:mutations/lib/wrap.js\"],\"names\":[\"wrap\",\"Mutation\",\"module\",\"export\",\"link\",\"default\",\"v\",\"AOP\",\"[object Object]\",\"this\",\"befores\",\"afters\",\"addBefore\",\"fn\",\"check\",\"Function\",\"push\",\"addAfter\",\"executeBefores\",\"_len\",\"arguments\",\"length\",\"args\",\"Array\",\"_key\",\"forEach\",\"call\",\"executeAfters\",\"_len2\",\"_key2\",\"exportDefault\",\"Object\",\"assign\",\"isDebugEnabled\",\"Meteor\",\"isDevelopment\",\"process\",\"env\",\"MUTATION_DEBUG_ENABLED\",\"shouldDebug\",\"config\",\"omit\",\"includes\",\"name\",\"addBeforeCall\",\"_ref\",\"params\",\"context\",\"console\",\"log\",\"concat\",\"addAfterCall\",\"_ref2\",\"result\",\"error\",\"time\",\"Date\",\"addBeforeExecution\",\"_ref3\",\"JSON\",\"stringify\",\"Match\",\"constructor\",\"checkDefaultConfig\",\"callAOP\",\"executionAOP\",\"Error\",\"addAfterExecution\",\"run\",\"callParams\",\"options\",\"undefined\",\"aopData\",\"Promise\",\"resolve\",\"reject\",\"apply\",\"setHandler\",\"self\",\"methods\",\"e\"],\"mappings\":\"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\",\"sourcesContent\":[\"import wrap from './lib/wrap';\\nimport Mutation from './lib/mutation.class';\\nimport './lib/debug';\\n\\nexport { Mutation, wrap };\\n\",\"class AOP {\\n    befores = [];\\n    afters = [];\\n\\n    addBefore(fn) {\\n        check(fn, Function);\\n\\n        this.befores.push(fn);\\n    }\\n\\n    addAfter(fn) {\\n        check(fn, Function);\\n\\n        this.afters.push(fn);\\n    }\\n\\n    executeBefores(...args) {\\n        this.befores.forEach(fn => fn.call(null, ...args));\\n    }\\n\\n    executeAfters(...args) {\\n        this.afters.forEach(fn => fn.call(null, ...args));\\n    }\\n}\\n\\nexport default AOP;\\n\",\"import Mutation from './mutation.class';\\n\\nObject.assign(Mutation, {\\n  isDebugEnabled: Meteor.isDevelopment || process.env.MUTATION_DEBUG_ENABLED,\\n});\\n\\nconst shouldDebug = (config) => {\\n  if (!Mutation.isDebugEnabled) {\\n    return false;\\n  }\\n\\n  if (Mutation.isDebugEnabled.omit) {\\n    return !Mutation.isDebugEnabled.omit.includes(config.name);\\n  }\\n\\n  return true;\\n};\\n\\nMutation.addBeforeCall(({ config, params, context }) => {\\n  if (shouldDebug(config)) {\\n    console.log(`[mutations][${config.name}] Calling with params:`, params);\\n  }\\n});\\n\\nMutation.addAfterCall(({ config, params, context, result, error }) => {\\n  if (shouldDebug(config)) {\\n    const time = new Date();\\n\\n    if (!error) {\\n      console.log(`[mutations][${config.name}] Received result:`, result);\\n    } else {\\n      console.error(`[mutations][${config.name}] Received error:`, error);\\n    }\\n  }\\n});\\n\\nMutation.addBeforeExecution(({ config, params, context }) => {\\n  if (shouldDebug(config)) {\\n    const time = new Date();\\n    console.log(`[mutations][${\\n      config.name\\n    }] Received call with params: ${JSON.stringify(params)}`);\\n  }\\n});\\n\",\"import { Meteor } from 'meteor/meteor';\\nimport AOP from './aop';\\nimport { check, Match } from 'meteor/check';\\n\\nexport default class Mutation {\\n    static callAOP = new AOP();\\n    static executionAOP = new AOP();\\n\\n    constructor(config) {\\n        Mutation.checkDefaultConfig(config);\\n\\n        this.config = config;\\n        this.callAOP = new AOP();\\n        this.executionAOP = new AOP();\\n    }\\n\\n    /**\\n     * @param {Function} fn\\n     */\\n    static addBeforeCall(fn) {\\n        this.callAOP.addBefore(fn);\\n    }\\n\\n    /**\\n     * @param {Function} fn\\n     */\\n    static addAfterCall(fn) {\\n        this.callAOP.addAfter(fn);\\n    }\\n\\n    /**\\n     * @param {Function} fn\\n     */\\n    static addBeforeExecution(fn) {\\n        this.executionAOP.addBefore(fn);\\n    }\\n\\n    /**\\n     * @param {Function} fn\\n     */\\n    static addAfterExecution(fn) {\\n        this.executionAOP.addAfter(fn);\\n    }\\n\\n    /**\\n     * @param {Object} config\\n     */\\n    static checkDefaultConfig(config) {\\n        check(config, Object);\\n        if (typeof config.name !== 'string') {\\n            throw new Meteor.Error(\\n                'invalid-config',\\n                'You must provide a \\\"name\\\" property to your mutation config.'\\n            );\\n        }\\n    }\\n\\n    /**\\n     * @param {Function} fn\\n     */\\n    addBeforeCall(fn) {\\n        this.callAOP.addBefore(fn);\\n    }\\n\\n    /**\\n     * @param {Function} fn\\n     */\\n    addAfterCall(fn) {\\n        this.callAOP.addAfter(fn);\\n    }\\n\\n    /**\\n     * @param {Function} fn\\n     */\\n    addBeforeExecution(fn) {\\n        this.executionAOP.addBefore(fn);\\n    }\\n\\n    /**\\n     * @param {Function} fn\\n     */\\n    addAfterExecution(fn) {\\n        this.executionAOP.addAfter(fn);\\n    }\\n\\n    /**\\n     * Runs the mutation inside a promise\\n     * @param {Object} callParams\\n     * @param {Object} options Meteor options https://docs.meteor.com/api/methods.html#Meteor-apply\\n     * @returns {Promise}\\n     */\\n    run(callParams, options = {}) {\\n        const config = this.config;\\n\\n        const aopData = { config, params: callParams };\\n        Mutation.callAOP.executeBefores(aopData);\\n        this.callAOP.executeBefores(aopData);\\n\\n        const { name, params } = config;\\n\\n        return new Promise((resolve, reject) => {\\n            Meteor.apply(name, [callParams], options, (error, result) => {\\n                const aopData = {\\n                    config,\\n                    params: callParams,\\n                    result,\\n                    error,\\n                };\\n\\n                Mutation.callAOP.executeAfters(aopData);\\n                this.callAOP.executeAfters(aopData);\\n\\n                if (error) {\\n                    reject(error);\\n                } else {\\n                    resolve(result);\\n                }\\n            });\\n        });\\n    }\\n\\n    /**\\n     * Creates the Meteor Method and the handler for it\\n     * @param {Function} fn\\n     */\\n    setHandler(fn) {\\n        const config = this.config;\\n        const { name, params } = config;\\n        const self = this;\\n\\n        Meteor.methods({\\n            [name](params = {}) {\\n                if (config.params) {\\n                    check(params, config.params);\\n                }\\n\\n                let aopData = {\\n                    context: this,\\n                    config,\\n                    params,\\n                };\\n\\n                Mutation.executionAOP.executeBefores(aopData);\\n                self.executionAOP.executeBefores(aopData);\\n\\n                let error, result;\\n                try {\\n                    result = fn.call(null, this, params);\\n                } catch (e) {\\n                    error = e;\\n                }\\n\\n                aopData = {\\n                    context: this,\\n                    config,\\n                    params,\\n                    result,\\n                    error,\\n                };\\n\\n                Mutation.executionAOP.executeAfters(aopData);\\n                self.executionAOP.executeAfters(aopData);\\n\\n                if (error) {\\n                    throw error;\\n                }\\n\\n                return result;\\n            },\\n        });\\n    }\\n}\\n\",\"import Mutation from './mutation.class';\\n\\nexport default function wrap(config) {\\n    return new Mutation(config);\\n}\\n\"]}","minifier":"terser"}