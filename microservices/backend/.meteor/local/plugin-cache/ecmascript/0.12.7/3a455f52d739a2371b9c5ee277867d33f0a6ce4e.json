{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/Florian/dev/epotek/microservices/backend/imports/core/utils/Calculator/PropertyCalculator.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties",["flow",{}],"dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"imports/core/utils/Calculator/PropertyCalculator.js","filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/utils/Calculator/PropertyCalculator.js","inputSourceMap":{"version":3,"sources":["imports/core/utils/Calculator/PropertyCalculator.js"],"names":["getPropertyArray","getPropertyLoanArray","getPercent","getCountedArray","getMissingFieldIds","filesPercent","getMissingDocumentIds","getPropertyDocuments","MiddlewareManager","withPropertyCalculator","SuperClass","constructor","config","initPropertyCalculator","propertyMiddleware","middlewareManager","applyToAllMethods","propertyPercent","loan","structureId","property","borrowers","structure","selectStructure","propertyToCalculateWith","formArray1","formArray2","getPropAndWork","propertyValue","selectPropertyValue","propertyWork","selectStructureKey","key","getPropertyWork","selectPropertyWork","getPropertyFilesProgress","doc","fileArray","id","_id","getPropertyCompletion","selectedProperty","selectProperty","formsProgress","filesProgress","getMissingPropertyFields","getMissingPropertyDocuments","hasDetailedPropertyValue","propertyExactValue","selectPropertyKey","landValue","constructionValue","isPromotionProperty","promotionOptionId"],"mappings":"AAAA;AACA,SACEA,gBADF,EAEEC,oBAFF;AAIA,SAASC,UAAT;AACA,SAASC,eAAT,EAA0BC,kBAA1B;AACA,SACEC,YADF,EAEEC,qBAFF;AAIA,SAASC,oBAAT;AACA,OAAOC,iBAAP;AAEA,OAAO,MAAMC,sBAAsB,GAAG,CAACC,UAAU,GAAG,MAAM,EAApB,KACpC,cAAcA,UAAd,CAAyB;AACvBC,EAAAA,WAAW,CAACC,MAAD,EAAS;AAClB,UAAMA,MAAN;AACA,SAAKC,sBAAL,CAA4BD,MAA5B;AACD;;AAEDC,EAAAA,sBAAsB,CAACD,MAAD,EAAS;AAC7B,QAAIA,MAAM,IAAIA,MAAM,CAACE,kBAArB,EAAyC;AACvC,YAAMC,iBAAiB,GAAG,IAAIP,iBAAJ,CAAsB,IAAtB,CAA1B;AACAO,MAAAA,iBAAiB,CAACC,iBAAlB,CAAoC,CAACJ,MAAM,CAACE,kBAAR,CAApC;AACD;AACF;;AAEDG,EAAAA,eAAe,CAAC;AAAEC,IAAAA,IAAF;AAAQC,IAAAA,WAAR;AAAqBC,IAAAA;AAArB,GAAD,EAAkC;AAC/C,UAAM;AAAEC,MAAAA;AAAF,QAAgBH,IAAtB;AACA,UAAMI,SAAS,GAAG,KAAKC,eAAL,CAAqB;AAAEL,MAAAA,IAAF;AAAQC,MAAAA;AAAR,KAArB,CAAlB;AACA,UAAMK,uBAAuB,GAAGJ,QAAQ,IAAIE,SAAS,CAACF,QAAtD;;AAEA,QAAI,CAACI,uBAAL,EAA8B;AAC5B,aAAO,CAAP;AACD;;AAED,UAAMC,UAAU,GAAGzB,gBAAgB,CAAC;AAClCkB,MAAAA,IADkC;AAElCG,MAAAA,SAFkC;AAGlCD,MAAAA,QAAQ,EAAEI;AAHwB,KAAD,CAAnC;AAKA,UAAME,UAAU,GAAGzB,oBAAoB,CAAC;AACtCiB,MAAAA,IADsC;AAEtCG,MAAAA,SAFsC;AAGtCD,MAAAA,QAAQ,EAAEI;AAH4B,KAAD,CAAvC;AAMA,WAAOtB,UAAU,CAAC,CAChB,GAAGC,eAAe,CAACsB,UAAD,EAAaD,uBAAb,CADF,EAEhB,GAAGrB,eAAe,CAACuB,UAAD,EAAaR,IAAb,CAFF,CAAD,CAAjB;AAID;;AAEDS,EAAAA,cAAc,CAAC;AAAET,IAAAA,IAAF;AAAQC,IAAAA;AAAR,GAAD,EAAwB;AACpC,UAAMS,aAAa,GAAG,KAAKC,mBAAL,CAAyB;AAAEX,MAAAA,IAAF;AAAQC,MAAAA;AAAR,KAAzB,CAAtB;AACA,UAAMW,YAAY,GAAG,KAAKC,kBAAL,CAAwB;AAC3Cb,MAAAA,IAD2C;AAE3CC,MAAAA,WAF2C;AAG3Ca,MAAAA,GAAG,EAAE;AAHsC,KAAxB,KAIf,CAJN;AAKA,WAAO,MAAML,cAAN,CAAqB;AAAEC,MAAAA,aAAF;AAAiBE,MAAAA;AAAjB,KAArB,CAAP;AACD;;AAEDG,EAAAA,eAAe,CAAC;AAAEf,IAAAA,IAAF;AAAQC,IAAAA;AAAR,GAAD,EAAwB;AACrC,WAAO,KAAKe,kBAAL,CAAwB;AAAEhB,MAAAA,IAAF;AAAQC,MAAAA;AAAR,KAAxB,CAAP;AACD;;AAEDgB,EAAAA,wBAAwB,CAAC;AAAEjB,IAAAA,IAAF;AAAQC,IAAAA,WAAR;AAAqBC,IAAAA;AAArB,GAAD,EAAkC;AACxD,UAAME,SAAS,GAAG,KAAKC,eAAL,CAAqB;AAAEL,MAAAA,IAAF;AAAQC,MAAAA;AAAR,KAArB,CAAlB;AACA,UAAMK,uBAAuB,GAAGJ,QAAQ,IAAIE,SAAS,CAACF,QAAtD;;AAEA,QAAI,CAACI,uBAAL,EAA8B;AAC5B,aAAO,CAAP;AACD;;AAED,WAAOnB,YAAY,CAAC;AAClB+B,MAAAA,GAAG,EAAEZ,uBADa;AAElBa,MAAAA,SAAS,EAAE9B,oBAAoB,CAAC;AAC9BW,QAAAA,IAD8B;AAE9BoB,QAAAA,EAAE,EAAEd,uBAAuB,CAACe;AAFE,OAAD;AAFb,KAAD,CAAnB;AAOD;;AAEDC,EAAAA,qBAAqB,CAAC;AAAEtB,IAAAA,IAAF;AAAQC,IAAAA,WAAR;AAAqBC,IAAAA;AAArB,GAAD,EAAkC;AACrD,UAAM;AAAEC,MAAAA;AAAF,QAAgBH,IAAtB;AACA,UAAMuB,gBAAgB,GAAG,KAAKC,cAAL,CAAoB;AAAExB,MAAAA,IAAF;AAAQC,MAAAA;AAAR,KAApB,CAAzB;AACA,UAAMK,uBAAuB,GAAGJ,QAAQ,IAAIqB,gBAA5C;AAEA,UAAME,aAAa,GAAG,KAAK1B,eAAL,CAAqB;AACzCC,MAAAA,IADyC;AAEzCG,MAAAA,SAFyC;AAGzCD,MAAAA,QAAQ,EAAEI;AAH+B,KAArB,CAAtB;AAKA,UAAMoB,aAAa,GAAG,KAAKT,wBAAL,CAA8B;AAClDjB,MAAAA,IADkD;AAElDE,MAAAA,QAAQ,EAAEI;AAFwC,KAA9B,CAAtB;AAKA,WAAO,CAACmB,aAAa,GAAGC,aAAjB,IAAkC,CAAzC;AACD;;AAEDC,EAAAA,wBAAwB,CAAC;AAAE3B,IAAAA,IAAF;AAAQC,IAAAA,WAAR;AAAqBC,IAAAA;AAArB,GAAD,EAAkC;AACxD,UAAM;AAAEC,MAAAA;AAAF,QAAgBH,IAAtB;AACA,UAAMuB,gBAAgB,GAAG,KAAKC,cAAL,CAAoB;AAAExB,MAAAA,IAAF;AAAQC,MAAAA;AAAR,KAApB,CAAzB;AAEA,UAAMK,uBAAuB,GAAGJ,QAAQ,IAAIqB,gBAA5C;AAEA,UAAMhB,UAAU,GAAGzB,gBAAgB,CAAC;AAClCkB,MAAAA,IADkC;AAElCG,MAAAA,SAFkC;AAGlCD,MAAAA,QAAQ,EAAEI;AAHwB,KAAD,CAAnC;AAKA,UAAME,UAAU,GAAGzB,oBAAoB,CAAC;AACtCiB,MAAAA,IADsC;AAEtCG,MAAAA,SAFsC;AAGtCD,MAAAA,QAAQ,EAAEI;AAH4B,KAAD,CAAvC;AAMA,WAAO,CACL,GAAGpB,kBAAkB,CAACqB,UAAD,EAAaD,uBAAb,CADhB,EAEL,GAAGpB,kBAAkB,CAACsB,UAAD,EAAaR,IAAb,CAFhB,CAAP;AAID;;AAED4B,EAAAA,2BAA2B,CAAC;AAAE5B,IAAAA,IAAF;AAAQC,IAAAA,WAAR;AAAqBC,IAAAA;AAArB,GAAD,EAAkC;AAC3D,UAAMqB,gBAAgB,GAAG,KAAKC,cAAL,CAAoB;AAAExB,MAAAA,IAAF;AAAQC,MAAAA;AAAR,KAApB,CAAzB;AACA,UAAMK,uBAAuB,GAAGJ,QAAQ,IAAIqB,gBAA5C;AAEA,WAAOnC,qBAAqB,CAAC;AAC3B8B,MAAAA,GAAG,EAAEZ,uBADsB;AAE3Ba,MAAAA,SAAS,EAAE9B,oBAAoB,CAAC;AAC9BW,QAAAA,IAD8B;AAE9BoB,QAAAA,EAAE,EAAEd,uBAAuB,CAACe;AAFE,OAAD;AAFJ,KAAD,CAA5B;AAOD;;AAEDQ,EAAAA,wBAAwB,CAAC;AAAE7B,IAAAA,IAAF;AAAQC,IAAAA;AAAR,GAAD,EAAwB;AAC9C,UAAM6B,kBAAkB,GAAG,KAAKC,iBAAL,CAAuB;AAChDjB,MAAAA,GAAG,EAAE,OAD2C;AAEhDd,MAAAA,IAFgD;AAGhDC,MAAAA;AAHgD,KAAvB,CAA3B;AAKA,UAAM+B,SAAS,GAAG,KAAKD,iBAAL,CAAuB;AACvCjB,MAAAA,GAAG,EAAE,WADkC;AAEvCd,MAAAA,IAFuC;AAGvCC,MAAAA;AAHuC,KAAvB,CAAlB;AAKA,UAAMgC,iBAAiB,GAAG,KAAKF,iBAAL,CAAuB;AAC/CjB,MAAAA,GAAG,EAAE,mBAD0C;AAE/Cd,MAAAA,IAF+C;AAG/CC,MAAAA;AAH+C,KAAvB,CAA1B;AAMA,WAAO,CAAC6B,kBAAD,IAAuB,CAAC,EAAEE,SAAS,IAAIC,iBAAf,CAA/B;AACD;;AAEDC,EAAAA,mBAAmB,CAAC;AAAElC,IAAAA,IAAF;AAAQC,IAAAA;AAAR,GAAD,EAAwB;AACzC,UAAMG,SAAS,GAAG,KAAKC,eAAL,CAAqB;AAAEL,MAAAA,IAAF;AAAQC,MAAAA;AAAR,KAArB,CAAlB;AACA,WAAO,CAAC,CAACG,SAAS,CAAC+B,iBAAnB;AACD;;AAnJsB,CADpB","sourcesContent":["// @flow\nimport {\n  getPropertyArray,\n  getPropertyLoanArray,\n} from '../../arrays/PropertyFormArray';\nimport { getPercent } from '../general';\nimport { getCountedArray, getMissingFieldIds } from '../formArrayHelpers';\nimport {\n  filesPercent,\n  getMissingDocumentIds,\n} from '../../api/files/fileHelpers';\nimport { getPropertyDocuments } from '../../api/files/documents';\nimport MiddlewareManager from '../MiddlewareManager';\n\nexport const withPropertyCalculator = (SuperClass = class {}) =>\n  class extends SuperClass {\n    constructor(config) {\n      super(config);\n      this.initPropertyCalculator(config);\n    }\n\n    initPropertyCalculator(config) {\n      if (config && config.propertyMiddleware) {\n        const middlewareManager = new MiddlewareManager(this);\n        middlewareManager.applyToAllMethods([config.propertyMiddleware]);\n      }\n    }\n\n    propertyPercent({ loan, structureId, property }) {\n      const { borrowers } = loan;\n      const structure = this.selectStructure({ loan, structureId });\n      const propertyToCalculateWith = property || structure.property;\n\n      if (!propertyToCalculateWith) {\n        return 0;\n      }\n\n      const formArray1 = getPropertyArray({\n        loan,\n        borrowers,\n        property: propertyToCalculateWith,\n      });\n      const formArray2 = getPropertyLoanArray({\n        loan,\n        borrowers,\n        property: propertyToCalculateWith,\n      });\n\n      return getPercent([\n        ...getCountedArray(formArray1, propertyToCalculateWith),\n        ...getCountedArray(formArray2, loan),\n      ]);\n    }\n\n    getPropAndWork({ loan, structureId }) {\n      const propertyValue = this.selectPropertyValue({ loan, structureId });\n      const propertyWork = this.selectStructureKey({\n        loan,\n        structureId,\n        key: 'propertyWork',\n      }) || 0;\n      return super.getPropAndWork({ propertyValue, propertyWork });\n    }\n\n    getPropertyWork({ loan, structureId }) {\n      return this.selectPropertyWork({ loan, structureId });\n    }\n\n    getPropertyFilesProgress({ loan, structureId, property }) {\n      const structure = this.selectStructure({ loan, structureId });\n      const propertyToCalculateWith = property || structure.property;\n\n      if (!propertyToCalculateWith) {\n        return 0;\n      }\n\n      return filesPercent({\n        doc: propertyToCalculateWith,\n        fileArray: getPropertyDocuments({\n          loan,\n          id: propertyToCalculateWith._id,\n        }),\n      });\n    }\n\n    getPropertyCompletion({ loan, structureId, property }) {\n      const { borrowers } = loan;\n      const selectedProperty = this.selectProperty({ loan, structureId });\n      const propertyToCalculateWith = property || selectedProperty;\n\n      const formsProgress = this.propertyPercent({\n        loan,\n        borrowers,\n        property: propertyToCalculateWith,\n      });\n      const filesProgress = this.getPropertyFilesProgress({\n        loan,\n        property: propertyToCalculateWith,\n      });\n\n      return (formsProgress + filesProgress) / 2;\n    }\n\n    getMissingPropertyFields({ loan, structureId, property }) {\n      const { borrowers } = loan;\n      const selectedProperty = this.selectProperty({ loan, structureId });\n\n      const propertyToCalculateWith = property || selectedProperty;\n\n      const formArray1 = getPropertyArray({\n        loan,\n        borrowers,\n        property: propertyToCalculateWith,\n      });\n      const formArray2 = getPropertyLoanArray({\n        loan,\n        borrowers,\n        property: propertyToCalculateWith,\n      });\n\n      return [\n        ...getMissingFieldIds(formArray1, propertyToCalculateWith),\n        ...getMissingFieldIds(formArray2, loan),\n      ];\n    }\n\n    getMissingPropertyDocuments({ loan, structureId, property }) {\n      const selectedProperty = this.selectProperty({ loan, structureId });\n      const propertyToCalculateWith = property || selectedProperty;\n\n      return getMissingDocumentIds({\n        doc: propertyToCalculateWith,\n        fileArray: getPropertyDocuments({\n          loan,\n          id: propertyToCalculateWith._id,\n        }),\n      });\n    }\n\n    hasDetailedPropertyValue({ loan, structureId }) {\n      const propertyExactValue = this.selectPropertyKey({\n        key: 'value',\n        loan,\n        structureId,\n      });\n      const landValue = this.selectPropertyKey({\n        key: 'landValue',\n        loan,\n        structureId,\n      });\n      const constructionValue = this.selectPropertyKey({\n        key: 'constructionValue',\n        loan,\n        structureId,\n      });\n\n      return !propertyExactValue || !!(landValue && constructionValue);\n    }\n\n    isPromotionProperty({ loan, structureId }) {\n      const structure = this.selectStructure({ loan, structureId });\n      return !!structure.promotionOptionId;\n    }\n  };\n"]},"passPerPreset":false,"envName":"development","cwd":"/Users/Florian/dev/epotek/microservices/backend","root":"/Users/Florian/dev/epotek/microservices/backend","plugins":[{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/utils/Calculator/PropertyCalculator.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/core/utils/Calculator/PropertyCalculator.js"}},"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _inheritsLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inheritsLoose\"));\n\nmodule.export({\n  withPropertyCalculator: function () {\n    return withPropertyCalculator;\n  }\n});\nvar getPropertyArray, getPropertyLoanArray;\nmodule.link(\"../../arrays/PropertyFormArray\", {\n  getPropertyArray: function (v) {\n    getPropertyArray = v;\n  },\n  getPropertyLoanArray: function (v) {\n    getPropertyLoanArray = v;\n  }\n}, 0);\nvar getPercent;\nmodule.link(\"../general\", {\n  getPercent: function (v) {\n    getPercent = v;\n  }\n}, 1);\nvar getCountedArray, getMissingFieldIds;\nmodule.link(\"../formArrayHelpers\", {\n  getCountedArray: function (v) {\n    getCountedArray = v;\n  },\n  getMissingFieldIds: function (v) {\n    getMissingFieldIds = v;\n  }\n}, 2);\nvar filesPercent, getMissingDocumentIds;\nmodule.link(\"../../api/files/fileHelpers\", {\n  filesPercent: function (v) {\n    filesPercent = v;\n  },\n  getMissingDocumentIds: function (v) {\n    getMissingDocumentIds = v;\n  }\n}, 3);\nvar getPropertyDocuments;\nmodule.link(\"../../api/files/documents\", {\n  getPropertyDocuments: function (v) {\n    getPropertyDocuments = v;\n  }\n}, 4);\nvar MiddlewareManager;\nmodule.link(\"../MiddlewareManager\", {\n  \"default\": function (v) {\n    MiddlewareManager = v;\n  }\n}, 5);\n\nvar withPropertyCalculator = function () {\n  var SuperClass = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] :\n  /*#__PURE__*/\n  function () {\n    function _class() {}\n\n    return _class;\n  }();\n  return (\n    /*#__PURE__*/\n    function (_SuperClass) {\n      (0, _inheritsLoose2.default)(_class2, _SuperClass);\n\n      function _class2(config) {\n        var _this;\n\n        _this = _SuperClass.call(this, config) || this;\n\n        _this.initPropertyCalculator(config);\n\n        return _this;\n      }\n\n      var _proto = _class2.prototype;\n\n      _proto.initPropertyCalculator = function () {\n        function initPropertyCalculator(config) {\n          if (config && config.propertyMiddleware) {\n            var middlewareManager = new MiddlewareManager(this);\n            middlewareManager.applyToAllMethods([config.propertyMiddleware]);\n          }\n        }\n\n        return initPropertyCalculator;\n      }();\n\n      _proto.propertyPercent = function () {\n        function propertyPercent(_ref) {\n          var loan = _ref.loan,\n              structureId = _ref.structureId,\n              property = _ref.property;\n          var borrowers = loan.borrowers;\n          var structure = this.selectStructure({\n            loan: loan,\n            structureId: structureId\n          });\n          var propertyToCalculateWith = property || structure.property;\n\n          if (!propertyToCalculateWith) {\n            return 0;\n          }\n\n          var formArray1 = getPropertyArray({\n            loan: loan,\n            borrowers: borrowers,\n            property: propertyToCalculateWith\n          });\n          var formArray2 = getPropertyLoanArray({\n            loan: loan,\n            borrowers: borrowers,\n            property: propertyToCalculateWith\n          });\n          return getPercent([].concat((0, _toConsumableArray2.default)(getCountedArray(formArray1, propertyToCalculateWith)), (0, _toConsumableArray2.default)(getCountedArray(formArray2, loan))));\n        }\n\n        return propertyPercent;\n      }();\n\n      _proto.getPropAndWork = function () {\n        function getPropAndWork(_ref2) {\n          var loan = _ref2.loan,\n              structureId = _ref2.structureId;\n          var propertyValue = this.selectPropertyValue({\n            loan: loan,\n            structureId: structureId\n          });\n          var propertyWork = this.selectStructureKey({\n            loan: loan,\n            structureId: structureId,\n            key: 'propertyWork'\n          }) || 0;\n          return _SuperClass.prototype.getPropAndWork.call(this, {\n            propertyValue: propertyValue,\n            propertyWork: propertyWork\n          });\n        }\n\n        return getPropAndWork;\n      }();\n\n      _proto.getPropertyWork = function () {\n        function getPropertyWork(_ref3) {\n          var loan = _ref3.loan,\n              structureId = _ref3.structureId;\n          return this.selectPropertyWork({\n            loan: loan,\n            structureId: structureId\n          });\n        }\n\n        return getPropertyWork;\n      }();\n\n      _proto.getPropertyFilesProgress = function () {\n        function getPropertyFilesProgress(_ref4) {\n          var loan = _ref4.loan,\n              structureId = _ref4.structureId,\n              property = _ref4.property;\n          var structure = this.selectStructure({\n            loan: loan,\n            structureId: structureId\n          });\n          var propertyToCalculateWith = property || structure.property;\n\n          if (!propertyToCalculateWith) {\n            return 0;\n          }\n\n          return filesPercent({\n            doc: propertyToCalculateWith,\n            fileArray: getPropertyDocuments({\n              loan: loan,\n              id: propertyToCalculateWith._id\n            })\n          });\n        }\n\n        return getPropertyFilesProgress;\n      }();\n\n      _proto.getPropertyCompletion = function () {\n        function getPropertyCompletion(_ref5) {\n          var loan = _ref5.loan,\n              structureId = _ref5.structureId,\n              property = _ref5.property;\n          var borrowers = loan.borrowers;\n          var selectedProperty = this.selectProperty({\n            loan: loan,\n            structureId: structureId\n          });\n          var propertyToCalculateWith = property || selectedProperty;\n          var formsProgress = this.propertyPercent({\n            loan: loan,\n            borrowers: borrowers,\n            property: propertyToCalculateWith\n          });\n          var filesProgress = this.getPropertyFilesProgress({\n            loan: loan,\n            property: propertyToCalculateWith\n          });\n          return (formsProgress + filesProgress) / 2;\n        }\n\n        return getPropertyCompletion;\n      }();\n\n      _proto.getMissingPropertyFields = function () {\n        function getMissingPropertyFields(_ref6) {\n          var loan = _ref6.loan,\n              structureId = _ref6.structureId,\n              property = _ref6.property;\n          var borrowers = loan.borrowers;\n          var selectedProperty = this.selectProperty({\n            loan: loan,\n            structureId: structureId\n          });\n          var propertyToCalculateWith = property || selectedProperty;\n          var formArray1 = getPropertyArray({\n            loan: loan,\n            borrowers: borrowers,\n            property: propertyToCalculateWith\n          });\n          var formArray2 = getPropertyLoanArray({\n            loan: loan,\n            borrowers: borrowers,\n            property: propertyToCalculateWith\n          });\n          return [].concat((0, _toConsumableArray2.default)(getMissingFieldIds(formArray1, propertyToCalculateWith)), (0, _toConsumableArray2.default)(getMissingFieldIds(formArray2, loan)));\n        }\n\n        return getMissingPropertyFields;\n      }();\n\n      _proto.getMissingPropertyDocuments = function () {\n        function getMissingPropertyDocuments(_ref7) {\n          var loan = _ref7.loan,\n              structureId = _ref7.structureId,\n              property = _ref7.property;\n          var selectedProperty = this.selectProperty({\n            loan: loan,\n            structureId: structureId\n          });\n          var propertyToCalculateWith = property || selectedProperty;\n          return getMissingDocumentIds({\n            doc: propertyToCalculateWith,\n            fileArray: getPropertyDocuments({\n              loan: loan,\n              id: propertyToCalculateWith._id\n            })\n          });\n        }\n\n        return getMissingPropertyDocuments;\n      }();\n\n      _proto.hasDetailedPropertyValue = function () {\n        function hasDetailedPropertyValue(_ref8) {\n          var loan = _ref8.loan,\n              structureId = _ref8.structureId;\n          var propertyExactValue = this.selectPropertyKey({\n            key: 'value',\n            loan: loan,\n            structureId: structureId\n          });\n          var landValue = this.selectPropertyKey({\n            key: 'landValue',\n            loan: loan,\n            structureId: structureId\n          });\n          var constructionValue = this.selectPropertyKey({\n            key: 'constructionValue',\n            loan: loan,\n            structureId: structureId\n          });\n          return !propertyExactValue || !!(landValue && constructionValue);\n        }\n\n        return hasDetailedPropertyValue;\n      }();\n\n      _proto.isPromotionProperty = function () {\n        function isPromotionProperty(_ref9) {\n          var loan = _ref9.loan,\n              structureId = _ref9.structureId;\n          var structure = this.selectStructure({\n            loan: loan,\n            structureId: structureId\n          });\n          return !!structure.promotionOptionId;\n        }\n\n        return isPromotionProperty;\n      }();\n\n      return _class2;\n    }(SuperClass)\n  );\n};","map":{"version":3,"sources":["imports/core/utils/Calculator/PropertyCalculator.js"],"names":["withPropertyCalculator","constructor","initPropertyCalculator","config","middlewareManager","propertyPercent","property","borrowers","structure","loan","structureId","propertyToCalculateWith","formArray1","getPropertyArray","formArray2","getPropertyLoanArray","getPercent","getCountedArray","getPropAndWork","propertyValue","propertyWork","key","getPropertyWork","getPropertyFilesProgress","filesPercent","doc","fileArray","getPropertyDocuments","id","_id","getPropertyCompletion","selectedProperty","formsProgress","filesProgress","getMissingPropertyFields","getMissingFieldIds","getMissingPropertyDocuments","getMissingDocumentIds","hasDetailedPropertyValue","propertyExactValue","landValue","constructionValue","isPromotionProperty"],"mappings":";;;;;;AAAA,MAAA,CAAA,MAAA,CAAA;AAAA,EAAA,sBAAA,EAAA;AAAA,WAAA,sBAAA;AAAA;AAAA,CAAA;AAAA,IAAA,gBAAA,EAAA,oBAAA;AAAA,MAAA,CAAA,IAAA,CAAA,gCAAA,EAAA;AAAA,EAAA,gBAAA,YAAA,CAAA,EAAA;AAAA,IAAA,gBAAA,GAAA,CAAA;AAAA,GAAA;AAAA,EAAA,oBAAA,YAAA,CAAA,EAAA;AAAA,IAAA,oBAAA,GAAA,CAAA;AAAA;AAAA,CAAA,EAAA,CAAA;AAAA,IAAA,UAAA;AAAA,MAAA,CAAA,IAAA,CAAA,YAAA,EAAA;AAAA,EAAA,UAAA,YAAA,CAAA,EAAA;AAAA,IAAA,UAAA,GAAA,CAAA;AAAA;AAAA,CAAA,EAAA,CAAA;AAAA,IAAA,eAAA,EAAA,kBAAA;AAAA,MAAA,CAAA,IAAA,CAAA,qBAAA,EAAA;AAAA,EAAA,eAAA,YAAA,CAAA,EAAA;AAAA,IAAA,eAAA,GAAA,CAAA;AAAA,GAAA;AAAA,EAAA,kBAAA,YAAA,CAAA,EAAA;AAAA,IAAA,kBAAA,GAAA,CAAA;AAAA;AAAA,CAAA,EAAA,CAAA;AAAA,IAAA,YAAA,EAAA,qBAAA;AAAA,MAAA,CAAA,IAAA,CAAA,6BAAA,EAAA;AAAA,EAAA,YAAA,YAAA,CAAA,EAAA;AAAA,IAAA,YAAA,GAAA,CAAA;AAAA,GAAA;AAAA,EAAA,qBAAA,YAAA,CAAA,EAAA;AAAA,IAAA,qBAAA,GAAA,CAAA;AAAA;AAAA,CAAA,EAAA,CAAA;AAAA,IAAA,oBAAA;AAAA,MAAA,CAAA,IAAA,CAAA,2BAAA,EAAA;AAAA,EAAA,oBAAA,YAAA,CAAA,EAAA;AAAA,IAAA,oBAAA,GAAA,CAAA;AAAA;AAAA,CAAA,EAAA,CAAA;AAAA,IAAA,iBAAA;AAAA,MAAA,CAAA,IAAA,CAAA,sBAAA,EAAA;AAAA,uBAAA,CAAA,EAAA;AAAA,IAAA,iBAAA,GAAA,CAAA;AAAA;AAAA,CAAA,EAAA,CAAA;;AAcO,IAAMA,sBAAsB,GAAG;AAAA,MAAA,UAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAElCC,uBAAW,MAAXA,EAAoB;AAAA;;AAClB,uCAAA,MAAA;;AACA,cAAA,sBAAA,CAAA,MAAA;;AAFkB;AAGnB;;AALiC;;AAAA,aAOlCC,sBAPkC;AAOlCA,wCAAsB,MAAtBA,EAA+B;AAC7B,cAAIC,MAAM,IAAIA,MAAM,CAApB,kBAAA,EAAyC;AACvC,gBAAMC,iBAAiB,GAAG,IAAA,iBAAA,CAA1B,IAA0B,CAA1B;AACAA,YAAAA,iBAAiB,CAAjBA,iBAAAA,CAAoC,CAACD,MAAM,CAA3CC,kBAAoC,CAApCA;AACD;AACF;;AAZiC;AAAA;;AAAA,aAclCC,eAdkC;AAclCA,uCAAiD;AAAA,cAAjC,IAAiC,QAAjC,IAAiC;AAAA,cAAjC,WAAiC,QAAjC,WAAiC;AAAA,cAAZC,QAAY,QAAZA,QAAY;AAAA,cACvCC,SADuC,GAC/C,IAD+C,CACvCA,SADuC;AAE/C,cAAMC,SAAS,GAAG,KAAA,eAAA,CAAqB;AAAEC,YAAAA,IAAF,EAAEA,IAAF;AAAQC,YAAAA,WAAAA,EAAAA;AAAR,WAArB,CAAlB;AACA,cAAMC,uBAAuB,GAAGL,QAAQ,IAAIE,SAAS,CAArD,QAAA;;AAEA,cAAI,CAAJ,uBAAA,EAA8B;AAC5B,mBAAA,CAAA;AACD;;AAED,cAAMI,UAAU,GAAGC,gBAAgB,CAAC;AAClCJ,YAAAA,IADkC,EAClCA,IADkC;AAElCF,YAAAA,SAFkC,EAElCA,SAFkC;AAGlCD,YAAAA,QAAQ,EAAEK;AAHwB,WAAD,CAAnC;AAKA,cAAMG,UAAU,GAAGC,oBAAoB,CAAC;AACtCN,YAAAA,IADsC,EACtCA,IADsC;AAEtCF,YAAAA,SAFsC,EAEtCA,SAFsC;AAGtCD,YAAAA,QAAQ,EAAEK;AAH4B,WAAD,CAAvC;AAMA,iBAAOK,UAAU,4CACZC,eAAe,CAAA,UAAA,EADF,uBACE,CADH,oCAEZA,eAAe,CAAA,UAAA,EAFpB,IAEoB,CAFH,GAAjB;AAID;;AAtCiC;AAAA;;AAAA,aAwClCC,cAxCkC;AAwClCA,uCAAsC;AAAA,cAAvB,IAAuB,SAAvB,IAAuB;AAAA,cAAfR,WAAe,SAAfA,WAAe;AACpC,cAAMS,aAAa,GAAG,KAAA,mBAAA,CAAyB;AAAEV,YAAAA,IAAF,EAAEA,IAAF;AAAQC,YAAAA,WAAAA,EAAAA;AAAR,WAAzB,CAAtB;AACA,cAAMU,YAAY,GAAG,KAAA,kBAAA,CAAwB;AAC3CX,YAAAA,IAD2C,EAC3CA,IAD2C;AAE3CC,YAAAA,WAF2C,EAE3CA,WAF2C;AAG3CW,YAAAA,GAAG,EAAE;AAHsC,WAAxB,KAArB,CAAA;AAKA,uCAAO,cAAP,YAA4B;AAAEF,YAAAA,aAAF,EAAEA,aAAF;AAAiBC,YAAAA,YAAAA,EAAAA;AAAjB,WAA5B;AACD;;AAhDiC;AAAA;;AAAA,aAkDlCE,eAlDkC;AAkDlCA,wCAAuC;AAAA,cAAvB,IAAuB,SAAvB,IAAuB;AAAA,cAAfZ,WAAe,SAAfA,WAAe;AACrC,iBAAO,KAAA,kBAAA,CAAwB;AAAED,YAAAA,IAAF,EAAEA,IAAF;AAAQC,YAAAA,WAAAA,EAAAA;AAAR,WAAxB,CAAP;AACD;;AApDiC;AAAA;;AAAA,aAsDlCa,wBAtDkC;AAsDlCA,iDAA0D;AAAA,cAAjC,IAAiC,SAAjC,IAAiC;AAAA,cAAjC,WAAiC,SAAjC,WAAiC;AAAA,cAAZjB,QAAY,SAAZA,QAAY;AACxD,cAAME,SAAS,GAAG,KAAA,eAAA,CAAqB;AAAEC,YAAAA,IAAF,EAAEA,IAAF;AAAQC,YAAAA,WAAAA,EAAAA;AAAR,WAArB,CAAlB;AACA,cAAMC,uBAAuB,GAAGL,QAAQ,IAAIE,SAAS,CAArD,QAAA;;AAEA,cAAI,CAAJ,uBAAA,EAA8B;AAC5B,mBAAA,CAAA;AACD;;AAED,iBAAOgB,YAAY,CAAC;AAClBC,YAAAA,GAAG,EADe,uBAAA;AAElBC,YAAAA,SAAS,EAAEC,oBAAoB,CAAC;AAC9BlB,cAAAA,IAD8B,EAC9BA,IAD8B;AAE9BmB,cAAAA,EAAE,EAAEjB,uBAAuB,CAACkB;AAFE,aAAD;AAFb,WAAD,CAAnB;AAOD;;AArEiC;AAAA;;AAAA,aAuElCC,qBAvEkC;AAuElCA,8CAAuD;AAAA,cAAjC,IAAiC,SAAjC,IAAiC;AAAA,cAAjC,WAAiC,SAAjC,WAAiC;AAAA,cAAZxB,QAAY,SAAZA,QAAY;AAAA,cAC7CC,SAD6C,GACrD,IADqD,CAC7CA,SAD6C;AAErD,cAAMwB,gBAAgB,GAAG,KAAA,cAAA,CAAoB;AAAEtB,YAAAA,IAAF,EAAEA,IAAF;AAAQC,YAAAA,WAAAA,EAAAA;AAAR,WAApB,CAAzB;AACA,cAAMC,uBAAuB,GAAGL,QAAQ,IAAxC,gBAAA;AAEA,cAAM0B,aAAa,GAAG,KAAA,eAAA,CAAqB;AACzCvB,YAAAA,IADyC,EACzCA,IADyC;AAEzCF,YAAAA,SAFyC,EAEzCA,SAFyC;AAGzCD,YAAAA,QAAQ,EAAEK;AAH+B,WAArB,CAAtB;AAKA,cAAMsB,aAAa,GAAG,KAAA,wBAAA,CAA8B;AAClDxB,YAAAA,IADkD,EAClDA,IADkD;AAElDH,YAAAA,QAAQ,EAAEK;AAFwC,WAA9B,CAAtB;AAKA,iBAAO,CAACqB,aAAa,GAAd,aAAA,IAAP,CAAA;AACD;;AAvFiC;AAAA;;AAAA,aAyFlCE,wBAzFkC;AAyFlCA,iDAA0D;AAAA,cAAjC,IAAiC,SAAjC,IAAiC;AAAA,cAAjC,WAAiC,SAAjC,WAAiC;AAAA,cAAZ5B,QAAY,SAAZA,QAAY;AAAA,cAChDC,SADgD,GACxD,IADwD,CAChDA,SADgD;AAExD,cAAMwB,gBAAgB,GAAG,KAAA,cAAA,CAAoB;AAAEtB,YAAAA,IAAF,EAAEA,IAAF;AAAQC,YAAAA,WAAAA,EAAAA;AAAR,WAApB,CAAzB;AAEA,cAAMC,uBAAuB,GAAGL,QAAQ,IAAxC,gBAAA;AAEA,cAAMM,UAAU,GAAGC,gBAAgB,CAAC;AAClCJ,YAAAA,IADkC,EAClCA,IADkC;AAElCF,YAAAA,SAFkC,EAElCA,SAFkC;AAGlCD,YAAAA,QAAQ,EAAEK;AAHwB,WAAD,CAAnC;AAKA,cAAMG,UAAU,GAAGC,oBAAoB,CAAC;AACtCN,YAAAA,IADsC,EACtCA,IADsC;AAEtCF,YAAAA,SAFsC,EAEtCA,SAFsC;AAGtCD,YAAAA,QAAQ,EAAEK;AAH4B,WAAD,CAAvC;AAMA,4DACKwB,kBAAkB,CAAA,UAAA,EADhB,uBACgB,CADvB,oCAEKA,kBAAkB,CAAA,UAAA,EAFvB,IAEuB,CAFvB;AAID;;AA9GiC;AAAA;;AAAA,aAgHlCC,2BAhHkC;AAgHlCA,oDAA6D;AAAA,cAAjC,IAAiC,SAAjC,IAAiC;AAAA,cAAjC,WAAiC,SAAjC,WAAiC;AAAA,cAAZ9B,QAAY,SAAZA,QAAY;AAC3D,cAAMyB,gBAAgB,GAAG,KAAA,cAAA,CAAoB;AAAEtB,YAAAA,IAAF,EAAEA,IAAF;AAAQC,YAAAA,WAAAA,EAAAA;AAAR,WAApB,CAAzB;AACA,cAAMC,uBAAuB,GAAGL,QAAQ,IAAxC,gBAAA;AAEA,iBAAO+B,qBAAqB,CAAC;AAC3BZ,YAAAA,GAAG,EADwB,uBAAA;AAE3BC,YAAAA,SAAS,EAAEC,oBAAoB,CAAC;AAC9BlB,cAAAA,IAD8B,EAC9BA,IAD8B;AAE9BmB,cAAAA,EAAE,EAAEjB,uBAAuB,CAACkB;AAFE,aAAD;AAFJ,WAAD,CAA5B;AAOD;;AA3HiC;AAAA;;AAAA,aA6HlCS,wBA7HkC;AA6HlCA,iDAAgD;AAAA,cAAvB,IAAuB,SAAvB,IAAuB;AAAA,cAAf5B,WAAe,SAAfA,WAAe;AAC9C,cAAM6B,kBAAkB,GAAG,KAAA,iBAAA,CAAuB;AAChDlB,YAAAA,GAAG,EAD6C,OAAA;AAEhDZ,YAAAA,IAFgD,EAEhDA,IAFgD;AAGhDC,YAAAA,WAAAA,EAAAA;AAHgD,WAAvB,CAA3B;AAKA,cAAM8B,SAAS,GAAG,KAAA,iBAAA,CAAuB;AACvCnB,YAAAA,GAAG,EADoC,WAAA;AAEvCZ,YAAAA,IAFuC,EAEvCA,IAFuC;AAGvCC,YAAAA,WAAAA,EAAAA;AAHuC,WAAvB,CAAlB;AAKA,cAAM+B,iBAAiB,GAAG,KAAA,iBAAA,CAAuB;AAC/CpB,YAAAA,GAAG,EAD4C,mBAAA;AAE/CZ,YAAAA,IAF+C,EAE/CA,IAF+C;AAG/CC,YAAAA,WAAAA,EAAAA;AAH+C,WAAvB,CAA1B;AAMA,iBAAO,CAAA,kBAAA,IAAuB,CAAC,EAAE8B,SAAS,IAA1C,iBAA+B,CAA/B;AACD;;AA/IiC;AAAA;;AAAA,aAiJlCE,mBAjJkC;AAiJlCA,4CAA2C;AAAA,cAAvB,IAAuB,SAAvB,IAAuB;AAAA,cAAfhC,WAAe,SAAfA,WAAe;AACzC,cAAMF,SAAS,GAAG,KAAA,eAAA,CAAqB;AAAEC,YAAAA,IAAF,EAAEA,IAAF;AAAQC,YAAAA,WAAAA,EAAAA;AAAR,WAArB,CAAlB;AACA,iBAAO,CAAC,CAACF,SAAS,CAAlB,iBAAA;AACD;;AApJiC;AAAA;;AAAA;AAAA,MACpC,UADoC;AAAA;AAAA,CAA/B","sourcesContent":["// @flow\nimport {\n  getPropertyArray,\n  getPropertyLoanArray,\n} from '../../arrays/PropertyFormArray';\nimport { getPercent } from '../general';\nimport { getCountedArray, getMissingFieldIds } from '../formArrayHelpers';\nimport {\n  filesPercent,\n  getMissingDocumentIds,\n} from '../../api/files/fileHelpers';\nimport { getPropertyDocuments } from '../../api/files/documents';\nimport MiddlewareManager from '../MiddlewareManager';\n\nexport const withPropertyCalculator = (SuperClass = class {}) =>\n  class extends SuperClass {\n    constructor(config) {\n      super(config);\n      this.initPropertyCalculator(config);\n    }\n\n    initPropertyCalculator(config) {\n      if (config && config.propertyMiddleware) {\n        const middlewareManager = new MiddlewareManager(this);\n        middlewareManager.applyToAllMethods([config.propertyMiddleware]);\n      }\n    }\n\n    propertyPercent({ loan, structureId, property }) {\n      const { borrowers } = loan;\n      const structure = this.selectStructure({ loan, structureId });\n      const propertyToCalculateWith = property || structure.property;\n\n      if (!propertyToCalculateWith) {\n        return 0;\n      }\n\n      const formArray1 = getPropertyArray({\n        loan,\n        borrowers,\n        property: propertyToCalculateWith,\n      });\n      const formArray2 = getPropertyLoanArray({\n        loan,\n        borrowers,\n        property: propertyToCalculateWith,\n      });\n\n      return getPercent([\n        ...getCountedArray(formArray1, propertyToCalculateWith),\n        ...getCountedArray(formArray2, loan),\n      ]);\n    }\n\n    getPropAndWork({ loan, structureId }) {\n      const propertyValue = this.selectPropertyValue({ loan, structureId });\n      const propertyWork = this.selectStructureKey({\n        loan,\n        structureId,\n        key: 'propertyWork',\n      }) || 0;\n      return super.getPropAndWork({ propertyValue, propertyWork });\n    }\n\n    getPropertyWork({ loan, structureId }) {\n      return this.selectPropertyWork({ loan, structureId });\n    }\n\n    getPropertyFilesProgress({ loan, structureId, property }) {\n      const structure = this.selectStructure({ loan, structureId });\n      const propertyToCalculateWith = property || structure.property;\n\n      if (!propertyToCalculateWith) {\n        return 0;\n      }\n\n      return filesPercent({\n        doc: propertyToCalculateWith,\n        fileArray: getPropertyDocuments({\n          loan,\n          id: propertyToCalculateWith._id,\n        }),\n      });\n    }\n\n    getPropertyCompletion({ loan, structureId, property }) {\n      const { borrowers } = loan;\n      const selectedProperty = this.selectProperty({ loan, structureId });\n      const propertyToCalculateWith = property || selectedProperty;\n\n      const formsProgress = this.propertyPercent({\n        loan,\n        borrowers,\n        property: propertyToCalculateWith,\n      });\n      const filesProgress = this.getPropertyFilesProgress({\n        loan,\n        property: propertyToCalculateWith,\n      });\n\n      return (formsProgress + filesProgress) / 2;\n    }\n\n    getMissingPropertyFields({ loan, structureId, property }) {\n      const { borrowers } = loan;\n      const selectedProperty = this.selectProperty({ loan, structureId });\n\n      const propertyToCalculateWith = property || selectedProperty;\n\n      const formArray1 = getPropertyArray({\n        loan,\n        borrowers,\n        property: propertyToCalculateWith,\n      });\n      const formArray2 = getPropertyLoanArray({\n        loan,\n        borrowers,\n        property: propertyToCalculateWith,\n      });\n\n      return [\n        ...getMissingFieldIds(formArray1, propertyToCalculateWith),\n        ...getMissingFieldIds(formArray2, loan),\n      ];\n    }\n\n    getMissingPropertyDocuments({ loan, structureId, property }) {\n      const selectedProperty = this.selectProperty({ loan, structureId });\n      const propertyToCalculateWith = property || selectedProperty;\n\n      return getMissingDocumentIds({\n        doc: propertyToCalculateWith,\n        fileArray: getPropertyDocuments({\n          loan,\n          id: propertyToCalculateWith._id,\n        }),\n      });\n    }\n\n    hasDetailedPropertyValue({ loan, structureId }) {\n      const propertyExactValue = this.selectPropertyKey({\n        key: 'value',\n        loan,\n        structureId,\n      });\n      const landValue = this.selectPropertyKey({\n        key: 'landValue',\n        loan,\n        structureId,\n      });\n      const constructionValue = this.selectPropertyKey({\n        key: 'constructionValue',\n        loan,\n        structureId,\n      });\n\n      return !propertyExactValue || !!(landValue && constructionValue);\n    }\n\n    isPromotionProperty({ loan, structureId }) {\n      const structure = this.selectStructure({ loan, structureId });\n      return !!structure.promotionOptionId;\n    }\n  };\n"]},"sourceType":"script","hash":"3a455f52d739a2371b9c5ee277867d33f0a6ce4e"}
