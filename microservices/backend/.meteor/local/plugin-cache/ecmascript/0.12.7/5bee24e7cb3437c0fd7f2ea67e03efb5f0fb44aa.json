{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/Florian/dev/epotek/microservices/backend/imports/core/components/AutoForm2/CustomSelectFieldContainer.jsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties",["flow",{}],"dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"imports/core/components/AutoForm2/CustomSelectFieldContainer.jsx","filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/components/AutoForm2/CustomSelectFieldContainer.jsx","inputSourceMap":{"version":3,"sources":["imports/core/components/AutoForm2/CustomSelectFieldContainer.jsx"],"names":["React","PureComponent","T","Chip","Loading","Component","CustomSelectFieldContainer","constructor","props","customAllowedValues","model","parent","values","state","setState","loading","length","Promise","resolve","then","Number","name","slice","result","finally","query","params","allowNull","clone","fetch","error","data","ids","map","_id","option","allowedValuesIntlId","intlId","value","transform","makeTransform","placeholder","Array","isArray","val","formatOption","marginRight","find","item","allowedValues","componentDidMount","getAllowedValues","componentWillReceiveProps","nextProps","nextModel","render","displayEmpty","uniforms","field","fields","rest","message","reason","renderValue","defaultProps"],"mappings":"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","sourcesContent":["import React, { PureComponent } from 'react';\n\nimport T from '../Translation';\nimport Chip from '../Material/Chip';\nimport Loading from '../Loading';\n\nexport default (Component) => {\n  class CustomSelectFieldContainer extends PureComponent {\n    constructor(props) {\n      super(props);\n      this.state = { values: props.allowedValues, data: null, error: null };\n    }\n\n    componentDidMount() {\n      this.getAllowedValues(this.props);\n    }\n\n    componentWillReceiveProps(nextProps) {\n      const { model: nextModel } = nextProps;\n      const { model } = this.props;\n\n      if (model !== nextModel) {\n        this.getAllowedValues(nextProps);\n      }\n    }\n\n    getAllowedValues = (props) => {\n      const { customAllowedValues, model, parent } = props;\n      const { values } = this.state;\n\n      if (customAllowedValues) {\n        this.setState({ loading: !values || !values.length });\n      }\n\n      if (customAllowedValues && typeof customAllowedValues === 'function') {\n        Promise.resolve()\n          .then(() =>\n            customAllowedValues(model, parent && Number(parent.name.slice(-1))))\n          .then(result => this.setState({ values: result }))\n          .finally(() => this.setState({ loading: false }));\n      } else if (\n        customAllowedValues\n        && typeof customAllowedValues === 'object'\n      ) {\n        const { query, params = () => ({}), allowNull } = customAllowedValues;\n\n        query.clone(params(model)).fetch((error, data) => {\n          if (error) {\n            return this.setState({ error });\n          }\n\n          const ids = data.map(({ _id }) => _id);\n\n          this.setState({\n            values: allowNull ? [null, ...ids] : ids,\n            data: allowNull ? [null, ...data] : data,\n            error: null,\n            loading: false,\n          });\n        });\n      }\n    };\n\n    formatOption = (option) => {\n      const { allowedValuesIntlId, intlId, name } = this.props;\n      return (\n        <T id={`Forms.${allowedValuesIntlId || intlId || name}.${option}`} />\n      );\n    };\n\n    renderValue = (value) => {\n      const transform = this.makeTransform();\n      const { placeholder } = this.props;\n\n      if (!value) {\n        return placeholder;\n      }\n\n      if (Array.isArray(value)) {\n        if (value.length === 0) {\n          return placeholder;\n        }\n        return value.map(val => (\n          <Chip\n            key={val}\n            label={transform ? transform(val) : this.formatOption(val)}\n            style={{ marginRight: 4 }}\n          />\n        ));\n      }\n\n      if (transform) {\n        return transform(value);\n      }\n\n      return this.formatOption(value);\n    };\n\n    makeTransform = () => {\n      const { transform } = this.props;\n      const { data } = this.state;\n      if (data) {\n        return (value) => {\n          if (!value) {\n            // If the value is falsy, just transform it\n            return transform(value);\n          }\n          return transform(data.find(item => (item && item._id) === value));\n        };\n      }\n      return transform;\n    };\n\n    render() {\n      const { values, error, loading } = this.state;\n      const {\n        placeholder,\n        displayEmpty,\n        model,\n        uniforms,\n        field,\n        fields,\n        ...rest\n      } = this.props;\n\n      if (error) {\n        return <span className=\"error\">{error.message || error.reason}</span>;\n      }\n\n      if (loading) {\n        return <Loading small />;\n      }\n\n      return (\n        <Component\n          {...rest}\n          placeholder={displayEmpty ? placeholder : ''}\n          values={values}\n          formatOption={this.formatOption}\n          renderValue={this.renderValue}\n          transform={this.makeTransform() || this.formatOption}\n        />\n      );\n    }\n  }\n\n  CustomSelectFieldContainer.defaultProps = {\n    displayEmpty: true,\n  };\n\n  return CustomSelectFieldContainer;\n};\n"]},"passPerPreset":false,"envName":"development","cwd":"/Users/Florian/dev/epotek/microservices/backend","root":"/Users/Florian/dev/epotek/microservices/backend","plugins":[{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/components/AutoForm2/CustomSelectFieldContainer.jsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/core/components/AutoForm2/CustomSelectFieldContainer.jsx"}},"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _objectWithoutProperties2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectWithoutProperties\"));\n\nlet React, PureComponent;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n\n  PureComponent(v) {\n    PureComponent = v;\n  }\n\n}, 0);\nlet T;\nmodule.link(\"../Translation\", {\n  default(v) {\n    T = v;\n  }\n\n}, 1);\nlet Chip;\nmodule.link(\"../Material/Chip\", {\n  default(v) {\n    Chip = v;\n  }\n\n}, 2);\nlet Loading;\nmodule.link(\"../Loading\", {\n  default(v) {\n    Loading = v;\n  }\n\n}, 3);\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exportDefault(Component => {\n  class CustomSelectFieldContainer extends PureComponent {\n    constructor(_props) {\n      super(_props);\n\n      _defineProperty(this, \"getAllowedValues\", props => {\n        const {\n          customAllowedValues,\n          model,\n          parent\n        } = props;\n        const {\n          values\n        } = this.state;\n\n        if (customAllowedValues) {\n          this.setState({\n            loading: !values || !values.length\n          });\n        }\n\n        if (customAllowedValues && typeof customAllowedValues === 'function') {\n          Promise.resolve().then(() => customAllowedValues(model, parent && Number(parent.name.slice(-1)))).then(result => this.setState({\n            values: result\n          })).finally(() => this.setState({\n            loading: false\n          }));\n        } else if (customAllowedValues && typeof customAllowedValues === 'object') {\n          const {\n            query,\n            params = () => ({}),\n            allowNull\n          } = customAllowedValues;\n          query.clone(params(model)).fetch((error, data) => {\n            if (error) {\n              return this.setState({\n                error\n              });\n            }\n\n            const ids = data.map((_ref) => {\n              let {\n                _id\n              } = _ref;\n              return _id;\n            });\n            this.setState({\n              values: allowNull ? [null, ...ids] : ids,\n              data: allowNull ? [null, ...data] : data,\n              error: null,\n              loading: false\n            });\n          });\n        }\n      });\n\n      _defineProperty(this, \"formatOption\", option => {\n        const {\n          allowedValuesIntlId,\n          intlId,\n          name\n        } = this.props;\n        return React.createElement(T, {\n          id: \"Forms.\".concat(allowedValuesIntlId || intlId || name, \".\").concat(option)\n        });\n      });\n\n      _defineProperty(this, \"renderValue\", value => {\n        const transform = this.makeTransform();\n        const {\n          placeholder\n        } = this.props;\n\n        if (!value) {\n          return placeholder;\n        }\n\n        if (Array.isArray(value)) {\n          if (value.length === 0) {\n            return placeholder;\n          }\n\n          return value.map(val => React.createElement(Chip, {\n            key: val,\n            label: transform ? transform(val) : this.formatOption(val),\n            style: {\n              marginRight: 4\n            }\n          }));\n        }\n\n        if (transform) {\n          return transform(value);\n        }\n\n        return this.formatOption(value);\n      });\n\n      _defineProperty(this, \"makeTransform\", () => {\n        const {\n          transform\n        } = this.props;\n        const {\n          data\n        } = this.state;\n\n        if (data) {\n          return value => {\n            if (!value) {\n              // If the value is falsy, just transform it\n              return transform(value);\n            }\n\n            return transform(data.find(item => (item && item._id) === value));\n          };\n        }\n\n        return transform;\n      });\n\n      this.state = {\n        values: _props.allowedValues,\n        data: null,\n        error: null\n      };\n    }\n\n    componentDidMount() {\n      this.getAllowedValues(this.props);\n    }\n\n    componentWillReceiveProps(nextProps) {\n      const {\n        model: nextModel\n      } = nextProps;\n      const {\n        model\n      } = this.props;\n\n      if (model !== nextModel) {\n        this.getAllowedValues(nextProps);\n      }\n    }\n\n    render() {\n      const {\n        values,\n        error,\n        loading\n      } = this.state;\n      const _this$props = this.props,\n            {\n        placeholder,\n        displayEmpty,\n        model,\n        uniforms,\n        field,\n        fields\n      } = _this$props,\n            rest = (0, _objectWithoutProperties2.default)(_this$props, [\"placeholder\", \"displayEmpty\", \"model\", \"uniforms\", \"field\", \"fields\"]);\n\n      if (error) {\n        return React.createElement(\"span\", {\n          className: \"error\"\n        }, error.message || error.reason);\n      }\n\n      if (loading) {\n        return React.createElement(Loading, {\n          small: true\n        });\n      }\n\n      return React.createElement(Component, (0, _extends2.default)({}, rest, {\n        placeholder: displayEmpty ? placeholder : '',\n        values: values,\n        formatOption: this.formatOption,\n        renderValue: this.renderValue,\n        transform: this.makeTransform() || this.formatOption\n      }));\n    }\n\n  }\n\n  CustomSelectFieldContainer.defaultProps = {\n    displayEmpty: true\n  };\n  return CustomSelectFieldContainer;\n});","map":{"version":3,"sources":["imports/core/components/AutoForm2/CustomSelectFieldContainer.jsx"],"names":["Component","constructor","values","props","data","error","componentDidMount","componentWillReceiveProps","model","nextModel","parent","loading","length","customAllowedValues","Promise","Number","result","params","allowNull","query","ids","_id","option","name","allowedValuesIntlId","value","transform","placeholder","Array","val","marginRight","item","render","rest","displayEmpty","CustomSelectFieldContainer"],"mappings":"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","sourcesContent":["import React, { PureComponent } from 'react';\n\nimport T from '../Translation';\nimport Chip from '../Material/Chip';\nimport Loading from '../Loading';\n\nexport default (Component) => {\n  class CustomSelectFieldContainer extends PureComponent {\n    constructor(props) {\n      super(props);\n      this.state = { values: props.allowedValues, data: null, error: null };\n    }\n\n    componentDidMount() {\n      this.getAllowedValues(this.props);\n    }\n\n    componentWillReceiveProps(nextProps) {\n      const { model: nextModel } = nextProps;\n      const { model } = this.props;\n\n      if (model !== nextModel) {\n        this.getAllowedValues(nextProps);\n      }\n    }\n\n    getAllowedValues = (props) => {\n      const { customAllowedValues, model, parent } = props;\n      const { values } = this.state;\n\n      if (customAllowedValues) {\n        this.setState({ loading: !values || !values.length });\n      }\n\n      if (customAllowedValues && typeof customAllowedValues === 'function') {\n        Promise.resolve()\n          .then(() =>\n            customAllowedValues(model, parent && Number(parent.name.slice(-1))))\n          .then(result => this.setState({ values: result }))\n          .finally(() => this.setState({ loading: false }));\n      } else if (\n        customAllowedValues\n        && typeof customAllowedValues === 'object'\n      ) {\n        const { query, params = () => ({}), allowNull } = customAllowedValues;\n\n        query.clone(params(model)).fetch((error, data) => {\n          if (error) {\n            return this.setState({ error });\n          }\n\n          const ids = data.map(({ _id }) => _id);\n\n          this.setState({\n            values: allowNull ? [null, ...ids] : ids,\n            data: allowNull ? [null, ...data] : data,\n            error: null,\n            loading: false,\n          });\n        });\n      }\n    };\n\n    formatOption = (option) => {\n      const { allowedValuesIntlId, intlId, name } = this.props;\n      return (\n        <T id={`Forms.${allowedValuesIntlId || intlId || name}.${option}`} />\n      );\n    };\n\n    renderValue = (value) => {\n      const transform = this.makeTransform();\n      const { placeholder } = this.props;\n\n      if (!value) {\n        return placeholder;\n      }\n\n      if (Array.isArray(value)) {\n        if (value.length === 0) {\n          return placeholder;\n        }\n        return value.map(val => (\n          <Chip\n            key={val}\n            label={transform ? transform(val) : this.formatOption(val)}\n            style={{ marginRight: 4 }}\n          />\n        ));\n      }\n\n      if (transform) {\n        return transform(value);\n      }\n\n      return this.formatOption(value);\n    };\n\n    makeTransform = () => {\n      const { transform } = this.props;\n      const { data } = this.state;\n      if (data) {\n        return (value) => {\n          if (!value) {\n            // If the value is falsy, just transform it\n            return transform(value);\n          }\n          return transform(data.find(item => (item && item._id) === value));\n        };\n      }\n      return transform;\n    };\n\n    render() {\n      const { values, error, loading } = this.state;\n      const {\n        placeholder,\n        displayEmpty,\n        model,\n        uniforms,\n        field,\n        fields,\n        ...rest\n      } = this.props;\n\n      if (error) {\n        return <span className=\"error\">{error.message || error.reason}</span>;\n      }\n\n      if (loading) {\n        return <Loading small />;\n      }\n\n      return (\n        <Component\n          {...rest}\n          placeholder={displayEmpty ? placeholder : ''}\n          values={values}\n          formatOption={this.formatOption}\n          renderValue={this.renderValue}\n          transform={this.makeTransform() || this.formatOption}\n        />\n      );\n    }\n  }\n\n  CustomSelectFieldContainer.defaultProps = {\n    displayEmpty: true,\n  };\n\n  return CustomSelectFieldContainer;\n};\n"]},"sourceType":"script","hash":"5bee24e7cb3437c0fd7f2ea67e03efb5f0fb44aa"}
