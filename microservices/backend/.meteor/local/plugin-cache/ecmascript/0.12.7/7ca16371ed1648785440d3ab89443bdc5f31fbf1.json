{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/Florian/dev/epotek/microservices/backend/packages/cultofcoders:mutations/lib/mutation.class.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"packages/cultofcoders:mutations/lib/mutation.class.js","filename":"/Users/Florian/dev/epotek/microservices/backend/packages/cultofcoders:mutations/lib/mutation.class.js","passPerPreset":false,"envName":"development","cwd":"/Users/Florian/dev/epotek/microservices/backend","root":"/Users/Florian/dev/epotek/microservices/backend","plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/Florian/dev/epotek/microservices/backend/packages/cultofcoders:mutations/lib/mutation.class.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/cultofcoders:mutations/lib/mutation.class.js"}},"code":"module.export({\n  default: () => Mutation\n});\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet AOP;\nmodule.link(\"./aop\", {\n  default(v) {\n    AOP = v;\n  }\n\n}, 1);\nlet check, Match;\nmodule.link(\"meteor/check\", {\n  check(v) {\n    check = v;\n  },\n\n  Match(v) {\n    Match = v;\n  }\n\n}, 2);\n\nclass Mutation {\n  constructor(config) {\n    Mutation.checkDefaultConfig(config);\n    this.config = config;\n    this.callAOP = new AOP();\n    this.executionAOP = new AOP();\n  }\n  /**\n   * @param {Function} fn\n   */\n\n\n  static addBeforeCall(fn) {\n    this.callAOP.addBefore(fn);\n  }\n  /**\n   * @param {Function} fn\n   */\n\n\n  static addAfterCall(fn) {\n    this.callAOP.addAfter(fn);\n  }\n  /**\n   * @param {Function} fn\n   */\n\n\n  static addBeforeExecution(fn) {\n    this.executionAOP.addBefore(fn);\n  }\n  /**\n   * @param {Function} fn\n   */\n\n\n  static addAfterExecution(fn) {\n    this.executionAOP.addAfter(fn);\n  }\n  /**\n   * @param {Object} config\n   */\n\n\n  static checkDefaultConfig(config) {\n    check(config, Object);\n\n    if (typeof config.name !== 'string') {\n      throw new Meteor.Error('invalid-config', 'You must provide a \"name\" property to your mutation config.');\n    }\n  }\n  /**\n   * @param {Function} fn\n   */\n\n\n  addBeforeCall(fn) {\n    this.callAOP.addBefore(fn);\n  }\n  /**\n   * @param {Function} fn\n   */\n\n\n  addAfterCall(fn) {\n    this.callAOP.addAfter(fn);\n  }\n  /**\n   * @param {Function} fn\n   */\n\n\n  addBeforeExecution(fn) {\n    this.executionAOP.addBefore(fn);\n  }\n  /**\n   * @param {Function} fn\n   */\n\n\n  addAfterExecution(fn) {\n    this.executionAOP.addAfter(fn);\n  }\n  /**\n   * Runs the mutation inside a promise\n   * @param {Object} callParams\n   * @param {Object} options Meteor options https://docs.meteor.com/api/methods.html#Meteor-apply\n   * @returns {Promise}\n   */\n\n\n  run(callParams) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const config = this.config;\n    const aopData = {\n      config,\n      params: callParams\n    };\n    Mutation.callAOP.executeBefores(aopData);\n    this.callAOP.executeBefores(aopData);\n    const {\n      name,\n      params\n    } = config;\n    return new Promise((resolve, reject) => {\n      Meteor.apply(name, [callParams], options, (error, result) => {\n        const aopData = {\n          config,\n          params: callParams,\n          result,\n          error\n        };\n        Mutation.callAOP.executeAfters(aopData);\n        this.callAOP.executeAfters(aopData);\n\n        if (error) {\n          reject(error);\n        } else {\n          resolve(result);\n        }\n      });\n    });\n  }\n  /**\n   * Creates the Meteor Method and the handler for it\n   * @param {Function} fn\n   */\n\n\n  setHandler(fn) {\n    const config = this.config;\n    const {\n      name,\n      params\n    } = config;\n    const self = this;\n    Meteor.methods({\n      [name]() {\n        let params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n        if (config.params) {\n          check(params, config.params);\n        }\n\n        let aopData = {\n          context: this,\n          config,\n          params\n        };\n        Mutation.executionAOP.executeBefores(aopData);\n        self.executionAOP.executeBefores(aopData);\n        let error, result;\n\n        try {\n          result = fn.call(null, this, params);\n        } catch (e) {\n          error = e;\n        }\n\n        aopData = {\n          context: this,\n          config,\n          params,\n          result,\n          error\n        };\n        Mutation.executionAOP.executeAfters(aopData);\n        self.executionAOP.executeAfters(aopData);\n\n        if (error) {\n          throw error;\n        }\n\n        return result;\n      }\n\n    });\n  }\n\n}\n\nMutation.callAOP = new AOP();\nMutation.executionAOP = new AOP();","map":{"version":3,"sources":["packages/cultofcoders:mutations/lib/mutation.class.js"],"names":["module","export","default","Mutation","Meteor","link","v","AOP","check","Match","constructor","config","checkDefaultConfig","callAOP","executionAOP","addBeforeCall","fn","addBefore","addAfterCall","addAfter","addBeforeExecution","addAfterExecution","Object","name","Error","run","callParams","options","aopData","params","executeBefores","Promise","resolve","reject","apply","error","result","executeAfters","setHandler","self","methods","context","call","e"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport AOP from './aop';\nimport { check, Match } from 'meteor/check';\n\nexport default class Mutation {\n    static callAOP = new AOP();\n    static executionAOP = new AOP();\n\n    constructor(config) {\n        Mutation.checkDefaultConfig(config);\n\n        this.config = config;\n        this.callAOP = new AOP();\n        this.executionAOP = new AOP();\n    }\n\n    /**\n     * @param {Function} fn\n     */\n    static addBeforeCall(fn) {\n        this.callAOP.addBefore(fn);\n    }\n\n    /**\n     * @param {Function} fn\n     */\n    static addAfterCall(fn) {\n        this.callAOP.addAfter(fn);\n    }\n\n    /**\n     * @param {Function} fn\n     */\n    static addBeforeExecution(fn) {\n        this.executionAOP.addBefore(fn);\n    }\n\n    /**\n     * @param {Function} fn\n     */\n    static addAfterExecution(fn) {\n        this.executionAOP.addAfter(fn);\n    }\n\n    /**\n     * @param {Object} config\n     */\n    static checkDefaultConfig(config) {\n        check(config, Object);\n        if (typeof config.name !== 'string') {\n            throw new Meteor.Error(\n                'invalid-config',\n                'You must provide a \"name\" property to your mutation config.'\n            );\n        }\n    }\n\n    /**\n     * @param {Function} fn\n     */\n    addBeforeCall(fn) {\n        this.callAOP.addBefore(fn);\n    }\n\n    /**\n     * @param {Function} fn\n     */\n    addAfterCall(fn) {\n        this.callAOP.addAfter(fn);\n    }\n\n    /**\n     * @param {Function} fn\n     */\n    addBeforeExecution(fn) {\n        this.executionAOP.addBefore(fn);\n    }\n\n    /**\n     * @param {Function} fn\n     */\n    addAfterExecution(fn) {\n        this.executionAOP.addAfter(fn);\n    }\n\n    /**\n     * Runs the mutation inside a promise\n     * @param {Object} callParams\n     * @param {Object} options Meteor options https://docs.meteor.com/api/methods.html#Meteor-apply\n     * @returns {Promise}\n     */\n    run(callParams, options = {}) {\n        const config = this.config;\n\n        const aopData = { config, params: callParams };\n        Mutation.callAOP.executeBefores(aopData);\n        this.callAOP.executeBefores(aopData);\n\n        const { name, params } = config;\n\n        return new Promise((resolve, reject) => {\n            Meteor.apply(name, [callParams], options, (error, result) => {\n                const aopData = {\n                    config,\n                    params: callParams,\n                    result,\n                    error,\n                };\n\n                Mutation.callAOP.executeAfters(aopData);\n                this.callAOP.executeAfters(aopData);\n\n                if (error) {\n                    reject(error);\n                } else {\n                    resolve(result);\n                }\n            });\n        });\n    }\n\n    /**\n     * Creates the Meteor Method and the handler for it\n     * @param {Function} fn\n     */\n    setHandler(fn) {\n        const config = this.config;\n        const { name, params } = config;\n        const self = this;\n\n        Meteor.methods({\n            [name](params = {}) {\n                if (config.params) {\n                    check(params, config.params);\n                }\n\n                let aopData = {\n                    context: this,\n                    config,\n                    params,\n                };\n\n                Mutation.executionAOP.executeBefores(aopData);\n                self.executionAOP.executeBefores(aopData);\n\n                let error, result;\n                try {\n                    result = fn.call(null, this, params);\n                } catch (e) {\n                    error = e;\n                }\n\n                aopData = {\n                    context: this,\n                    config,\n                    params,\n                    result,\n                    error,\n                };\n\n                Mutation.executionAOP.executeAfters(aopData);\n                self.executionAOP.executeAfters(aopData);\n\n                if (error) {\n                    throw error;\n                }\n\n                return result;\n            },\n        });\n    }\n}\n"]},"sourceType":"script","hash":"7ca16371ed1648785440d3ab89443bdc5f31fbf1"}
