{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/Florian/dev/epotek/microservices/backend/imports/core/api/properties/server/methods.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties",["flow",{}],"jsx",["flow",{}],["flow",{}],"objectRestSpread","objectRestSpread","dynamicImport","asyncGenerators","classProperties","classPrivateProperties"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.linux.x86_64"},"sourceFileName":"imports/core/api/properties/server/methods.js","filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/api/properties/server/methods.js","inputSourceMap":{"version":3,"sources":["imports/core/api/properties/server/methods.js"],"names":["SecurityService","checkInsertUserId","propertyInsert","propertyUpdate","propertyDelete","pushPropertyValue","popPropertyValue","pullPropertyValue","evaluateProperty","propertyDataIsInvalid","addProUserToProperty","proPropertyInsert","setProPropertyPermissions","removeProFromProperty","removeCustomerFromProperty","insertExternalProperty","PropertyService","setHandler","context","params","userId","insert","properties","isAllowedToUpdate","propertyId","update","isAllowedToDelete","remove","pushValue","popValue","pullValue","unblock","checkUserIsPro","isAllowedToInviteProUsers","addProUser","isAllowedToManagePermissions","setProUserPermissions","checkCurrentUserIsAdmin","loanId","isAllowedToRemoveCustomer"],"mappings":"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","sourcesContent":["import SecurityService from '../../security';\nimport { checkInsertUserId } from '../../helpers/server/methodServerHelpers';\nimport {\n  propertyInsert,\n  propertyUpdate,\n  propertyDelete,\n  pushPropertyValue,\n  popPropertyValue,\n  pullPropertyValue,\n  evaluateProperty,\n  propertyDataIsInvalid,\n  addProUserToProperty,\n  proPropertyInsert,\n  setProPropertyPermissions,\n  removeProFromProperty,\n  removeCustomerFromProperty,\n  insertExternalProperty,\n} from '../methodDefinitions';\nimport PropertyService from './PropertyService';\n\npropertyInsert.setHandler((context, params) => {\n  const userId = checkInsertUserId(params.userId);\n  return PropertyService.insert({ ...params, userId });\n});\n\npropertyUpdate.setHandler(({ userId }, params) => {\n  SecurityService.properties.isAllowedToUpdate(params.propertyId, userId);\n  return PropertyService.update(params);\n});\n\npropertyDelete.setHandler((context, params) => {\n  SecurityService.properties.isAllowedToDelete(\n    params.propertyId,\n    context.userId,\n  );\n  return PropertyService.remove(params);\n});\n\npushPropertyValue.setHandler(({ userId }, params) => {\n  SecurityService.properties.isAllowedToUpdate(params.propertyId, userId);\n  return PropertyService.pushValue(params);\n});\n\npopPropertyValue.setHandler(({ userId }, params) => {\n  SecurityService.properties.isAllowedToUpdate(params.propertyId, userId);\n  return PropertyService.popValue(params);\n});\n\npullPropertyValue.setHandler(({ userId }, params) => {\n  SecurityService.properties.isAllowedToUpdate(params.propertyId, userId);\n  return PropertyService.pullValue(params);\n});\n\nevaluateProperty.setHandler(({ userId }, params) => {\n  context.unblock();\n  SecurityService.properties.isAllowedToUpdate(params.propertyId, userId);\n  return PropertyService.evaluateProperty(params);\n});\n\npropertyDataIsInvalid.setHandler(({ userId }, params) => {\n  context.unblock();\n  SecurityService.properties.isAllowedToUpdate(params.propertyId, userId);\n  return PropertyService.propertyDataIsInvalid(params);\n});\n\naddProUserToProperty.setHandler(({ userId }, params) => {\n  SecurityService.checkUserIsPro(userId);\n  SecurityService.properties.isAllowedToInviteProUsers({\n    userId,\n    propertyId: params.propertyId,\n  });\n  return PropertyService.addProUser(params);\n});\n\nproPropertyInsert.setHandler(({ userId }, params) => {\n  SecurityService.checkUserIsPro(userId);\n  return PropertyService.proPropertyInsert(params);\n});\n\nsetProPropertyPermissions.setHandler(({ userId }, params) => {\n  SecurityService.checkUserIsPro(userId);\n  SecurityService.properties.isAllowedToManagePermissions({\n    userId,\n    propertyId: params.propertyId,\n  });\n  PropertyService.setProUserPermissions(params);\n});\n\nremoveProFromProperty.setHandler(({ userId }, params) => {\n  SecurityService.checkCurrentUserIsAdmin();\n  PropertyService.removeProFromProperty(params);\n});\n\nremoveCustomerFromProperty.setHandler(({ userId }, params) => {\n  const { loanId, propertyId } = params;\n  SecurityService.checkUserIsPro(userId);\n  SecurityService.properties.isAllowedToRemoveCustomer({\n    userId,\n    propertyId,\n    loanId,\n  });\n  PropertyService.removeCustomerFromProperty(params);\n});\n\ninsertExternalProperty.setHandler(({ userId }, params) => {\n  SecurityService.checkUserIsPro(userId);\n  PropertyService.insertExternalProperty({ userId, ...params });\n});\n"]},"passPerPreset":false,"envName":"production","cwd":"/Users/Florian/dev/epotek/microservices/backend","root":"/Users/Florian/dev/epotek/microservices/backend","plugins":[{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}}],"presets":[],"generatorOpts":{"filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/api/properties/server/methods.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/core/api/properties/server/methods.js"}},"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread\"));\n\nlet SecurityService;\nmodule.link(\"../../security\", {\n  default(v) {\n    SecurityService = v;\n  }\n\n}, 0);\nlet checkInsertUserId;\nmodule.link(\"../../helpers/server/methodServerHelpers\", {\n  checkInsertUserId(v) {\n    checkInsertUserId = v;\n  }\n\n}, 1);\nlet propertyInsert, propertyUpdate, propertyDelete, pushPropertyValue, popPropertyValue, pullPropertyValue, evaluateProperty, propertyDataIsInvalid, addProUserToProperty, proPropertyInsert, setProPropertyPermissions, removeProFromProperty, removeCustomerFromProperty, insertExternalProperty;\nmodule.link(\"../methodDefinitions\", {\n  propertyInsert(v) {\n    propertyInsert = v;\n  },\n\n  propertyUpdate(v) {\n    propertyUpdate = v;\n  },\n\n  propertyDelete(v) {\n    propertyDelete = v;\n  },\n\n  pushPropertyValue(v) {\n    pushPropertyValue = v;\n  },\n\n  popPropertyValue(v) {\n    popPropertyValue = v;\n  },\n\n  pullPropertyValue(v) {\n    pullPropertyValue = v;\n  },\n\n  evaluateProperty(v) {\n    evaluateProperty = v;\n  },\n\n  propertyDataIsInvalid(v) {\n    propertyDataIsInvalid = v;\n  },\n\n  addProUserToProperty(v) {\n    addProUserToProperty = v;\n  },\n\n  proPropertyInsert(v) {\n    proPropertyInsert = v;\n  },\n\n  setProPropertyPermissions(v) {\n    setProPropertyPermissions = v;\n  },\n\n  removeProFromProperty(v) {\n    removeProFromProperty = v;\n  },\n\n  removeCustomerFromProperty(v) {\n    removeCustomerFromProperty = v;\n  },\n\n  insertExternalProperty(v) {\n    insertExternalProperty = v;\n  }\n\n}, 2);\nlet PropertyService;\nmodule.link(\"./PropertyService\", {\n  default(v) {\n    PropertyService = v;\n  }\n\n}, 3);\npropertyInsert.setHandler((context, params) => {\n  const userId = checkInsertUserId(params.userId);\n  return PropertyService.insert((0, _objectSpread2.default)({}, params, {\n    userId\n  }));\n});\npropertyUpdate.setHandler(({\n  userId\n}, params) => {\n  SecurityService.properties.isAllowedToUpdate(params.propertyId, userId);\n  return PropertyService.update(params);\n});\npropertyDelete.setHandler((context, params) => {\n  SecurityService.properties.isAllowedToDelete(params.propertyId, context.userId);\n  return PropertyService.remove(params);\n});\npushPropertyValue.setHandler(({\n  userId\n}, params) => {\n  SecurityService.properties.isAllowedToUpdate(params.propertyId, userId);\n  return PropertyService.pushValue(params);\n});\npopPropertyValue.setHandler(({\n  userId\n}, params) => {\n  SecurityService.properties.isAllowedToUpdate(params.propertyId, userId);\n  return PropertyService.popValue(params);\n});\npullPropertyValue.setHandler(({\n  userId\n}, params) => {\n  SecurityService.properties.isAllowedToUpdate(params.propertyId, userId);\n  return PropertyService.pullValue(params);\n});\nevaluateProperty.setHandler(({\n  userId\n}, params) => {\n  context.unblock();\n  SecurityService.properties.isAllowedToUpdate(params.propertyId, userId);\n  return PropertyService.evaluateProperty(params);\n});\npropertyDataIsInvalid.setHandler(({\n  userId\n}, params) => {\n  context.unblock();\n  SecurityService.properties.isAllowedToUpdate(params.propertyId, userId);\n  return PropertyService.propertyDataIsInvalid(params);\n});\naddProUserToProperty.setHandler(({\n  userId\n}, params) => {\n  SecurityService.checkUserIsPro(userId);\n  SecurityService.properties.isAllowedToInviteProUsers({\n    userId,\n    propertyId: params.propertyId\n  });\n  return PropertyService.addProUser(params);\n});\nproPropertyInsert.setHandler(({\n  userId\n}, params) => {\n  SecurityService.checkUserIsPro(userId);\n  return PropertyService.proPropertyInsert(params);\n});\nsetProPropertyPermissions.setHandler(({\n  userId\n}, params) => {\n  SecurityService.checkUserIsPro(userId);\n  SecurityService.properties.isAllowedToManagePermissions({\n    userId,\n    propertyId: params.propertyId\n  });\n  PropertyService.setProUserPermissions(params);\n});\nremoveProFromProperty.setHandler(({\n  userId\n}, params) => {\n  SecurityService.checkCurrentUserIsAdmin();\n  PropertyService.removeProFromProperty(params);\n});\nremoveCustomerFromProperty.setHandler(({\n  userId\n}, params) => {\n  const {\n    loanId,\n    propertyId\n  } = params;\n  SecurityService.checkUserIsPro(userId);\n  SecurityService.properties.isAllowedToRemoveCustomer({\n    userId,\n    propertyId,\n    loanId\n  });\n  PropertyService.removeCustomerFromProperty(params);\n});\ninsertExternalProperty.setHandler(({\n  userId\n}, params) => {\n  SecurityService.checkUserIsPro(userId);\n  PropertyService.insertExternalProperty((0, _objectSpread2.default)({\n    userId\n  }, params));\n});","map":{"version":3,"sources":["imports/core/api/properties/server/methods.js"],"names":["propertyInsert","userId","checkInsertUserId","params","propertyUpdate","SecurityService","PropertyService","propertyDelete","context","pushPropertyValue","popPropertyValue","pullPropertyValue","evaluateProperty","propertyDataIsInvalid","addProUserToProperty","propertyId","proPropertyInsert","setProPropertyPermissions","removeProFromProperty","removeCustomerFromProperty","loanId","insertExternalProperty"],"mappings":"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","sourcesContent":["import SecurityService from '../../security';\nimport { checkInsertUserId } from '../../helpers/server/methodServerHelpers';\nimport {\n  propertyInsert,\n  propertyUpdate,\n  propertyDelete,\n  pushPropertyValue,\n  popPropertyValue,\n  pullPropertyValue,\n  evaluateProperty,\n  propertyDataIsInvalid,\n  addProUserToProperty,\n  proPropertyInsert,\n  setProPropertyPermissions,\n  removeProFromProperty,\n  removeCustomerFromProperty,\n  insertExternalProperty,\n} from '../methodDefinitions';\nimport PropertyService from './PropertyService';\n\npropertyInsert.setHandler((context, params) => {\n  const userId = checkInsertUserId(params.userId);\n  return PropertyService.insert({ ...params, userId });\n});\n\npropertyUpdate.setHandler(({ userId }, params) => {\n  SecurityService.properties.isAllowedToUpdate(params.propertyId, userId);\n  return PropertyService.update(params);\n});\n\npropertyDelete.setHandler((context, params) => {\n  SecurityService.properties.isAllowedToDelete(\n    params.propertyId,\n    context.userId,\n  );\n  return PropertyService.remove(params);\n});\n\npushPropertyValue.setHandler(({ userId }, params) => {\n  SecurityService.properties.isAllowedToUpdate(params.propertyId, userId);\n  return PropertyService.pushValue(params);\n});\n\npopPropertyValue.setHandler(({ userId }, params) => {\n  SecurityService.properties.isAllowedToUpdate(params.propertyId, userId);\n  return PropertyService.popValue(params);\n});\n\npullPropertyValue.setHandler(({ userId }, params) => {\n  SecurityService.properties.isAllowedToUpdate(params.propertyId, userId);\n  return PropertyService.pullValue(params);\n});\n\nevaluateProperty.setHandler(({ userId }, params) => {\n  context.unblock();\n  SecurityService.properties.isAllowedToUpdate(params.propertyId, userId);\n  return PropertyService.evaluateProperty(params);\n});\n\npropertyDataIsInvalid.setHandler(({ userId }, params) => {\n  context.unblock();\n  SecurityService.properties.isAllowedToUpdate(params.propertyId, userId);\n  return PropertyService.propertyDataIsInvalid(params);\n});\n\naddProUserToProperty.setHandler(({ userId }, params) => {\n  SecurityService.checkUserIsPro(userId);\n  SecurityService.properties.isAllowedToInviteProUsers({\n    userId,\n    propertyId: params.propertyId,\n  });\n  return PropertyService.addProUser(params);\n});\n\nproPropertyInsert.setHandler(({ userId }, params) => {\n  SecurityService.checkUserIsPro(userId);\n  return PropertyService.proPropertyInsert(params);\n});\n\nsetProPropertyPermissions.setHandler(({ userId }, params) => {\n  SecurityService.checkUserIsPro(userId);\n  SecurityService.properties.isAllowedToManagePermissions({\n    userId,\n    propertyId: params.propertyId,\n  });\n  PropertyService.setProUserPermissions(params);\n});\n\nremoveProFromProperty.setHandler(({ userId }, params) => {\n  SecurityService.checkCurrentUserIsAdmin();\n  PropertyService.removeProFromProperty(params);\n});\n\nremoveCustomerFromProperty.setHandler(({ userId }, params) => {\n  const { loanId, propertyId } = params;\n  SecurityService.checkUserIsPro(userId);\n  SecurityService.properties.isAllowedToRemoveCustomer({\n    userId,\n    propertyId,\n    loanId,\n  });\n  PropertyService.removeCustomerFromProperty(params);\n});\n\ninsertExternalProperty.setHandler(({ userId }, params) => {\n  SecurityService.checkUserIsPro(userId);\n  PropertyService.insertExternalProperty({ userId, ...params });\n});\n"]},"sourceType":"script","hash":"466c9b74648d608557c5ded1a79f52abfdae95a1"}
