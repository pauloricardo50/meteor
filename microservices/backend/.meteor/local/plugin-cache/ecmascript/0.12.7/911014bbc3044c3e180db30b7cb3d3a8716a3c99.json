{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/Florian/dev/epotek/microservices/backend/imports/core/api/cronitor/server/CronitorService.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties",["flow",{}],"jsx",["flow",{}],["flow",{}],"objectRestSpread","objectRestSpread","dynamicImport","asyncGenerators","classProperties","classPrivateProperties"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.x86_64"},"sourceFileName":"imports/core/api/cronitor/server/CronitorService.js","filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/api/cronitor/server/CronitorService.js","inputSourceMap":{"version":3,"sources":["imports/core/api/cronitor/server/CronitorService.js"],"names":["Meteor","https","queryString","CRONITOR_URL","ACTIONS","RUN","COMPLETE","PAUSE","FAIL","REQ_TIMEOUT","CronitorService","constructor","id","authKey","urlObj","buildUrlObj","action","url","buildUrl","getWithTimeout","msg","qs","JSON","stringify","hours","basePath","sanitizedError","message","baseUrl","auth_key","promise","Promise","resolve","reject","get","response","data","on","chunk","timeout","wait","setTimeout","clearTimeout","Error","race"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport https from 'https';\nimport queryString from 'query-string';\n\nconst CRONITOR_URL = 'https://cronitor.io';\nconst ACTIONS = {\n  RUN: 'run',\n  COMPLETE: 'complete',\n  PAUSE: 'pause',\n  FAIL: 'fail',\n};\nconst REQ_TIMEOUT = 10000;\n\nexport default class CronitorService {\n  constructor({ id, authKey }) {\n    this.id = id;\n    this.authKey = authKey;\n    this.baseUrl = CRONITOR_URL;\n  }\n\n  run = () => {\n    const urlObj = this.buildUrlObj({ action: ACTIONS.RUN });\n    const url = this.buildUrl({ urlObj });\n    return this.getWithTimeout({ url });\n  };\n\n  complete = (msg) => {\n    const urlObj = this.buildUrlObj({ action: ACTIONS.COMPLETE });\n    if (msg) {\n      if (!urlObj.qs) {\n        urlObj.qs = {};\n      }\n\n      urlObj.qs.msg = JSON.stringify(msg);\n    }\n    const url = this.buildUrl({ urlObj });\n    return this.getWithTimeout({ url });\n  };\n\n  pause = (hours) => {\n    const urlObj = this.buildUrlObj({ action: ACTIONS.PAUSE });\n    urlObj.basePath = `${urlObj.basePath}/${hours}`;\n    const url = this.buildUrl({ urlObj });\n    return this.getWithTimeout({ url });\n  };\n\n  fail = (msg) => {\n    const urlObj = this.buildUrlObj({ action: ACTIONS.FAIL });\n    if (msg) {\n      if (!urlObj.qs) {\n        urlObj.qs = {};\n      }\n\n      if (msg.sanitizedError) {\n        urlObj.qs.msg = JSON.stringify(msg.sanitizedError.message);\n      } else {\n        urlObj.qs.msg = JSON.stringify(msg);\n      }\n    }\n    const url = this.buildUrl({ urlObj });\n    return this.getWithTimeout({ url });\n  };\n\n  buildUrlObj = ({ action }) => {\n    const urlObj = { basePath: `${this.baseUrl}/${this.id}/${action}` };\n    if (this.authKey) {\n      urlObj.qs = { auth_key: this.authKey };\n    }\n\n    return urlObj;\n  };\n\n  buildUrl = ({ urlObj }) =>\n    urlObj.basePath + (urlObj.qs ? `?${queryString.stringify(urlObj.qs)}` : '');\n\n  getWithTimeout = ({ url }) => {\n    const promise = new Promise((resolve, reject) => {\n      https\n        .get(url, (response) => {\n          let data = '';\n\n          response.on('data', (chunk) => {\n            data += chunk;\n          });\n\n          response.on('end', () => {\n            resolve(data);\n          });\n        })\n        .on('error', reject);\n    });\n\n    const timeout = new Promise((resolve, reject) => {\n      const wait = Meteor.setTimeout(() => {\n        Meteor.clearTimeout(wait);\n        reject(new Meteor.Error('Timed out'));\n      }, REQ_TIMEOUT);\n    });\n\n    return Promise.race([promise, timeout]);\n  };\n}\n"]},"passPerPreset":false,"envName":"development","cwd":"/Users/Florian/dev/epotek/microservices/backend","root":"/Users/Florian/dev/epotek/microservices/backend","plugins":[{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}}],"presets":[],"generatorOpts":{"filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/api/cronitor/server/CronitorService.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/core/api/cronitor/server/CronitorService.js"}},"code":"module.export({\n  default: () => CronitorService\n});\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet https;\nmodule.link(\"https\", {\n  default(v) {\n    https = v;\n  }\n\n}, 1);\nlet queryString;\nmodule.link(\"query-string\", {\n  default(v) {\n    queryString = v;\n  }\n\n}, 2);\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nconst CRONITOR_URL = 'https://cronitor.io';\nconst ACTIONS = {\n  RUN: 'run',\n  COMPLETE: 'complete',\n  PAUSE: 'pause',\n  FAIL: 'fail'\n};\nconst REQ_TIMEOUT = 10000;\n\nclass CronitorService {\n  constructor({\n    id,\n    authKey\n  }) {\n    _defineProperty(this, \"run\", () => {\n      const urlObj = this.buildUrlObj({\n        action: ACTIONS.RUN\n      });\n      const url = this.buildUrl({\n        urlObj\n      });\n      return this.getWithTimeout({\n        url\n      });\n    });\n\n    _defineProperty(this, \"complete\", msg => {\n      const urlObj = this.buildUrlObj({\n        action: ACTIONS.COMPLETE\n      });\n\n      if (msg) {\n        if (!urlObj.qs) {\n          urlObj.qs = {};\n        }\n\n        urlObj.qs.msg = JSON.stringify(msg);\n      }\n\n      const url = this.buildUrl({\n        urlObj\n      });\n      return this.getWithTimeout({\n        url\n      });\n    });\n\n    _defineProperty(this, \"pause\", hours => {\n      const urlObj = this.buildUrlObj({\n        action: ACTIONS.PAUSE\n      });\n      urlObj.basePath = `${urlObj.basePath}/${hours}`;\n      const url = this.buildUrl({\n        urlObj\n      });\n      return this.getWithTimeout({\n        url\n      });\n    });\n\n    _defineProperty(this, \"fail\", msg => {\n      const urlObj = this.buildUrlObj({\n        action: ACTIONS.FAIL\n      });\n\n      if (msg) {\n        if (!urlObj.qs) {\n          urlObj.qs = {};\n        }\n\n        if (msg.sanitizedError) {\n          urlObj.qs.msg = JSON.stringify(msg.sanitizedError.message);\n        } else {\n          urlObj.qs.msg = JSON.stringify(msg);\n        }\n      }\n\n      const url = this.buildUrl({\n        urlObj\n      });\n      return this.getWithTimeout({\n        url\n      });\n    });\n\n    _defineProperty(this, \"buildUrlObj\", ({\n      action\n    }) => {\n      const urlObj = {\n        basePath: `${this.baseUrl}/${this.id}/${action}`\n      };\n\n      if (this.authKey) {\n        urlObj.qs = {\n          auth_key: this.authKey\n        };\n      }\n\n      return urlObj;\n    });\n\n    _defineProperty(this, \"buildUrl\", ({\n      urlObj\n    }) => urlObj.basePath + (urlObj.qs ? `?${queryString.stringify(urlObj.qs)}` : ''));\n\n    _defineProperty(this, \"getWithTimeout\", ({\n      url\n    }) => {\n      const promise = new Promise((resolve, reject) => {\n        https.get(url, response => {\n          let data = '';\n          response.on('data', chunk => {\n            data += chunk;\n          });\n          response.on('end', () => {\n            resolve(data);\n          });\n        }).on('error', reject);\n      });\n      const timeout = new Promise((resolve, reject) => {\n        const wait = Meteor.setTimeout(() => {\n          Meteor.clearTimeout(wait);\n          reject(new Meteor.Error('Timed out'));\n        }, REQ_TIMEOUT);\n      });\n      return Promise.race([promise, timeout]);\n    });\n\n    this.id = id;\n    this.authKey = authKey;\n    this.baseUrl = CRONITOR_URL;\n  }\n\n}","map":{"version":3,"sources":["imports/core/api/cronitor/server/CronitorService.js"],"names":["CRONITOR_URL","ACTIONS","RUN","COMPLETE","PAUSE","FAIL","REQ_TIMEOUT","constructor","authKey","urlObj","action","url","msg","JSON","hours","basePath","baseUrl","id","auth_key","queryString","promise","https","response","data","chunk","resolve","timeout","wait","Meteor","reject","Promise"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport https from 'https';\nimport queryString from 'query-string';\n\nconst CRONITOR_URL = 'https://cronitor.io';\nconst ACTIONS = {\n  RUN: 'run',\n  COMPLETE: 'complete',\n  PAUSE: 'pause',\n  FAIL: 'fail',\n};\nconst REQ_TIMEOUT = 10000;\n\nexport default class CronitorService {\n  constructor({ id, authKey }) {\n    this.id = id;\n    this.authKey = authKey;\n    this.baseUrl = CRONITOR_URL;\n  }\n\n  run = () => {\n    const urlObj = this.buildUrlObj({ action: ACTIONS.RUN });\n    const url = this.buildUrl({ urlObj });\n    return this.getWithTimeout({ url });\n  };\n\n  complete = (msg) => {\n    const urlObj = this.buildUrlObj({ action: ACTIONS.COMPLETE });\n    if (msg) {\n      if (!urlObj.qs) {\n        urlObj.qs = {};\n      }\n\n      urlObj.qs.msg = JSON.stringify(msg);\n    }\n    const url = this.buildUrl({ urlObj });\n    return this.getWithTimeout({ url });\n  };\n\n  pause = (hours) => {\n    const urlObj = this.buildUrlObj({ action: ACTIONS.PAUSE });\n    urlObj.basePath = `${urlObj.basePath}/${hours}`;\n    const url = this.buildUrl({ urlObj });\n    return this.getWithTimeout({ url });\n  };\n\n  fail = (msg) => {\n    const urlObj = this.buildUrlObj({ action: ACTIONS.FAIL });\n    if (msg) {\n      if (!urlObj.qs) {\n        urlObj.qs = {};\n      }\n\n      if (msg.sanitizedError) {\n        urlObj.qs.msg = JSON.stringify(msg.sanitizedError.message);\n      } else {\n        urlObj.qs.msg = JSON.stringify(msg);\n      }\n    }\n    const url = this.buildUrl({ urlObj });\n    return this.getWithTimeout({ url });\n  };\n\n  buildUrlObj = ({ action }) => {\n    const urlObj = { basePath: `${this.baseUrl}/${this.id}/${action}` };\n    if (this.authKey) {\n      urlObj.qs = { auth_key: this.authKey };\n    }\n\n    return urlObj;\n  };\n\n  buildUrl = ({ urlObj }) =>\n    urlObj.basePath + (urlObj.qs ? `?${queryString.stringify(urlObj.qs)}` : '');\n\n  getWithTimeout = ({ url }) => {\n    const promise = new Promise((resolve, reject) => {\n      https\n        .get(url, (response) => {\n          let data = '';\n\n          response.on('data', (chunk) => {\n            data += chunk;\n          });\n\n          response.on('end', () => {\n            resolve(data);\n          });\n        })\n        .on('error', reject);\n    });\n\n    const timeout = new Promise((resolve, reject) => {\n      const wait = Meteor.setTimeout(() => {\n        Meteor.clearTimeout(wait);\n        reject(new Meteor.Error('Timed out'));\n      }, REQ_TIMEOUT);\n    });\n\n    return Promise.race([promise, timeout]);\n  };\n}\n"]},"sourceType":"script","hash":"911014bbc3044c3e180db30b7cb3d3a8716a3c99"}
