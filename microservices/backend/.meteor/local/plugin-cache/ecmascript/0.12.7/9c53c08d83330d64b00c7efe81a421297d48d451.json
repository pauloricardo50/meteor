{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/Florian/dev/epotek/microservices/backend/imports/core/components/AutoForm2/CustomSelectFieldContainer.jsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties",["flow",{}],"dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"imports/core/components/AutoForm2/CustomSelectFieldContainer.jsx","filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/components/AutoForm2/CustomSelectFieldContainer.jsx","inputSourceMap":{"version":3,"sources":["imports/core/components/AutoForm2/CustomSelectFieldContainer.jsx"],"names":["React","PureComponent","T","Chip","Loading","Component","CustomSelectFieldContainer","constructor","props","customAllowedValues","model","parent","values","state","setState","loading","length","Promise","resolve","then","Number","name","slice","result","finally","query","params","allowNull","clone","fetch","error","data","ids","map","_id","option","allowedValuesIntlId","intlId","value","transform","makeTransform","placeholder","Array","isArray","val","formatOption","marginRight","find","item","allowedValues","componentDidMount","getAllowedValues","componentWillReceiveProps","nextProps","nextModel","render","displayEmpty","uniforms","field","fields","rest","message","reason","renderValue","defaultProps"],"mappings":";;AAAA,OAAOA,KAAP,IAAgBC,aAAhB,QAAqC,OAArC;AAEA,OAAOC,CAAP;AACA,OAAOC,IAAP;AACA,OAAOC,OAAP;AAEA,gBAAgBC,SAAD,IAAe;AAC5B,QAAMC,0BAAN,SAAyCL,aAAzC,CAAuD;AACrDM,IAAAA,WAAW,CAACC,MAAD,EAAQ;AACjB,YAAMA,MAAN;;AADiB,gDAkBCA,KAAD,IAAW;AAC5B,cAAM;AAAEC,UAAAA,mBAAF;AAAuBC,UAAAA,KAAvB;AAA8BC,UAAAA;AAA9B,YAAyCH,KAA/C;AACA,cAAM;AAAEI,UAAAA;AAAF,YAAa,KAAKC,KAAxB;;AAEA,YAAIJ,mBAAJ,EAAyB;AACvB,eAAKK,QAAL,CAAc;AAAEC,YAAAA,OAAO,EAAE,CAACH,MAAD,IAAW,CAACA,MAAM,CAACI;AAA9B,WAAd;AACD;;AAED,YAAIP,mBAAmB,IAAI,OAAOA,mBAAP,KAA+B,UAA1D,EAAsE;AACpEQ,UAAAA,OAAO,CAACC,OAAR,GACGC,IADH,CACQ,MACJV,mBAAmB,CAACC,KAAD,EAAQC,MAAM,IAAIS,MAAM,CAACT,MAAM,CAACU,IAAP,CAAYC,KAAZ,CAAkB,CAAC,CAAnB,CAAD,CAAxB,CAFvB,EAGGH,IAHH,CAGQI,MAAM,IAAI,KAAKT,QAAL,CAAc;AAAEF,YAAAA,MAAM,EAAEW;AAAV,WAAd,CAHlB,EAIGC,OAJH,CAIW,MAAM,KAAKV,QAAL,CAAc;AAAEC,YAAAA,OAAO,EAAE;AAAX,WAAd,CAJjB;AAKD,SAND,MAMO,IACLN,mBAAmB,IAChB,OAAOA,mBAAP,KAA+B,QAF7B,EAGL;AACA,gBAAM;AAAEgB,YAAAA,KAAF;AAASC,YAAAA,MAAM,GAAG,OAAO,EAAP,CAAlB;AAA8BC,YAAAA;AAA9B,cAA4ClB,mBAAlD;AAEAgB,UAAAA,KAAK,CAACG,KAAN,CAAYF,MAAM,CAAChB,KAAD,CAAlB,EAA2BmB,KAA3B,CAAiC,CAACC,KAAD,EAAQC,IAAR,KAAiB;AAChD,gBAAID,KAAJ,EAAW;AACT,qBAAO,KAAKhB,QAAL,CAAc;AAAEgB,gBAAAA;AAAF,eAAd,CAAP;AACD;;AAED,kBAAME,GAAG,GAAGD,IAAI,CAACE,GAAL,CAAS,CAAC;AAAEC,cAAAA;AAAF,aAAD,KAAaA,GAAtB,CAAZ;AAEA,iBAAKpB,QAAL,CAAc;AACZF,cAAAA,MAAM,EAAEe,SAAS,GAAG,CAAC,IAAD,EAAO,GAAGK,GAAV,CAAH,GAAoBA,GADzB;AAEZD,cAAAA,IAAI,EAAEJ,SAAS,GAAG,CAAC,IAAD,EAAO,GAAGI,IAAV,CAAH,GAAqBA,IAFxB;AAGZD,cAAAA,KAAK,EAAE,IAHK;AAIZf,cAAAA,OAAO,EAAE;AAJG,aAAd;AAMD,WAbD;AAcD;AACF,OArDkB;;AAAA,4CAuDHoB,MAAD,IAAY;AACzB,cAAM;AAAEC,UAAAA,mBAAF;AAAuBC,UAAAA,MAAvB;AAA+BhB,UAAAA;AAA/B,YAAwC,KAAKb,KAAnD;AACA,eACE,CAAC,CAAD,CAAG,GAAG,CAAE,SAAQ4B,mBAAmB,IAAIC,MAAvB,IAAiChB,IAAK,IAAGc,MAAO,EAA1D,CAAN,GADF;AAGD,OA5DkB;;AAAA,2CA8DJG,KAAD,IAAW;AACvB,cAAMC,SAAS,GAAG,KAAKC,aAAL,EAAlB;AACA,cAAM;AAAEC,UAAAA;AAAF,YAAkB,KAAKjC,KAA7B;;AAEA,YAAI,CAAC8B,KAAL,EAAY;AACV,iBAAOG,WAAP;AACD;;AAED,YAAIC,KAAK,CAACC,OAAN,CAAcL,KAAd,CAAJ,EAA0B;AACxB,cAAIA,KAAK,CAACtB,MAAN,KAAiB,CAArB,EAAwB;AACtB,mBAAOyB,WAAP;AACD;;AACD,iBAAOH,KAAK,CAACL,GAAN,CAAUW,GAAG,IAClB,CAAC,IAAD,CACE,IAAI,CAACA,GAAD,CADN,CAEE,MAAM,CAACL,SAAS,GAAGA,SAAS,CAACK,GAAD,CAAZ,GAAoB,KAAKC,YAAL,CAAkBD,GAAlB,CAA9B,CAFR,CAGE,MAAM,CAAC;AAAEE,YAAAA,WAAW,EAAE;AAAf,WAAD,CAHR,GADK,CAAP;AAOD;;AAED,YAAIP,SAAJ,EAAe;AACb,iBAAOA,SAAS,CAACD,KAAD,CAAhB;AACD;;AAED,eAAO,KAAKO,YAAL,CAAkBP,KAAlB,CAAP;AACD,OAxFkB;;AAAA,6CA0FH,MAAM;AACpB,cAAM;AAAEC,UAAAA;AAAF,YAAgB,KAAK/B,KAA3B;AACA,cAAM;AAAEuB,UAAAA;AAAF,YAAW,KAAKlB,KAAtB;;AACA,YAAIkB,IAAJ,EAAU;AACR,iBAAQO,KAAD,IAAW;AAChB,gBAAI,CAACA,KAAL,EAAY;AACV;AACA,qBAAOC,SAAS,CAACD,KAAD,CAAhB;AACD;;AACD,mBAAOC,SAAS,CAACR,IAAI,CAACgB,IAAL,CAAUC,IAAI,IAAI,CAACA,IAAI,IAAIA,IAAI,CAACd,GAAd,MAAuBI,KAAzC,CAAD,CAAhB;AACD,WAND;AAOD;;AACD,eAAOC,SAAP;AACD,OAvGkB;;AAEjB,WAAK1B,KAAL,GAAa;AAAED,QAAAA,MAAM,EAAEJ,MAAK,CAACyC,aAAhB;AAA+BlB,QAAAA,IAAI,EAAE,IAArC;AAA2CD,QAAAA,KAAK,EAAE;AAAlD,OAAb;AACD;;AAEDoB,IAAAA,iBAAiB,GAAG;AAClB,WAAKC,gBAAL,CAAsB,KAAK3C,KAA3B;AACD;;AAED4C,IAAAA,yBAAyB,CAACC,SAAD,EAAY;AACnC,YAAM;AAAE3C,QAAAA,KAAK,EAAE4C;AAAT,UAAuBD,SAA7B;AACA,YAAM;AAAE3C,QAAAA;AAAF,UAAY,KAAKF,KAAvB;;AAEA,UAAIE,KAAK,KAAK4C,SAAd,EAAyB;AACvB,aAAKH,gBAAL,CAAsBE,SAAtB;AACD;AACF;;AAyFDE,IAAAA,MAAM,GAAG;AACP,YAAM;AAAE3C,QAAAA,MAAF;AAAUkB,QAAAA,KAAV;AAAiBf,QAAAA;AAAjB,UAA6B,KAAKF,KAAxC;AACA,YAAM;AACJ4B,QAAAA,WADI;AAEJe,QAAAA,YAFI;AAGJ9C,QAAAA,KAHI;AAIJ+C,QAAAA,QAJI;AAKJC,QAAAA,KALI;AAMJC,QAAAA,MANI;AAOJ,WAAGC;AAPC,UAQF,KAAKpD,KART;;AAUA,UAAIsB,KAAJ,EAAW;AACT,eAAO,CAAC,IAAD,CAAM,UAAU,OAAhB,CAAwB,CAACA,KAAK,CAAC+B,OAAN,IAAiB/B,KAAK,CAACgC,MAAxB,CAA+B,EAAE,IAAF,CAA9D;AACD;;AAED,UAAI/C,OAAJ,EAAa;AACX,eAAO,CAAC,OAAD,CAAS,KAAT,GAAP;AACD;;AAED,aACE,CAAC,SAAD,CACE,IAAI6C,IAAJ,CADF,CAEE,YAAY,CAACJ,YAAY,GAAGf,WAAH,GAAiB,EAA9B,CAFd,CAGE,OAAO,CAAC7B,MAAD,CAHT,CAIE,aAAa,CAAC,KAAKiC,YAAN,CAJf,CAKE,YAAY,CAAC,KAAKkB,WAAN,CALd,CAME,UAAU,CAAC,KAAKvB,aAAL,MAAwB,KAAKK,YAA9B,CANZ,GADF;AAUD;;AAxIoD;;AA2IvDvC,EAAAA,0BAA0B,CAAC0D,YAA3B,GAA0C;AACxCR,IAAAA,YAAY,EAAE;AAD0B,GAA1C;AAIA,SAAOlD,0BAAP;AACD,CAjJD","sourcesContent":["import React, { PureComponent } from 'react';\n\nimport T from '../Translation';\nimport Chip from '../Material/Chip';\nimport Loading from '../Loading';\n\nexport default (Component) => {\n  class CustomSelectFieldContainer extends PureComponent {\n    constructor(props) {\n      super(props);\n      this.state = { values: props.allowedValues, data: null, error: null };\n    }\n\n    componentDidMount() {\n      this.getAllowedValues(this.props);\n    }\n\n    componentWillReceiveProps(nextProps) {\n      const { model: nextModel } = nextProps;\n      const { model } = this.props;\n\n      if (model !== nextModel) {\n        this.getAllowedValues(nextProps);\n      }\n    }\n\n    getAllowedValues = (props) => {\n      const { customAllowedValues, model, parent } = props;\n      const { values } = this.state;\n\n      if (customAllowedValues) {\n        this.setState({ loading: !values || !values.length });\n      }\n\n      if (customAllowedValues && typeof customAllowedValues === 'function') {\n        Promise.resolve()\n          .then(() =>\n            customAllowedValues(model, parent && Number(parent.name.slice(-1))))\n          .then(result => this.setState({ values: result }))\n          .finally(() => this.setState({ loading: false }));\n      } else if (\n        customAllowedValues\n        && typeof customAllowedValues === 'object'\n      ) {\n        const { query, params = () => ({}), allowNull } = customAllowedValues;\n\n        query.clone(params(model)).fetch((error, data) => {\n          if (error) {\n            return this.setState({ error });\n          }\n\n          const ids = data.map(({ _id }) => _id);\n\n          this.setState({\n            values: allowNull ? [null, ...ids] : ids,\n            data: allowNull ? [null, ...data] : data,\n            error: null,\n            loading: false,\n          });\n        });\n      }\n    };\n\n    formatOption = (option) => {\n      const { allowedValuesIntlId, intlId, name } = this.props;\n      return (\n        <T id={`Forms.${allowedValuesIntlId || intlId || name}.${option}`} />\n      );\n    };\n\n    renderValue = (value) => {\n      const transform = this.makeTransform();\n      const { placeholder } = this.props;\n\n      if (!value) {\n        return placeholder;\n      }\n\n      if (Array.isArray(value)) {\n        if (value.length === 0) {\n          return placeholder;\n        }\n        return value.map(val => (\n          <Chip\n            key={val}\n            label={transform ? transform(val) : this.formatOption(val)}\n            style={{ marginRight: 4 }}\n          />\n        ));\n      }\n\n      if (transform) {\n        return transform(value);\n      }\n\n      return this.formatOption(value);\n    };\n\n    makeTransform = () => {\n      const { transform } = this.props;\n      const { data } = this.state;\n      if (data) {\n        return (value) => {\n          if (!value) {\n            // If the value is falsy, just transform it\n            return transform(value);\n          }\n          return transform(data.find(item => (item && item._id) === value));\n        };\n      }\n      return transform;\n    };\n\n    render() {\n      const { values, error, loading } = this.state;\n      const {\n        placeholder,\n        displayEmpty,\n        model,\n        uniforms,\n        field,\n        fields,\n        ...rest\n      } = this.props;\n\n      if (error) {\n        return <span className=\"error\">{error.message || error.reason}</span>;\n      }\n\n      if (loading) {\n        return <Loading small />;\n      }\n\n      return (\n        <Component\n          {...rest}\n          placeholder={displayEmpty ? placeholder : ''}\n          values={values}\n          formatOption={this.formatOption}\n          renderValue={this.renderValue}\n          transform={this.makeTransform() || this.formatOption}\n        />\n      );\n    }\n  }\n\n  CustomSelectFieldContainer.defaultProps = {\n    displayEmpty: true,\n  };\n\n  return CustomSelectFieldContainer;\n};\n"]},"passPerPreset":false,"envName":"development","cwd":"/Users/Florian/dev/epotek/microservices/backend","root":"/Users/Florian/dev/epotek/microservices/backend","plugins":[{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/components/AutoForm2/CustomSelectFieldContainer.jsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/core/components/AutoForm2/CustomSelectFieldContainer.jsx"}},"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _objectWithoutProperties2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectWithoutProperties\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nvar _inheritsLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inheritsLoose\"));\n\nvar React, PureComponent;\nmodule.link(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  PureComponent: function (v) {\n    PureComponent = v;\n  }\n}, 0);\nvar T;\nmodule.link(\"../Translation\", {\n  \"default\": function (v) {\n    T = v;\n  }\n}, 1);\nvar Chip;\nmodule.link(\"../Material/Chip\", {\n  \"default\": function (v) {\n    Chip = v;\n  }\n}, 2);\nvar Loading;\nmodule.link(\"../Loading\", {\n  \"default\": function (v) {\n    Loading = v;\n  }\n}, 3);\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exportDefault(function (Component) {\n  var CustomSelectFieldContainer =\n  /*#__PURE__*/\n  function (_PureComponent) {\n    (0, _inheritsLoose2.default)(CustomSelectFieldContainer, _PureComponent);\n\n    function CustomSelectFieldContainer(_props) {\n      var _this;\n\n      _this = _PureComponent.call(this, _props) || this;\n\n      _defineProperty((0, _assertThisInitialized2.default)(_this), \"getAllowedValues\", function (props) {\n        var customAllowedValues = props.customAllowedValues,\n            model = props.model,\n            parent = props.parent;\n        var values = _this.state.values;\n\n        if (customAllowedValues) {\n          _this.setState({\n            loading: !values || !values.length\n          });\n        }\n\n        if (customAllowedValues && typeof customAllowedValues === 'function') {\n          Promise.resolve().then(function () {\n            return customAllowedValues(model, parent && Number(parent.name.slice(-1)));\n          }).then(function (result) {\n            return _this.setState({\n              values: result\n            });\n          }).finally(function () {\n            return _this.setState({\n              loading: false\n            });\n          });\n        } else if (customAllowedValues && (0, _typeof2.default)(customAllowedValues) === 'object') {\n          var query = customAllowedValues.query,\n              _customAllowedValues$ = customAllowedValues.params,\n              params = _customAllowedValues$ === void 0 ? function () {\n            return {};\n          } : _customAllowedValues$,\n              allowNull = customAllowedValues.allowNull;\n          query.clone(params(model)).fetch(function (error, data) {\n            if (error) {\n              return _this.setState({\n                error: error\n              });\n            }\n\n            var ids = data.map(function (_ref) {\n              var _id = _ref._id;\n              return _id;\n            });\n\n            _this.setState({\n              values: allowNull ? [null].concat((0, _toConsumableArray2.default)(ids)) : ids,\n              data: allowNull ? [null].concat((0, _toConsumableArray2.default)(data)) : data,\n              error: null,\n              loading: false\n            });\n          });\n        }\n      });\n\n      _defineProperty((0, _assertThisInitialized2.default)(_this), \"formatOption\", function (option) {\n        var _this$props = _this.props,\n            allowedValuesIntlId = _this$props.allowedValuesIntlId,\n            intlId = _this$props.intlId,\n            name = _this$props.name;\n        return React.createElement(T, {\n          id: \"Forms.\" + (allowedValuesIntlId || intlId || name) + \".\" + option\n        });\n      });\n\n      _defineProperty((0, _assertThisInitialized2.default)(_this), \"renderValue\", function (value) {\n        var transform = _this.makeTransform();\n\n        var placeholder = _this.props.placeholder;\n\n        if (!value) {\n          return placeholder;\n        }\n\n        if (Array.isArray(value)) {\n          if (value.length === 0) {\n            return placeholder;\n          }\n\n          return value.map(function (val) {\n            return React.createElement(Chip, {\n              key: val,\n              label: transform ? transform(val) : _this.formatOption(val),\n              style: {\n                marginRight: 4\n              }\n            });\n          });\n        }\n\n        if (transform) {\n          return transform(value);\n        }\n\n        return _this.formatOption(value);\n      });\n\n      _defineProperty((0, _assertThisInitialized2.default)(_this), \"makeTransform\", function () {\n        var transform = _this.props.transform;\n        var data = _this.state.data;\n\n        if (data) {\n          return function (value) {\n            if (!value) {\n              // If the value is falsy, just transform it\n              return transform(value);\n            }\n\n            return transform(data.find(function (item) {\n              return (item && item._id) === value;\n            }));\n          };\n        }\n\n        return transform;\n      });\n\n      _this.state = {\n        values: _props.allowedValues,\n        data: null,\n        error: null\n      };\n      return _this;\n    }\n\n    var _proto = CustomSelectFieldContainer.prototype;\n\n    _proto.componentDidMount = function () {\n      function componentDidMount() {\n        this.getAllowedValues(this.props);\n      }\n\n      return componentDidMount;\n    }();\n\n    _proto.componentWillReceiveProps = function () {\n      function componentWillReceiveProps(nextProps) {\n        var nextModel = nextProps.model;\n        var model = this.props.model;\n\n        if (model !== nextModel) {\n          this.getAllowedValues(nextProps);\n        }\n      }\n\n      return componentWillReceiveProps;\n    }();\n\n    _proto.render = function () {\n      function render() {\n        var _this$state = this.state,\n            values = _this$state.values,\n            error = _this$state.error,\n            loading = _this$state.loading;\n        var _this$props2 = this.props,\n            placeholder = _this$props2.placeholder,\n            displayEmpty = _this$props2.displayEmpty,\n            model = _this$props2.model,\n            uniforms = _this$props2.uniforms,\n            field = _this$props2.field,\n            fields = _this$props2.fields,\n            rest = (0, _objectWithoutProperties2.default)(_this$props2, [\"placeholder\", \"displayEmpty\", \"model\", \"uniforms\", \"field\", \"fields\"]);\n\n        if (error) {\n          return React.createElement(\"span\", {\n            className: \"error\"\n          }, error.message || error.reason);\n        }\n\n        if (loading) {\n          return React.createElement(Loading, {\n            small: true\n          });\n        }\n\n        return React.createElement(Component, (0, _extends2.default)({}, rest, {\n          placeholder: displayEmpty ? placeholder : '',\n          values: values,\n          formatOption: this.formatOption,\n          renderValue: this.renderValue,\n          transform: this.makeTransform() || this.formatOption\n        }));\n      }\n\n      return render;\n    }();\n\n    return CustomSelectFieldContainer;\n  }(PureComponent);\n\n  CustomSelectFieldContainer.defaultProps = {\n    displayEmpty: true\n  };\n  return CustomSelectFieldContainer;\n});","map":{"version":3,"sources":["imports/core/components/AutoForm2/CustomSelectFieldContainer.jsx"],"names":["Component","constructor","values","props","data","error","componentDidMount","componentWillReceiveProps","model","nextModel","parent","loading","length","customAllowedValues","Promise","Number","result","params","allowNull","query","ids","_id","option","name","allowedValuesIntlId","value","transform","placeholder","Array","val","marginRight","item","render","rest","displayEmpty","CustomSelectFieldContainer"],"mappings":"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","sourcesContent":["import React, { PureComponent } from 'react';\n\nimport T from '../Translation';\nimport Chip from '../Material/Chip';\nimport Loading from '../Loading';\n\nexport default (Component) => {\n  class CustomSelectFieldContainer extends PureComponent {\n    constructor(props) {\n      super(props);\n      this.state = { values: props.allowedValues, data: null, error: null };\n    }\n\n    componentDidMount() {\n      this.getAllowedValues(this.props);\n    }\n\n    componentWillReceiveProps(nextProps) {\n      const { model: nextModel } = nextProps;\n      const { model } = this.props;\n\n      if (model !== nextModel) {\n        this.getAllowedValues(nextProps);\n      }\n    }\n\n    getAllowedValues = (props) => {\n      const { customAllowedValues, model, parent } = props;\n      const { values } = this.state;\n\n      if (customAllowedValues) {\n        this.setState({ loading: !values || !values.length });\n      }\n\n      if (customAllowedValues && typeof customAllowedValues === 'function') {\n        Promise.resolve()\n          .then(() =>\n            customAllowedValues(model, parent && Number(parent.name.slice(-1))))\n          .then(result => this.setState({ values: result }))\n          .finally(() => this.setState({ loading: false }));\n      } else if (\n        customAllowedValues\n        && typeof customAllowedValues === 'object'\n      ) {\n        const { query, params = () => ({}), allowNull } = customAllowedValues;\n\n        query.clone(params(model)).fetch((error, data) => {\n          if (error) {\n            return this.setState({ error });\n          }\n\n          const ids = data.map(({ _id }) => _id);\n\n          this.setState({\n            values: allowNull ? [null, ...ids] : ids,\n            data: allowNull ? [null, ...data] : data,\n            error: null,\n            loading: false,\n          });\n        });\n      }\n    };\n\n    formatOption = (option) => {\n      const { allowedValuesIntlId, intlId, name } = this.props;\n      return (\n        <T id={`Forms.${allowedValuesIntlId || intlId || name}.${option}`} />\n      );\n    };\n\n    renderValue = (value) => {\n      const transform = this.makeTransform();\n      const { placeholder } = this.props;\n\n      if (!value) {\n        return placeholder;\n      }\n\n      if (Array.isArray(value)) {\n        if (value.length === 0) {\n          return placeholder;\n        }\n        return value.map(val => (\n          <Chip\n            key={val}\n            label={transform ? transform(val) : this.formatOption(val)}\n            style={{ marginRight: 4 }}\n          />\n        ));\n      }\n\n      if (transform) {\n        return transform(value);\n      }\n\n      return this.formatOption(value);\n    };\n\n    makeTransform = () => {\n      const { transform } = this.props;\n      const { data } = this.state;\n      if (data) {\n        return (value) => {\n          if (!value) {\n            // If the value is falsy, just transform it\n            return transform(value);\n          }\n          return transform(data.find(item => (item && item._id) === value));\n        };\n      }\n      return transform;\n    };\n\n    render() {\n      const { values, error, loading } = this.state;\n      const {\n        placeholder,\n        displayEmpty,\n        model,\n        uniforms,\n        field,\n        fields,\n        ...rest\n      } = this.props;\n\n      if (error) {\n        return <span className=\"error\">{error.message || error.reason}</span>;\n      }\n\n      if (loading) {\n        return <Loading small />;\n      }\n\n      return (\n        <Component\n          {...rest}\n          placeholder={displayEmpty ? placeholder : ''}\n          values={values}\n          formatOption={this.formatOption}\n          renderValue={this.renderValue}\n          transform={this.makeTransform() || this.formatOption}\n        />\n      );\n    }\n  }\n\n  CustomSelectFieldContainer.defaultProps = {\n    displayEmpty: true,\n  };\n\n  return CustomSelectFieldContainer;\n};\n"]},"sourceType":"script","hash":"9c53c08d83330d64b00c7efe81a421297d48d451"}
