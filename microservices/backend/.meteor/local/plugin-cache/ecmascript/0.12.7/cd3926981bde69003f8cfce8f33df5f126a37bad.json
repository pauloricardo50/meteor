{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/Florian/dev/epotek/microservices/backend/imports/core/utils/FinanceCalculator/FinanceCalculator.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties",["flow",{}],"dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"imports/core/utils/FinanceCalculator/FinanceCalculator.js","filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/utils/FinanceCalculator/FinanceCalculator.js","inputSourceMap":{"version":3,"sources":["imports/core/utils/FinanceCalculator/FinanceCalculator.js"],"names":["GENDER","SUCCESS","ERROR","WARNING","RESIDENCE_TYPE","REAL_ESTATE_CONSIDERATION_TYPES","EXPENSE_TYPES_WITHOUT_DELTAS","AMORTIZATION_STOP","AMORTIZATION_YEARS","AVERAGE_TAX_RATE","BONUS_ALGORITHMS","BONUS_CONSIDERATION","BONUS_HISTORY_TO_CONSIDER","COMPANY_INCOME_TO_CONSIDER","DEFAULT_AMORTIZATION","DIVIDENDS_CONSIDERATION","DIVIDENDS_HISTORY_TO_CONSIDER","ESTIMATED_COMMISSION","FORTUNE_RETURNS_RATIO","INTERESTS_FINMA","INVESTMENT_INCOME_CONSIDERATION","MAINTENANCE_FINMA","MAX_BORROW_RATIO_PRIMARY_PROPERTY","MAX_BORROW_RATIO_WITH_PLEDGE","MAX_INCOME_RATIO_TIGHT","MAX_INCOME_RATIO","MIN_CASH","NOTARY_FEES","OWN_FUNDS_ROUNDING_AMOUNT","PENSION_INCOME_CONSIDERATION","REAL_ESTATE_INCOME_ALGORITHMS","REAL_ESTATE_INCOME_CONSIDERATION","REFERRAL_COMMISSION_SPLIT","REFERRAL_COMMISSION","MiddlewareManager","precisionMiddleware","memoizeMiddleware","FinanceCalculator","constructor","settings","Object","middlewares","Array","Function","middlewareObject","middlewareManager","applyToAllMethods","age1","age2","gender1","gender2","retirement1","getRetirementForGender","gender","retirement2","toRetirement1","toRetirement2","yearsToRetirement","Math","min","max","nF","r","i","mR","m","income","fortune","incomeLimited1","incomeLimited2","floor","initFinanceCalculator","allowPledge","amortizationBaseRate","amortizationGoal","amortizationYears","bonusAlgorithm","WEAK_AVERAGE","bonusConsideration","bonusHistoryToConsider","companyIncomeHistoryToConsider","dividendsConsideration","dividendsHistoryToConsider","expensesSubtractFromIncome","fortuneReturnsRatio","investmentIncomeConsideration","maxBorrowRatio","maxBorrowRatioWithPledge","maxIncomeRatio","maxIncomeRatioTight","minCash","notaryFees","ownFundsRoundingAmount","pensionIncomeConsideration","realEstateIncomeAlgorithm","DEFAULT","realEstateIncomeConsideration","realEstateIncomeConsiderationType","ADD_TO_INCOME","taxRate","theoreticalInterestRate","theoreticalInterestRate2ndRank","theoreticalMaintenanceRate","estimatedCommission","referralCommission","referralCommissionSplit","setMiddleware","getLoanValue","propertyValue","propertyWork","pledgedValue","fees","getFeesBase","getPropAndWork","getBorrowRatio","loan","getLoanFromBorrowRatio","borrowRatio","getBorrowRatioWithoutLoan","getBorrowRatioStatus","M","F","getIncomeRatio","monthlyIncome","monthlyPayment","getIncomeRatioStatus","incomeRatio","getLoanCost","maintenance","interests","amortization","getLoanCostWithParts","total","checkInterestsAndTranches","tranches","interestRates","type","value","reduce","invalidRate","undefined","getInterestsWithTranches","acc","rate","getAmortizationRateBase","amortizationRate","amountToAmortize","getMaxLoanBase","pledgedAmount","residenceType","MAIN_RESIDENCE","getTheoreticalMonthly","propAndWork","loanValue","getNotaryFeesRate","getMinCash","getAveragedInterestRate","totalRate"],"mappings":"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","sourcesContent":["// @flow\nimport {\n  GENDER,\n  SUCCESS,\n  ERROR,\n  WARNING,\n  RESIDENCE_TYPE,\n  REAL_ESTATE_CONSIDERATION_TYPES,\n  EXPENSE_TYPES_WITHOUT_DELTAS,\n} from '../../api/constants';\nimport {\n  AMORTIZATION_STOP,\n  AMORTIZATION_YEARS,\n  AVERAGE_TAX_RATE,\n  BONUS_ALGORITHMS,\n  BONUS_CONSIDERATION,\n  BONUS_HISTORY_TO_CONSIDER,\n  COMPANY_INCOME_TO_CONSIDER,\n  DEFAULT_AMORTIZATION,\n  DIVIDENDS_CONSIDERATION,\n  DIVIDENDS_HISTORY_TO_CONSIDER,\n  ESTIMATED_COMMISSION,\n  FORTUNE_RETURNS_RATIO,\n  INTERESTS_FINMA,\n  INVESTMENT_INCOME_CONSIDERATION,\n  MAINTENANCE_FINMA,\n  MAX_BORROW_RATIO_PRIMARY_PROPERTY,\n  MAX_BORROW_RATIO_WITH_PLEDGE,\n  MAX_INCOME_RATIO_TIGHT,\n  MAX_INCOME_RATIO,\n  MIN_CASH,\n  NOTARY_FEES,\n  OWN_FUNDS_ROUNDING_AMOUNT,\n  PENSION_INCOME_CONSIDERATION,\n  REAL_ESTATE_INCOME_ALGORITHMS,\n  REAL_ESTATE_INCOME_CONSIDERATION,\n  REFERRAL_COMMISSION_SPLIT,\n  REFERRAL_COMMISSION,\n} from '../../config/financeConstants';\nimport MiddlewareManager from '../MiddlewareManager';\nimport { precisionMiddleware } from './financeCalculatorMiddlewares';\nimport { memoizeMiddleware } from '../Calculator/middleware';\n\nexport class FinanceCalculator {\n  constructor(settings?: Object) {\n    this.initFinanceCalculator(settings);\n  }\n\n  notaryFees: number;\n\n  amortizationBaseRate: number;\n\n  amortizationGoal: number;\n\n  initFinanceCalculator({\n    allowPledge = true,\n    amortizationBaseRate = DEFAULT_AMORTIZATION,\n    amortizationGoal = AMORTIZATION_STOP,\n    amortizationYears = AMORTIZATION_YEARS,\n    bonusAlgorithm = BONUS_ALGORITHMS.WEAK_AVERAGE,\n    bonusConsideration = BONUS_CONSIDERATION,\n    bonusHistoryToConsider = BONUS_HISTORY_TO_CONSIDER,\n    companyIncomeHistoryToConsider = COMPANY_INCOME_TO_CONSIDER,\n    dividendsConsideration = DIVIDENDS_CONSIDERATION,\n    dividendsHistoryToConsider = DIVIDENDS_HISTORY_TO_CONSIDER,\n    expensesSubtractFromIncome = EXPENSE_TYPES_WITHOUT_DELTAS,\n    fortuneReturnsRatio = FORTUNE_RETURNS_RATIO,\n    investmentIncomeConsideration = INVESTMENT_INCOME_CONSIDERATION,\n    maxBorrowRatio = MAX_BORROW_RATIO_PRIMARY_PROPERTY,\n    maxBorrowRatioWithPledge = MAX_BORROW_RATIO_WITH_PLEDGE,\n    maxIncomeRatio = MAX_INCOME_RATIO,\n    maxIncomeRatioTight = MAX_INCOME_RATIO_TIGHT,\n    minCash = MIN_CASH,\n    notaryFees = NOTARY_FEES,\n    ownFundsRoundingAmount = OWN_FUNDS_ROUNDING_AMOUNT,\n    pensionIncomeConsideration = PENSION_INCOME_CONSIDERATION,\n    realEstateIncomeAlgorithm = REAL_ESTATE_INCOME_ALGORITHMS.DEFAULT,\n    realEstateIncomeConsideration = REAL_ESTATE_INCOME_CONSIDERATION,\n    realEstateIncomeConsiderationType = REAL_ESTATE_CONSIDERATION_TYPES.ADD_TO_INCOME,\n    taxRate = AVERAGE_TAX_RATE,\n    theoreticalInterestRate = INTERESTS_FINMA,\n    theoreticalInterestRate2ndRank = null,\n    theoreticalMaintenanceRate = MAINTENANCE_FINMA,\n    estimatedCommission = ESTIMATED_COMMISSION,\n    referralCommission = REFERRAL_COMMISSION,\n    referralCommissionSplit = REFERRAL_COMMISSION_SPLIT,\n    middlewares = [],\n    middlewareObject,\n  } = {}) {\n    this.allowPledge = allowPledge;\n    this.amortizationBaseRate = amortizationBaseRate;\n    this.amortizationGoal = amortizationGoal;\n    this.amortizationYears = amortizationYears;\n    this.bonusAlgorithm = bonusAlgorithm;\n    this.bonusConsideration = bonusConsideration;\n    this.bonusHistoryToConsider = bonusHistoryToConsider;\n    this.companyIncomeHistoryToConsider = companyIncomeHistoryToConsider;\n    this.dividendsConsideration = dividendsConsideration;\n    this.dividendsHistoryToConsider = dividendsHistoryToConsider;\n    this.expensesSubtractFromIncome = expensesSubtractFromIncome;\n    this.fortuneReturnsRatio = fortuneReturnsRatio;\n    this.investmentIncomeConsideration = investmentIncomeConsideration;\n    this.maxBorrowRatio = maxBorrowRatio;\n    this.maxBorrowRatioWithPledge = maxBorrowRatioWithPledge;\n    this.maxIncomeRatio = maxIncomeRatio;\n    this.maxIncomeRatioTight = maxIncomeRatioTight;\n    this.minCash = minCash;\n    this.notaryFees = notaryFees;\n    this.ownFundsRoundingAmount = ownFundsRoundingAmount;\n    this.pensionIncomeConsideration = pensionIncomeConsideration;\n    this.realEstateIncomeAlgorithm = realEstateIncomeAlgorithm;\n    this.realEstateIncomeConsideration = realEstateIncomeConsideration;\n    this.realEstateIncomeConsiderationType = realEstateIncomeConsiderationType;\n    this.taxRate = taxRate;\n    this.theoreticalInterestRate = theoreticalInterestRate;\n    this.theoreticalInterestRate2ndRank = theoreticalInterestRate2ndRank;\n    this.theoreticalMaintenanceRate = theoreticalMaintenanceRate;\n    this.estimatedCommission = estimatedCommission;\n    this.referralCommission = referralCommission;\n    this.referralCommissionSplit = referralCommissionSplit;\n    this.setMiddleware(middlewares, middlewareObject);\n  }\n\n  setMiddleware = (middlewares?: Array<Function>, middlewareObject) => {\n    const middlewareManager = new MiddlewareManager(this, middlewareObject);\n    middlewareManager.applyToAllMethods([\n      precisionMiddleware,\n      memoizeMiddleware,\n      ...middlewares,\n    ]);\n  };\n\n  getLoanValue({\n    propertyValue,\n    propertyWork = 0,\n    fortune,\n    pledgedValue = 0,\n    fees = this.getFeesBase({ propertyValue, propertyWork }),\n  }: {\n    propertyValue: number,\n    fortune: number,\n    pledgedValue?: number,\n    fees?: number,\n  }) {\n    return propertyValue + propertyWork + fees + pledgedValue - fortune;\n  }\n\n  getPropAndWork({ propertyValue, propertyWork }) {\n    return propertyValue + propertyWork;\n  }\n\n  getBorrowRatio({\n    propertyValue,\n    loan = 0,\n  }: {\n    propertyValue: number,\n    loan: number,\n  }) {\n    return loan / propertyValue;\n  }\n\n  getLoanFromBorrowRatio({\n    propertyValue,\n    borrowRatio,\n  }: {\n    propertyValue: number,\n    borrowRatio: number,\n  }) {\n    return borrowRatio * propertyValue;\n  }\n\n  getBorrowRatioWithoutLoan({\n    propertyValue,\n    fortune,\n  }: {\n    propertyValue: number,\n    fortune: number,\n  }) {\n    return this.getBorrowRatio({\n      propertyValue,\n      loan: this.getLoanValue({ propertyValue, fortune }),\n    });\n  }\n\n  getBorrowRatioStatus({ borrowRatio }) {\n    if (borrowRatio <= this.maxBorrowRatio) {\n      return SUCCESS;\n    }\n    if (borrowRatio <= this.maxBorrowRatioWithPledge) {\n      return WARNING;\n    }\n    return ERROR;\n  }\n\n  getRetirementForGender({ gender = GENDER.M }: { gender?: string } = {}) {\n    return gender === GENDER.F ? 64 : 65;\n  }\n\n  getIncomeRatio({\n    monthlyIncome,\n    monthlyPayment = 0,\n  }: {\n    monthlyIncome: number,\n    monthlyPayment: number,\n  }) {\n    return monthlyPayment / monthlyIncome;\n  }\n\n  getIncomeRatioStatus({ incomeRatio }) {\n    if (incomeRatio <= this.maxIncomeRatio) {\n      return SUCCESS;\n    }\n    if (this.maxIncomeRatioTight && incomeRatio <= this.maxIncomeRatioTight) {\n      // This ratio can be disabled, i.e. set to 0, and then it'll skip the warning\n      // and only display success or error\n      return WARNING;\n    }\n    return ERROR;\n  }\n\n  getLoanCost({\n    maintenance = 0,\n    interests = 0,\n    amortization = 0,\n  }: {\n    maintenance?: number,\n    interests?: number,\n    amortization?: number,\n  } = {}) {\n    return maintenance + interests + amortization;\n  }\n\n  getLoanCostWithParts({\n    maintenance,\n    interests,\n    amortization,\n  }: {\n    maintenance: number,\n    interests: number,\n    amortization?: number,\n  }) {\n    return {\n      maintenance,\n      interests,\n      amortization,\n      total: this.getLoanCost({ maintenance, interests, amortization }),\n    };\n  }\n\n  checkInterestsAndTranches({\n    tranches = [],\n    interestRates,\n  }: {\n    tranches: Array<{ type: string, value: number }>,\n    interestRates: Object,\n  }) {\n    return tranches.reduce((invalidRate, { type }) => {\n      if (invalidRate) {\n        return invalidRate;\n      }\n\n      if (!interestRates[type]) {\n        return type;\n      }\n    }, undefined);\n  }\n\n  getInterestsWithTranches({\n    tranches = [],\n    interestRates,\n  }: {\n    tranches: Array<{ type: string, value: number }>,\n    interestRates: Object,\n  } = {}) {\n    return tranches.reduce((acc, { type, value }) => {\n      const rate = interestRates[type];\n\n      if (!rate || acc === '-') {\n        return '-';\n      }\n\n      return acc + value * rate;\n    }, 0);\n  }\n\n  getAmortizationRateBase({\n    borrowRatio = 0,\n    amortizationYears = this.amortizationYears,\n  }: { borrowRatio: number, amortizationRate?: number } = {}) {\n    let amortizationRate = 0;\n    if (borrowRatio > this.amortizationGoal) {\n      // The loan has to be below 65% before 15 years or before retirement,\n      // whichever comes first\n      const amountToAmortize = borrowRatio - this.amortizationGoal;\n\n      // Make sure we don't create a black hole, or use negative values by error\n      if (amortizationYears > 0) {\n        // Amortization is the amount to amortize divided by the amount\n        // of years before the deadline\n        amortizationRate = amountToAmortize / amortizationYears;\n      }\n    } else {\n      // For projects below 65%, stop amortizing\n      // yearlyAmortization = propAndWork * constants.amortization;\n    }\n\n    return amortizationRate / borrowRatio || 0;\n  }\n\n  getMaxLoanBase({\n    propertyValue,\n    propertyWork,\n    pledgedAmount = 0,\n    residenceType,\n  }: {\n    propertyValue: number,\n    propertyWork: number,\n    pledgedAmount: number,\n    residenceType: string,\n  } = {}): number {\n    if (residenceType === RESIDENCE_TYPE.MAIN_RESIDENCE) {\n      return Math.min(\n        (propertyValue + propertyWork) * this.maxBorrowRatio + pledgedAmount,\n\n        (propertyValue + propertyWork) * this.maxBorrowRatioWithPledge,\n      );\n    }\n    return (propertyValue + propertyWork) * this.maxBorrowRatio;\n  }\n\n  getYearsToRetirement = ({\n    age1,\n    age2,\n    gender1,\n    gender2,\n  }: {\n    age1?: number,\n    age2?: number,\n    gender1?: 'F' | 'M',\n    gender2?: 'F' | 'M',\n  } = {}) => {\n    const retirement1 = this.getRetirementForGender({ gender: gender1 });\n    let retirement2 = null;\n    if (gender2) {\n      retirement2 = this.getRetirementForGender({ gender: gender2 });\n    }\n\n    // Substract age to determine remaining time to retirement for both borrowers\n    const toRetirement1 = retirement1 - age1;\n    let toRetirement2;\n    if (retirement2 && age2) {\n      toRetirement2 = retirement2 - age2;\n    }\n\n    // Get the most limiting time to retirement for both borrowers, in years\n    let yearsToRetirement;\n    if (toRetirement2) {\n      yearsToRetirement = Math.min(toRetirement1, toRetirement2);\n    } else {\n      yearsToRetirement = toRetirement1;\n    }\n\n    return Math.max(yearsToRetirement, 0);\n  };\n\n  getTheoreticalMonthly({ propAndWork, loanValue, amortizationRate }) {\n    const maintenance = (propAndWork * this.theoreticalMaintenanceRate) / 12;\n    const interests = (loanValue * this.theoreticalInterestRate) / 12;\n    const amortization = (loanValue * amortizationRate) / 12;\n    return this.getLoanCostWithParts({ maintenance, interests, amortization });\n  }\n\n  getNotaryFeesRate() {\n    return this.notaryFees;\n  }\n\n  getMinCash({\n    propertyValue,\n    propertyWork,\n    fees = this.getFeesBase({ propertyValue, propertyWork }),\n  }) {\n    return (propertyValue + propertyWork) * this.minCash + fees;\n  }\n\n  getFeesBase({ fees, propertyValue = 0 }) {\n    if (fees === 0 || fees > 0) {\n      return fees;\n    }\n\n    return propertyValue * this.notaryFees;\n  }\n\n  getIncomeLimitedPropertyValue = ({ nF, r, i, mR, m }) => ({\n    income,\n    fortune,\n  }) => {\n    // The first one is with 0 amortization\n    const incomeLimited1 = (mR * income + fortune * i) / (m + (1 + nF) * i);\n\n    // The second is with amortization factored in (and it could be negative due to math)\n    const incomeLimited2 = ((1 + r * i) * fortune + mR * r * income)\n      / (r * (m + i) + nF * (1 + r * i) + 0.35);\n\n    // Therefore, take the minimum value of both, which is the most limiting one\n    // Because of the ratios, round this value down\n    return Math.floor(Math.min(incomeLimited1, incomeLimited2));\n  };\n\n  getAveragedInterestRate({ tranches = [], interestRates = {} }) {\n    return tranches.reduce(\n      (totalRate, { type, value }) => totalRate + interestRates[type] * value,\n      0,\n    );\n  }\n}\n\nexport default new FinanceCalculator();\n"]},"passPerPreset":false,"envName":"development","cwd":"/Users/Florian/dev/epotek/microservices/backend","root":"/Users/Florian/dev/epotek/microservices/backend","plugins":[{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/utils/FinanceCalculator/FinanceCalculator.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/core/utils/FinanceCalculator/FinanceCalculator.js"}},"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nmodule.export({\n  FinanceCalculator: function () {\n    return FinanceCalculator;\n  }\n});\nvar GENDER, SUCCESS, ERROR, WARNING, RESIDENCE_TYPE, REAL_ESTATE_CONSIDERATION_TYPES, EXPENSE_TYPES_WITHOUT_DELTAS;\nmodule.link(\"../../api/constants\", {\n  GENDER: function (v) {\n    GENDER = v;\n  },\n  SUCCESS: function (v) {\n    SUCCESS = v;\n  },\n  ERROR: function (v) {\n    ERROR = v;\n  },\n  WARNING: function (v) {\n    WARNING = v;\n  },\n  RESIDENCE_TYPE: function (v) {\n    RESIDENCE_TYPE = v;\n  },\n  REAL_ESTATE_CONSIDERATION_TYPES: function (v) {\n    REAL_ESTATE_CONSIDERATION_TYPES = v;\n  },\n  EXPENSE_TYPES_WITHOUT_DELTAS: function (v) {\n    EXPENSE_TYPES_WITHOUT_DELTAS = v;\n  }\n}, 0);\nvar AMORTIZATION_STOP, AMORTIZATION_YEARS, AVERAGE_TAX_RATE, BONUS_ALGORITHMS, BONUS_CONSIDERATION, BONUS_HISTORY_TO_CONSIDER, COMPANY_INCOME_TO_CONSIDER, DEFAULT_AMORTIZATION, DIVIDENDS_CONSIDERATION, DIVIDENDS_HISTORY_TO_CONSIDER, ESTIMATED_COMMISSION, FORTUNE_RETURNS_RATIO, INTERESTS_FINMA, INVESTMENT_INCOME_CONSIDERATION, MAINTENANCE_FINMA, MAX_BORROW_RATIO_PRIMARY_PROPERTY, MAX_BORROW_RATIO_WITH_PLEDGE, MAX_INCOME_RATIO_TIGHT, MAX_INCOME_RATIO, MIN_CASH, NOTARY_FEES, OWN_FUNDS_ROUNDING_AMOUNT, PENSION_INCOME_CONSIDERATION, REAL_ESTATE_INCOME_ALGORITHMS, REAL_ESTATE_INCOME_CONSIDERATION, REFERRAL_COMMISSION_SPLIT, REFERRAL_COMMISSION;\nmodule.link(\"../../config/financeConstants\", {\n  AMORTIZATION_STOP: function (v) {\n    AMORTIZATION_STOP = v;\n  },\n  AMORTIZATION_YEARS: function (v) {\n    AMORTIZATION_YEARS = v;\n  },\n  AVERAGE_TAX_RATE: function (v) {\n    AVERAGE_TAX_RATE = v;\n  },\n  BONUS_ALGORITHMS: function (v) {\n    BONUS_ALGORITHMS = v;\n  },\n  BONUS_CONSIDERATION: function (v) {\n    BONUS_CONSIDERATION = v;\n  },\n  BONUS_HISTORY_TO_CONSIDER: function (v) {\n    BONUS_HISTORY_TO_CONSIDER = v;\n  },\n  COMPANY_INCOME_TO_CONSIDER: function (v) {\n    COMPANY_INCOME_TO_CONSIDER = v;\n  },\n  DEFAULT_AMORTIZATION: function (v) {\n    DEFAULT_AMORTIZATION = v;\n  },\n  DIVIDENDS_CONSIDERATION: function (v) {\n    DIVIDENDS_CONSIDERATION = v;\n  },\n  DIVIDENDS_HISTORY_TO_CONSIDER: function (v) {\n    DIVIDENDS_HISTORY_TO_CONSIDER = v;\n  },\n  ESTIMATED_COMMISSION: function (v) {\n    ESTIMATED_COMMISSION = v;\n  },\n  FORTUNE_RETURNS_RATIO: function (v) {\n    FORTUNE_RETURNS_RATIO = v;\n  },\n  INTERESTS_FINMA: function (v) {\n    INTERESTS_FINMA = v;\n  },\n  INVESTMENT_INCOME_CONSIDERATION: function (v) {\n    INVESTMENT_INCOME_CONSIDERATION = v;\n  },\n  MAINTENANCE_FINMA: function (v) {\n    MAINTENANCE_FINMA = v;\n  },\n  MAX_BORROW_RATIO_PRIMARY_PROPERTY: function (v) {\n    MAX_BORROW_RATIO_PRIMARY_PROPERTY = v;\n  },\n  MAX_BORROW_RATIO_WITH_PLEDGE: function (v) {\n    MAX_BORROW_RATIO_WITH_PLEDGE = v;\n  },\n  MAX_INCOME_RATIO_TIGHT: function (v) {\n    MAX_INCOME_RATIO_TIGHT = v;\n  },\n  MAX_INCOME_RATIO: function (v) {\n    MAX_INCOME_RATIO = v;\n  },\n  MIN_CASH: function (v) {\n    MIN_CASH = v;\n  },\n  NOTARY_FEES: function (v) {\n    NOTARY_FEES = v;\n  },\n  OWN_FUNDS_ROUNDING_AMOUNT: function (v) {\n    OWN_FUNDS_ROUNDING_AMOUNT = v;\n  },\n  PENSION_INCOME_CONSIDERATION: function (v) {\n    PENSION_INCOME_CONSIDERATION = v;\n  },\n  REAL_ESTATE_INCOME_ALGORITHMS: function (v) {\n    REAL_ESTATE_INCOME_ALGORITHMS = v;\n  },\n  REAL_ESTATE_INCOME_CONSIDERATION: function (v) {\n    REAL_ESTATE_INCOME_CONSIDERATION = v;\n  },\n  REFERRAL_COMMISSION_SPLIT: function (v) {\n    REFERRAL_COMMISSION_SPLIT = v;\n  },\n  REFERRAL_COMMISSION: function (v) {\n    REFERRAL_COMMISSION = v;\n  }\n}, 1);\nvar MiddlewareManager;\nmodule.link(\"../MiddlewareManager\", {\n  \"default\": function (v) {\n    MiddlewareManager = v;\n  }\n}, 2);\nvar precisionMiddleware;\nmodule.link(\"./financeCalculatorMiddlewares\", {\n  precisionMiddleware: function (v) {\n    precisionMiddleware = v;\n  }\n}, 3);\nvar memoizeMiddleware;\nmodule.link(\"../Calculator/middleware\", {\n  memoizeMiddleware: function (v) {\n    memoizeMiddleware = v;\n  }\n}, 4);\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar FinanceCalculator =\n/*#__PURE__*/\nfunction () {\n  function FinanceCalculator(settings) {\n    var _this = this;\n\n    _defineProperty(this, \"notaryFees\", void 0);\n\n    _defineProperty(this, \"amortizationBaseRate\", void 0);\n\n    _defineProperty(this, \"amortizationGoal\", void 0);\n\n    _defineProperty(this, \"setMiddleware\", function (middlewares, middlewareObject) {\n      var middlewareManager = new MiddlewareManager(_this, middlewareObject);\n      middlewareManager.applyToAllMethods([precisionMiddleware, memoizeMiddleware].concat((0, _toConsumableArray2.default)(middlewares)));\n    });\n\n    _defineProperty(this, \"getYearsToRetirement\", function () {\n      var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n          age1 = _ref.age1,\n          age2 = _ref.age2,\n          gender1 = _ref.gender1,\n          gender2 = _ref.gender2;\n\n      var retirement1 = _this.getRetirementForGender({\n        gender: gender1\n      });\n\n      var retirement2 = null;\n\n      if (gender2) {\n        retirement2 = _this.getRetirementForGender({\n          gender: gender2\n        });\n      } // Substract age to determine remaining time to retirement for both borrowers\n\n\n      var toRetirement1 = retirement1 - age1;\n      var toRetirement2;\n\n      if (retirement2 && age2) {\n        toRetirement2 = retirement2 - age2;\n      } // Get the most limiting time to retirement for both borrowers, in years\n\n\n      var yearsToRetirement;\n\n      if (toRetirement2) {\n        yearsToRetirement = Math.min(toRetirement1, toRetirement2);\n      } else {\n        yearsToRetirement = toRetirement1;\n      }\n\n      return Math.max(yearsToRetirement, 0);\n    });\n\n    _defineProperty(this, \"getIncomeLimitedPropertyValue\", function (_ref2) {\n      var nF = _ref2.nF,\n          r = _ref2.r,\n          i = _ref2.i,\n          mR = _ref2.mR,\n          m = _ref2.m;\n      return function (_ref3) {\n        var income = _ref3.income,\n            fortune = _ref3.fortune;\n        // The first one is with 0 amortization\n        var incomeLimited1 = (mR * income + fortune * i) / (m + (1 + nF) * i); // The second is with amortization factored in (and it could be negative due to math)\n\n        var incomeLimited2 = ((1 + r * i) * fortune + mR * r * income) / (r * (m + i) + nF * (1 + r * i) + 0.35); // Therefore, take the minimum value of both, which is the most limiting one\n        // Because of the ratios, round this value down\n\n        return Math.floor(Math.min(incomeLimited1, incomeLimited2));\n      };\n    });\n\n    this.initFinanceCalculator(settings);\n  }\n\n  var _proto = FinanceCalculator.prototype;\n\n  _proto.initFinanceCalculator = function () {\n    function initFinanceCalculator() {\n      var _ref4 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n          _ref4$allowPledge = _ref4.allowPledge,\n          allowPledge = _ref4$allowPledge === void 0 ? true : _ref4$allowPledge,\n          _ref4$amortizationBas = _ref4.amortizationBaseRate,\n          amortizationBaseRate = _ref4$amortizationBas === void 0 ? DEFAULT_AMORTIZATION : _ref4$amortizationBas,\n          _ref4$amortizationGoa = _ref4.amortizationGoal,\n          amortizationGoal = _ref4$amortizationGoa === void 0 ? AMORTIZATION_STOP : _ref4$amortizationGoa,\n          _ref4$amortizationYea = _ref4.amortizationYears,\n          amortizationYears = _ref4$amortizationYea === void 0 ? AMORTIZATION_YEARS : _ref4$amortizationYea,\n          _ref4$bonusAlgorithm = _ref4.bonusAlgorithm,\n          bonusAlgorithm = _ref4$bonusAlgorithm === void 0 ? BONUS_ALGORITHMS.WEAK_AVERAGE : _ref4$bonusAlgorithm,\n          _ref4$bonusConsiderat = _ref4.bonusConsideration,\n          bonusConsideration = _ref4$bonusConsiderat === void 0 ? BONUS_CONSIDERATION : _ref4$bonusConsiderat,\n          _ref4$bonusHistoryToC = _ref4.bonusHistoryToConsider,\n          bonusHistoryToConsider = _ref4$bonusHistoryToC === void 0 ? BONUS_HISTORY_TO_CONSIDER : _ref4$bonusHistoryToC,\n          _ref4$companyIncomeHi = _ref4.companyIncomeHistoryToConsider,\n          companyIncomeHistoryToConsider = _ref4$companyIncomeHi === void 0 ? COMPANY_INCOME_TO_CONSIDER : _ref4$companyIncomeHi,\n          _ref4$dividendsConsid = _ref4.dividendsConsideration,\n          dividendsConsideration = _ref4$dividendsConsid === void 0 ? DIVIDENDS_CONSIDERATION : _ref4$dividendsConsid,\n          _ref4$dividendsHistor = _ref4.dividendsHistoryToConsider,\n          dividendsHistoryToConsider = _ref4$dividendsHistor === void 0 ? DIVIDENDS_HISTORY_TO_CONSIDER : _ref4$dividendsHistor,\n          _ref4$expensesSubtrac = _ref4.expensesSubtractFromIncome,\n          expensesSubtractFromIncome = _ref4$expensesSubtrac === void 0 ? EXPENSE_TYPES_WITHOUT_DELTAS : _ref4$expensesSubtrac,\n          _ref4$fortuneReturnsR = _ref4.fortuneReturnsRatio,\n          fortuneReturnsRatio = _ref4$fortuneReturnsR === void 0 ? FORTUNE_RETURNS_RATIO : _ref4$fortuneReturnsR,\n          _ref4$investmentIncom = _ref4.investmentIncomeConsideration,\n          investmentIncomeConsideration = _ref4$investmentIncom === void 0 ? INVESTMENT_INCOME_CONSIDERATION : _ref4$investmentIncom,\n          _ref4$maxBorrowRatio = _ref4.maxBorrowRatio,\n          maxBorrowRatio = _ref4$maxBorrowRatio === void 0 ? MAX_BORROW_RATIO_PRIMARY_PROPERTY : _ref4$maxBorrowRatio,\n          _ref4$maxBorrowRatioW = _ref4.maxBorrowRatioWithPledge,\n          maxBorrowRatioWithPledge = _ref4$maxBorrowRatioW === void 0 ? MAX_BORROW_RATIO_WITH_PLEDGE : _ref4$maxBorrowRatioW,\n          _ref4$maxIncomeRatio = _ref4.maxIncomeRatio,\n          maxIncomeRatio = _ref4$maxIncomeRatio === void 0 ? MAX_INCOME_RATIO : _ref4$maxIncomeRatio,\n          _ref4$maxIncomeRatioT = _ref4.maxIncomeRatioTight,\n          maxIncomeRatioTight = _ref4$maxIncomeRatioT === void 0 ? MAX_INCOME_RATIO_TIGHT : _ref4$maxIncomeRatioT,\n          _ref4$minCash = _ref4.minCash,\n          minCash = _ref4$minCash === void 0 ? MIN_CASH : _ref4$minCash,\n          _ref4$notaryFees = _ref4.notaryFees,\n          notaryFees = _ref4$notaryFees === void 0 ? NOTARY_FEES : _ref4$notaryFees,\n          _ref4$ownFundsRoundin = _ref4.ownFundsRoundingAmount,\n          ownFundsRoundingAmount = _ref4$ownFundsRoundin === void 0 ? OWN_FUNDS_ROUNDING_AMOUNT : _ref4$ownFundsRoundin,\n          _ref4$pensionIncomeCo = _ref4.pensionIncomeConsideration,\n          pensionIncomeConsideration = _ref4$pensionIncomeCo === void 0 ? PENSION_INCOME_CONSIDERATION : _ref4$pensionIncomeCo,\n          _ref4$realEstateIncom = _ref4.realEstateIncomeAlgorithm,\n          realEstateIncomeAlgorithm = _ref4$realEstateIncom === void 0 ? REAL_ESTATE_INCOME_ALGORITHMS.DEFAULT : _ref4$realEstateIncom,\n          _ref4$realEstateIncom2 = _ref4.realEstateIncomeConsideration,\n          realEstateIncomeConsideration = _ref4$realEstateIncom2 === void 0 ? REAL_ESTATE_INCOME_CONSIDERATION : _ref4$realEstateIncom2,\n          _ref4$realEstateIncom3 = _ref4.realEstateIncomeConsiderationType,\n          realEstateIncomeConsiderationType = _ref4$realEstateIncom3 === void 0 ? REAL_ESTATE_CONSIDERATION_TYPES.ADD_TO_INCOME : _ref4$realEstateIncom3,\n          _ref4$taxRate = _ref4.taxRate,\n          taxRate = _ref4$taxRate === void 0 ? AVERAGE_TAX_RATE : _ref4$taxRate,\n          _ref4$theoreticalInte = _ref4.theoreticalInterestRate,\n          theoreticalInterestRate = _ref4$theoreticalInte === void 0 ? INTERESTS_FINMA : _ref4$theoreticalInte,\n          _ref4$theoreticalInte2 = _ref4.theoreticalInterestRate2ndRank,\n          theoreticalInterestRate2ndRank = _ref4$theoreticalInte2 === void 0 ? null : _ref4$theoreticalInte2,\n          _ref4$theoreticalMain = _ref4.theoreticalMaintenanceRate,\n          theoreticalMaintenanceRate = _ref4$theoreticalMain === void 0 ? MAINTENANCE_FINMA : _ref4$theoreticalMain,\n          _ref4$estimatedCommis = _ref4.estimatedCommission,\n          estimatedCommission = _ref4$estimatedCommis === void 0 ? ESTIMATED_COMMISSION : _ref4$estimatedCommis,\n          _ref4$referralCommiss = _ref4.referralCommission,\n          referralCommission = _ref4$referralCommiss === void 0 ? REFERRAL_COMMISSION : _ref4$referralCommiss,\n          _ref4$referralCommiss2 = _ref4.referralCommissionSplit,\n          referralCommissionSplit = _ref4$referralCommiss2 === void 0 ? REFERRAL_COMMISSION_SPLIT : _ref4$referralCommiss2,\n          _ref4$middlewares = _ref4.middlewares,\n          middlewares = _ref4$middlewares === void 0 ? [] : _ref4$middlewares,\n          middlewareObject = _ref4.middlewareObject;\n\n      this.allowPledge = allowPledge;\n      this.amortizationBaseRate = amortizationBaseRate;\n      this.amortizationGoal = amortizationGoal;\n      this.amortizationYears = amortizationYears;\n      this.bonusAlgorithm = bonusAlgorithm;\n      this.bonusConsideration = bonusConsideration;\n      this.bonusHistoryToConsider = bonusHistoryToConsider;\n      this.companyIncomeHistoryToConsider = companyIncomeHistoryToConsider;\n      this.dividendsConsideration = dividendsConsideration;\n      this.dividendsHistoryToConsider = dividendsHistoryToConsider;\n      this.expensesSubtractFromIncome = expensesSubtractFromIncome;\n      this.fortuneReturnsRatio = fortuneReturnsRatio;\n      this.investmentIncomeConsideration = investmentIncomeConsideration;\n      this.maxBorrowRatio = maxBorrowRatio;\n      this.maxBorrowRatioWithPledge = maxBorrowRatioWithPledge;\n      this.maxIncomeRatio = maxIncomeRatio;\n      this.maxIncomeRatioTight = maxIncomeRatioTight;\n      this.minCash = minCash;\n      this.notaryFees = notaryFees;\n      this.ownFundsRoundingAmount = ownFundsRoundingAmount;\n      this.pensionIncomeConsideration = pensionIncomeConsideration;\n      this.realEstateIncomeAlgorithm = realEstateIncomeAlgorithm;\n      this.realEstateIncomeConsideration = realEstateIncomeConsideration;\n      this.realEstateIncomeConsiderationType = realEstateIncomeConsiderationType;\n      this.taxRate = taxRate;\n      this.theoreticalInterestRate = theoreticalInterestRate;\n      this.theoreticalInterestRate2ndRank = theoreticalInterestRate2ndRank;\n      this.theoreticalMaintenanceRate = theoreticalMaintenanceRate;\n      this.estimatedCommission = estimatedCommission;\n      this.referralCommission = referralCommission;\n      this.referralCommissionSplit = referralCommissionSplit;\n      this.setMiddleware(middlewares, middlewareObject);\n    }\n\n    return initFinanceCalculator;\n  }();\n\n  _proto.getLoanValue = function () {\n    function getLoanValue(_ref5) {\n      var propertyValue = _ref5.propertyValue,\n          _ref5$propertyWork = _ref5.propertyWork,\n          propertyWork = _ref5$propertyWork === void 0 ? 0 : _ref5$propertyWork,\n          fortune = _ref5.fortune,\n          _ref5$pledgedValue = _ref5.pledgedValue,\n          pledgedValue = _ref5$pledgedValue === void 0 ? 0 : _ref5$pledgedValue,\n          _ref5$fees = _ref5.fees,\n          fees = _ref5$fees === void 0 ? this.getFeesBase({\n        propertyValue: propertyValue,\n        propertyWork: propertyWork\n      }) : _ref5$fees;\n      return propertyValue + propertyWork + fees + pledgedValue - fortune;\n    }\n\n    return getLoanValue;\n  }();\n\n  _proto.getPropAndWork = function () {\n    function getPropAndWork(_ref6) {\n      var propertyValue = _ref6.propertyValue,\n          propertyWork = _ref6.propertyWork;\n      return propertyValue + propertyWork;\n    }\n\n    return getPropAndWork;\n  }();\n\n  _proto.getBorrowRatio = function () {\n    function getBorrowRatio(_ref7) {\n      var propertyValue = _ref7.propertyValue,\n          _ref7$loan = _ref7.loan,\n          loan = _ref7$loan === void 0 ? 0 : _ref7$loan;\n      return loan / propertyValue;\n    }\n\n    return getBorrowRatio;\n  }();\n\n  _proto.getLoanFromBorrowRatio = function () {\n    function getLoanFromBorrowRatio(_ref8) {\n      var propertyValue = _ref8.propertyValue,\n          borrowRatio = _ref8.borrowRatio;\n      return borrowRatio * propertyValue;\n    }\n\n    return getLoanFromBorrowRatio;\n  }();\n\n  _proto.getBorrowRatioWithoutLoan = function () {\n    function getBorrowRatioWithoutLoan(_ref9) {\n      var propertyValue = _ref9.propertyValue,\n          fortune = _ref9.fortune;\n      return this.getBorrowRatio({\n        propertyValue: propertyValue,\n        loan: this.getLoanValue({\n          propertyValue: propertyValue,\n          fortune: fortune\n        })\n      });\n    }\n\n    return getBorrowRatioWithoutLoan;\n  }();\n\n  _proto.getBorrowRatioStatus = function () {\n    function getBorrowRatioStatus(_ref10) {\n      var borrowRatio = _ref10.borrowRatio;\n\n      if (borrowRatio <= this.maxBorrowRatio) {\n        return SUCCESS;\n      }\n\n      if (borrowRatio <= this.maxBorrowRatioWithPledge) {\n        return WARNING;\n      }\n\n      return ERROR;\n    }\n\n    return getBorrowRatioStatus;\n  }();\n\n  _proto.getRetirementForGender = function () {\n    function getRetirementForGender() {\n      var _ref11 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n          _ref11$gender = _ref11.gender,\n          gender = _ref11$gender === void 0 ? GENDER.M : _ref11$gender;\n\n      return gender === GENDER.F ? 64 : 65;\n    }\n\n    return getRetirementForGender;\n  }();\n\n  _proto.getIncomeRatio = function () {\n    function getIncomeRatio(_ref12) {\n      var monthlyIncome = _ref12.monthlyIncome,\n          _ref12$monthlyPayment = _ref12.monthlyPayment,\n          monthlyPayment = _ref12$monthlyPayment === void 0 ? 0 : _ref12$monthlyPayment;\n      return monthlyPayment / monthlyIncome;\n    }\n\n    return getIncomeRatio;\n  }();\n\n  _proto.getIncomeRatioStatus = function () {\n    function getIncomeRatioStatus(_ref13) {\n      var incomeRatio = _ref13.incomeRatio;\n\n      if (incomeRatio <= this.maxIncomeRatio) {\n        return SUCCESS;\n      }\n\n      if (this.maxIncomeRatioTight && incomeRatio <= this.maxIncomeRatioTight) {\n        // This ratio can be disabled, i.e. set to 0, and then it'll skip the warning\n        // and only display success or error\n        return WARNING;\n      }\n\n      return ERROR;\n    }\n\n    return getIncomeRatioStatus;\n  }();\n\n  _proto.getLoanCost = function () {\n    function getLoanCost() {\n      var _ref14 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n          _ref14$maintenance = _ref14.maintenance,\n          maintenance = _ref14$maintenance === void 0 ? 0 : _ref14$maintenance,\n          _ref14$interests = _ref14.interests,\n          interests = _ref14$interests === void 0 ? 0 : _ref14$interests,\n          _ref14$amortization = _ref14.amortization,\n          amortization = _ref14$amortization === void 0 ? 0 : _ref14$amortization;\n\n      return maintenance + interests + amortization;\n    }\n\n    return getLoanCost;\n  }();\n\n  _proto.getLoanCostWithParts = function () {\n    function getLoanCostWithParts(_ref15) {\n      var maintenance = _ref15.maintenance,\n          interests = _ref15.interests,\n          amortization = _ref15.amortization;\n      return {\n        maintenance: maintenance,\n        interests: interests,\n        amortization: amortization,\n        total: this.getLoanCost({\n          maintenance: maintenance,\n          interests: interests,\n          amortization: amortization\n        })\n      };\n    }\n\n    return getLoanCostWithParts;\n  }();\n\n  _proto.checkInterestsAndTranches = function () {\n    function checkInterestsAndTranches(_ref16) {\n      var _ref16$tranches = _ref16.tranches,\n          tranches = _ref16$tranches === void 0 ? [] : _ref16$tranches,\n          interestRates = _ref16.interestRates;\n      return tranches.reduce(function (invalidRate, _ref17) {\n        var type = _ref17.type;\n\n        if (invalidRate) {\n          return invalidRate;\n        }\n\n        if (!interestRates[type]) {\n          return type;\n        }\n      }, undefined);\n    }\n\n    return checkInterestsAndTranches;\n  }();\n\n  _proto.getInterestsWithTranches = function () {\n    function getInterestsWithTranches() {\n      var _ref18 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n          _ref18$tranches = _ref18.tranches,\n          tranches = _ref18$tranches === void 0 ? [] : _ref18$tranches,\n          interestRates = _ref18.interestRates;\n\n      return tranches.reduce(function (acc, _ref19) {\n        var type = _ref19.type,\n            value = _ref19.value;\n        var rate = interestRates[type];\n\n        if (!rate || acc === '-') {\n          return '-';\n        }\n\n        return acc + value * rate;\n      }, 0);\n    }\n\n    return getInterestsWithTranches;\n  }();\n\n  _proto.getAmortizationRateBase = function () {\n    function getAmortizationRateBase() {\n      var _ref20 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n          _ref20$borrowRatio = _ref20.borrowRatio,\n          borrowRatio = _ref20$borrowRatio === void 0 ? 0 : _ref20$borrowRatio,\n          _ref20$amortizationYe = _ref20.amortizationYears,\n          amortizationYears = _ref20$amortizationYe === void 0 ? this.amortizationYears : _ref20$amortizationYe;\n\n      var amortizationRate = 0;\n\n      if (borrowRatio > this.amortizationGoal) {\n        // The loan has to be below 65% before 15 years or before retirement,\n        // whichever comes first\n        var amountToAmortize = borrowRatio - this.amortizationGoal; // Make sure we don't create a black hole, or use negative values by error\n\n        if (amortizationYears > 0) {\n          // Amortization is the amount to amortize divided by the amount\n          // of years before the deadline\n          amortizationRate = amountToAmortize / amortizationYears;\n        }\n      } else {// For projects below 65%, stop amortizing\n        // yearlyAmortization = propAndWork * constants.amortization;\n      }\n\n      return amortizationRate / borrowRatio || 0;\n    }\n\n    return getAmortizationRateBase;\n  }();\n\n  _proto.getMaxLoanBase = function () {\n    function getMaxLoanBase() {\n      var _ref21 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n          propertyValue = _ref21.propertyValue,\n          propertyWork = _ref21.propertyWork,\n          _ref21$pledgedAmount = _ref21.pledgedAmount,\n          pledgedAmount = _ref21$pledgedAmount === void 0 ? 0 : _ref21$pledgedAmount,\n          residenceType = _ref21.residenceType;\n\n      if (residenceType === RESIDENCE_TYPE.MAIN_RESIDENCE) {\n        return Math.min((propertyValue + propertyWork) * this.maxBorrowRatio + pledgedAmount, (propertyValue + propertyWork) * this.maxBorrowRatioWithPledge);\n      }\n\n      return (propertyValue + propertyWork) * this.maxBorrowRatio;\n    }\n\n    return getMaxLoanBase;\n  }();\n\n  _proto.getTheoreticalMonthly = function () {\n    function getTheoreticalMonthly(_ref22) {\n      var propAndWork = _ref22.propAndWork,\n          loanValue = _ref22.loanValue,\n          amortizationRate = _ref22.amortizationRate;\n      var maintenance = propAndWork * this.theoreticalMaintenanceRate / 12;\n      var interests = loanValue * this.theoreticalInterestRate / 12;\n      var amortization = loanValue * amortizationRate / 12;\n      return this.getLoanCostWithParts({\n        maintenance: maintenance,\n        interests: interests,\n        amortization: amortization\n      });\n    }\n\n    return getTheoreticalMonthly;\n  }();\n\n  _proto.getNotaryFeesRate = function () {\n    function getNotaryFeesRate() {\n      return this.notaryFees;\n    }\n\n    return getNotaryFeesRate;\n  }();\n\n  _proto.getMinCash = function () {\n    function getMinCash(_ref23) {\n      var propertyValue = _ref23.propertyValue,\n          propertyWork = _ref23.propertyWork,\n          _ref23$fees = _ref23.fees,\n          fees = _ref23$fees === void 0 ? this.getFeesBase({\n        propertyValue: propertyValue,\n        propertyWork: propertyWork\n      }) : _ref23$fees;\n      return (propertyValue + propertyWork) * this.minCash + fees;\n    }\n\n    return getMinCash;\n  }();\n\n  _proto.getFeesBase = function () {\n    function getFeesBase(_ref24) {\n      var fees = _ref24.fees,\n          _ref24$propertyValue = _ref24.propertyValue,\n          propertyValue = _ref24$propertyValue === void 0 ? 0 : _ref24$propertyValue;\n\n      if (fees === 0 || fees > 0) {\n        return fees;\n      }\n\n      return propertyValue * this.notaryFees;\n    }\n\n    return getFeesBase;\n  }();\n\n  _proto.getAveragedInterestRate = function () {\n    function getAveragedInterestRate(_ref25) {\n      var _ref25$tranches = _ref25.tranches,\n          tranches = _ref25$tranches === void 0 ? [] : _ref25$tranches,\n          _ref25$interestRates = _ref25.interestRates,\n          interestRates = _ref25$interestRates === void 0 ? {} : _ref25$interestRates;\n      return tranches.reduce(function (totalRate, _ref26) {\n        var type = _ref26.type,\n            value = _ref26.value;\n        return totalRate + interestRates[type] * value;\n      }, 0);\n    }\n\n    return getAveragedInterestRate;\n  }();\n\n  return FinanceCalculator;\n}();\n\nmodule.exportDefault(new FinanceCalculator());","map":{"version":3,"sources":["imports/core/utils/FinanceCalculator/FinanceCalculator.js"],"names":["constructor","initFinanceCalculator","allowPledge","amortizationBaseRate","amortizationGoal","amortizationYears","bonusAlgorithm","BONUS_ALGORITHMS","bonusConsideration","bonusHistoryToConsider","companyIncomeHistoryToConsider","dividendsConsideration","dividendsHistoryToConsider","expensesSubtractFromIncome","fortuneReturnsRatio","investmentIncomeConsideration","maxBorrowRatio","maxBorrowRatioWithPledge","maxIncomeRatio","maxIncomeRatioTight","minCash","notaryFees","ownFundsRoundingAmount","pensionIncomeConsideration","realEstateIncomeAlgorithm","REAL_ESTATE_INCOME_ALGORITHMS","realEstateIncomeConsideration","realEstateIncomeConsiderationType","REAL_ESTATE_CONSIDERATION_TYPES","taxRate","theoreticalInterestRate","theoreticalInterestRate2ndRank","theoreticalMaintenanceRate","estimatedCommission","referralCommission","referralCommissionSplit","middlewares","middlewareObject","middlewareManager","getLoanValue","propertyWork","pledgedValue","fees","propertyValue","getPropAndWork","getBorrowRatio","loan","getLoanFromBorrowRatio","borrowRatio","getBorrowRatioWithoutLoan","fortune","getBorrowRatioStatus","getRetirementForGender","gender","GENDER","M","getIncomeRatio","monthlyPayment","getIncomeRatioStatus","incomeRatio","getLoanCost","maintenance","interests","amortization","getLoanCostWithParts","total","checkInterestsAndTranches","tranches","interestRates","type","getInterestsWithTranches","value","rate","acc","getAmortizationRateBase","amortizationRate","amountToAmortize","getMaxLoanBase","pledgedAmount","residenceType","RESIDENCE_TYPE","Math","gender2","retirement1","gender1","retirement2","toRetirement1","toRetirement2","yearsToRetirement","getTheoreticalMonthly","propAndWork","loanValue","getNotaryFeesRate","getMinCash","getFeesBase","m","incomeLimited1","mR","incomeLimited2","r","nF","getAveragedInterestRate","totalRate"],"mappings":"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","sourcesContent":["// @flow\nimport {\n  GENDER,\n  SUCCESS,\n  ERROR,\n  WARNING,\n  RESIDENCE_TYPE,\n  REAL_ESTATE_CONSIDERATION_TYPES,\n  EXPENSE_TYPES_WITHOUT_DELTAS,\n} from '../../api/constants';\nimport {\n  AMORTIZATION_STOP,\n  AMORTIZATION_YEARS,\n  AVERAGE_TAX_RATE,\n  BONUS_ALGORITHMS,\n  BONUS_CONSIDERATION,\n  BONUS_HISTORY_TO_CONSIDER,\n  COMPANY_INCOME_TO_CONSIDER,\n  DEFAULT_AMORTIZATION,\n  DIVIDENDS_CONSIDERATION,\n  DIVIDENDS_HISTORY_TO_CONSIDER,\n  ESTIMATED_COMMISSION,\n  FORTUNE_RETURNS_RATIO,\n  INTERESTS_FINMA,\n  INVESTMENT_INCOME_CONSIDERATION,\n  MAINTENANCE_FINMA,\n  MAX_BORROW_RATIO_PRIMARY_PROPERTY,\n  MAX_BORROW_RATIO_WITH_PLEDGE,\n  MAX_INCOME_RATIO_TIGHT,\n  MAX_INCOME_RATIO,\n  MIN_CASH,\n  NOTARY_FEES,\n  OWN_FUNDS_ROUNDING_AMOUNT,\n  PENSION_INCOME_CONSIDERATION,\n  REAL_ESTATE_INCOME_ALGORITHMS,\n  REAL_ESTATE_INCOME_CONSIDERATION,\n  REFERRAL_COMMISSION_SPLIT,\n  REFERRAL_COMMISSION,\n} from '../../config/financeConstants';\nimport MiddlewareManager from '../MiddlewareManager';\nimport { precisionMiddleware } from './financeCalculatorMiddlewares';\nimport { memoizeMiddleware } from '../Calculator/middleware';\n\nexport class FinanceCalculator {\n  constructor(settings?: Object) {\n    this.initFinanceCalculator(settings);\n  }\n\n  notaryFees: number;\n\n  amortizationBaseRate: number;\n\n  amortizationGoal: number;\n\n  initFinanceCalculator({\n    allowPledge = true,\n    amortizationBaseRate = DEFAULT_AMORTIZATION,\n    amortizationGoal = AMORTIZATION_STOP,\n    amortizationYears = AMORTIZATION_YEARS,\n    bonusAlgorithm = BONUS_ALGORITHMS.WEAK_AVERAGE,\n    bonusConsideration = BONUS_CONSIDERATION,\n    bonusHistoryToConsider = BONUS_HISTORY_TO_CONSIDER,\n    companyIncomeHistoryToConsider = COMPANY_INCOME_TO_CONSIDER,\n    dividendsConsideration = DIVIDENDS_CONSIDERATION,\n    dividendsHistoryToConsider = DIVIDENDS_HISTORY_TO_CONSIDER,\n    expensesSubtractFromIncome = EXPENSE_TYPES_WITHOUT_DELTAS,\n    fortuneReturnsRatio = FORTUNE_RETURNS_RATIO,\n    investmentIncomeConsideration = INVESTMENT_INCOME_CONSIDERATION,\n    maxBorrowRatio = MAX_BORROW_RATIO_PRIMARY_PROPERTY,\n    maxBorrowRatioWithPledge = MAX_BORROW_RATIO_WITH_PLEDGE,\n    maxIncomeRatio = MAX_INCOME_RATIO,\n    maxIncomeRatioTight = MAX_INCOME_RATIO_TIGHT,\n    minCash = MIN_CASH,\n    notaryFees = NOTARY_FEES,\n    ownFundsRoundingAmount = OWN_FUNDS_ROUNDING_AMOUNT,\n    pensionIncomeConsideration = PENSION_INCOME_CONSIDERATION,\n    realEstateIncomeAlgorithm = REAL_ESTATE_INCOME_ALGORITHMS.DEFAULT,\n    realEstateIncomeConsideration = REAL_ESTATE_INCOME_CONSIDERATION,\n    realEstateIncomeConsiderationType = REAL_ESTATE_CONSIDERATION_TYPES.ADD_TO_INCOME,\n    taxRate = AVERAGE_TAX_RATE,\n    theoreticalInterestRate = INTERESTS_FINMA,\n    theoreticalInterestRate2ndRank = null,\n    theoreticalMaintenanceRate = MAINTENANCE_FINMA,\n    estimatedCommission = ESTIMATED_COMMISSION,\n    referralCommission = REFERRAL_COMMISSION,\n    referralCommissionSplit = REFERRAL_COMMISSION_SPLIT,\n    middlewares = [],\n    middlewareObject,\n  } = {}) {\n    this.allowPledge = allowPledge;\n    this.amortizationBaseRate = amortizationBaseRate;\n    this.amortizationGoal = amortizationGoal;\n    this.amortizationYears = amortizationYears;\n    this.bonusAlgorithm = bonusAlgorithm;\n    this.bonusConsideration = bonusConsideration;\n    this.bonusHistoryToConsider = bonusHistoryToConsider;\n    this.companyIncomeHistoryToConsider = companyIncomeHistoryToConsider;\n    this.dividendsConsideration = dividendsConsideration;\n    this.dividendsHistoryToConsider = dividendsHistoryToConsider;\n    this.expensesSubtractFromIncome = expensesSubtractFromIncome;\n    this.fortuneReturnsRatio = fortuneReturnsRatio;\n    this.investmentIncomeConsideration = investmentIncomeConsideration;\n    this.maxBorrowRatio = maxBorrowRatio;\n    this.maxBorrowRatioWithPledge = maxBorrowRatioWithPledge;\n    this.maxIncomeRatio = maxIncomeRatio;\n    this.maxIncomeRatioTight = maxIncomeRatioTight;\n    this.minCash = minCash;\n    this.notaryFees = notaryFees;\n    this.ownFundsRoundingAmount = ownFundsRoundingAmount;\n    this.pensionIncomeConsideration = pensionIncomeConsideration;\n    this.realEstateIncomeAlgorithm = realEstateIncomeAlgorithm;\n    this.realEstateIncomeConsideration = realEstateIncomeConsideration;\n    this.realEstateIncomeConsiderationType = realEstateIncomeConsiderationType;\n    this.taxRate = taxRate;\n    this.theoreticalInterestRate = theoreticalInterestRate;\n    this.theoreticalInterestRate2ndRank = theoreticalInterestRate2ndRank;\n    this.theoreticalMaintenanceRate = theoreticalMaintenanceRate;\n    this.estimatedCommission = estimatedCommission;\n    this.referralCommission = referralCommission;\n    this.referralCommissionSplit = referralCommissionSplit;\n    this.setMiddleware(middlewares, middlewareObject);\n  }\n\n  setMiddleware = (middlewares?: Array<Function>, middlewareObject) => {\n    const middlewareManager = new MiddlewareManager(this, middlewareObject);\n    middlewareManager.applyToAllMethods([\n      precisionMiddleware,\n      memoizeMiddleware,\n      ...middlewares,\n    ]);\n  };\n\n  getLoanValue({\n    propertyValue,\n    propertyWork = 0,\n    fortune,\n    pledgedValue = 0,\n    fees = this.getFeesBase({ propertyValue, propertyWork }),\n  }: {\n    propertyValue: number,\n    fortune: number,\n    pledgedValue?: number,\n    fees?: number,\n  }) {\n    return propertyValue + propertyWork + fees + pledgedValue - fortune;\n  }\n\n  getPropAndWork({ propertyValue, propertyWork }) {\n    return propertyValue + propertyWork;\n  }\n\n  getBorrowRatio({\n    propertyValue,\n    loan = 0,\n  }: {\n    propertyValue: number,\n    loan: number,\n  }) {\n    return loan / propertyValue;\n  }\n\n  getLoanFromBorrowRatio({\n    propertyValue,\n    borrowRatio,\n  }: {\n    propertyValue: number,\n    borrowRatio: number,\n  }) {\n    return borrowRatio * propertyValue;\n  }\n\n  getBorrowRatioWithoutLoan({\n    propertyValue,\n    fortune,\n  }: {\n    propertyValue: number,\n    fortune: number,\n  }) {\n    return this.getBorrowRatio({\n      propertyValue,\n      loan: this.getLoanValue({ propertyValue, fortune }),\n    });\n  }\n\n  getBorrowRatioStatus({ borrowRatio }) {\n    if (borrowRatio <= this.maxBorrowRatio) {\n      return SUCCESS;\n    }\n    if (borrowRatio <= this.maxBorrowRatioWithPledge) {\n      return WARNING;\n    }\n    return ERROR;\n  }\n\n  getRetirementForGender({ gender = GENDER.M }: { gender?: string } = {}) {\n    return gender === GENDER.F ? 64 : 65;\n  }\n\n  getIncomeRatio({\n    monthlyIncome,\n    monthlyPayment = 0,\n  }: {\n    monthlyIncome: number,\n    monthlyPayment: number,\n  }) {\n    return monthlyPayment / monthlyIncome;\n  }\n\n  getIncomeRatioStatus({ incomeRatio }) {\n    if (incomeRatio <= this.maxIncomeRatio) {\n      return SUCCESS;\n    }\n    if (this.maxIncomeRatioTight && incomeRatio <= this.maxIncomeRatioTight) {\n      // This ratio can be disabled, i.e. set to 0, and then it'll skip the warning\n      // and only display success or error\n      return WARNING;\n    }\n    return ERROR;\n  }\n\n  getLoanCost({\n    maintenance = 0,\n    interests = 0,\n    amortization = 0,\n  }: {\n    maintenance?: number,\n    interests?: number,\n    amortization?: number,\n  } = {}) {\n    return maintenance + interests + amortization;\n  }\n\n  getLoanCostWithParts({\n    maintenance,\n    interests,\n    amortization,\n  }: {\n    maintenance: number,\n    interests: number,\n    amortization?: number,\n  }) {\n    return {\n      maintenance,\n      interests,\n      amortization,\n      total: this.getLoanCost({ maintenance, interests, amortization }),\n    };\n  }\n\n  checkInterestsAndTranches({\n    tranches = [],\n    interestRates,\n  }: {\n    tranches: Array<{ type: string, value: number }>,\n    interestRates: Object,\n  }) {\n    return tranches.reduce((invalidRate, { type }) => {\n      if (invalidRate) {\n        return invalidRate;\n      }\n\n      if (!interestRates[type]) {\n        return type;\n      }\n    }, undefined);\n  }\n\n  getInterestsWithTranches({\n    tranches = [],\n    interestRates,\n  }: {\n    tranches: Array<{ type: string, value: number }>,\n    interestRates: Object,\n  } = {}) {\n    return tranches.reduce((acc, { type, value }) => {\n      const rate = interestRates[type];\n\n      if (!rate || acc === '-') {\n        return '-';\n      }\n\n      return acc + value * rate;\n    }, 0);\n  }\n\n  getAmortizationRateBase({\n    borrowRatio = 0,\n    amortizationYears = this.amortizationYears,\n  }: { borrowRatio: number, amortizationRate?: number } = {}) {\n    let amortizationRate = 0;\n    if (borrowRatio > this.amortizationGoal) {\n      // The loan has to be below 65% before 15 years or before retirement,\n      // whichever comes first\n      const amountToAmortize = borrowRatio - this.amortizationGoal;\n\n      // Make sure we don't create a black hole, or use negative values by error\n      if (amortizationYears > 0) {\n        // Amortization is the amount to amortize divided by the amount\n        // of years before the deadline\n        amortizationRate = amountToAmortize / amortizationYears;\n      }\n    } else {\n      // For projects below 65%, stop amortizing\n      // yearlyAmortization = propAndWork * constants.amortization;\n    }\n\n    return amortizationRate / borrowRatio || 0;\n  }\n\n  getMaxLoanBase({\n    propertyValue,\n    propertyWork,\n    pledgedAmount = 0,\n    residenceType,\n  }: {\n    propertyValue: number,\n    propertyWork: number,\n    pledgedAmount: number,\n    residenceType: string,\n  } = {}): number {\n    if (residenceType === RESIDENCE_TYPE.MAIN_RESIDENCE) {\n      return Math.min(\n        (propertyValue + propertyWork) * this.maxBorrowRatio + pledgedAmount,\n\n        (propertyValue + propertyWork) * this.maxBorrowRatioWithPledge,\n      );\n    }\n    return (propertyValue + propertyWork) * this.maxBorrowRatio;\n  }\n\n  getYearsToRetirement = ({\n    age1,\n    age2,\n    gender1,\n    gender2,\n  }: {\n    age1?: number,\n    age2?: number,\n    gender1?: 'F' | 'M',\n    gender2?: 'F' | 'M',\n  } = {}) => {\n    const retirement1 = this.getRetirementForGender({ gender: gender1 });\n    let retirement2 = null;\n    if (gender2) {\n      retirement2 = this.getRetirementForGender({ gender: gender2 });\n    }\n\n    // Substract age to determine remaining time to retirement for both borrowers\n    const toRetirement1 = retirement1 - age1;\n    let toRetirement2;\n    if (retirement2 && age2) {\n      toRetirement2 = retirement2 - age2;\n    }\n\n    // Get the most limiting time to retirement for both borrowers, in years\n    let yearsToRetirement;\n    if (toRetirement2) {\n      yearsToRetirement = Math.min(toRetirement1, toRetirement2);\n    } else {\n      yearsToRetirement = toRetirement1;\n    }\n\n    return Math.max(yearsToRetirement, 0);\n  };\n\n  getTheoreticalMonthly({ propAndWork, loanValue, amortizationRate }) {\n    const maintenance = (propAndWork * this.theoreticalMaintenanceRate) / 12;\n    const interests = (loanValue * this.theoreticalInterestRate) / 12;\n    const amortization = (loanValue * amortizationRate) / 12;\n    return this.getLoanCostWithParts({ maintenance, interests, amortization });\n  }\n\n  getNotaryFeesRate() {\n    return this.notaryFees;\n  }\n\n  getMinCash({\n    propertyValue,\n    propertyWork,\n    fees = this.getFeesBase({ propertyValue, propertyWork }),\n  }) {\n    return (propertyValue + propertyWork) * this.minCash + fees;\n  }\n\n  getFeesBase({ fees, propertyValue = 0 }) {\n    if (fees === 0 || fees > 0) {\n      return fees;\n    }\n\n    return propertyValue * this.notaryFees;\n  }\n\n  getIncomeLimitedPropertyValue = ({ nF, r, i, mR, m }) => ({\n    income,\n    fortune,\n  }) => {\n    // The first one is with 0 amortization\n    const incomeLimited1 = (mR * income + fortune * i) / (m + (1 + nF) * i);\n\n    // The second is with amortization factored in (and it could be negative due to math)\n    const incomeLimited2 = ((1 + r * i) * fortune + mR * r * income)\n      / (r * (m + i) + nF * (1 + r * i) + 0.35);\n\n    // Therefore, take the minimum value of both, which is the most limiting one\n    // Because of the ratios, round this value down\n    return Math.floor(Math.min(incomeLimited1, incomeLimited2));\n  };\n\n  getAveragedInterestRate({ tranches = [], interestRates = {} }) {\n    return tranches.reduce(\n      (totalRate, { type, value }) => totalRate + interestRates[type] * value,\n      0,\n    );\n  }\n}\n\nexport default new FinanceCalculator();\n"]},"sourceType":"script","hash":"cd3926981bde69003f8cfce8f33df5f126a37bad"}
