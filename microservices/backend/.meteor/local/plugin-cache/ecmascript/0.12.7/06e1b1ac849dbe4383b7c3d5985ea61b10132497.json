{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/Florian/dev/epotek/microservices/backend/imports/core/components/Financing/client/FinancingOwnFunds/FinancingOwnFundsPicker/FinancingOwnFundsPickerContainer.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties",["flow",{}],"dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"imports/core/components/Financing/client/FinancingOwnFunds/FinancingOwnFundsPicker/FinancingOwnFundsPickerContainer.js","filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/components/Financing/client/FinancingOwnFunds/FinancingOwnFundsPicker/FinancingOwnFundsPickerContainer.js","inputSourceMap":{"version":3,"sources":["imports/core/components/Financing/client/FinancingOwnFunds/FinancingOwnFundsPicker/FinancingOwnFundsPickerContainer.js"],"names":["compose","withProps","withStateHandlers","withState","lifecycle","borrowerUpdate","pushBorrowerValue","updateStructure","OWN_FUNDS_USAGE_TYPES","RESIDENCE_TYPE","Calculator","SingleStructureContainer","FinancingDataContainer","chooseOwnFundsTypes","shouldAskForUsageType","makeNewOwnFundsArray","getOwnFundsOfTypeAndBorrower","getAvailableFundsOfTypeAndBorrower","getNewWantedLoanAfterPledge","FIELDS","TYPE","USAGE_TYPE","BORROWER_ID","VALUE","getInitialState","structure","borrowers","ownFundsIndex","undefined","WITHDRAW","_id","ownFunds","addState","handleChange","value","id","reset","_","props","withDisableSubmit","type","borrowerId","usageType","disableSubmit","withStructureUpdate","loan","loanId","structureId","updateLoan","wantedLoan","run","updateOwnFunds","withAdditionalProps","handleClose","setLoading","otherValueOfTypeAndBorrower","updateCleanup","handleDelete","shouldDelete","handleSubmit","event","preventDefault","PLEDGE","handleUpdateBorrower","isTypeWithArrayValues","currentlyAvailable","deltaNeeded","object","description","finally","handleCancelUpdateBorrower","remaining","types","allowPledge","residenceType","MAIN_RESIDENCE","FinancingOwnFundsPickerContainer","componentWillReceiveProps","nextFunds","nextIndex","JSON","stringify"],"mappings":"AAAA,SACEA,OADF,EAEEC,SAFF,EAGEC,iBAHF,EAIEC,SAJF,EAKEC,SALF,QAMO,WANP;AAQA,SACEC,cADF,EAEEC,iBAFF,EAGEC,eAHF;AAKA,SACEC,qBADF,EAEEC,cAFF;AAIA,OAAOC,UAAP;AACA,OAAOC,wBAAP;AACA,OAAOC,sBAAP;AACA,SACEC,mBADF,EAEEC,qBAFF,EAGEC,oBAHF,EAIEC,4BAJF,EAKEC,kCALF,EAMEC,2BANF;AASA,OAAO,MAAMC,MAAM,GAAG;AACpBC,EAAAA,IAAI,EAAE,MADc;AAEpBC,EAAAA,UAAU,EAAE,WAFQ;AAGpBC,EAAAA,WAAW,EAAE,YAHO;AAIpBC,EAAAA,KAAK,EAAE;AAJa,CAAf;;AAOP,MAAMC,eAAe,GAAG,CAAC;AAAEC,EAAAA,SAAF;AAAaC,EAAAA,SAAb;AAAwBC,EAAAA;AAAxB,CAAD,KAA6C;AACnE;AACA;AACA,MAAI,CAACF,SAAL,EAAgB;AACd,WAAO,EAAP;AACD,GALkE,CAOnE;;;AACA,MAAIE,aAAa,GAAG,CAApB,EAAuB;AACrB,WAAO;AACL,OAACR,MAAM,CAACC,IAAR,GAAeQ,SADV;AAEL,OAACT,MAAM,CAACE,UAAR,GAAqBb,qBAAqB,CAACqB,QAFtC;AAGL,OAACV,MAAM,CAACG,WAAR,GAAsBI,SAAS,CAAC,CAAD,CAAT,CAAaI,GAH9B;AAIL,OAACX,MAAM,CAACI,KAAR,GAAgBK;AAJX,KAAP;AAMD,GAfkE,CAiBnE;;;AACA,SAAOH,SAAS,CAACM,QAAV,CAAmBJ,aAAnB,CAAP;AACD,CAnBD;;AAqBA,MAAMK,QAAQ,GAAG9B,iBAAiB,CAACsB,eAAD,EAAkB;AAClDS,EAAAA,YAAY,EAAE,MAAM,CAACC,KAAD,EAAQC,EAAR,MAAgB;AAAE,KAACA,EAAD,GAAMD;AAAR,GAAhB,CAD8B;AAElDE,EAAAA,KAAK,EAAE,CAACC,CAAD,EAAIC,KAAJ,KAAc,MAAMd,eAAe,CAACc,KAAD;AAFQ,CAAlB,CAAlC;AAKA,MAAMC,iBAAiB,GAAGtC,SAAS,CAAC,CAAC;AAAEuC,EAAAA,IAAF;AAAQC,EAAAA,UAAR;AAAoBP,EAAAA,KAApB;AAA2BQ,EAAAA;AAA3B,CAAD,MAA6C;AAC/EC,EAAAA,aAAa,EAAE,EACbH,IAAI,IACCC,UADL,IAEKP,KAAK,IAAI,CAFd,KAGM,CAACpB,qBAAqB,CAAC0B,IAAD,CAAtB,IAAgCE,SAHtC,CADa;AADgE,CAA7C,CAAD,CAAnC;AASA,MAAME,mBAAmB,GAAG3C,SAAS,CAAC,CAAC;AAAE4C,EAAAA,IAAI,EAAE;AAAEf,IAAAA,GAAG,EAAEgB;AAAP,GAAR;AAAyBC,EAAAA;AAAzB,CAAD,MAA6C;AACjFC,EAAAA,UAAU,EAAEC,UAAU,IACpB1C,eAAe,CAAC2C,GAAhB,CAAoB;AAAEJ,IAAAA,MAAF;AAAUC,IAAAA,WAAV;AAAuBtB,IAAAA,SAAS,EAAE;AAAEwB,MAAAA;AAAF;AAAlC,GAApB,CAF+E;AAGjFE,EAAAA,cAAc,EAAEpB,QAAQ,IACtBxB,eAAe,CAAC2C,GAAhB,CAAoB;AAAEJ,IAAAA,MAAF;AAAUC,IAAAA,WAAV;AAAuBtB,IAAAA,SAAS,EAAE;AAAEM,MAAAA;AAAF;AAAlC,GAApB;AAJ+E,CAA7C,CAAD,CAArC;AAOA,MAAMqB,mBAAmB,GAAGnD,SAAS,CAAEqC,KAAD,IAAW;AAC/C,QAAM;AACJK,IAAAA,aADI;AAEJQ,IAAAA,cAFI;AAGJH,IAAAA,UAHI;AAIJK,IAAAA,WAJI;AAKJC,IAAAA,UALI;AAMJb,IAAAA,UANI;AAOJD,IAAAA,IAPI;AAQJN,IAAAA,KARI;AASJQ,IAAAA,SATI;AAUJT,IAAAA,YAVI;AAWJG,IAAAA,KAXI;AAYJT,IAAAA,aAZI;AAaJkB,IAAAA;AAbI,MAcFP,KAdJ;AAeA,QAAMiB,2BAA2B,GAAGvC,4BAA4B,CAACsB,KAAD,CAAhE;;AAEA,QAAMkB,aAAa,GAAG,MAAM;AAC1BF,IAAAA,UAAU,CAAC,KAAD,CAAV;AACD,GAFD;;AAIA,SAAO;AACLG,IAAAA,YAAY,EAAE,MAAM;AAClBN,MAAAA,cAAc,CAACpC,oBAAoB,CAAC,EAAE,GAAGuB,KAAL;AAAYoB,QAAAA,YAAY,EAAE;AAA1B,OAAD,CAArB,CAAd;AACAL,MAAAA,WAAW;AACZ,KAJI;AAKLM,IAAAA,YAAY,EAAGC,KAAD,IAAW;AACvBA,MAAAA,KAAK,CAACC,cAAN;;AACA,UAAIlB,aAAJ,EAAmB;AACjB,eAAO,KAAP;AACD;;AAED,UACE7B,qBAAqB,CAAC0B,IAAD,CAArB,IACGE,SAAS,KAAKlC,qBAAqB,CAACsD,MAFzC,EAGE;AACAd,QAAAA,UAAU,CAAC9B,2BAA2B,CAACoB,KAAD,CAA5B,CAAV;AACD;;AAEDa,MAAAA,cAAc,CAACpC,oBAAoB,CAACuB,KAAD,CAArB,CAAd;AACAe,MAAAA,WAAW;;AAEX,UAAI1B,aAAa,KAAK,CAAC,CAAvB,EAA0B;AACxB;AACAS,QAAAA,KAAK;AACN;AACF,KAzBI;AA0BL2B,IAAAA,oBAAoB,EAAGH,KAAD,IAAW;AAC/B,UAAIA,KAAK,IAAIA,KAAK,CAACC,cAAnB,EAAmC;AACjCD,QAAAA,KAAK,CAACC,cAAN;AACD;;AACDP,MAAAA,UAAU,CAAC,IAAD,CAAV;;AAEA,UAAI5C,UAAU,CAACsD,qBAAX,CAAiCxB,IAAjC,CAAJ,EAA4C;AAC1C,cAAMyB,kBAAkB,GAAGhD,kCAAkC,CAACqB,KAAD,CAA7D;AACA,cAAM4B,WAAW,GAAGX,2BAA2B,GAAGrB,KAA9B,GAAsC+B,kBAA1D;AACA,eAAO3D,iBAAiB,CACrB4C,GADI,CACA;AACHT,UAAAA,UADG;AAEH0B,UAAAA,MAAM,EAAE;AACN,aAAC3B,IAAD,GAAQ;AAAEN,cAAAA,KAAK,EAAEgC,WAAT;AAAsBE,cAAAA,WAAW,EAAE;AAAnC;AADF;AAFL,SADA,EAOJC,OAPI,CAOIb,aAPJ,CAAP;AAQD;;AAED,aAAOnD,cAAc,CAClB6C,GADI,CACA;AACHT,QAAAA,UADG;AAEH0B,QAAAA,MAAM,EAAE;AAAE,WAAC3B,IAAD,GAAQe,2BAA2B,GAAGrB;AAAxC;AAFL,OADA,EAKJmC,OALI,CAKIb,aALJ,CAAP;AAMD,KAnDI;AAoDLc,IAAAA,0BAA0B,EAAEC,SAAS,IAAI,MAAM;AAC7CtC,MAAAA,YAAY,CAACsC,SAAD,EAAYpD,MAAM,CAACI,KAAnB,CAAZ;AACD,KAtDI;AAuDLiD,IAAAA,KAAK,EAAE3D,mBAAmB,CAACyB,KAAD,CAvDrB;AAwDLiB,IAAAA,2BAxDK;AAyDLkB,IAAAA,WAAW,EAAE5B,IAAI,CAAC6B,aAAL,KAAuBjE,cAAc,CAACkE;AAzD9C,GAAP;AA2DD,CAjFoC,CAArC;AAmFA,MAAMC,gCAAgC,GAAG5E,OAAO,CAC9CW,wBAD8C,EAE9CC,sBAF8C,EAG9CoB,QAH8C,EAI9C5B,SAAS,CAAC;AACRyE,EAAAA,yBAAyB,CAAC;AACxBpD,IAAAA,SAAS,EAAE;AAAEM,MAAAA,QAAQ,EAAE+C;AAAZ,KADa;AAExBnD,IAAAA,aAAa,EAAEoD;AAFS,GAAD,EAGtB;AACD,UAAM;AACJtD,MAAAA,SAAS,EAAE;AAAEM,QAAAA;AAAF,OADP;AAEJJ,MAAAA;AAFI,QAGF,KAAKW,KAHT;;AAIA,QACE0C,IAAI,CAACC,SAAL,CAAelD,QAAQ,CAACJ,aAAD,CAAvB,MACIqD,IAAI,CAACC,SAAL,CAAeH,SAAS,CAACC,SAAD,CAAxB,CAFN,EAGE;AACA,WAAKzC,KAAL,CAAWF,KAAX;AACD;AACF;;AAfO,CAAD,CAJqC,EAqB9CG,iBArB8C,EAsB9CK,mBAtB8C,EAuB9CzC,SAAS,CAAC,SAAD,EAAY,YAAZ,EAA0B,KAA1B,CAvBqC,EAwB9CiD,mBAxB8C,CAAhD;AA2BA,eAAewB,gCAAf","sourcesContent":["import {\n  compose,\n  withProps,\n  withStateHandlers,\n  withState,\n  lifecycle,\n} from 'recompose';\n\nimport {\n  borrowerUpdate,\n  pushBorrowerValue,\n  updateStructure,\n} from '../../../../../api';\nimport {\n  OWN_FUNDS_USAGE_TYPES,\n  RESIDENCE_TYPE,\n} from '../../../../../api/constants';\nimport Calculator from '../../../../../utils/Calculator';\nimport SingleStructureContainer from '../../containers/SingleStructureContainer';\nimport FinancingDataContainer from '../../containers/FinancingDataContainer';\nimport {\n  chooseOwnFundsTypes,\n  shouldAskForUsageType,\n  makeNewOwnFundsArray,\n  getOwnFundsOfTypeAndBorrower,\n  getAvailableFundsOfTypeAndBorrower,\n  getNewWantedLoanAfterPledge,\n} from './FinancingOwnFundsPickerHelpers';\n\nexport const FIELDS = {\n  TYPE: 'type',\n  USAGE_TYPE: 'usageType',\n  BORROWER_ID: 'borrowerId',\n  VALUE: 'value',\n};\n\nconst getInitialState = ({ structure, borrowers, ownFundsIndex }) => {\n  // On load, the redux store has not loaded yet, causing this to crash\n  // if we don't add this simple check\n  if (!structure) {\n    return {};\n  }\n\n  // New ownFunds object\n  if (ownFundsIndex < 0) {\n    return {\n      [FIELDS.TYPE]: undefined,\n      [FIELDS.USAGE_TYPE]: OWN_FUNDS_USAGE_TYPES.WITHDRAW,\n      [FIELDS.BORROWER_ID]: borrowers[0]._id,\n      [FIELDS.VALUE]: undefined,\n    };\n  }\n\n  // When editing existing ownFunds object\n  return structure.ownFunds[ownFundsIndex];\n};\n\nconst addState = withStateHandlers(getInitialState, {\n  handleChange: () => (value, id) => ({ [id]: value }),\n  reset: (_, props) => () => getInitialState(props),\n});\n\nconst withDisableSubmit = withProps(({ type, borrowerId, value, usageType }) => ({\n  disableSubmit: !(\n    type\n      && borrowerId\n      && value >= 0\n      && (!shouldAskForUsageType(type) || usageType)\n  ),\n}));\n\nconst withStructureUpdate = withProps(({ loan: { _id: loanId }, structureId }) => ({\n  updateLoan: wantedLoan =>\n    updateStructure.run({ loanId, structureId, structure: { wantedLoan } }),\n  updateOwnFunds: ownFunds =>\n    updateStructure.run({ loanId, structureId, structure: { ownFunds } }),\n}));\n\nconst withAdditionalProps = withProps((props) => {\n  const {\n    disableSubmit,\n    updateOwnFunds,\n    updateLoan,\n    handleClose,\n    setLoading,\n    borrowerId,\n    type,\n    value,\n    usageType,\n    handleChange,\n    reset,\n    ownFundsIndex,\n    loan,\n  } = props;\n  const otherValueOfTypeAndBorrower = getOwnFundsOfTypeAndBorrower(props);\n\n  const updateCleanup = () => {\n    setLoading(false);\n  };\n\n  return {\n    handleDelete: () => {\n      updateOwnFunds(makeNewOwnFundsArray({ ...props, shouldDelete: true }));\n      handleClose();\n    },\n    handleSubmit: (event) => {\n      event.preventDefault();\n      if (disableSubmit) {\n        return false;\n      }\n\n      if (\n        shouldAskForUsageType(type)\n        && usageType === OWN_FUNDS_USAGE_TYPES.PLEDGE\n      ) {\n        updateLoan(getNewWantedLoanAfterPledge(props));\n      }\n\n      updateOwnFunds(makeNewOwnFundsArray(props));\n      handleClose();\n\n      if (ownFundsIndex === -1) {\n        // Cleanup\n        reset();\n      }\n    },\n    handleUpdateBorrower: (event) => {\n      if (event && event.preventDefault) {\n        event.preventDefault();\n      }\n      setLoading(true);\n\n      if (Calculator.isTypeWithArrayValues(type)) {\n        const currentlyAvailable = getAvailableFundsOfTypeAndBorrower(props);\n        const deltaNeeded = otherValueOfTypeAndBorrower + value - currentlyAvailable;\n        return pushBorrowerValue\n          .run({\n            borrowerId,\n            object: {\n              [type]: { value: deltaNeeded, description: 'Ajout automatique' },\n            },\n          })\n          .finally(updateCleanup);\n      }\n\n      return borrowerUpdate\n        .run({\n          borrowerId,\n          object: { [type]: otherValueOfTypeAndBorrower + value },\n        })\n        .finally(updateCleanup);\n    },\n    handleCancelUpdateBorrower: remaining => () => {\n      handleChange(remaining, FIELDS.VALUE);\n    },\n    types: chooseOwnFundsTypes(props),\n    otherValueOfTypeAndBorrower,\n    allowPledge: loan.residenceType === RESIDENCE_TYPE.MAIN_RESIDENCE,\n  };\n});\n\nconst FinancingOwnFundsPickerContainer = compose(\n  SingleStructureContainer,\n  FinancingDataContainer,\n  addState,\n  lifecycle({\n    componentWillReceiveProps({\n      structure: { ownFunds: nextFunds },\n      ownFundsIndex: nextIndex,\n    }) {\n      const {\n        structure: { ownFunds },\n        ownFundsIndex,\n      } = this.props;\n      if (\n        JSON.stringify(ownFunds[ownFundsIndex])\n        !== JSON.stringify(nextFunds[nextIndex])\n      ) {\n        this.props.reset();\n      }\n    },\n  }),\n  withDisableSubmit,\n  withStructureUpdate,\n  withState('loading', 'setLoading', false),\n  withAdditionalProps,\n);\n\nexport default FinancingOwnFundsPickerContainer;\n"]},"passPerPreset":false,"envName":"development","cwd":"/Users/Florian/dev/epotek/microservices/backend","root":"/Users/Florian/dev/epotek/microservices/backend","plugins":[{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/components/Financing/client/FinancingOwnFunds/FinancingOwnFundsPicker/FinancingOwnFundsPickerContainer.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/core/components/Financing/client/FinancingOwnFunds/FinancingOwnFundsPicker/FinancingOwnFundsPickerContainer.js"}},"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread\"));\n\nmodule.export({\n  FIELDS: () => FIELDS\n});\nlet compose, withProps, withStateHandlers, withState, lifecycle;\nmodule.link(\"recompose\", {\n  compose(v) {\n    compose = v;\n  },\n\n  withProps(v) {\n    withProps = v;\n  },\n\n  withStateHandlers(v) {\n    withStateHandlers = v;\n  },\n\n  withState(v) {\n    withState = v;\n  },\n\n  lifecycle(v) {\n    lifecycle = v;\n  }\n\n}, 0);\nlet borrowerUpdate, pushBorrowerValue, updateStructure;\nmodule.link(\"../../../../../api\", {\n  borrowerUpdate(v) {\n    borrowerUpdate = v;\n  },\n\n  pushBorrowerValue(v) {\n    pushBorrowerValue = v;\n  },\n\n  updateStructure(v) {\n    updateStructure = v;\n  }\n\n}, 1);\nlet OWN_FUNDS_USAGE_TYPES, RESIDENCE_TYPE;\nmodule.link(\"../../../../../api/constants\", {\n  OWN_FUNDS_USAGE_TYPES(v) {\n    OWN_FUNDS_USAGE_TYPES = v;\n  },\n\n  RESIDENCE_TYPE(v) {\n    RESIDENCE_TYPE = v;\n  }\n\n}, 2);\nlet Calculator;\nmodule.link(\"../../../../../utils/Calculator\", {\n  default(v) {\n    Calculator = v;\n  }\n\n}, 3);\nlet SingleStructureContainer;\nmodule.link(\"../../containers/SingleStructureContainer\", {\n  default(v) {\n    SingleStructureContainer = v;\n  }\n\n}, 4);\nlet FinancingDataContainer;\nmodule.link(\"../../containers/FinancingDataContainer\", {\n  default(v) {\n    FinancingDataContainer = v;\n  }\n\n}, 5);\nlet chooseOwnFundsTypes, shouldAskForUsageType, makeNewOwnFundsArray, getOwnFundsOfTypeAndBorrower, getAvailableFundsOfTypeAndBorrower, getNewWantedLoanAfterPledge;\nmodule.link(\"./FinancingOwnFundsPickerHelpers\", {\n  chooseOwnFundsTypes(v) {\n    chooseOwnFundsTypes = v;\n  },\n\n  shouldAskForUsageType(v) {\n    shouldAskForUsageType = v;\n  },\n\n  makeNewOwnFundsArray(v) {\n    makeNewOwnFundsArray = v;\n  },\n\n  getOwnFundsOfTypeAndBorrower(v) {\n    getOwnFundsOfTypeAndBorrower = v;\n  },\n\n  getAvailableFundsOfTypeAndBorrower(v) {\n    getAvailableFundsOfTypeAndBorrower = v;\n  },\n\n  getNewWantedLoanAfterPledge(v) {\n    getNewWantedLoanAfterPledge = v;\n  }\n\n}, 6);\nconst FIELDS = {\n  TYPE: 'type',\n  USAGE_TYPE: 'usageType',\n  BORROWER_ID: 'borrowerId',\n  VALUE: 'value'\n};\n\nconst getInitialState = (_ref) => {\n  let {\n    structure,\n    borrowers,\n    ownFundsIndex\n  } = _ref;\n\n  // On load, the redux store has not loaded yet, causing this to crash\n  // if we don't add this simple check\n  if (!structure) {\n    return {};\n  } // New ownFunds object\n\n\n  if (ownFundsIndex < 0) {\n    return {\n      [FIELDS.TYPE]: undefined,\n      [FIELDS.USAGE_TYPE]: OWN_FUNDS_USAGE_TYPES.WITHDRAW,\n      [FIELDS.BORROWER_ID]: borrowers[0]._id,\n      [FIELDS.VALUE]: undefined\n    };\n  } // When editing existing ownFunds object\n\n\n  return structure.ownFunds[ownFundsIndex];\n};\n\nconst addState = withStateHandlers(getInitialState, {\n  handleChange: () => (value, id) => ({\n    [id]: value\n  }),\n  reset: (_, props) => () => getInitialState(props)\n});\nconst withDisableSubmit = withProps((_ref2) => {\n  let {\n    type,\n    borrowerId,\n    value,\n    usageType\n  } = _ref2;\n  return {\n    disableSubmit: !(type && borrowerId && value >= 0 && (!shouldAskForUsageType(type) || usageType))\n  };\n});\nconst withStructureUpdate = withProps((_ref3) => {\n  let {\n    loan: {\n      _id: loanId\n    },\n    structureId\n  } = _ref3;\n  return {\n    updateLoan: wantedLoan => updateStructure.run({\n      loanId,\n      structureId,\n      structure: {\n        wantedLoan\n      }\n    }),\n    updateOwnFunds: ownFunds => updateStructure.run({\n      loanId,\n      structureId,\n      structure: {\n        ownFunds\n      }\n    })\n  };\n});\nconst withAdditionalProps = withProps(props => {\n  const {\n    disableSubmit,\n    updateOwnFunds,\n    updateLoan,\n    handleClose,\n    setLoading,\n    borrowerId,\n    type,\n    value,\n    usageType,\n    handleChange,\n    reset,\n    ownFundsIndex,\n    loan\n  } = props;\n  const otherValueOfTypeAndBorrower = getOwnFundsOfTypeAndBorrower(props);\n\n  const updateCleanup = () => {\n    setLoading(false);\n  };\n\n  return {\n    handleDelete: () => {\n      updateOwnFunds(makeNewOwnFundsArray((0, _objectSpread2.default)({}, props, {\n        shouldDelete: true\n      })));\n      handleClose();\n    },\n    handleSubmit: event => {\n      event.preventDefault();\n\n      if (disableSubmit) {\n        return false;\n      }\n\n      if (shouldAskForUsageType(type) && usageType === OWN_FUNDS_USAGE_TYPES.PLEDGE) {\n        updateLoan(getNewWantedLoanAfterPledge(props));\n      }\n\n      updateOwnFunds(makeNewOwnFundsArray(props));\n      handleClose();\n\n      if (ownFundsIndex === -1) {\n        // Cleanup\n        reset();\n      }\n    },\n    handleUpdateBorrower: event => {\n      if (event && event.preventDefault) {\n        event.preventDefault();\n      }\n\n      setLoading(true);\n\n      if (Calculator.isTypeWithArrayValues(type)) {\n        const currentlyAvailable = getAvailableFundsOfTypeAndBorrower(props);\n        const deltaNeeded = otherValueOfTypeAndBorrower + value - currentlyAvailable;\n        return pushBorrowerValue.run({\n          borrowerId,\n          object: {\n            [type]: {\n              value: deltaNeeded,\n              description: 'Ajout automatique'\n            }\n          }\n        }).finally(updateCleanup);\n      }\n\n      return borrowerUpdate.run({\n        borrowerId,\n        object: {\n          [type]: otherValueOfTypeAndBorrower + value\n        }\n      }).finally(updateCleanup);\n    },\n    handleCancelUpdateBorrower: remaining => () => {\n      handleChange(remaining, FIELDS.VALUE);\n    },\n    types: chooseOwnFundsTypes(props),\n    otherValueOfTypeAndBorrower,\n    allowPledge: loan.residenceType === RESIDENCE_TYPE.MAIN_RESIDENCE\n  };\n});\nconst FinancingOwnFundsPickerContainer = compose(SingleStructureContainer, FinancingDataContainer, addState, lifecycle({\n  componentWillReceiveProps(_ref4) {\n    let {\n      structure: {\n        ownFunds: nextFunds\n      },\n      ownFundsIndex: nextIndex\n    } = _ref4;\n    const {\n      structure: {\n        ownFunds\n      },\n      ownFundsIndex\n    } = this.props;\n\n    if (JSON.stringify(ownFunds[ownFundsIndex]) !== JSON.stringify(nextFunds[nextIndex])) {\n      this.props.reset();\n    }\n  }\n\n}), withDisableSubmit, withStructureUpdate, withState('loading', 'setLoading', false), withAdditionalProps);\nmodule.exportDefault(FinancingOwnFundsPickerContainer);","map":{"version":3,"sources":["imports/core/components/Financing/client/FinancingOwnFunds/FinancingOwnFundsPicker/FinancingOwnFundsPickerContainer.js"],"names":["compose","withProps","withStateHandlers","FIELDS","TYPE","USAGE_TYPE","BORROWER_ID","VALUE","getInitialState","ownFundsIndex","OWN_FUNDS_USAGE_TYPES","borrowers","undefined","structure","addState","handleChange","value","reset","withDisableSubmit","usageType","disableSubmit","type","shouldAskForUsageType","withStructureUpdate","loan","_id","loanId","structureId","updateLoan","wantedLoan","updateOwnFunds","ownFunds","withAdditionalProps","props","otherValueOfTypeAndBorrower","getOwnFundsOfTypeAndBorrower","updateCleanup","setLoading","handleDelete","makeNewOwnFundsArray","shouldDelete","handleClose","handleSubmit","event","getNewWantedLoanAfterPledge","handleUpdateBorrower","Calculator","currentlyAvailable","getAvailableFundsOfTypeAndBorrower","deltaNeeded","object","description","handleCancelUpdateBorrower","remaining","types","chooseOwnFundsTypes","allowPledge","RESIDENCE_TYPE","MAIN_RESIDENCE","FinancingOwnFundsPickerContainer","lifecycle","componentWillReceiveProps","nextFunds","nextIndex","JSON","withState"],"mappings":"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","sourcesContent":["import {\n  compose,\n  withProps,\n  withStateHandlers,\n  withState,\n  lifecycle,\n} from 'recompose';\n\nimport {\n  borrowerUpdate,\n  pushBorrowerValue,\n  updateStructure,\n} from '../../../../../api';\nimport {\n  OWN_FUNDS_USAGE_TYPES,\n  RESIDENCE_TYPE,\n} from '../../../../../api/constants';\nimport Calculator from '../../../../../utils/Calculator';\nimport SingleStructureContainer from '../../containers/SingleStructureContainer';\nimport FinancingDataContainer from '../../containers/FinancingDataContainer';\nimport {\n  chooseOwnFundsTypes,\n  shouldAskForUsageType,\n  makeNewOwnFundsArray,\n  getOwnFundsOfTypeAndBorrower,\n  getAvailableFundsOfTypeAndBorrower,\n  getNewWantedLoanAfterPledge,\n} from './FinancingOwnFundsPickerHelpers';\n\nexport const FIELDS = {\n  TYPE: 'type',\n  USAGE_TYPE: 'usageType',\n  BORROWER_ID: 'borrowerId',\n  VALUE: 'value',\n};\n\nconst getInitialState = ({ structure, borrowers, ownFundsIndex }) => {\n  // On load, the redux store has not loaded yet, causing this to crash\n  // if we don't add this simple check\n  if (!structure) {\n    return {};\n  }\n\n  // New ownFunds object\n  if (ownFundsIndex < 0) {\n    return {\n      [FIELDS.TYPE]: undefined,\n      [FIELDS.USAGE_TYPE]: OWN_FUNDS_USAGE_TYPES.WITHDRAW,\n      [FIELDS.BORROWER_ID]: borrowers[0]._id,\n      [FIELDS.VALUE]: undefined,\n    };\n  }\n\n  // When editing existing ownFunds object\n  return structure.ownFunds[ownFundsIndex];\n};\n\nconst addState = withStateHandlers(getInitialState, {\n  handleChange: () => (value, id) => ({ [id]: value }),\n  reset: (_, props) => () => getInitialState(props),\n});\n\nconst withDisableSubmit = withProps(({ type, borrowerId, value, usageType }) => ({\n  disableSubmit: !(\n    type\n      && borrowerId\n      && value >= 0\n      && (!shouldAskForUsageType(type) || usageType)\n  ),\n}));\n\nconst withStructureUpdate = withProps(({ loan: { _id: loanId }, structureId }) => ({\n  updateLoan: wantedLoan =>\n    updateStructure.run({ loanId, structureId, structure: { wantedLoan } }),\n  updateOwnFunds: ownFunds =>\n    updateStructure.run({ loanId, structureId, structure: { ownFunds } }),\n}));\n\nconst withAdditionalProps = withProps((props) => {\n  const {\n    disableSubmit,\n    updateOwnFunds,\n    updateLoan,\n    handleClose,\n    setLoading,\n    borrowerId,\n    type,\n    value,\n    usageType,\n    handleChange,\n    reset,\n    ownFundsIndex,\n    loan,\n  } = props;\n  const otherValueOfTypeAndBorrower = getOwnFundsOfTypeAndBorrower(props);\n\n  const updateCleanup = () => {\n    setLoading(false);\n  };\n\n  return {\n    handleDelete: () => {\n      updateOwnFunds(makeNewOwnFundsArray({ ...props, shouldDelete: true }));\n      handleClose();\n    },\n    handleSubmit: (event) => {\n      event.preventDefault();\n      if (disableSubmit) {\n        return false;\n      }\n\n      if (\n        shouldAskForUsageType(type)\n        && usageType === OWN_FUNDS_USAGE_TYPES.PLEDGE\n      ) {\n        updateLoan(getNewWantedLoanAfterPledge(props));\n      }\n\n      updateOwnFunds(makeNewOwnFundsArray(props));\n      handleClose();\n\n      if (ownFundsIndex === -1) {\n        // Cleanup\n        reset();\n      }\n    },\n    handleUpdateBorrower: (event) => {\n      if (event && event.preventDefault) {\n        event.preventDefault();\n      }\n      setLoading(true);\n\n      if (Calculator.isTypeWithArrayValues(type)) {\n        const currentlyAvailable = getAvailableFundsOfTypeAndBorrower(props);\n        const deltaNeeded = otherValueOfTypeAndBorrower + value - currentlyAvailable;\n        return pushBorrowerValue\n          .run({\n            borrowerId,\n            object: {\n              [type]: { value: deltaNeeded, description: 'Ajout automatique' },\n            },\n          })\n          .finally(updateCleanup);\n      }\n\n      return borrowerUpdate\n        .run({\n          borrowerId,\n          object: { [type]: otherValueOfTypeAndBorrower + value },\n        })\n        .finally(updateCleanup);\n    },\n    handleCancelUpdateBorrower: remaining => () => {\n      handleChange(remaining, FIELDS.VALUE);\n    },\n    types: chooseOwnFundsTypes(props),\n    otherValueOfTypeAndBorrower,\n    allowPledge: loan.residenceType === RESIDENCE_TYPE.MAIN_RESIDENCE,\n  };\n});\n\nconst FinancingOwnFundsPickerContainer = compose(\n  SingleStructureContainer,\n  FinancingDataContainer,\n  addState,\n  lifecycle({\n    componentWillReceiveProps({\n      structure: { ownFunds: nextFunds },\n      ownFundsIndex: nextIndex,\n    }) {\n      const {\n        structure: { ownFunds },\n        ownFundsIndex,\n      } = this.props;\n      if (\n        JSON.stringify(ownFunds[ownFundsIndex])\n        !== JSON.stringify(nextFunds[nextIndex])\n      ) {\n        this.props.reset();\n      }\n    },\n  }),\n  withDisableSubmit,\n  withStructureUpdate,\n  withState('loading', 'setLoading', false),\n  withAdditionalProps,\n);\n\nexport default FinancingOwnFundsPickerContainer;\n"]},"sourceType":"script","hash":"06e1b1ac849dbe4383b7c3d5985ea61b10132497"}
