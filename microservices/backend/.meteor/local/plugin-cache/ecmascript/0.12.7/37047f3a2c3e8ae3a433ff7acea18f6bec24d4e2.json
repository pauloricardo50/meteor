{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/Florian/dev/epotek/microservices/backend/imports/core/components/OfferList/feedbackHelpers.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties",["flow",{}],"dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"imports/core/components/OfferList/feedbackHelpers.js","filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/components/OfferList/feedbackHelpers.js","inputSourceMap":{"version":3,"sources":["imports/core/components/OfferList/feedbackHelpers.js"],"names":["Meteor","moment","FEEDBACK_OPTIONS","POSITIVE","NEGATIVE_NOT_COMPETITIVE","NEGATIVE_WITHOUT_FOLLOW_UP","CUSTOM","FEEDBACK_OPTIONS_SETTINGS","enableComments","enableOutro","enableCustomIntro","greetings","contactName","formatMessage","id","introduction","option","borrowers","singleBorrower","address","date","borrower","name","borrower1","borrower2","outro","closing","assignee","makeFeedback","model","offer","comments","customFeedback","lender","contact","firstName","loan","user","assignedEmployee","property","createdAt","address1","zipCode","city","Error","replace","feedback","length","concat","format","filter","x","map","comment","join"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport moment from 'moment';\n\nexport const FEEDBACK_OPTIONS = {\n  POSITIVE: 'POSITIVE',\n  NEGATIVE_NOT_COMPETITIVE: 'NEGATIVE_NOT_COMPETITIVE',\n  NEGATIVE_WITHOUT_FOLLOW_UP: 'NEGATIVE_WITHOUT_FOLLOW_UP',\n  CUSTOM: 'CUSTOM',\n};\n\nexport const FEEDBACK_OPTIONS_SETTINGS = {\n  [FEEDBACK_OPTIONS.POSITIVE]: {\n    enableComments: true,\n    enableOutro: true,\n  },\n  [FEEDBACK_OPTIONS.NEGATIVE_NOT_COMPETITIVE]: {\n    enableComments: true,\n    enableOutro: true,\n  },\n  [FEEDBACK_OPTIONS.NEGATIVE_WITHOUT_FOLLOW_UP]: {\n    enableComments: true,\n    enableCustomIntro: true,\n    enableOutro: true,\n  },\n  [FEEDBACK_OPTIONS.CUSTOM]: {\n    enableCustomIntro: false,\n    enableComments: false,\n    enableOutro: false,\n  },\n};\n\nconst greetings = ({ contactName, formatMessage }) =>\n  formatMessage({ id: 'Feedback.greetings' }, { contactName });\n\nconst introduction = ({\n  option,\n  borrowers,\n  singleBorrower,\n  address,\n  date,\n  formatMessage,\n}) => {\n  if (singleBorrower) {\n    return formatMessage(\n      {\n        id: FEEDBACK_OPTIONS_SETTINGS[option].enableCustomIntro\n          ? `Feedback.${option}.introduction.singleBorrower`\n          : 'Feedback.introduction.singleBorrower',\n      },\n      {\n        borrower: borrowers[0].name,\n        address,\n        date,\n      },\n    );\n  }\n\n  return formatMessage(\n    {\n      id: FEEDBACK_OPTIONS_SETTINGS[option].enableCustomIntro\n        ? `Feedback.${option}.introduction.twoBorrowers`\n        : 'Feedback.introduction.twoBorrowers',\n    },\n    {\n      borrower1: borrowers[0].name,\n      borrower2: borrowers[1].name,\n      address,\n      date,\n    },\n  );\n};\n\nconst outro = ({ borrowers, singleBorrower, option, formatMessage }) => {\n  if (singleBorrower) {\n    return formatMessage(\n      { id: `Feedback.${option}.outro.singleBorrower` },\n      { borrower: borrowers[0].name, singleBorrower: true },\n    );\n  }\n\n  return formatMessage(\n    { id: `Feedback.${option}.outro.twoBorrowers` },\n    {\n      borrower1: borrowers[0].name,\n      borrower2: borrowers[1].name,\n      singleBorrower: false,\n    },\n  );\n};\n\nconst closing = ({ assignee, formatMessage }) =>\n  formatMessage({ id: 'Feedback.closing' }, { assignee });\n\nexport const makeFeedback = ({ model, offer, formatMessage }) => {\n  const { option, comments = [], customFeedback = '' } = model;\n  const {\n    lender: {\n      contact: { firstName: contactName },\n      loan: {\n        borrowers,\n        user: { assignedEmployee },\n      },\n    },\n    property,\n    createdAt,\n  } = offer;\n\n  const { firstName: assignee = 'e-Potek' } = assignedEmployee || {};\n  const { address1, zipCode, city } = property || {};\n\n  if (!property || !address1 || !zipCode || !city) {\n    throw new Meteor.Error('No property or address');\n  }\n\n  const address = `${address1}, ${zipCode} ${city}`;\n\n  if (option === FEEDBACK_OPTIONS.CUSTOM) {\n    // Replace all returns into HTML\n    return customFeedback.replace(/(?:\\r\\n|\\r|\\n)/g, '<br>');\n  }\n\n  let feedback = '';\n  const singleBorrower = borrowers.length === 1;\n\n  if (option) {\n    feedback = feedback.concat(greetings({ contactName, formatMessage }));\n    feedback = feedback.concat(introduction({\n      option,\n      borrowers,\n      singleBorrower,\n      address,\n      date: moment(createdAt).format('DD.MM.YYYY'),\n      formatMessage,\n    }));\n    feedback = feedback.concat(formatMessage({ id: `Feedback.${option}.body` }, { singleBorrower }));\n\n    if (comments.length && FEEDBACK_OPTIONS_SETTINGS[option].enableComments) {\n      feedback = feedback.concat(formatMessage(\n        { id: `Feedback.${option}.comments` },\n        { singleBorrower },\n      ));\n      feedback = feedback.concat(\n        '<ul>',\n        comments\n          .filter(x => x)\n          .map(comment => `<li><b>${comment}</b></li>`)\n          .join('\\n'),\n        '</ul>',\n      );\n    }\n\n    if (FEEDBACK_OPTIONS_SETTINGS[option].enableOutro) {\n      feedback = feedback.concat(outro({ option, singleBorrower, borrowers, formatMessage }));\n    }\n\n    feedback = feedback.concat(closing({ assignee, formatMessage }));\n  }\n\n  return feedback;\n};\n"]},"passPerPreset":false,"envName":"development","cwd":"/Users/Florian/dev/epotek/microservices/backend","root":"/Users/Florian/dev/epotek/microservices/backend","plugins":[{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/components/OfferList/feedbackHelpers.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/core/components/OfferList/feedbackHelpers.js"}},"code":"var _FEEDBACK_OPTIONS_SET;\n\nmodule.export({\n  FEEDBACK_OPTIONS: function () {\n    return FEEDBACK_OPTIONS;\n  },\n  FEEDBACK_OPTIONS_SETTINGS: function () {\n    return FEEDBACK_OPTIONS_SETTINGS;\n  },\n  makeFeedback: function () {\n    return makeFeedback;\n  }\n});\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 0);\nvar moment;\nmodule.link(\"moment\", {\n  \"default\": function (v) {\n    moment = v;\n  }\n}, 1);\nvar FEEDBACK_OPTIONS = {\n  POSITIVE: 'POSITIVE',\n  NEGATIVE_NOT_COMPETITIVE: 'NEGATIVE_NOT_COMPETITIVE',\n  NEGATIVE_WITHOUT_FOLLOW_UP: 'NEGATIVE_WITHOUT_FOLLOW_UP',\n  CUSTOM: 'CUSTOM'\n};\nvar FEEDBACK_OPTIONS_SETTINGS = (_FEEDBACK_OPTIONS_SET = {}, _FEEDBACK_OPTIONS_SET[FEEDBACK_OPTIONS.POSITIVE] = {\n  enableComments: true,\n  enableOutro: true\n}, _FEEDBACK_OPTIONS_SET[FEEDBACK_OPTIONS.NEGATIVE_NOT_COMPETITIVE] = {\n  enableComments: true,\n  enableOutro: true\n}, _FEEDBACK_OPTIONS_SET[FEEDBACK_OPTIONS.NEGATIVE_WITHOUT_FOLLOW_UP] = {\n  enableComments: true,\n  enableCustomIntro: true,\n  enableOutro: true\n}, _FEEDBACK_OPTIONS_SET[FEEDBACK_OPTIONS.CUSTOM] = {\n  enableCustomIntro: false,\n  enableComments: false,\n  enableOutro: false\n}, _FEEDBACK_OPTIONS_SET);\n\nvar greetings = function (_ref) {\n  var contactName = _ref.contactName,\n      formatMessage = _ref.formatMessage;\n  return formatMessage({\n    id: 'Feedback.greetings'\n  }, {\n    contactName: contactName\n  });\n};\n\nvar introduction = function (_ref2) {\n  var option = _ref2.option,\n      borrowers = _ref2.borrowers,\n      singleBorrower = _ref2.singleBorrower,\n      address = _ref2.address,\n      date = _ref2.date,\n      formatMessage = _ref2.formatMessage;\n\n  if (singleBorrower) {\n    return formatMessage({\n      id: FEEDBACK_OPTIONS_SETTINGS[option].enableCustomIntro ? \"Feedback.\" + option + \".introduction.singleBorrower\" : 'Feedback.introduction.singleBorrower'\n    }, {\n      borrower: borrowers[0].name,\n      address: address,\n      date: date\n    });\n  }\n\n  return formatMessage({\n    id: FEEDBACK_OPTIONS_SETTINGS[option].enableCustomIntro ? \"Feedback.\" + option + \".introduction.twoBorrowers\" : 'Feedback.introduction.twoBorrowers'\n  }, {\n    borrower1: borrowers[0].name,\n    borrower2: borrowers[1].name,\n    address: address,\n    date: date\n  });\n};\n\nvar outro = function (_ref3) {\n  var borrowers = _ref3.borrowers,\n      singleBorrower = _ref3.singleBorrower,\n      option = _ref3.option,\n      formatMessage = _ref3.formatMessage;\n\n  if (singleBorrower) {\n    return formatMessage({\n      id: \"Feedback.\" + option + \".outro.singleBorrower\"\n    }, {\n      borrower: borrowers[0].name,\n      singleBorrower: true\n    });\n  }\n\n  return formatMessage({\n    id: \"Feedback.\" + option + \".outro.twoBorrowers\"\n  }, {\n    borrower1: borrowers[0].name,\n    borrower2: borrowers[1].name,\n    singleBorrower: false\n  });\n};\n\nvar closing = function (_ref4) {\n  var assignee = _ref4.assignee,\n      formatMessage = _ref4.formatMessage;\n  return formatMessage({\n    id: 'Feedback.closing'\n  }, {\n    assignee: assignee\n  });\n};\n\nvar makeFeedback = function (_ref5) {\n  var model = _ref5.model,\n      offer = _ref5.offer,\n      formatMessage = _ref5.formatMessage;\n  var option = model.option,\n      _model$comments = model.comments,\n      comments = _model$comments === void 0 ? [] : _model$comments,\n      _model$customFeedback = model.customFeedback,\n      customFeedback = _model$customFeedback === void 0 ? '' : _model$customFeedback;\n  var _offer$lender = offer.lender,\n      contactName = _offer$lender.contact.firstName,\n      _offer$lender$loan = _offer$lender.loan,\n      borrowers = _offer$lender$loan.borrowers,\n      assignedEmployee = _offer$lender$loan.user.assignedEmployee,\n      property = offer.property,\n      createdAt = offer.createdAt;\n\n  var _ref6 = assignedEmployee || {},\n      _ref6$firstName = _ref6.firstName,\n      assignee = _ref6$firstName === void 0 ? 'e-Potek' : _ref6$firstName;\n\n  var _ref7 = property || {},\n      address1 = _ref7.address1,\n      zipCode = _ref7.zipCode,\n      city = _ref7.city;\n\n  if (!property || !address1 || !zipCode || !city) {\n    throw new Meteor.Error('No property or address');\n  }\n\n  var address = address1 + \", \" + zipCode + \" \" + city;\n\n  if (option === FEEDBACK_OPTIONS.CUSTOM) {\n    // Replace all returns into HTML\n    return customFeedback.replace(/(?:\\r\\n|\\r|\\n)/g, '<br>');\n  }\n\n  var feedback = '';\n  var singleBorrower = borrowers.length === 1;\n\n  if (option) {\n    feedback = feedback.concat(greetings({\n      contactName: contactName,\n      formatMessage: formatMessage\n    }));\n    feedback = feedback.concat(introduction({\n      option: option,\n      borrowers: borrowers,\n      singleBorrower: singleBorrower,\n      address: address,\n      date: moment(createdAt).format('DD.MM.YYYY'),\n      formatMessage: formatMessage\n    }));\n    feedback = feedback.concat(formatMessage({\n      id: \"Feedback.\" + option + \".body\"\n    }, {\n      singleBorrower: singleBorrower\n    }));\n\n    if (comments.length && FEEDBACK_OPTIONS_SETTINGS[option].enableComments) {\n      feedback = feedback.concat(formatMessage({\n        id: \"Feedback.\" + option + \".comments\"\n      }, {\n        singleBorrower: singleBorrower\n      }));\n      feedback = feedback.concat('<ul>', comments.filter(function (x) {\n        return x;\n      }).map(function (comment) {\n        return \"<li><b>\" + comment + \"</b></li>\";\n      }).join('\\n'), '</ul>');\n    }\n\n    if (FEEDBACK_OPTIONS_SETTINGS[option].enableOutro) {\n      feedback = feedback.concat(outro({\n        option: option,\n        singleBorrower: singleBorrower,\n        borrowers: borrowers,\n        formatMessage: formatMessage\n      }));\n    }\n\n    feedback = feedback.concat(closing({\n      assignee: assignee,\n      formatMessage: formatMessage\n    }));\n  }\n\n  return feedback;\n};","map":{"version":3,"sources":["imports/core/components/OfferList/feedbackHelpers.js"],"names":["Meteor","FEEDBACK_OPTIONS","POSITIVE","NEGATIVE_NOT_COMPETITIVE","NEGATIVE_WITHOUT_FOLLOW_UP","CUSTOM","FEEDBACK_OPTIONS_SETTINGS","enableComments","enableOutro","enableCustomIntro","greetings","formatMessage","id","contactName","introduction","borrower","borrowers","address","date","borrower1","borrower2","outro","option","singleBorrower","closing","assignee","makeFeedback","comments","customFeedback","lender","contact","firstName","loan","user","assignedEmployee","createdAt","city","property","address1","zipCode","feedback","moment","x","comment"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport moment from 'moment';\n\nexport const FEEDBACK_OPTIONS = {\n  POSITIVE: 'POSITIVE',\n  NEGATIVE_NOT_COMPETITIVE: 'NEGATIVE_NOT_COMPETITIVE',\n  NEGATIVE_WITHOUT_FOLLOW_UP: 'NEGATIVE_WITHOUT_FOLLOW_UP',\n  CUSTOM: 'CUSTOM',\n};\n\nexport const FEEDBACK_OPTIONS_SETTINGS = {\n  [FEEDBACK_OPTIONS.POSITIVE]: {\n    enableComments: true,\n    enableOutro: true,\n  },\n  [FEEDBACK_OPTIONS.NEGATIVE_NOT_COMPETITIVE]: {\n    enableComments: true,\n    enableOutro: true,\n  },\n  [FEEDBACK_OPTIONS.NEGATIVE_WITHOUT_FOLLOW_UP]: {\n    enableComments: true,\n    enableCustomIntro: true,\n    enableOutro: true,\n  },\n  [FEEDBACK_OPTIONS.CUSTOM]: {\n    enableCustomIntro: false,\n    enableComments: false,\n    enableOutro: false,\n  },\n};\n\nconst greetings = ({ contactName, formatMessage }) =>\n  formatMessage({ id: 'Feedback.greetings' }, { contactName });\n\nconst introduction = ({\n  option,\n  borrowers,\n  singleBorrower,\n  address,\n  date,\n  formatMessage,\n}) => {\n  if (singleBorrower) {\n    return formatMessage(\n      {\n        id: FEEDBACK_OPTIONS_SETTINGS[option].enableCustomIntro\n          ? `Feedback.${option}.introduction.singleBorrower`\n          : 'Feedback.introduction.singleBorrower',\n      },\n      {\n        borrower: borrowers[0].name,\n        address,\n        date,\n      },\n    );\n  }\n\n  return formatMessage(\n    {\n      id: FEEDBACK_OPTIONS_SETTINGS[option].enableCustomIntro\n        ? `Feedback.${option}.introduction.twoBorrowers`\n        : 'Feedback.introduction.twoBorrowers',\n    },\n    {\n      borrower1: borrowers[0].name,\n      borrower2: borrowers[1].name,\n      address,\n      date,\n    },\n  );\n};\n\nconst outro = ({ borrowers, singleBorrower, option, formatMessage }) => {\n  if (singleBorrower) {\n    return formatMessage(\n      { id: `Feedback.${option}.outro.singleBorrower` },\n      { borrower: borrowers[0].name, singleBorrower: true },\n    );\n  }\n\n  return formatMessage(\n    { id: `Feedback.${option}.outro.twoBorrowers` },\n    {\n      borrower1: borrowers[0].name,\n      borrower2: borrowers[1].name,\n      singleBorrower: false,\n    },\n  );\n};\n\nconst closing = ({ assignee, formatMessage }) =>\n  formatMessage({ id: 'Feedback.closing' }, { assignee });\n\nexport const makeFeedback = ({ model, offer, formatMessage }) => {\n  const { option, comments = [], customFeedback = '' } = model;\n  const {\n    lender: {\n      contact: { firstName: contactName },\n      loan: {\n        borrowers,\n        user: { assignedEmployee },\n      },\n    },\n    property,\n    createdAt,\n  } = offer;\n\n  const { firstName: assignee = 'e-Potek' } = assignedEmployee || {};\n  const { address1, zipCode, city } = property || {};\n\n  if (!property || !address1 || !zipCode || !city) {\n    throw new Meteor.Error('No property or address');\n  }\n\n  const address = `${address1}, ${zipCode} ${city}`;\n\n  if (option === FEEDBACK_OPTIONS.CUSTOM) {\n    // Replace all returns into HTML\n    return customFeedback.replace(/(?:\\r\\n|\\r|\\n)/g, '<br>');\n  }\n\n  let feedback = '';\n  const singleBorrower = borrowers.length === 1;\n\n  if (option) {\n    feedback = feedback.concat(greetings({ contactName, formatMessage }));\n    feedback = feedback.concat(introduction({\n      option,\n      borrowers,\n      singleBorrower,\n      address,\n      date: moment(createdAt).format('DD.MM.YYYY'),\n      formatMessage,\n    }));\n    feedback = feedback.concat(formatMessage({ id: `Feedback.${option}.body` }, { singleBorrower }));\n\n    if (comments.length && FEEDBACK_OPTIONS_SETTINGS[option].enableComments) {\n      feedback = feedback.concat(formatMessage(\n        { id: `Feedback.${option}.comments` },\n        { singleBorrower },\n      ));\n      feedback = feedback.concat(\n        '<ul>',\n        comments\n          .filter(x => x)\n          .map(comment => `<li><b>${comment}</b></li>`)\n          .join('\\n'),\n        '</ul>',\n      );\n    }\n\n    if (FEEDBACK_OPTIONS_SETTINGS[option].enableOutro) {\n      feedback = feedback.concat(outro({ option, singleBorrower, borrowers, formatMessage }));\n    }\n\n    feedback = feedback.concat(closing({ assignee, formatMessage }));\n  }\n\n  return feedback;\n};\n"]},"sourceType":"script","hash":"37047f3a2c3e8ae3a433ff7acea18f6bec24d4e2"}
