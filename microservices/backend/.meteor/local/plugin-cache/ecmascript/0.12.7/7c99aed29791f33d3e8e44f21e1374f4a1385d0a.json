{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/Florian/dev/epotek/microservices/backend/imports/core/api/email/server/emailHelpers.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties",["flow",{}],"jsx",["flow",{}],["flow",{}],"objectRestSpread","objectRestSpread","dynamicImport","asyncGenerators","classProperties","classPrivateProperties"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.x86_64"},"sourceFileName":"imports/core/api/email/server/emailHelpers.js","filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/api/email/server/emailHelpers.js","inputSourceMap":{"version":3,"sources":["imports/core/api/email/server/emailHelpers.js"],"names":["Meteor","Roles","Intl","FROM_DEFAULT","CTA_URL_DEFAULT","EMAIL_I18N_NAMESPACE","EMAIL_PARTS","ROLES","WWW_URL","settings","public","subdomains","www","APP_URL","app","ADMIN_URL","admin","PRO_URL","pro","getEmailFooter","footerType","allowUnsubscribe","formatMessage","id","values","url","unsubscribe","getEmailPart","emailId","part","intlValues","intlFallback","fallback","getEmailContent","subject","SUBJECT","title","TITLE","body","BODY","verticalSpace","cta","CTA","customFrom","FROM","from","getAccountsUrl","path","user","userIsUser","userIsInRole","USER","userIsPro","PRO","userIsAdmin","ADMIN","DEV","token","split","notificationTemplateDefaultOverride","params","variables","template","name","content","notificationAndCtaTemplateDefaultOverride","CTA_URL"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Roles } from 'meteor/alanning:roles';\n\nimport Intl from 'core/utils/server/intl';\nimport {\n  FROM_DEFAULT,\n  CTA_URL_DEFAULT,\n  EMAIL_I18N_NAMESPACE,\n  EMAIL_PARTS,\n} from '../emailConstants';\nimport { ROLES } from '../../constants';\n\nconst WWW_URL = Meteor.settings.public.subdomains.www;\nconst APP_URL = Meteor.settings.public.subdomains.app;\nconst ADMIN_URL = Meteor.settings.public.subdomains.admin;\nconst PRO_URL = Meteor.settings.public.subdomains.pro;\n\n/**\n * emailFooter - Returns the default email footer for all emails\n *\n * @param {boolean} [unsubscribe=true] Whether to show an unsubscribe line or not\n *\n * @return {type} a HTML string\n */\nexport const getEmailFooter = (footerType, allowUnsubscribe) =>\n  Intl.formatMessage({\n    id: `emails.${footerType}`,\n    values: {\n      url: `<a href=\"${WWW_URL}\" target=\"_blank\" style=\"color:inherit;\">e-potek.ch</a><br />`,\n      unsubscribe: allowUnsubscribe\n        ? `<a href=\"*|UNSUB|*\" style=\"color:inherit;\">${Intl.formatMessage({\n          id: 'emails.unsubscribe',\n        })}</a>`\n        : '',\n    },\n  });\n\nexport const getEmailPart = ({\n  emailId,\n  part,\n  intlValues = {},\n  intlFallback = '',\n}) =>\n  Intl.formatMessage({\n    id: `${EMAIL_I18N_NAMESPACE}.${emailId}.${part}`,\n    values: intlValues,\n    fallback: intlFallback,\n  });\n\n/**\n * getEmailContent - Returns all the fields for an email\n *\n * @param {String} emailId an id representing what email this is, example:\n * auctionEnded, verificationRequested\n *\n * @return {Object} contains all the fields\n */\nexport const getEmailContent = (emailId, intlValues) => {\n  const subject = getEmailPart({\n    emailId,\n    part: EMAIL_PARTS.SUBJECT,\n    intlValues,\n  });\n  const title = getEmailPart({ emailId, part: EMAIL_PARTS.TITLE, intlValues });\n  const body = getEmailPart({\n    emailId,\n    part: EMAIL_PARTS.BODY,\n    intlValues: {\n      verticalSpace: '<span><br/><br/></span>',\n      ...intlValues,\n    },\n  });\n  const cta = getEmailPart({\n    emailId,\n    part: EMAIL_PARTS.CTA,\n    intlValues,\n    intlFallback: CTA_URL_DEFAULT,\n  });\n  const customFrom = getEmailPart({\n    emailId,\n    part: EMAIL_PARTS.FROM,\n    intlValues,\n    intlFallback: FROM_DEFAULT,\n  });\n\n  return {\n    subject,\n    title,\n    body,\n    cta,\n    from: customFrom,\n  };\n};\n\nexport const getAccountsUrl = path => (user, url) => {\n  const userIsUser = Roles.userIsInRole(user, ROLES.USER);\n  const userIsPro = Roles.userIsInRole(user, ROLES.PRO);\n  const userIsAdmin = Roles.userIsInRole(user, ROLES.ADMIN)\n    || Roles.userIsInRole(user, ROLES.DEV);\n  const token = url.split(`/${path}/`)[1];\n\n  if (userIsUser) {\n    return `${APP_URL}/${path}/${token}`;\n  }\n  if (userIsPro) {\n    return `${PRO_URL}/${path}/${token}`;\n  }\n  if (userIsAdmin) {\n    // Admin does not have the enroll, verify, and reset-password pages\n    // Just send them to APP\n    return `${APP_URL}/${path}/${token}`;\n  }\n\n  return url;\n};\n\n/**\n * This is a default override function for the NOTIFICATION template\n *\n * @export\n * @param {Object} params The params passed by the method\n * @param {Object} { title, body } The strings extracted from i18n files\n * @returns a template override object\n */\nexport function notificationTemplateDefaultOverride(params, { title, body }) {\n  const { variables } = this.template;\n\n  return {\n    variables: [\n      { name: variables.TITLE, content: title },\n      { name: variables.BODY, content: body },\n    ],\n  };\n}\n\n/**\n * This is a default override function for the NOTIFICATION_AND_CTA template\n *\n * @export\n * @param {Object} params The params passed by the method\n * @param {Object} { title, body, cta } The strings extracted from i18n files\n * @returns a template override object\n */\nexport function notificationAndCtaTemplateDefaultOverride(\n  params,\n  { title, body, cta },\n) {\n  const { variables } = this.template;\n\n  return {\n    variables: [\n      { name: variables.TITLE, content: title },\n      { name: variables.BODY, content: body },\n      { name: variables.CTA, content: cta },\n      { name: variables.CTA_URL, content: CTA_URL_DEFAULT },\n    ],\n  };\n}\n"]},"passPerPreset":false,"envName":"development","cwd":"/Users/Florian/dev/epotek/microservices/backend","root":"/Users/Florian/dev/epotek/microservices/backend","plugins":[{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}}],"presets":[],"generatorOpts":{"filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/api/email/server/emailHelpers.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/core/api/email/server/emailHelpers.js"}},"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread\"));\n\nmodule.export({\n  getEmailFooter: () => getEmailFooter,\n  getEmailPart: () => getEmailPart,\n  getEmailContent: () => getEmailContent,\n  getAccountsUrl: () => getAccountsUrl,\n  notificationTemplateDefaultOverride: () => notificationTemplateDefaultOverride,\n  notificationAndCtaTemplateDefaultOverride: () => notificationAndCtaTemplateDefaultOverride\n});\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet Roles;\nmodule.link(\"meteor/alanning:roles\", {\n  Roles(v) {\n    Roles = v;\n  }\n\n}, 1);\nlet Intl;\nmodule.link(\"../../../utils/server/intl\", {\n  default(v) {\n    Intl = v;\n  }\n\n}, 2);\nlet FROM_DEFAULT, CTA_URL_DEFAULT, EMAIL_I18N_NAMESPACE, EMAIL_PARTS;\nmodule.link(\"../emailConstants\", {\n  FROM_DEFAULT(v) {\n    FROM_DEFAULT = v;\n  },\n\n  CTA_URL_DEFAULT(v) {\n    CTA_URL_DEFAULT = v;\n  },\n\n  EMAIL_I18N_NAMESPACE(v) {\n    EMAIL_I18N_NAMESPACE = v;\n  },\n\n  EMAIL_PARTS(v) {\n    EMAIL_PARTS = v;\n  }\n\n}, 3);\nlet ROLES;\nmodule.link(\"../../constants\", {\n  ROLES(v) {\n    ROLES = v;\n  }\n\n}, 4);\nconst WWW_URL = Meteor.settings.public.subdomains.www;\nconst APP_URL = Meteor.settings.public.subdomains.app;\nconst ADMIN_URL = Meteor.settings.public.subdomains.admin;\nconst PRO_URL = Meteor.settings.public.subdomains.pro;\n/**\n * emailFooter - Returns the default email footer for all emails\n *\n * @param {boolean} [unsubscribe=true] Whether to show an unsubscribe line or not\n *\n * @return {type} a HTML string\n */\n\nconst getEmailFooter = (footerType, allowUnsubscribe) => Intl.formatMessage({\n  id: `emails.${footerType}`,\n  values: {\n    url: `<a href=\"${WWW_URL}\" target=\"_blank\" style=\"color:inherit;\">e-potek.ch</a><br />`,\n    unsubscribe: allowUnsubscribe ? `<a href=\"*|UNSUB|*\" style=\"color:inherit;\">${Intl.formatMessage({\n      id: 'emails.unsubscribe'\n    })}</a>` : ''\n  }\n});\n\nconst getEmailPart = ({\n  emailId,\n  part,\n  intlValues = {},\n  intlFallback = ''\n}) => Intl.formatMessage({\n  id: `${EMAIL_I18N_NAMESPACE}.${emailId}.${part}`,\n  values: intlValues,\n  fallback: intlFallback\n});\n\nconst getEmailContent = (emailId, intlValues) => {\n  const subject = getEmailPart({\n    emailId,\n    part: EMAIL_PARTS.SUBJECT,\n    intlValues\n  });\n  const title = getEmailPart({\n    emailId,\n    part: EMAIL_PARTS.TITLE,\n    intlValues\n  });\n  const body = getEmailPart({\n    emailId,\n    part: EMAIL_PARTS.BODY,\n    intlValues: (0, _objectSpread2.default)({\n      verticalSpace: '<span><br/><br/></span>'\n    }, intlValues)\n  });\n  const cta = getEmailPart({\n    emailId,\n    part: EMAIL_PARTS.CTA,\n    intlValues,\n    intlFallback: CTA_URL_DEFAULT\n  });\n  const customFrom = getEmailPart({\n    emailId,\n    part: EMAIL_PARTS.FROM,\n    intlValues,\n    intlFallback: FROM_DEFAULT\n  });\n  return {\n    subject,\n    title,\n    body,\n    cta,\n    from: customFrom\n  };\n};\n\nconst getAccountsUrl = path => (user, url) => {\n  const userIsUser = Roles.userIsInRole(user, ROLES.USER);\n  const userIsPro = Roles.userIsInRole(user, ROLES.PRO);\n  const userIsAdmin = Roles.userIsInRole(user, ROLES.ADMIN) || Roles.userIsInRole(user, ROLES.DEV);\n  const token = url.split(`/${path}/`)[1];\n\n  if (userIsUser) {\n    return `${APP_URL}/${path}/${token}`;\n  }\n\n  if (userIsPro) {\n    return `${PRO_URL}/${path}/${token}`;\n  }\n\n  if (userIsAdmin) {\n    // Admin does not have the enroll, verify, and reset-password pages\n    // Just send them to APP\n    return `${APP_URL}/${path}/${token}`;\n  }\n\n  return url;\n};\n\nfunction notificationTemplateDefaultOverride(params, {\n  title,\n  body\n}) {\n  const {\n    variables\n  } = this.template;\n  return {\n    variables: [{\n      name: variables.TITLE,\n      content: title\n    }, {\n      name: variables.BODY,\n      content: body\n    }]\n  };\n}\n\nfunction notificationAndCtaTemplateDefaultOverride(params, {\n  title,\n  body,\n  cta\n}) {\n  const {\n    variables\n  } = this.template;\n  return {\n    variables: [{\n      name: variables.TITLE,\n      content: title\n    }, {\n      name: variables.BODY,\n      content: body\n    }, {\n      name: variables.CTA,\n      content: cta\n    }, {\n      name: variables.CTA_URL,\n      content: CTA_URL_DEFAULT\n    }]\n  };\n}","map":{"version":3,"sources":["imports/core/api/email/server/emailHelpers.js"],"names":["Meteor","WWW_URL","APP_URL","ADMIN_URL","PRO_URL","getEmailFooter","id","footerType","values","url","unsubscribe","allowUnsubscribe","getEmailPart","intlValues","intlFallback","EMAIL_I18N_NAMESPACE","emailId","part","fallback","getEmailContent","subject","EMAIL_PARTS","title","body","verticalSpace","cta","CTA_URL_DEFAULT","customFrom","FROM_DEFAULT","from","getAccountsUrl","path","userIsUser","Roles","ROLES","userIsPro","userIsAdmin","token","variables","name","content"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Roles } from 'meteor/alanning:roles';\n\nimport Intl from 'core/utils/server/intl';\nimport {\n  FROM_DEFAULT,\n  CTA_URL_DEFAULT,\n  EMAIL_I18N_NAMESPACE,\n  EMAIL_PARTS,\n} from '../emailConstants';\nimport { ROLES } from '../../constants';\n\nconst WWW_URL = Meteor.settings.public.subdomains.www;\nconst APP_URL = Meteor.settings.public.subdomains.app;\nconst ADMIN_URL = Meteor.settings.public.subdomains.admin;\nconst PRO_URL = Meteor.settings.public.subdomains.pro;\n\n/**\n * emailFooter - Returns the default email footer for all emails\n *\n * @param {boolean} [unsubscribe=true] Whether to show an unsubscribe line or not\n *\n * @return {type} a HTML string\n */\nexport const getEmailFooter = (footerType, allowUnsubscribe) =>\n  Intl.formatMessage({\n    id: `emails.${footerType}`,\n    values: {\n      url: `<a href=\"${WWW_URL}\" target=\"_blank\" style=\"color:inherit;\">e-potek.ch</a><br />`,\n      unsubscribe: allowUnsubscribe\n        ? `<a href=\"*|UNSUB|*\" style=\"color:inherit;\">${Intl.formatMessage({\n          id: 'emails.unsubscribe',\n        })}</a>`\n        : '',\n    },\n  });\n\nexport const getEmailPart = ({\n  emailId,\n  part,\n  intlValues = {},\n  intlFallback = '',\n}) =>\n  Intl.formatMessage({\n    id: `${EMAIL_I18N_NAMESPACE}.${emailId}.${part}`,\n    values: intlValues,\n    fallback: intlFallback,\n  });\n\n/**\n * getEmailContent - Returns all the fields for an email\n *\n * @param {String} emailId an id representing what email this is, example:\n * auctionEnded, verificationRequested\n *\n * @return {Object} contains all the fields\n */\nexport const getEmailContent = (emailId, intlValues) => {\n  const subject = getEmailPart({\n    emailId,\n    part: EMAIL_PARTS.SUBJECT,\n    intlValues,\n  });\n  const title = getEmailPart({ emailId, part: EMAIL_PARTS.TITLE, intlValues });\n  const body = getEmailPart({\n    emailId,\n    part: EMAIL_PARTS.BODY,\n    intlValues: {\n      verticalSpace: '<span><br/><br/></span>',\n      ...intlValues,\n    },\n  });\n  const cta = getEmailPart({\n    emailId,\n    part: EMAIL_PARTS.CTA,\n    intlValues,\n    intlFallback: CTA_URL_DEFAULT,\n  });\n  const customFrom = getEmailPart({\n    emailId,\n    part: EMAIL_PARTS.FROM,\n    intlValues,\n    intlFallback: FROM_DEFAULT,\n  });\n\n  return {\n    subject,\n    title,\n    body,\n    cta,\n    from: customFrom,\n  };\n};\n\nexport const getAccountsUrl = path => (user, url) => {\n  const userIsUser = Roles.userIsInRole(user, ROLES.USER);\n  const userIsPro = Roles.userIsInRole(user, ROLES.PRO);\n  const userIsAdmin = Roles.userIsInRole(user, ROLES.ADMIN)\n    || Roles.userIsInRole(user, ROLES.DEV);\n  const token = url.split(`/${path}/`)[1];\n\n  if (userIsUser) {\n    return `${APP_URL}/${path}/${token}`;\n  }\n  if (userIsPro) {\n    return `${PRO_URL}/${path}/${token}`;\n  }\n  if (userIsAdmin) {\n    // Admin does not have the enroll, verify, and reset-password pages\n    // Just send them to APP\n    return `${APP_URL}/${path}/${token}`;\n  }\n\n  return url;\n};\n\n/**\n * This is a default override function for the NOTIFICATION template\n *\n * @export\n * @param {Object} params The params passed by the method\n * @param {Object} { title, body } The strings extracted from i18n files\n * @returns a template override object\n */\nexport function notificationTemplateDefaultOverride(params, { title, body }) {\n  const { variables } = this.template;\n\n  return {\n    variables: [\n      { name: variables.TITLE, content: title },\n      { name: variables.BODY, content: body },\n    ],\n  };\n}\n\n/**\n * This is a default override function for the NOTIFICATION_AND_CTA template\n *\n * @export\n * @param {Object} params The params passed by the method\n * @param {Object} { title, body, cta } The strings extracted from i18n files\n * @returns a template override object\n */\nexport function notificationAndCtaTemplateDefaultOverride(\n  params,\n  { title, body, cta },\n) {\n  const { variables } = this.template;\n\n  return {\n    variables: [\n      { name: variables.TITLE, content: title },\n      { name: variables.BODY, content: body },\n      { name: variables.CTA, content: cta },\n      { name: variables.CTA_URL, content: CTA_URL_DEFAULT },\n    ],\n  };\n}\n"]},"sourceType":"script","hash":"7c99aed29791f33d3e8e44f21e1374f4a1385d0a"}
