{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/Florian/dev/epotek/microservices/backend/packages/epotek:accounts-ui/imports/login_session.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","jsx",["flow",{}],["flow",{}],"objectRestSpread","objectRestSpread","dynamicImport","asyncGenerators","classProperties","classPrivateProperties"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.x86_64"},"sourceFileName":"packages/epotek:accounts-ui/imports/login_session.js","filename":"/Users/Florian/dev/epotek/microservices/backend/packages/epotek:accounts-ui/imports/login_session.js","passPerPreset":false,"envName":"development","cwd":"/Users/Florian/dev/epotek/microservices/backend","root":"/Users/Florian/dev/epotek/microservices/backend","plugins":[{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}}],"presets":[],"generatorOpts":{"filename":"/Users/Florian/dev/epotek/microservices/backend/packages/epotek:accounts-ui/imports/login_session.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/epotek:accounts-ui/imports/login_session.js"}},"code":"module.export({\n  validateKey: () => validateKey,\n  KEY_PREFIX: () => KEY_PREFIX\n});\nlet Accounts;\nmodule.link(\"meteor/accounts-base\", {\n  Accounts(v) {\n    Accounts = v;\n  }\n\n}, 0);\nlet STATES, loginResultCallback, getLoginServices;\nmodule.link(\"./helpers.js\", {\n  STATES(v) {\n    STATES = v;\n  },\n\n  loginResultCallback(v) {\n    loginResultCallback = v;\n  },\n\n  getLoginServices(v) {\n    getLoginServices = v;\n  }\n\n}, 1);\nconst VALID_KEYS = ['dropdownVisible', // XXX consider replacing these with one key that has an enum for values.\n'inSignupFlow', 'inForgotPasswordFlow', 'inChangePasswordFlow', 'inMessageOnlyFlow', 'errorMessage', 'infoMessage', // dialogs with messages (info and error)\n'resetPasswordToken', 'enrollAccountToken', 'justVerifiedEmail', 'justResetPassword', 'configureLoginServiceDialogVisible', 'configureLoginServiceDialogServiceName', 'configureLoginServiceDialogSaveDisabled', 'configureOnDesktopVisible'];\n\nconst validateKey = function (key) {\n  if (!VALID_KEYS.includes(key)) throw new Error('Invalid key in loginButtonsSession: ' + key);\n};\n\nconst KEY_PREFIX = 'Meteor.loginButtons.';\n// XXX This should probably be package scope rather than exported\n// (there was even a comment to that effect here from before we had\n// namespacing) but accounts-ui-viewer uses it, so leave it as is for\n// now\nAccounts._loginButtonsSession = {\n  set: function (key, value) {\n    validateKey(key);\n    if (['errorMessage', 'infoMessage'].includes(key)) throw new Error(\"Don't set errorMessage or infoMessage directly. Instead, use errorMessage() or infoMessage().\");\n\n    this._set(key, value);\n  },\n  _set: function (key, value) {\n    Session.set(KEY_PREFIX + key, value);\n  },\n  get: function (key) {\n    validateKey(key);\n    return Session.get(KEY_PREFIX + key);\n  }\n};\n\nif (Meteor.isClient) {\n  // In the login redirect flow, we'll have the result of the login\n  // attempt at page load time when we're redirected back to the\n  // application.  Register a callback to update the UI (i.e. to close\n  // the dialog on a successful login or display the error on a failed\n  // login).\n  //\n  Accounts.onPageLoadLogin(function (attemptInfo) {\n    // Ignore if we have a left over login attempt for a service that is no longer registered.\n    if (getLoginServices().map(({\n      name\n    }) => name).includes(attemptInfo.type)) loginResultCallback(attemptInfo.type, attemptInfo.error);\n  });\n  let doneCallback;\n  Accounts.onResetPasswordLink(function (token, done) {\n    Accounts._loginButtonsSession.set('resetPasswordToken', token);\n\n    Session.set(KEY_PREFIX + 'state', 'resetPasswordToken');\n    doneCallback = done;\n\n    Accounts.ui._options.onResetPasswordHook();\n  });\n  Accounts.onEnrollmentLink(function (token, done) {\n    Accounts._loginButtonsSession.set('enrollAccountToken', token);\n\n    Session.set(KEY_PREFIX + 'state', 'enrollAccountToken');\n    doneCallback = done;\n\n    Accounts.ui._options.onEnrollAccountHook();\n  });\n  Accounts.onEmailVerificationLink(function (token, done) {\n    Accounts.verifyEmail(token, function (error) {\n      if (!error) {\n        Accounts._loginButtonsSession.set('justVerifiedEmail', true);\n\n        Session.set(KEY_PREFIX + 'state', 'justVerifiedEmail');\n\n        Accounts.ui._options.onSignedInHook();\n      } else {\n        Accounts.ui._options.onVerifyEmailHook();\n      }\n\n      done();\n    });\n  });\n}","map":{"version":3,"sources":["packages/epotek:accounts-ui/imports/login_session.js"],"names":["module","export","validateKey","KEY_PREFIX","Accounts","link","v","STATES","loginResultCallback","getLoginServices","VALID_KEYS","key","includes","Error","_loginButtonsSession","set","value","_set","Session","get","Meteor","isClient","onPageLoadLogin","attemptInfo","map","name","type","error","doneCallback","onResetPasswordLink","token","done","ui","_options","onResetPasswordHook","onEnrollmentLink","onEnrollAccountHook","onEmailVerificationLink","verifyEmail","onSignedInHook","onVerifyEmailHook"],"mappings":"AAAAA,MAAM,CAACC,MAAP,CAAc;AAACC,EAAAA,WAAW,EAAC,MAAIA,WAAjB;AAA6BC,EAAAA,UAAU,EAAC,MAAIA;AAA5C,CAAd;AAAuE,IAAIC,QAAJ;AAAaJ,MAAM,CAACK,IAAP,CAAY,sBAAZ,EAAmC;AAACD,EAAAA,QAAQ,CAACE,CAAD,EAAG;AAACF,IAAAA,QAAQ,GAACE,CAAT;AAAW;;AAAxB,CAAnC,EAA6D,CAA7D;AAAgE,IAAIC,MAAJ,EAAWC,mBAAX,EAA+BC,gBAA/B;AAAgDT,MAAM,CAACK,IAAP,CAAY,cAAZ,EAA2B;AAACE,EAAAA,MAAM,CAACD,CAAD,EAAG;AAACC,IAAAA,MAAM,GAACD,CAAP;AAAS,GAApB;;AAAqBE,EAAAA,mBAAmB,CAACF,CAAD,EAAG;AAACE,IAAAA,mBAAmB,GAACF,CAApB;AAAsB,GAAlE;;AAAmEG,EAAAA,gBAAgB,CAACH,CAAD,EAAG;AAACG,IAAAA,gBAAgB,GAACH,CAAjB;AAAmB;;AAA1G,CAA3B,EAAuI,CAAvI;AAGpM,MAAMI,UAAU,GAAG,CACjB,iBADiB,EAGjB;AACA,cAJiB,EAKjB,sBALiB,EAMjB,sBANiB,EAOjB,mBAPiB,EASjB,cATiB,EAUjB,aAViB,EAYjB;AACA,oBAbiB,EAcjB,oBAdiB,EAejB,mBAfiB,EAgBjB,mBAhBiB,EAkBjB,oCAlBiB,EAmBjB,wCAnBiB,EAoBjB,yCApBiB,EAqBjB,2BArBiB,CAAnB;;AAwBO,MAAMR,WAAW,GAAG,UAASS,GAAT,EAAc;AACvC,MAAI,CAACD,UAAU,CAACE,QAAX,CAAoBD,GAApB,CAAL,EACE,MAAM,IAAIE,KAAJ,CAAU,yCAAyCF,GAAnD,CAAN;AACH,CAHM;;AAKA,MAAMR,UAAU,GAAG,sBAAnB;AAEP;AACA;AACA;AACA;AACAC,QAAQ,CAACU,oBAAT,GAAgC;AAC9BC,EAAAA,GAAG,EAAE,UAASJ,GAAT,EAAcK,KAAd,EAAqB;AACxBd,IAAAA,WAAW,CAACS,GAAD,CAAX;AACA,QAAI,CAAC,cAAD,EAAiB,aAAjB,EAAgCC,QAAhC,CAAyCD,GAAzC,CAAJ,EACE,MAAM,IAAIE,KAAJ,CACJ,+FADI,CAAN;;AAIF,SAAKI,IAAL,CAAUN,GAAV,EAAeK,KAAf;AACD,GAT6B;AAW9BC,EAAAA,IAAI,EAAE,UAASN,GAAT,EAAcK,KAAd,EAAqB;AACzBE,IAAAA,OAAO,CAACH,GAAR,CAAYZ,UAAU,GAAGQ,GAAzB,EAA8BK,KAA9B;AACD,GAb6B;AAe9BG,EAAAA,GAAG,EAAE,UAASR,GAAT,EAAc;AACjBT,IAAAA,WAAW,CAACS,GAAD,CAAX;AACA,WAAOO,OAAO,CAACC,GAAR,CAAYhB,UAAU,GAAGQ,GAAzB,CAAP;AACD;AAlB6B,CAAhC;;AAqBA,IAAIS,MAAM,CAACC,QAAX,EAAqB;AACnB;AACA;AACA;AACA;AACA;AACA;AACAjB,EAAAA,QAAQ,CAACkB,eAAT,CAAyB,UAASC,WAAT,EAAsB;AAC7C;AACA,QACEd,gBAAgB,GACbe,GADH,CACO,CAAC;AAAEC,MAAAA;AAAF,KAAD,KAAcA,IADrB,EAEGb,QAFH,CAEYW,WAAW,CAACG,IAFxB,CADF,EAKElB,mBAAmB,CAACe,WAAW,CAACG,IAAb,EAAmBH,WAAW,CAACI,KAA/B,CAAnB;AACH,GARD;AAUA,MAAIC,YAAJ;AAEAxB,EAAAA,QAAQ,CAACyB,mBAAT,CAA6B,UAASC,KAAT,EAAgBC,IAAhB,EAAsB;AACjD3B,IAAAA,QAAQ,CAACU,oBAAT,CAA8BC,GAA9B,CAAkC,oBAAlC,EAAwDe,KAAxD;;AACAZ,IAAAA,OAAO,CAACH,GAAR,CAAYZ,UAAU,GAAG,OAAzB,EAAkC,oBAAlC;AACAyB,IAAAA,YAAY,GAAGG,IAAf;;AAEA3B,IAAAA,QAAQ,CAAC4B,EAAT,CAAYC,QAAZ,CAAqBC,mBAArB;AACD,GAND;AAQA9B,EAAAA,QAAQ,CAAC+B,gBAAT,CAA0B,UAASL,KAAT,EAAgBC,IAAhB,EAAsB;AAC9C3B,IAAAA,QAAQ,CAACU,oBAAT,CAA8BC,GAA9B,CAAkC,oBAAlC,EAAwDe,KAAxD;;AACAZ,IAAAA,OAAO,CAACH,GAAR,CAAYZ,UAAU,GAAG,OAAzB,EAAkC,oBAAlC;AACAyB,IAAAA,YAAY,GAAGG,IAAf;;AAEA3B,IAAAA,QAAQ,CAAC4B,EAAT,CAAYC,QAAZ,CAAqBG,mBAArB;AACD,GAND;AAQAhC,EAAAA,QAAQ,CAACiC,uBAAT,CAAiC,UAASP,KAAT,EAAgBC,IAAhB,EAAsB;AACrD3B,IAAAA,QAAQ,CAACkC,WAAT,CAAqBR,KAArB,EAA4B,UAASH,KAAT,EAAgB;AAC1C,UAAI,CAACA,KAAL,EAAY;AACVvB,QAAAA,QAAQ,CAACU,oBAAT,CAA8BC,GAA9B,CAAkC,mBAAlC,EAAuD,IAAvD;;AACAG,QAAAA,OAAO,CAACH,GAAR,CAAYZ,UAAU,GAAG,OAAzB,EAAkC,mBAAlC;;AACAC,QAAAA,QAAQ,CAAC4B,EAAT,CAAYC,QAAZ,CAAqBM,cAArB;AACD,OAJD,MAIO;AACLnC,QAAAA,QAAQ,CAAC4B,EAAT,CAAYC,QAAZ,CAAqBO,iBAArB;AACD;;AAEDT,MAAAA,IAAI;AACL,KAVD;AAWD,GAZD;AAaD","sourcesContent":["import { Accounts } from 'meteor/accounts-base';\nimport { STATES, loginResultCallback, getLoginServices } from './helpers.js';\n\nconst VALID_KEYS = [\n  'dropdownVisible',\n\n  // XXX consider replacing these with one key that has an enum for values.\n  'inSignupFlow',\n  'inForgotPasswordFlow',\n  'inChangePasswordFlow',\n  'inMessageOnlyFlow',\n\n  'errorMessage',\n  'infoMessage',\n\n  // dialogs with messages (info and error)\n  'resetPasswordToken',\n  'enrollAccountToken',\n  'justVerifiedEmail',\n  'justResetPassword',\n\n  'configureLoginServiceDialogVisible',\n  'configureLoginServiceDialogServiceName',\n  'configureLoginServiceDialogSaveDisabled',\n  'configureOnDesktopVisible'\n];\n\nexport const validateKey = function(key) {\n  if (!VALID_KEYS.includes(key))\n    throw new Error('Invalid key in loginButtonsSession: ' + key);\n};\n\nexport const KEY_PREFIX = 'Meteor.loginButtons.';\n\n// XXX This should probably be package scope rather than exported\n// (there was even a comment to that effect here from before we had\n// namespacing) but accounts-ui-viewer uses it, so leave it as is for\n// now\nAccounts._loginButtonsSession = {\n  set: function(key, value) {\n    validateKey(key);\n    if (['errorMessage', 'infoMessage'].includes(key))\n      throw new Error(\n        \"Don't set errorMessage or infoMessage directly. Instead, use errorMessage() or infoMessage().\"\n      );\n\n    this._set(key, value);\n  },\n\n  _set: function(key, value) {\n    Session.set(KEY_PREFIX + key, value);\n  },\n\n  get: function(key) {\n    validateKey(key);\n    return Session.get(KEY_PREFIX + key);\n  }\n};\n\nif (Meteor.isClient) {\n  // In the login redirect flow, we'll have the result of the login\n  // attempt at page load time when we're redirected back to the\n  // application.  Register a callback to update the UI (i.e. to close\n  // the dialog on a successful login or display the error on a failed\n  // login).\n  //\n  Accounts.onPageLoadLogin(function(attemptInfo) {\n    // Ignore if we have a left over login attempt for a service that is no longer registered.\n    if (\n      getLoginServices()\n        .map(({ name }) => name)\n        .includes(attemptInfo.type)\n    )\n      loginResultCallback(attemptInfo.type, attemptInfo.error);\n  });\n\n  let doneCallback;\n\n  Accounts.onResetPasswordLink(function(token, done) {\n    Accounts._loginButtonsSession.set('resetPasswordToken', token);\n    Session.set(KEY_PREFIX + 'state', 'resetPasswordToken');\n    doneCallback = done;\n\n    Accounts.ui._options.onResetPasswordHook();\n  });\n\n  Accounts.onEnrollmentLink(function(token, done) {\n    Accounts._loginButtonsSession.set('enrollAccountToken', token);\n    Session.set(KEY_PREFIX + 'state', 'enrollAccountToken');\n    doneCallback = done;\n\n    Accounts.ui._options.onEnrollAccountHook();\n  });\n\n  Accounts.onEmailVerificationLink(function(token, done) {\n    Accounts.verifyEmail(token, function(error) {\n      if (!error) {\n        Accounts._loginButtonsSession.set('justVerifiedEmail', true);\n        Session.set(KEY_PREFIX + 'state', 'justVerifiedEmail');\n        Accounts.ui._options.onSignedInHook();\n      } else {\n        Accounts.ui._options.onVerifyEmailHook();\n      }\n\n      done();\n    });\n  });\n}\n"]},"sourceType":"script","hash":"6f9190239bebcd82ae5371ab2b7955cfaeeb832d"}
