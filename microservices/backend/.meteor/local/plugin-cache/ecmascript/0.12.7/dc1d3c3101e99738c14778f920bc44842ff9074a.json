{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/Florian/dev/epotek/microservices/backend/imports/core/api/RESTAPI/server/endpoints/test/interestRates.test.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties",["flow",{}],"jsx",["flow",{}],["flow",{}],"objectRestSpread","objectRestSpread","dynamicImport","asyncGenerators","classProperties","classPrivateProperties"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.x86_64"},"sourceFileName":"imports/core/api/RESTAPI/server/endpoints/test/interestRates.test.js","filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/api/RESTAPI/server/endpoints/test/interestRates.test.js","inputSourceMap":{"version":3,"sources":["imports/core/api/RESTAPI/server/endpoints/test/interestRates.test.js"],"names":["Meteor","resetDatabase","moment","generator","TRENDS","INTEREST_RATES","RESTAPI","fetchAndCheckResponse","makeHeaders","getTimestampAndNonce","interestRatesAPI","api","addEndpoint","getRates","expectedResponse","timestamp","nonce","url","data","method","headers","userId","describe","timeout","before","settings","public","microservice","parent","pending","skip","start","after","reset","beforeEach","users","_factory","_id","organisations","it","rates","averageRates","momentDate","date","toDate","textDate","toISOString","interestRates","interestLibor","rateLow","rateHigh","trend","DOWN","interest5","UP","interest10","FLAT","type","LIBOR","YEARS_5","YEARS_10"],"mappings":"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","sourcesContent":["/* eslint-env mocha */\nimport { Meteor } from 'meteor/meteor';\nimport { resetDatabase } from 'meteor/xolvio:cleaner';\nimport moment from 'moment';\n\nimport generator from '../../../../factories';\nimport { TRENDS, INTEREST_RATES } from '../../../../constants';\nimport RESTAPI from '../../RESTAPI';\nimport {\n  fetchAndCheckResponse,\n  makeHeaders,\n  getTimestampAndNonce,\n} from '../../test/apiTestHelpers.test';\nimport { interestRatesAPI } from '..';\n\nconst api = new RESTAPI();\napi.addEndpoint('/interest-rates/latest', 'GET', interestRatesAPI);\n\nconst getRates = ({ expectedResponse }) => {\n  const { timestamp, nonce } = getTimestampAndNonce();\n\n  return fetchAndCheckResponse({\n    url: '/interest-rates/latest',\n    data: {\n      method: 'GET',\n      headers: makeHeaders({\n        userId: 'pro',\n        timestamp,\n        nonce,\n      }),\n    },\n    expectedResponse,\n  });\n};\n\ndescribe('REST: interestRates', function () {\n  this.timeout(10000);\n\n  before(function () {\n    if (Meteor.settings.public.microservice !== 'pro') {\n      this.parent.pending = true;\n      this.skip();\n    } else {\n      api.start();\n    }\n  });\n\n  after(() => {\n    api.reset();\n  });\n\n  beforeEach(() => {\n    resetDatabase();\n    generator({\n      users: [{ _factory: 'pro', _id: 'pro', organisations: [{ _id: 'org' }] }],\n    });\n  });\n\n  it('Returns empty response if no rates exist', () => {\n    const expectedResponse = { rates: [], averageRates: {} };\n    return getRates({ expectedResponse });\n  });\n\n  it('Returns the latest interest rates', () => {\n    const momentDate = moment();\n    const date = momentDate.toDate();\n    const textDate = momentDate.toISOString();\n    generator({\n      interestRates: [\n        {\n          date,\n          interestLibor: {\n            rateLow: 0.1,\n            rateHigh: 0.3,\n            trend: TRENDS.DOWN,\n          },\n          interest5: {\n            rateLow: 0.1,\n            rateHigh: 0.4,\n            trend: TRENDS.UP,\n          },\n          interest10: {\n            rateLow: 0.1,\n            rateHigh: 0.5,\n            trend: TRENDS.FLAT,\n          },\n        },\n      ],\n    });\n    const expectedResponse = {\n      rates: [\n        {\n          rateLow: 0.1,\n          rateHigh: 0.3,\n          trend: TRENDS.DOWN,\n          type: INTEREST_RATES.LIBOR,\n        },\n        {\n          rateLow: 0.1,\n          rateHigh: 0.4,\n          trend: TRENDS.UP,\n          type: INTEREST_RATES.YEARS_5,\n        },\n        {\n          rateLow: 0.1,\n          rateHigh: 0.5,\n          trend: TRENDS.FLAT,\n          type: INTEREST_RATES.YEARS_10,\n        },\n      ],\n      date: textDate,\n      averageRates: {\n        interestLibor: 0.2,\n        interest5: 0.25,\n        interest10: 0.3,\n      },\n    };\n    return getRates({ expectedResponse });\n  });\n});\n"]},"passPerPreset":false,"envName":"development","cwd":"/Users/Florian/dev/epotek/microservices/backend","root":"/Users/Florian/dev/epotek/microservices/backend","plugins":[{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}}],"presets":[],"generatorOpts":{"filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/api/RESTAPI/server/endpoints/test/interestRates.test.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/core/api/RESTAPI/server/endpoints/test/interestRates.test.js"}},"code":"let Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet resetDatabase;\nmodule.link(\"meteor/xolvio:cleaner\", {\n  resetDatabase(v) {\n    resetDatabase = v;\n  }\n\n}, 1);\nlet moment;\nmodule.link(\"moment\", {\n  default(v) {\n    moment = v;\n  }\n\n}, 2);\nlet generator;\nmodule.link(\"../../../../factories\", {\n  default(v) {\n    generator = v;\n  }\n\n}, 3);\nlet TRENDS, INTEREST_RATES;\nmodule.link(\"../../../../constants\", {\n  TRENDS(v) {\n    TRENDS = v;\n  },\n\n  INTEREST_RATES(v) {\n    INTEREST_RATES = v;\n  }\n\n}, 4);\nlet RESTAPI;\nmodule.link(\"../../RESTAPI\", {\n  default(v) {\n    RESTAPI = v;\n  }\n\n}, 5);\nlet fetchAndCheckResponse, makeHeaders, getTimestampAndNonce;\nmodule.link(\"../../test/apiTestHelpers.test\", {\n  fetchAndCheckResponse(v) {\n    fetchAndCheckResponse = v;\n  },\n\n  makeHeaders(v) {\n    makeHeaders = v;\n  },\n\n  getTimestampAndNonce(v) {\n    getTimestampAndNonce = v;\n  }\n\n}, 6);\nlet interestRatesAPI;\nmodule.link(\"..\", {\n  interestRatesAPI(v) {\n    interestRatesAPI = v;\n  }\n\n}, 7);\nconst api = new RESTAPI();\napi.addEndpoint('/interest-rates/latest', 'GET', interestRatesAPI);\n\nconst getRates = ({\n  expectedResponse\n}) => {\n  const {\n    timestamp,\n    nonce\n  } = getTimestampAndNonce();\n  return fetchAndCheckResponse({\n    url: '/interest-rates/latest',\n    data: {\n      method: 'GET',\n      headers: makeHeaders({\n        userId: 'pro',\n        timestamp,\n        nonce\n      })\n    },\n    expectedResponse\n  });\n};\n\ndescribe('REST: interestRates', function () {\n  this.timeout(10000);\n  before(function () {\n    if (Meteor.settings.public.microservice !== 'pro') {\n      this.parent.pending = true;\n      this.skip();\n    } else {\n      api.start();\n    }\n  });\n  after(() => {\n    api.reset();\n  });\n  beforeEach(() => {\n    resetDatabase();\n    generator({\n      users: [{\n        _factory: 'pro',\n        _id: 'pro',\n        organisations: [{\n          _id: 'org'\n        }]\n      }]\n    });\n  });\n  it('Returns empty response if no rates exist', () => {\n    const expectedResponse = {\n      rates: [],\n      averageRates: {}\n    };\n    return getRates({\n      expectedResponse\n    });\n  });\n  it('Returns the latest interest rates', () => {\n    const momentDate = moment();\n    const date = momentDate.toDate();\n    const textDate = momentDate.toISOString();\n    generator({\n      interestRates: [{\n        date,\n        interestLibor: {\n          rateLow: 0.1,\n          rateHigh: 0.3,\n          trend: TRENDS.DOWN\n        },\n        interest5: {\n          rateLow: 0.1,\n          rateHigh: 0.4,\n          trend: TRENDS.UP\n        },\n        interest10: {\n          rateLow: 0.1,\n          rateHigh: 0.5,\n          trend: TRENDS.FLAT\n        }\n      }]\n    });\n    const expectedResponse = {\n      rates: [{\n        rateLow: 0.1,\n        rateHigh: 0.3,\n        trend: TRENDS.DOWN,\n        type: INTEREST_RATES.LIBOR\n      }, {\n        rateLow: 0.1,\n        rateHigh: 0.4,\n        trend: TRENDS.UP,\n        type: INTEREST_RATES.YEARS_5\n      }, {\n        rateLow: 0.1,\n        rateHigh: 0.5,\n        trend: TRENDS.FLAT,\n        type: INTEREST_RATES.YEARS_10\n      }],\n      date: textDate,\n      averageRates: {\n        interestLibor: 0.2,\n        interest5: 0.25,\n        interest10: 0.3\n      }\n    };\n    return getRates({\n      expectedResponse\n    });\n  });\n});","map":{"version":3,"sources":["imports/core/api/RESTAPI/server/endpoints/test/interestRates.test.js"],"names":["api","getRates","expectedResponse","nonce","getTimestampAndNonce","fetchAndCheckResponse","url","data","method","headers","makeHeaders","userId","describe","before","Meteor","after","beforeEach","resetDatabase","generator","users","_factory","_id","organisations","it","rates","averageRates","momentDate","moment","date","textDate","interestRates","interestLibor","rateLow","rateHigh","trend","TRENDS","DOWN","interest5","UP","interest10","FLAT","type","INTEREST_RATES","LIBOR","YEARS_5","YEARS_10"],"mappings":"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","sourcesContent":["/* eslint-env mocha */\nimport { Meteor } from 'meteor/meteor';\nimport { resetDatabase } from 'meteor/xolvio:cleaner';\nimport moment from 'moment';\n\nimport generator from '../../../../factories';\nimport { TRENDS, INTEREST_RATES } from '../../../../constants';\nimport RESTAPI from '../../RESTAPI';\nimport {\n  fetchAndCheckResponse,\n  makeHeaders,\n  getTimestampAndNonce,\n} from '../../test/apiTestHelpers.test';\nimport { interestRatesAPI } from '..';\n\nconst api = new RESTAPI();\napi.addEndpoint('/interest-rates/latest', 'GET', interestRatesAPI);\n\nconst getRates = ({ expectedResponse }) => {\n  const { timestamp, nonce } = getTimestampAndNonce();\n\n  return fetchAndCheckResponse({\n    url: '/interest-rates/latest',\n    data: {\n      method: 'GET',\n      headers: makeHeaders({\n        userId: 'pro',\n        timestamp,\n        nonce,\n      }),\n    },\n    expectedResponse,\n  });\n};\n\ndescribe('REST: interestRates', function () {\n  this.timeout(10000);\n\n  before(function () {\n    if (Meteor.settings.public.microservice !== 'pro') {\n      this.parent.pending = true;\n      this.skip();\n    } else {\n      api.start();\n    }\n  });\n\n  after(() => {\n    api.reset();\n  });\n\n  beforeEach(() => {\n    resetDatabase();\n    generator({\n      users: [{ _factory: 'pro', _id: 'pro', organisations: [{ _id: 'org' }] }],\n    });\n  });\n\n  it('Returns empty response if no rates exist', () => {\n    const expectedResponse = { rates: [], averageRates: {} };\n    return getRates({ expectedResponse });\n  });\n\n  it('Returns the latest interest rates', () => {\n    const momentDate = moment();\n    const date = momentDate.toDate();\n    const textDate = momentDate.toISOString();\n    generator({\n      interestRates: [\n        {\n          date,\n          interestLibor: {\n            rateLow: 0.1,\n            rateHigh: 0.3,\n            trend: TRENDS.DOWN,\n          },\n          interest5: {\n            rateLow: 0.1,\n            rateHigh: 0.4,\n            trend: TRENDS.UP,\n          },\n          interest10: {\n            rateLow: 0.1,\n            rateHigh: 0.5,\n            trend: TRENDS.FLAT,\n          },\n        },\n      ],\n    });\n    const expectedResponse = {\n      rates: [\n        {\n          rateLow: 0.1,\n          rateHigh: 0.3,\n          trend: TRENDS.DOWN,\n          type: INTEREST_RATES.LIBOR,\n        },\n        {\n          rateLow: 0.1,\n          rateHigh: 0.4,\n          trend: TRENDS.UP,\n          type: INTEREST_RATES.YEARS_5,\n        },\n        {\n          rateLow: 0.1,\n          rateHigh: 0.5,\n          trend: TRENDS.FLAT,\n          type: INTEREST_RATES.YEARS_10,\n        },\n      ],\n      date: textDate,\n      averageRates: {\n        interestLibor: 0.2,\n        interest5: 0.25,\n        interest10: 0.3,\n      },\n    };\n    return getRates({ expectedResponse });\n  });\n});\n"]},"sourceType":"script","hash":"dc1d3c3101e99738c14778f920bc44842ff9074a"}
