{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/Florian/dev/epotek/microservices/backend/imports/core/components/Financing/client/FinancingResult/financingResultHelpers.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties",["flow",{}],"dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"imports/core/components/Financing/client/FinancingResult/financingResultHelpers.js","filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/components/Financing/client/FinancingResult/financingResultHelpers.js","inputSourceMap":{"version":3,"sources":["imports/core/components/Financing/client/FinancingResult/financingResultHelpers.js"],"names":["Calculator","CalculatorClass","FinanceCalculator","getProperty","OWN_FUNDS_USAGE_TYPES","initCalc","loan","structureId","offer","InitializedCalculator","finalOffer","offers","offerId","selectStructure","find","_id","organisation","lenderRules","getInterests","params","structure","wantedLoan","getInterestsWithTranches","getAmortization","calc","getPropertyExpenses","data","property","Math","round","yearlyExpenses","getNonPledgedFundsOfType","ownFunds","type","filter","t","usageType","PLEDGE","reduce","sum","value","getRemainingCash","borrowers","getFortune","getRemainingInsurance2","getInsurance2","getRemainingInsurance3A","getInsurance3A","getRemainingInsurance3B","getInsurance3B","getRemainingBank3A","getBank3A","getBorrowRatio","getIncomeRatio","getBorrowRatioStatus","borrowRatio","getIncomeRatioStatus","incomeRatio","makeHasOwnFundsOfType","getFunds"],"mappings":"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","sourcesContent":["// @flow\nimport Calculator, {\n  Calculator as CalculatorClass,\n} from 'core/utils/Calculator';\nimport FinanceCalculator, { getProperty } from '../FinancingCalculator';\nimport { OWN_FUNDS_USAGE_TYPES } from '../../../../api/constants';\n\nconst initCalc = ({\n  loan,\n  structureId,\n  offer,\n  Calculator: InitializedCalculator,\n}) => {\n  let finalOffer = offer;\n\n  if (!finalOffer) {\n    const { offers = [] } = loan;\n    const { offerId } = Calculator.selectStructure({ loan, structureId });\n    finalOffer = offers.find(({ _id }) => offerId === _id);\n  }\n\n  if (finalOffer && finalOffer.organisation && finalOffer.organisation.lenderRules) {\n    return new CalculatorClass({\n      loan,\n      structureId,\n      lenderRules: finalOffer.organisation.lenderRules,\n    });\n  }\n\n  return InitializedCalculator;\n};\nexport const getInterests = (params) => {\n  const {\n    structure: { wantedLoan },\n  } = params;\n  return (FinanceCalculator.getInterestsWithTranches(params) * wantedLoan) / 12;\n};\n\nexport const getAmortization = (params) => {\n  const calc = initCalc(params);\n  const { loan, structureId } = params;\n\n  return calc.getAmortization({ loan, structureId });\n};\n\nexport const getPropertyExpenses = (data) => {\n  const property = getProperty(data);\n  return Math.round((property && property.yearlyExpenses) / 12 || 0);\n};\n\nconst getNonPledgedFundsOfType = ({ structure: { ownFunds }, type }) =>\n  ownFunds\n    .filter(({ type: t }) => t === type)\n    .filter(({ usageType }) => usageType !== OWN_FUNDS_USAGE_TYPES.PLEDGE)\n    .reduce((sum, { value }) => sum + value, 0);\n\nexport const getRemainingCash = ({ borrowers, structure }) =>\n  Calculator.getFortune({ borrowers })\n  - getNonPledgedFundsOfType({ structure, type: 'bankFortune' });\n\nexport const getRemainingInsurance2 = ({ borrowers, structure }) =>\n  Calculator.getInsurance2({ borrowers })\n  - getNonPledgedFundsOfType({ structure, type: 'insurance2' });\n\nexport const getRemainingInsurance3A = ({ borrowers, structure }) =>\n  Calculator.getInsurance3A({ borrowers })\n  - getNonPledgedFundsOfType({ structure, type: 'insurance3A' });\n\nexport const getRemainingInsurance3B = ({ borrowers, structure }) =>\n  Calculator.getInsurance3B({ borrowers })\n  - getNonPledgedFundsOfType({ structure, type: 'insurance3B' });\n\nexport const getRemainingBank3A = ({ borrowers, structure }) =>\n  Calculator.getBank3A({ borrowers })\n  - getNonPledgedFundsOfType({ structure, type: 'bank3A' });\n\nexport const getBorrowRatio = (params) => {\n  const calc = initCalc(params);\n  const { loan, structureId } = params;\n  return calc.getBorrowRatio({ loan, structureId });\n};\n\nexport const getIncomeRatio = (params) => {\n  const calc = initCalc(params);\n  const { loan, structureId } = params;\n  return calc.getIncomeRatio({ loan, structureId });\n};\n\nexport const getBorrowRatioStatus = (params) => {\n  const calc = initCalc(params);\n  return calc.getBorrowRatioStatus({ borrowRatio: params.value });\n};\n\nexport const getIncomeRatioStatus = (params) => {\n  const calc = initCalc(params);\n  return calc.getIncomeRatioStatus({ incomeRatio: params.value });\n};\n\nexport const makeHasOwnFundsOfType = type => ({ borrowers }) =>\n  Calculator.getFunds({ borrowers, type }) > 0;\n"]},"passPerPreset":false,"envName":"development","cwd":"/Users/Florian/dev/epotek/microservices/backend","root":"/Users/Florian/dev/epotek/microservices/backend","plugins":[{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/components/Financing/client/FinancingResult/financingResultHelpers.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/core/components/Financing/client/FinancingResult/financingResultHelpers.js"}},"code":"module.export({\n  getInterests: function () {\n    return getInterests;\n  },\n  getAmortization: function () {\n    return getAmortization;\n  },\n  getPropertyExpenses: function () {\n    return getPropertyExpenses;\n  },\n  getRemainingCash: function () {\n    return getRemainingCash;\n  },\n  getRemainingInsurance2: function () {\n    return getRemainingInsurance2;\n  },\n  getRemainingInsurance3A: function () {\n    return getRemainingInsurance3A;\n  },\n  getRemainingInsurance3B: function () {\n    return getRemainingInsurance3B;\n  },\n  getRemainingBank3A: function () {\n    return getRemainingBank3A;\n  },\n  getBorrowRatio: function () {\n    return getBorrowRatio;\n  },\n  getIncomeRatio: function () {\n    return getIncomeRatio;\n  },\n  getBorrowRatioStatus: function () {\n    return getBorrowRatioStatus;\n  },\n  getIncomeRatioStatus: function () {\n    return getIncomeRatioStatus;\n  },\n  makeHasOwnFundsOfType: function () {\n    return makeHasOwnFundsOfType;\n  }\n});\nvar Calculator, CalculatorClass;\nmodule.link(\"../../../../utils/Calculator\", {\n  \"default\": function (v) {\n    Calculator = v;\n  },\n  Calculator: function (v) {\n    CalculatorClass = v;\n  }\n}, 0);\nvar FinanceCalculator, getProperty;\nmodule.link(\"../FinancingCalculator\", {\n  \"default\": function (v) {\n    FinanceCalculator = v;\n  },\n  getProperty: function (v) {\n    getProperty = v;\n  }\n}, 1);\nvar OWN_FUNDS_USAGE_TYPES;\nmodule.link(\"../../../../api/constants\", {\n  OWN_FUNDS_USAGE_TYPES: function (v) {\n    OWN_FUNDS_USAGE_TYPES = v;\n  }\n}, 2);\n\nvar initCalc = function (_ref) {\n  var loan = _ref.loan,\n      structureId = _ref.structureId,\n      offer = _ref.offer,\n      InitializedCalculator = _ref.Calculator;\n  var finalOffer = offer;\n\n  if (!finalOffer) {\n    var _loan$offers = loan.offers,\n        offers = _loan$offers === void 0 ? [] : _loan$offers;\n\n    var _Calculator$selectStr = Calculator.selectStructure({\n      loan: loan,\n      structureId: structureId\n    }),\n        offerId = _Calculator$selectStr.offerId;\n\n    finalOffer = offers.find(function (_ref2) {\n      var _id = _ref2._id;\n      return offerId === _id;\n    });\n  }\n\n  if (finalOffer && finalOffer.organisation && finalOffer.organisation.lenderRules) {\n    return new CalculatorClass({\n      loan: loan,\n      structureId: structureId,\n      lenderRules: finalOffer.organisation.lenderRules\n    });\n  }\n\n  return InitializedCalculator;\n};\n\nvar getInterests = function (params) {\n  var wantedLoan = params.structure.wantedLoan;\n  return FinanceCalculator.getInterestsWithTranches(params) * wantedLoan / 12;\n};\n\nvar getAmortization = function (params) {\n  var calc = initCalc(params);\n  var loan = params.loan,\n      structureId = params.structureId;\n  return calc.getAmortization({\n    loan: loan,\n    structureId: structureId\n  });\n};\n\nvar getPropertyExpenses = function (data) {\n  var property = getProperty(data);\n  return Math.round((property && property.yearlyExpenses) / 12 || 0);\n};\n\nvar getNonPledgedFundsOfType = function (_ref3) {\n  var ownFunds = _ref3.structure.ownFunds,\n      type = _ref3.type;\n  return ownFunds.filter(function (_ref4) {\n    var t = _ref4.type;\n    return t === type;\n  }).filter(function (_ref5) {\n    var usageType = _ref5.usageType;\n    return usageType !== OWN_FUNDS_USAGE_TYPES.PLEDGE;\n  }).reduce(function (sum, _ref6) {\n    var value = _ref6.value;\n    return sum + value;\n  }, 0);\n};\n\nvar getRemainingCash = function (_ref7) {\n  var borrowers = _ref7.borrowers,\n      structure = _ref7.structure;\n  return Calculator.getFortune({\n    borrowers: borrowers\n  }) - getNonPledgedFundsOfType({\n    structure: structure,\n    type: 'bankFortune'\n  });\n};\n\nvar getRemainingInsurance2 = function (_ref8) {\n  var borrowers = _ref8.borrowers,\n      structure = _ref8.structure;\n  return Calculator.getInsurance2({\n    borrowers: borrowers\n  }) - getNonPledgedFundsOfType({\n    structure: structure,\n    type: 'insurance2'\n  });\n};\n\nvar getRemainingInsurance3A = function (_ref9) {\n  var borrowers = _ref9.borrowers,\n      structure = _ref9.structure;\n  return Calculator.getInsurance3A({\n    borrowers: borrowers\n  }) - getNonPledgedFundsOfType({\n    structure: structure,\n    type: 'insurance3A'\n  });\n};\n\nvar getRemainingInsurance3B = function (_ref10) {\n  var borrowers = _ref10.borrowers,\n      structure = _ref10.structure;\n  return Calculator.getInsurance3B({\n    borrowers: borrowers\n  }) - getNonPledgedFundsOfType({\n    structure: structure,\n    type: 'insurance3B'\n  });\n};\n\nvar getRemainingBank3A = function (_ref11) {\n  var borrowers = _ref11.borrowers,\n      structure = _ref11.structure;\n  return Calculator.getBank3A({\n    borrowers: borrowers\n  }) - getNonPledgedFundsOfType({\n    structure: structure,\n    type: 'bank3A'\n  });\n};\n\nvar getBorrowRatio = function (params) {\n  var calc = initCalc(params);\n  var loan = params.loan,\n      structureId = params.structureId;\n  return calc.getBorrowRatio({\n    loan: loan,\n    structureId: structureId\n  });\n};\n\nvar getIncomeRatio = function (params) {\n  var calc = initCalc(params);\n  var loan = params.loan,\n      structureId = params.structureId;\n  return calc.getIncomeRatio({\n    loan: loan,\n    structureId: structureId\n  });\n};\n\nvar getBorrowRatioStatus = function (params) {\n  var calc = initCalc(params);\n  return calc.getBorrowRatioStatus({\n    borrowRatio: params.value\n  });\n};\n\nvar getIncomeRatioStatus = function (params) {\n  var calc = initCalc(params);\n  return calc.getIncomeRatioStatus({\n    incomeRatio: params.value\n  });\n};\n\nvar makeHasOwnFundsOfType = function (type) {\n  return function (_ref12) {\n    var borrowers = _ref12.borrowers;\n    return Calculator.getFunds({\n      borrowers: borrowers,\n      type: type\n    }) > 0;\n  };\n};","map":{"version":3,"sources":["imports/core/components/Financing/client/FinancingResult/financingResultHelpers.js"],"names":["initCalc","Calculator","InitializedCalculator","finalOffer","offers","offerId","loan","structureId","_id","lenderRules","getInterests","params","structure","wantedLoan","FinanceCalculator","getAmortization","calc","getPropertyExpenses","data","property","getProperty","Math","getNonPledgedFundsOfType","ownFunds","type","t","usageType","OWN_FUNDS_USAGE_TYPES","value","sum","getRemainingCash","borrowers","getRemainingInsurance2","getRemainingInsurance3A","getRemainingInsurance3B","getRemainingBank3A","getBorrowRatio","getIncomeRatio","getBorrowRatioStatus","borrowRatio","getIncomeRatioStatus","incomeRatio","makeHasOwnFundsOfType"],"mappings":"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","sourcesContent":["// @flow\nimport Calculator, {\n  Calculator as CalculatorClass,\n} from 'core/utils/Calculator';\nimport FinanceCalculator, { getProperty } from '../FinancingCalculator';\nimport { OWN_FUNDS_USAGE_TYPES } from '../../../../api/constants';\n\nconst initCalc = ({\n  loan,\n  structureId,\n  offer,\n  Calculator: InitializedCalculator,\n}) => {\n  let finalOffer = offer;\n\n  if (!finalOffer) {\n    const { offers = [] } = loan;\n    const { offerId } = Calculator.selectStructure({ loan, structureId });\n    finalOffer = offers.find(({ _id }) => offerId === _id);\n  }\n\n  if (finalOffer && finalOffer.organisation && finalOffer.organisation.lenderRules) {\n    return new CalculatorClass({\n      loan,\n      structureId,\n      lenderRules: finalOffer.organisation.lenderRules,\n    });\n  }\n\n  return InitializedCalculator;\n};\nexport const getInterests = (params) => {\n  const {\n    structure: { wantedLoan },\n  } = params;\n  return (FinanceCalculator.getInterestsWithTranches(params) * wantedLoan) / 12;\n};\n\nexport const getAmortization = (params) => {\n  const calc = initCalc(params);\n  const { loan, structureId } = params;\n\n  return calc.getAmortization({ loan, structureId });\n};\n\nexport const getPropertyExpenses = (data) => {\n  const property = getProperty(data);\n  return Math.round((property && property.yearlyExpenses) / 12 || 0);\n};\n\nconst getNonPledgedFundsOfType = ({ structure: { ownFunds }, type }) =>\n  ownFunds\n    .filter(({ type: t }) => t === type)\n    .filter(({ usageType }) => usageType !== OWN_FUNDS_USAGE_TYPES.PLEDGE)\n    .reduce((sum, { value }) => sum + value, 0);\n\nexport const getRemainingCash = ({ borrowers, structure }) =>\n  Calculator.getFortune({ borrowers })\n  - getNonPledgedFundsOfType({ structure, type: 'bankFortune' });\n\nexport const getRemainingInsurance2 = ({ borrowers, structure }) =>\n  Calculator.getInsurance2({ borrowers })\n  - getNonPledgedFundsOfType({ structure, type: 'insurance2' });\n\nexport const getRemainingInsurance3A = ({ borrowers, structure }) =>\n  Calculator.getInsurance3A({ borrowers })\n  - getNonPledgedFundsOfType({ structure, type: 'insurance3A' });\n\nexport const getRemainingInsurance3B = ({ borrowers, structure }) =>\n  Calculator.getInsurance3B({ borrowers })\n  - getNonPledgedFundsOfType({ structure, type: 'insurance3B' });\n\nexport const getRemainingBank3A = ({ borrowers, structure }) =>\n  Calculator.getBank3A({ borrowers })\n  - getNonPledgedFundsOfType({ structure, type: 'bank3A' });\n\nexport const getBorrowRatio = (params) => {\n  const calc = initCalc(params);\n  const { loan, structureId } = params;\n  return calc.getBorrowRatio({ loan, structureId });\n};\n\nexport const getIncomeRatio = (params) => {\n  const calc = initCalc(params);\n  const { loan, structureId } = params;\n  return calc.getIncomeRatio({ loan, structureId });\n};\n\nexport const getBorrowRatioStatus = (params) => {\n  const calc = initCalc(params);\n  return calc.getBorrowRatioStatus({ borrowRatio: params.value });\n};\n\nexport const getIncomeRatioStatus = (params) => {\n  const calc = initCalc(params);\n  return calc.getIncomeRatioStatus({ incomeRatio: params.value });\n};\n\nexport const makeHasOwnFundsOfType = type => ({ borrowers }) =>\n  Calculator.getFunds({ borrowers, type }) > 0;\n"]},"sourceType":"script","hash":"9abb090d194b51fda18cd7e936e2cdc29d18da91"}
