{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/Florian/dev/epotek/microservices/backend/imports/core/components/Financing/client/FinancingResult/financingResultHelpers.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties",["flow",{}],"dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"imports/core/components/Financing/client/FinancingResult/financingResultHelpers.js","filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/components/Financing/client/FinancingResult/financingResultHelpers.js","inputSourceMap":{"version":3,"sources":["imports/core/components/Financing/client/FinancingResult/financingResultHelpers.js"],"names":["Calculator","CalculatorClass","FinanceCalculator","getProperty","OWN_FUNDS_USAGE_TYPES","initCalc","loan","structureId","offer","InitializedCalculator","finalOffer","offers","offerId","selectStructure","find","_id","organisation","lenderRules","getInterests","params","structure","wantedLoan","getInterestsWithTranches","getAmortization","calc","getPropertyExpenses","data","property","Math","round","yearlyExpenses","getNonPledgedFundsOfType","ownFunds","type","filter","t","usageType","PLEDGE","reduce","sum","value","getRemainingCash","borrowers","getFortune","getRemainingInsurance2","getInsurance2","getRemainingInsurance3A","getInsurance3A","getRemainingInsurance3B","getInsurance3B","getRemainingBank3A","getBank3A","getBorrowRatio","getIncomeRatio","getBorrowRatioStatus","borrowRatio","getIncomeRatioStatus","incomeRatio","makeHasOwnFundsOfType","getFunds"],"mappings":"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","sourcesContent":["// @flow\nimport Calculator, {\n  Calculator as CalculatorClass,\n} from 'core/utils/Calculator';\nimport FinanceCalculator, { getProperty } from '../FinancingCalculator';\nimport { OWN_FUNDS_USAGE_TYPES } from '../../../../api/constants';\n\nconst initCalc = ({\n  loan,\n  structureId,\n  offer,\n  Calculator: InitializedCalculator,\n}) => {\n  let finalOffer = offer;\n\n  if (!finalOffer) {\n    const { offers = [] } = loan;\n    const { offerId } = Calculator.selectStructure({ loan, structureId });\n    finalOffer = offers.find(({ _id }) => offerId === _id);\n  }\n\n  if (finalOffer && finalOffer.organisation && finalOffer.organisation.lenderRules) {\n    return new CalculatorClass({\n      loan,\n      structureId,\n      lenderRules: finalOffer.organisation.lenderRules,\n    });\n  }\n\n  return InitializedCalculator;\n};\nexport const getInterests = (params) => {\n  const {\n    structure: { wantedLoan },\n  } = params;\n  return (FinanceCalculator.getInterestsWithTranches(params) * wantedLoan) / 12;\n};\n\nexport const getAmortization = (params) => {\n  const calc = initCalc(params);\n  const { loan, structureId } = params;\n\n  return calc.getAmortization({ loan, structureId });\n};\n\nexport const getPropertyExpenses = (data) => {\n  const property = getProperty(data);\n  return Math.round((property && property.yearlyExpenses) / 12 || 0);\n};\n\nconst getNonPledgedFundsOfType = ({ structure: { ownFunds }, type }) =>\n  ownFunds\n    .filter(({ type: t }) => t === type)\n    .filter(({ usageType }) => usageType !== OWN_FUNDS_USAGE_TYPES.PLEDGE)\n    .reduce((sum, { value }) => sum + value, 0);\n\nexport const getRemainingCash = ({ borrowers, structure }) =>\n  Calculator.getFortune({ borrowers })\n  - getNonPledgedFundsOfType({ structure, type: 'bankFortune' });\n\nexport const getRemainingInsurance2 = ({ borrowers, structure }) =>\n  Calculator.getInsurance2({ borrowers })\n  - getNonPledgedFundsOfType({ structure, type: 'insurance2' });\n\nexport const getRemainingInsurance3A = ({ borrowers, structure }) =>\n  Calculator.getInsurance3A({ borrowers })\n  - getNonPledgedFundsOfType({ structure, type: 'insurance3A' });\n\nexport const getRemainingInsurance3B = ({ borrowers, structure }) =>\n  Calculator.getInsurance3B({ borrowers })\n  - getNonPledgedFundsOfType({ structure, type: 'insurance3B' });\n\nexport const getRemainingBank3A = ({ borrowers, structure }) =>\n  Calculator.getBank3A({ borrowers })\n  - getNonPledgedFundsOfType({ structure, type: 'bank3A' });\n\nexport const getBorrowRatio = (params) => {\n  const calc = initCalc(params);\n  const { loan, structureId } = params;\n  return calc.getBorrowRatio({ loan, structureId });\n};\n\nexport const getIncomeRatio = (params) => {\n  const calc = initCalc(params);\n  const { loan, structureId } = params;\n  return calc.getIncomeRatio({ loan, structureId });\n};\n\nexport const getBorrowRatioStatus = (params) => {\n  const calc = initCalc(params);\n  return calc.getBorrowRatioStatus({ borrowRatio: params.value });\n};\n\nexport const getIncomeRatioStatus = (params) => {\n  const calc = initCalc(params);\n  return calc.getIncomeRatioStatus({ incomeRatio: params.value });\n};\n\nexport const makeHasOwnFundsOfType = type => ({ borrowers }) =>\n  Calculator.getFunds({ borrowers, type }) > 0;\n"]},"passPerPreset":false,"envName":"development","cwd":"/Users/Florian/dev/epotek/microservices/backend","root":"/Users/Florian/dev/epotek/microservices/backend","plugins":[{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/components/Financing/client/FinancingResult/financingResultHelpers.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/core/components/Financing/client/FinancingResult/financingResultHelpers.js"}},"code":"module.export({\n  getInterests: () => getInterests,\n  getAmortization: () => getAmortization,\n  getPropertyExpenses: () => getPropertyExpenses,\n  getRemainingCash: () => getRemainingCash,\n  getRemainingInsurance2: () => getRemainingInsurance2,\n  getRemainingInsurance3A: () => getRemainingInsurance3A,\n  getRemainingInsurance3B: () => getRemainingInsurance3B,\n  getRemainingBank3A: () => getRemainingBank3A,\n  getBorrowRatio: () => getBorrowRatio,\n  getIncomeRatio: () => getIncomeRatio,\n  getBorrowRatioStatus: () => getBorrowRatioStatus,\n  getIncomeRatioStatus: () => getIncomeRatioStatus,\n  makeHasOwnFundsOfType: () => makeHasOwnFundsOfType\n});\nlet Calculator, CalculatorClass;\nmodule.link(\"../../../../utils/Calculator\", {\n  default(v) {\n    Calculator = v;\n  },\n\n  Calculator(v) {\n    CalculatorClass = v;\n  }\n\n}, 0);\nlet FinanceCalculator, getProperty;\nmodule.link(\"../FinancingCalculator\", {\n  default(v) {\n    FinanceCalculator = v;\n  },\n\n  getProperty(v) {\n    getProperty = v;\n  }\n\n}, 1);\nlet OWN_FUNDS_USAGE_TYPES;\nmodule.link(\"../../../../api/constants\", {\n  OWN_FUNDS_USAGE_TYPES(v) {\n    OWN_FUNDS_USAGE_TYPES = v;\n  }\n\n}, 2);\n\nconst initCalc = (_ref) => {\n  let {\n    loan,\n    structureId,\n    offer,\n    Calculator: InitializedCalculator\n  } = _ref;\n  let finalOffer = offer;\n\n  if (!finalOffer) {\n    const {\n      offers = []\n    } = loan;\n    const {\n      offerId\n    } = Calculator.selectStructure({\n      loan,\n      structureId\n    });\n    finalOffer = offers.find((_ref2) => {\n      let {\n        _id\n      } = _ref2;\n      return offerId === _id;\n    });\n  }\n\n  if (finalOffer && finalOffer.organisation && finalOffer.organisation.lenderRules) {\n    return new CalculatorClass({\n      loan,\n      structureId,\n      lenderRules: finalOffer.organisation.lenderRules\n    });\n  }\n\n  return InitializedCalculator;\n};\n\nconst getInterests = params => {\n  const {\n    structure: {\n      wantedLoan\n    }\n  } = params;\n  return FinanceCalculator.getInterestsWithTranches(params) * wantedLoan / 12;\n};\n\nconst getAmortization = params => {\n  const calc = initCalc(params);\n  const {\n    loan,\n    structureId\n  } = params;\n  return calc.getAmortization({\n    loan,\n    structureId\n  });\n};\n\nconst getPropertyExpenses = data => {\n  const property = getProperty(data);\n  return Math.round((property && property.yearlyExpenses) / 12 || 0);\n};\n\nconst getNonPledgedFundsOfType = (_ref3) => {\n  let {\n    structure: {\n      ownFunds\n    },\n    type\n  } = _ref3;\n  return ownFunds.filter((_ref4) => {\n    let {\n      type: t\n    } = _ref4;\n    return t === type;\n  }).filter((_ref5) => {\n    let {\n      usageType\n    } = _ref5;\n    return usageType !== OWN_FUNDS_USAGE_TYPES.PLEDGE;\n  }).reduce((sum, _ref6) => {\n    let {\n      value\n    } = _ref6;\n    return sum + value;\n  }, 0);\n};\n\nconst getRemainingCash = (_ref7) => {\n  let {\n    borrowers,\n    structure\n  } = _ref7;\n  return Calculator.getFortune({\n    borrowers\n  }) - getNonPledgedFundsOfType({\n    structure,\n    type: 'bankFortune'\n  });\n};\n\nconst getRemainingInsurance2 = (_ref8) => {\n  let {\n    borrowers,\n    structure\n  } = _ref8;\n  return Calculator.getInsurance2({\n    borrowers\n  }) - getNonPledgedFundsOfType({\n    structure,\n    type: 'insurance2'\n  });\n};\n\nconst getRemainingInsurance3A = (_ref9) => {\n  let {\n    borrowers,\n    structure\n  } = _ref9;\n  return Calculator.getInsurance3A({\n    borrowers\n  }) - getNonPledgedFundsOfType({\n    structure,\n    type: 'insurance3A'\n  });\n};\n\nconst getRemainingInsurance3B = (_ref10) => {\n  let {\n    borrowers,\n    structure\n  } = _ref10;\n  return Calculator.getInsurance3B({\n    borrowers\n  }) - getNonPledgedFundsOfType({\n    structure,\n    type: 'insurance3B'\n  });\n};\n\nconst getRemainingBank3A = (_ref11) => {\n  let {\n    borrowers,\n    structure\n  } = _ref11;\n  return Calculator.getBank3A({\n    borrowers\n  }) - getNonPledgedFundsOfType({\n    structure,\n    type: 'bank3A'\n  });\n};\n\nconst getBorrowRatio = params => {\n  const calc = initCalc(params);\n  const {\n    loan,\n    structureId\n  } = params;\n  return calc.getBorrowRatio({\n    loan,\n    structureId\n  });\n};\n\nconst getIncomeRatio = params => {\n  const calc = initCalc(params);\n  const {\n    loan,\n    structureId\n  } = params;\n  return calc.getIncomeRatio({\n    loan,\n    structureId\n  });\n};\n\nconst getBorrowRatioStatus = params => {\n  const calc = initCalc(params);\n  return calc.getBorrowRatioStatus({\n    borrowRatio: params.value\n  });\n};\n\nconst getIncomeRatioStatus = params => {\n  const calc = initCalc(params);\n  return calc.getIncomeRatioStatus({\n    incomeRatio: params.value\n  });\n};\n\nconst makeHasOwnFundsOfType = type => (_ref12) => {\n  let {\n    borrowers\n  } = _ref12;\n  return Calculator.getFunds({\n    borrowers,\n    type\n  }) > 0;\n};","map":{"version":3,"sources":["imports/core/components/Financing/client/FinancingResult/financingResultHelpers.js"],"names":["initCalc","Calculator","InitializedCalculator","finalOffer","offers","offerId","structureId","_id","lenderRules","getInterests","params","structure","wantedLoan","FinanceCalculator","getAmortization","calc","getPropertyExpenses","data","property","getProperty","Math","getNonPledgedFundsOfType","ownFunds","type","t","usageType","OWN_FUNDS_USAGE_TYPES","value","sum","getRemainingCash","borrowers","getRemainingInsurance2","getRemainingInsurance3A","getRemainingInsurance3B","getRemainingBank3A","getBorrowRatio","getIncomeRatio","getBorrowRatioStatus","borrowRatio","getIncomeRatioStatus","incomeRatio","makeHasOwnFundsOfType"],"mappings":"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","sourcesContent":["// @flow\nimport Calculator, {\n  Calculator as CalculatorClass,\n} from 'core/utils/Calculator';\nimport FinanceCalculator, { getProperty } from '../FinancingCalculator';\nimport { OWN_FUNDS_USAGE_TYPES } from '../../../../api/constants';\n\nconst initCalc = ({\n  loan,\n  structureId,\n  offer,\n  Calculator: InitializedCalculator,\n}) => {\n  let finalOffer = offer;\n\n  if (!finalOffer) {\n    const { offers = [] } = loan;\n    const { offerId } = Calculator.selectStructure({ loan, structureId });\n    finalOffer = offers.find(({ _id }) => offerId === _id);\n  }\n\n  if (finalOffer && finalOffer.organisation && finalOffer.organisation.lenderRules) {\n    return new CalculatorClass({\n      loan,\n      structureId,\n      lenderRules: finalOffer.organisation.lenderRules,\n    });\n  }\n\n  return InitializedCalculator;\n};\nexport const getInterests = (params) => {\n  const {\n    structure: { wantedLoan },\n  } = params;\n  return (FinanceCalculator.getInterestsWithTranches(params) * wantedLoan) / 12;\n};\n\nexport const getAmortization = (params) => {\n  const calc = initCalc(params);\n  const { loan, structureId } = params;\n\n  return calc.getAmortization({ loan, structureId });\n};\n\nexport const getPropertyExpenses = (data) => {\n  const property = getProperty(data);\n  return Math.round((property && property.yearlyExpenses) / 12 || 0);\n};\n\nconst getNonPledgedFundsOfType = ({ structure: { ownFunds }, type }) =>\n  ownFunds\n    .filter(({ type: t }) => t === type)\n    .filter(({ usageType }) => usageType !== OWN_FUNDS_USAGE_TYPES.PLEDGE)\n    .reduce((sum, { value }) => sum + value, 0);\n\nexport const getRemainingCash = ({ borrowers, structure }) =>\n  Calculator.getFortune({ borrowers })\n  - getNonPledgedFundsOfType({ structure, type: 'bankFortune' });\n\nexport const getRemainingInsurance2 = ({ borrowers, structure }) =>\n  Calculator.getInsurance2({ borrowers })\n  - getNonPledgedFundsOfType({ structure, type: 'insurance2' });\n\nexport const getRemainingInsurance3A = ({ borrowers, structure }) =>\n  Calculator.getInsurance3A({ borrowers })\n  - getNonPledgedFundsOfType({ structure, type: 'insurance3A' });\n\nexport const getRemainingInsurance3B = ({ borrowers, structure }) =>\n  Calculator.getInsurance3B({ borrowers })\n  - getNonPledgedFundsOfType({ structure, type: 'insurance3B' });\n\nexport const getRemainingBank3A = ({ borrowers, structure }) =>\n  Calculator.getBank3A({ borrowers })\n  - getNonPledgedFundsOfType({ structure, type: 'bank3A' });\n\nexport const getBorrowRatio = (params) => {\n  const calc = initCalc(params);\n  const { loan, structureId } = params;\n  return calc.getBorrowRatio({ loan, structureId });\n};\n\nexport const getIncomeRatio = (params) => {\n  const calc = initCalc(params);\n  const { loan, structureId } = params;\n  return calc.getIncomeRatio({ loan, structureId });\n};\n\nexport const getBorrowRatioStatus = (params) => {\n  const calc = initCalc(params);\n  return calc.getBorrowRatioStatus({ borrowRatio: params.value });\n};\n\nexport const getIncomeRatioStatus = (params) => {\n  const calc = initCalc(params);\n  return calc.getIncomeRatioStatus({ incomeRatio: params.value });\n};\n\nexport const makeHasOwnFundsOfType = type => ({ borrowers }) =>\n  Calculator.getFunds({ borrowers, type }) > 0;\n"]},"sourceType":"script","hash":"02b09b815c7d302d8c7b64eaff16ea394d085099"}
