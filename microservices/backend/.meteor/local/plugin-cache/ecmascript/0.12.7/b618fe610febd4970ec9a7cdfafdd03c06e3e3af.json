{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/Florian/dev/epotek/microservices/backend/imports/core/components/Financing/client/FinancingOwnFunds/FinancingOwnFundsPicker/FinancingOwnFundsPickerContainer.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties",["flow",{}],"dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"imports/core/components/Financing/client/FinancingOwnFunds/FinancingOwnFundsPicker/FinancingOwnFundsPickerContainer.js","filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/components/Financing/client/FinancingOwnFunds/FinancingOwnFundsPicker/FinancingOwnFundsPickerContainer.js","inputSourceMap":{"version":3,"sources":["imports/core/components/Financing/client/FinancingOwnFunds/FinancingOwnFundsPicker/FinancingOwnFundsPickerContainer.js"],"names":["compose","withProps","withStateHandlers","withState","lifecycle","borrowerUpdate","pushBorrowerValue","updateStructure","OWN_FUNDS_USAGE_TYPES","RESIDENCE_TYPE","Calculator","SingleStructureContainer","FinancingDataContainer","chooseOwnFundsTypes","shouldAskForUsageType","makeNewOwnFundsArray","getOwnFundsOfTypeAndBorrower","getAvailableFundsOfTypeAndBorrower","getNewWantedLoanAfterPledge","FIELDS","TYPE","USAGE_TYPE","BORROWER_ID","VALUE","getInitialState","structure","borrowers","ownFundsIndex","undefined","WITHDRAW","_id","ownFunds","addState","handleChange","value","id","reset","_","props","withDisableSubmit","type","borrowerId","usageType","disableSubmit","withStructureUpdate","loan","loanId","structureId","updateLoan","wantedLoan","run","updateOwnFunds","withAdditionalProps","handleClose","setLoading","otherValueOfTypeAndBorrower","updateCleanup","handleDelete","shouldDelete","handleSubmit","event","preventDefault","PLEDGE","handleUpdateBorrower","isTypeWithArrayValues","currentlyAvailable","deltaNeeded","object","description","finally","handleCancelUpdateBorrower","remaining","types","allowPledge","residenceType","MAIN_RESIDENCE","FinancingOwnFundsPickerContainer","componentWillReceiveProps","nextFunds","nextIndex","JSON","stringify"],"mappings":"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","sourcesContent":["import {\n  compose,\n  withProps,\n  withStateHandlers,\n  withState,\n  lifecycle,\n} from 'recompose';\n\nimport {\n  borrowerUpdate,\n  pushBorrowerValue,\n  updateStructure,\n} from '../../../../../api';\nimport {\n  OWN_FUNDS_USAGE_TYPES,\n  RESIDENCE_TYPE,\n} from '../../../../../api/constants';\nimport Calculator from '../../../../../utils/Calculator';\nimport SingleStructureContainer from '../../containers/SingleStructureContainer';\nimport FinancingDataContainer from '../../containers/FinancingDataContainer';\nimport {\n  chooseOwnFundsTypes,\n  shouldAskForUsageType,\n  makeNewOwnFundsArray,\n  getOwnFundsOfTypeAndBorrower,\n  getAvailableFundsOfTypeAndBorrower,\n  getNewWantedLoanAfterPledge,\n} from './FinancingOwnFundsPickerHelpers';\n\nexport const FIELDS = {\n  TYPE: 'type',\n  USAGE_TYPE: 'usageType',\n  BORROWER_ID: 'borrowerId',\n  VALUE: 'value',\n};\n\nconst getInitialState = ({ structure, borrowers, ownFundsIndex }) => {\n  // On load, the redux store has not loaded yet, causing this to crash\n  // if we don't add this simple check\n  if (!structure) {\n    return {};\n  }\n\n  // New ownFunds object\n  if (ownFundsIndex < 0) {\n    return {\n      [FIELDS.TYPE]: undefined,\n      [FIELDS.USAGE_TYPE]: OWN_FUNDS_USAGE_TYPES.WITHDRAW,\n      [FIELDS.BORROWER_ID]: borrowers[0]._id,\n      [FIELDS.VALUE]: undefined,\n    };\n  }\n\n  // When editing existing ownFunds object\n  return structure.ownFunds[ownFundsIndex];\n};\n\nconst addState = withStateHandlers(getInitialState, {\n  handleChange: () => (value, id) => ({ [id]: value }),\n  reset: (_, props) => () => getInitialState(props),\n});\n\nconst withDisableSubmit = withProps(({ type, borrowerId, value, usageType }) => ({\n  disableSubmit: !(\n    type\n      && borrowerId\n      && value >= 0\n      && (!shouldAskForUsageType(type) || usageType)\n  ),\n}));\n\nconst withStructureUpdate = withProps(({ loan: { _id: loanId }, structureId }) => ({\n  updateLoan: wantedLoan =>\n    updateStructure.run({ loanId, structureId, structure: { wantedLoan } }),\n  updateOwnFunds: ownFunds =>\n    updateStructure.run({ loanId, structureId, structure: { ownFunds } }),\n}));\n\nconst withAdditionalProps = withProps((props) => {\n  const {\n    disableSubmit,\n    updateOwnFunds,\n    updateLoan,\n    handleClose,\n    setLoading,\n    borrowerId,\n    type,\n    value,\n    usageType,\n    handleChange,\n    reset,\n    ownFundsIndex,\n    loan,\n  } = props;\n  const otherValueOfTypeAndBorrower = getOwnFundsOfTypeAndBorrower(props);\n\n  const updateCleanup = () => {\n    setLoading(false);\n  };\n\n  return {\n    handleDelete: () => {\n      updateOwnFunds(makeNewOwnFundsArray({ ...props, shouldDelete: true }));\n      handleClose();\n    },\n    handleSubmit: (event) => {\n      event.preventDefault();\n      if (disableSubmit) {\n        return false;\n      }\n\n      if (\n        shouldAskForUsageType(type)\n        && usageType === OWN_FUNDS_USAGE_TYPES.PLEDGE\n      ) {\n        updateLoan(getNewWantedLoanAfterPledge(props));\n      }\n\n      updateOwnFunds(makeNewOwnFundsArray(props));\n      handleClose();\n\n      if (ownFundsIndex === -1) {\n        // Cleanup\n        reset();\n      }\n    },\n    handleUpdateBorrower: (event) => {\n      if (event && event.preventDefault) {\n        event.preventDefault();\n      }\n      setLoading(true);\n\n      if (Calculator.isTypeWithArrayValues(type)) {\n        const currentlyAvailable = getAvailableFundsOfTypeAndBorrower(props);\n        const deltaNeeded = otherValueOfTypeAndBorrower + value - currentlyAvailable;\n        return pushBorrowerValue\n          .run({\n            borrowerId,\n            object: {\n              [type]: { value: deltaNeeded, description: 'Ajout automatique' },\n            },\n          })\n          .finally(updateCleanup);\n      }\n\n      return borrowerUpdate\n        .run({\n          borrowerId,\n          object: { [type]: otherValueOfTypeAndBorrower + value },\n        })\n        .finally(updateCleanup);\n    },\n    handleCancelUpdateBorrower: remaining => () => {\n      handleChange(remaining, FIELDS.VALUE);\n    },\n    types: chooseOwnFundsTypes(props),\n    otherValueOfTypeAndBorrower,\n    allowPledge: loan.residenceType === RESIDENCE_TYPE.MAIN_RESIDENCE,\n  };\n});\n\nconst FinancingOwnFundsPickerContainer = compose(\n  SingleStructureContainer,\n  FinancingDataContainer,\n  addState,\n  lifecycle({\n    componentWillReceiveProps({\n      structure: { ownFunds: nextFunds },\n      ownFundsIndex: nextIndex,\n    }) {\n      const {\n        structure: { ownFunds },\n        ownFundsIndex,\n      } = this.props;\n      if (\n        JSON.stringify(ownFunds[ownFundsIndex])\n        !== JSON.stringify(nextFunds[nextIndex])\n      ) {\n        this.props.reset();\n      }\n    },\n  }),\n  withDisableSubmit,\n  withStructureUpdate,\n  withState('loading', 'setLoading', false),\n  withAdditionalProps,\n);\n\nexport default FinancingOwnFundsPickerContainer;\n"]},"passPerPreset":false,"envName":"development","cwd":"/Users/Florian/dev/epotek/microservices/backend","root":"/Users/Florian/dev/epotek/microservices/backend","plugins":[{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/components/Financing/client/FinancingOwnFunds/FinancingOwnFundsPicker/FinancingOwnFundsPickerContainer.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/core/components/Financing/client/FinancingOwnFunds/FinancingOwnFundsPicker/FinancingOwnFundsPickerContainer.js"}},"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread\"));\n\nmodule.export({\n  FIELDS: function () {\n    return FIELDS;\n  }\n});\nvar compose, withProps, withStateHandlers, withState, lifecycle;\nmodule.link(\"recompose\", {\n  compose: function (v) {\n    compose = v;\n  },\n  withProps: function (v) {\n    withProps = v;\n  },\n  withStateHandlers: function (v) {\n    withStateHandlers = v;\n  },\n  withState: function (v) {\n    withState = v;\n  },\n  lifecycle: function (v) {\n    lifecycle = v;\n  }\n}, 0);\nvar borrowerUpdate, pushBorrowerValue, updateStructure;\nmodule.link(\"../../../../../api\", {\n  borrowerUpdate: function (v) {\n    borrowerUpdate = v;\n  },\n  pushBorrowerValue: function (v) {\n    pushBorrowerValue = v;\n  },\n  updateStructure: function (v) {\n    updateStructure = v;\n  }\n}, 1);\nvar OWN_FUNDS_USAGE_TYPES, RESIDENCE_TYPE;\nmodule.link(\"../../../../../api/constants\", {\n  OWN_FUNDS_USAGE_TYPES: function (v) {\n    OWN_FUNDS_USAGE_TYPES = v;\n  },\n  RESIDENCE_TYPE: function (v) {\n    RESIDENCE_TYPE = v;\n  }\n}, 2);\nvar Calculator;\nmodule.link(\"../../../../../utils/Calculator\", {\n  \"default\": function (v) {\n    Calculator = v;\n  }\n}, 3);\nvar SingleStructureContainer;\nmodule.link(\"../../containers/SingleStructureContainer\", {\n  \"default\": function (v) {\n    SingleStructureContainer = v;\n  }\n}, 4);\nvar FinancingDataContainer;\nmodule.link(\"../../containers/FinancingDataContainer\", {\n  \"default\": function (v) {\n    FinancingDataContainer = v;\n  }\n}, 5);\nvar chooseOwnFundsTypes, shouldAskForUsageType, makeNewOwnFundsArray, getOwnFundsOfTypeAndBorrower, getAvailableFundsOfTypeAndBorrower, getNewWantedLoanAfterPledge;\nmodule.link(\"./FinancingOwnFundsPickerHelpers\", {\n  chooseOwnFundsTypes: function (v) {\n    chooseOwnFundsTypes = v;\n  },\n  shouldAskForUsageType: function (v) {\n    shouldAskForUsageType = v;\n  },\n  makeNewOwnFundsArray: function (v) {\n    makeNewOwnFundsArray = v;\n  },\n  getOwnFundsOfTypeAndBorrower: function (v) {\n    getOwnFundsOfTypeAndBorrower = v;\n  },\n  getAvailableFundsOfTypeAndBorrower: function (v) {\n    getAvailableFundsOfTypeAndBorrower = v;\n  },\n  getNewWantedLoanAfterPledge: function (v) {\n    getNewWantedLoanAfterPledge = v;\n  }\n}, 6);\nvar FIELDS = {\n  TYPE: 'type',\n  USAGE_TYPE: 'usageType',\n  BORROWER_ID: 'borrowerId',\n  VALUE: 'value'\n};\n\nvar getInitialState = function (_ref) {\n  var structure = _ref.structure,\n      borrowers = _ref.borrowers,\n      ownFundsIndex = _ref.ownFundsIndex;\n\n  // On load, the redux store has not loaded yet, causing this to crash\n  // if we don't add this simple check\n  if (!structure) {\n    return {};\n  } // New ownFunds object\n\n\n  if (ownFundsIndex < 0) {\n    var _ref2;\n\n    return _ref2 = {}, _ref2[FIELDS.TYPE] = undefined, _ref2[FIELDS.USAGE_TYPE] = OWN_FUNDS_USAGE_TYPES.WITHDRAW, _ref2[FIELDS.BORROWER_ID] = borrowers[0]._id, _ref2[FIELDS.VALUE] = undefined, _ref2;\n  } // When editing existing ownFunds object\n\n\n  return structure.ownFunds[ownFundsIndex];\n};\n\nvar addState = withStateHandlers(getInitialState, {\n  handleChange: function () {\n    return function (value, id) {\n      var _ref3;\n\n      return _ref3 = {}, _ref3[id] = value, _ref3;\n    };\n  },\n  reset: function (_, props) {\n    return function () {\n      return getInitialState(props);\n    };\n  }\n});\nvar withDisableSubmit = withProps(function (_ref4) {\n  var type = _ref4.type,\n      borrowerId = _ref4.borrowerId,\n      value = _ref4.value,\n      usageType = _ref4.usageType;\n  return {\n    disableSubmit: !(type && borrowerId && value >= 0 && (!shouldAskForUsageType(type) || usageType))\n  };\n});\nvar withStructureUpdate = withProps(function (_ref5) {\n  var loanId = _ref5.loan._id,\n      structureId = _ref5.structureId;\n  return {\n    updateLoan: function (wantedLoan) {\n      return updateStructure.run({\n        loanId: loanId,\n        structureId: structureId,\n        structure: {\n          wantedLoan: wantedLoan\n        }\n      });\n    },\n    updateOwnFunds: function (ownFunds) {\n      return updateStructure.run({\n        loanId: loanId,\n        structureId: structureId,\n        structure: {\n          ownFunds: ownFunds\n        }\n      });\n    }\n  };\n});\nvar withAdditionalProps = withProps(function (props) {\n  var disableSubmit = props.disableSubmit,\n      updateOwnFunds = props.updateOwnFunds,\n      updateLoan = props.updateLoan,\n      handleClose = props.handleClose,\n      setLoading = props.setLoading,\n      borrowerId = props.borrowerId,\n      type = props.type,\n      value = props.value,\n      usageType = props.usageType,\n      handleChange = props.handleChange,\n      reset = props.reset,\n      ownFundsIndex = props.ownFundsIndex,\n      loan = props.loan;\n  var otherValueOfTypeAndBorrower = getOwnFundsOfTypeAndBorrower(props);\n\n  var updateCleanup = function () {\n    setLoading(false);\n  };\n\n  return {\n    handleDelete: function () {\n      updateOwnFunds(makeNewOwnFundsArray((0, _objectSpread2.default)({}, props, {\n        shouldDelete: true\n      })));\n      handleClose();\n    },\n    handleSubmit: function (event) {\n      event.preventDefault();\n\n      if (disableSubmit) {\n        return false;\n      }\n\n      if (shouldAskForUsageType(type) && usageType === OWN_FUNDS_USAGE_TYPES.PLEDGE) {\n        updateLoan(getNewWantedLoanAfterPledge(props));\n      }\n\n      updateOwnFunds(makeNewOwnFundsArray(props));\n      handleClose();\n\n      if (ownFundsIndex === -1) {\n        // Cleanup\n        reset();\n      }\n    },\n    handleUpdateBorrower: function (event) {\n      var _object2;\n\n      if (event && event.preventDefault) {\n        event.preventDefault();\n      }\n\n      setLoading(true);\n\n      if (Calculator.isTypeWithArrayValues(type)) {\n        var _object;\n\n        var currentlyAvailable = getAvailableFundsOfTypeAndBorrower(props);\n        var deltaNeeded = otherValueOfTypeAndBorrower + value - currentlyAvailable;\n        return pushBorrowerValue.run({\n          borrowerId: borrowerId,\n          object: (_object = {}, _object[type] = {\n            value: deltaNeeded,\n            description: 'Ajout automatique'\n          }, _object)\n        }).finally(updateCleanup);\n      }\n\n      return borrowerUpdate.run({\n        borrowerId: borrowerId,\n        object: (_object2 = {}, _object2[type] = otherValueOfTypeAndBorrower + value, _object2)\n      }).finally(updateCleanup);\n    },\n    handleCancelUpdateBorrower: function (remaining) {\n      return function () {\n        handleChange(remaining, FIELDS.VALUE);\n      };\n    },\n    types: chooseOwnFundsTypes(props),\n    otherValueOfTypeAndBorrower: otherValueOfTypeAndBorrower,\n    allowPledge: loan.residenceType === RESIDENCE_TYPE.MAIN_RESIDENCE\n  };\n});\nvar FinancingOwnFundsPickerContainer = compose(SingleStructureContainer, FinancingDataContainer, addState, lifecycle({\n  componentWillReceiveProps: function (_ref6) {\n    var nextFunds = _ref6.structure.ownFunds,\n        nextIndex = _ref6.ownFundsIndex;\n    var _this$props = this.props,\n        ownFunds = _this$props.structure.ownFunds,\n        ownFundsIndex = _this$props.ownFundsIndex;\n\n    if (JSON.stringify(ownFunds[ownFundsIndex]) !== JSON.stringify(nextFunds[nextIndex])) {\n      this.props.reset();\n    }\n  }\n}), withDisableSubmit, withStructureUpdate, withState('loading', 'setLoading', false), withAdditionalProps);\nmodule.exportDefault(FinancingOwnFundsPickerContainer);","map":{"version":3,"sources":["imports/core/components/Financing/client/FinancingOwnFunds/FinancingOwnFundsPicker/FinancingOwnFundsPickerContainer.js"],"names":["compose","withProps","withStateHandlers","FIELDS","TYPE","USAGE_TYPE","BORROWER_ID","VALUE","getInitialState","ownFundsIndex","OWN_FUNDS_USAGE_TYPES","borrowers","undefined","structure","addState","handleChange","value","reset","withDisableSubmit","usageType","disableSubmit","type","shouldAskForUsageType","withStructureUpdate","loan","_id","loanId","structureId","updateLoan","wantedLoan","updateOwnFunds","ownFunds","withAdditionalProps","props","otherValueOfTypeAndBorrower","getOwnFundsOfTypeAndBorrower","updateCleanup","setLoading","handleDelete","makeNewOwnFundsArray","shouldDelete","handleClose","handleSubmit","event","getNewWantedLoanAfterPledge","handleUpdateBorrower","Calculator","currentlyAvailable","getAvailableFundsOfTypeAndBorrower","deltaNeeded","borrowerId","object","description","handleCancelUpdateBorrower","remaining","types","chooseOwnFundsTypes","allowPledge","RESIDENCE_TYPE","MAIN_RESIDENCE","FinancingOwnFundsPickerContainer","lifecycle","componentWillReceiveProps","nextFunds","nextIndex","JSON","withState"],"mappings":"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","sourcesContent":["import {\n  compose,\n  withProps,\n  withStateHandlers,\n  withState,\n  lifecycle,\n} from 'recompose';\n\nimport {\n  borrowerUpdate,\n  pushBorrowerValue,\n  updateStructure,\n} from '../../../../../api';\nimport {\n  OWN_FUNDS_USAGE_TYPES,\n  RESIDENCE_TYPE,\n} from '../../../../../api/constants';\nimport Calculator from '../../../../../utils/Calculator';\nimport SingleStructureContainer from '../../containers/SingleStructureContainer';\nimport FinancingDataContainer from '../../containers/FinancingDataContainer';\nimport {\n  chooseOwnFundsTypes,\n  shouldAskForUsageType,\n  makeNewOwnFundsArray,\n  getOwnFundsOfTypeAndBorrower,\n  getAvailableFundsOfTypeAndBorrower,\n  getNewWantedLoanAfterPledge,\n} from './FinancingOwnFundsPickerHelpers';\n\nexport const FIELDS = {\n  TYPE: 'type',\n  USAGE_TYPE: 'usageType',\n  BORROWER_ID: 'borrowerId',\n  VALUE: 'value',\n};\n\nconst getInitialState = ({ structure, borrowers, ownFundsIndex }) => {\n  // On load, the redux store has not loaded yet, causing this to crash\n  // if we don't add this simple check\n  if (!structure) {\n    return {};\n  }\n\n  // New ownFunds object\n  if (ownFundsIndex < 0) {\n    return {\n      [FIELDS.TYPE]: undefined,\n      [FIELDS.USAGE_TYPE]: OWN_FUNDS_USAGE_TYPES.WITHDRAW,\n      [FIELDS.BORROWER_ID]: borrowers[0]._id,\n      [FIELDS.VALUE]: undefined,\n    };\n  }\n\n  // When editing existing ownFunds object\n  return structure.ownFunds[ownFundsIndex];\n};\n\nconst addState = withStateHandlers(getInitialState, {\n  handleChange: () => (value, id) => ({ [id]: value }),\n  reset: (_, props) => () => getInitialState(props),\n});\n\nconst withDisableSubmit = withProps(({ type, borrowerId, value, usageType }) => ({\n  disableSubmit: !(\n    type\n      && borrowerId\n      && value >= 0\n      && (!shouldAskForUsageType(type) || usageType)\n  ),\n}));\n\nconst withStructureUpdate = withProps(({ loan: { _id: loanId }, structureId }) => ({\n  updateLoan: wantedLoan =>\n    updateStructure.run({ loanId, structureId, structure: { wantedLoan } }),\n  updateOwnFunds: ownFunds =>\n    updateStructure.run({ loanId, structureId, structure: { ownFunds } }),\n}));\n\nconst withAdditionalProps = withProps((props) => {\n  const {\n    disableSubmit,\n    updateOwnFunds,\n    updateLoan,\n    handleClose,\n    setLoading,\n    borrowerId,\n    type,\n    value,\n    usageType,\n    handleChange,\n    reset,\n    ownFundsIndex,\n    loan,\n  } = props;\n  const otherValueOfTypeAndBorrower = getOwnFundsOfTypeAndBorrower(props);\n\n  const updateCleanup = () => {\n    setLoading(false);\n  };\n\n  return {\n    handleDelete: () => {\n      updateOwnFunds(makeNewOwnFundsArray({ ...props, shouldDelete: true }));\n      handleClose();\n    },\n    handleSubmit: (event) => {\n      event.preventDefault();\n      if (disableSubmit) {\n        return false;\n      }\n\n      if (\n        shouldAskForUsageType(type)\n        && usageType === OWN_FUNDS_USAGE_TYPES.PLEDGE\n      ) {\n        updateLoan(getNewWantedLoanAfterPledge(props));\n      }\n\n      updateOwnFunds(makeNewOwnFundsArray(props));\n      handleClose();\n\n      if (ownFundsIndex === -1) {\n        // Cleanup\n        reset();\n      }\n    },\n    handleUpdateBorrower: (event) => {\n      if (event && event.preventDefault) {\n        event.preventDefault();\n      }\n      setLoading(true);\n\n      if (Calculator.isTypeWithArrayValues(type)) {\n        const currentlyAvailable = getAvailableFundsOfTypeAndBorrower(props);\n        const deltaNeeded = otherValueOfTypeAndBorrower + value - currentlyAvailable;\n        return pushBorrowerValue\n          .run({\n            borrowerId,\n            object: {\n              [type]: { value: deltaNeeded, description: 'Ajout automatique' },\n            },\n          })\n          .finally(updateCleanup);\n      }\n\n      return borrowerUpdate\n        .run({\n          borrowerId,\n          object: { [type]: otherValueOfTypeAndBorrower + value },\n        })\n        .finally(updateCleanup);\n    },\n    handleCancelUpdateBorrower: remaining => () => {\n      handleChange(remaining, FIELDS.VALUE);\n    },\n    types: chooseOwnFundsTypes(props),\n    otherValueOfTypeAndBorrower,\n    allowPledge: loan.residenceType === RESIDENCE_TYPE.MAIN_RESIDENCE,\n  };\n});\n\nconst FinancingOwnFundsPickerContainer = compose(\n  SingleStructureContainer,\n  FinancingDataContainer,\n  addState,\n  lifecycle({\n    componentWillReceiveProps({\n      structure: { ownFunds: nextFunds },\n      ownFundsIndex: nextIndex,\n    }) {\n      const {\n        structure: { ownFunds },\n        ownFundsIndex,\n      } = this.props;\n      if (\n        JSON.stringify(ownFunds[ownFundsIndex])\n        !== JSON.stringify(nextFunds[nextIndex])\n      ) {\n        this.props.reset();\n      }\n    },\n  }),\n  withDisableSubmit,\n  withStructureUpdate,\n  withState('loading', 'setLoading', false),\n  withAdditionalProps,\n);\n\nexport default FinancingOwnFundsPickerContainer;\n"]},"sourceType":"script","hash":"b618fe610febd4970ec9a7cdfafdd03c06e3e3af"}
