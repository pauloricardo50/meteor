{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/Florian/dev/epotek/microservices/backend/imports/core/api/slack/server/slackNotifications.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties",["flow",{}],"jsx",["flow",{}],["flow",{}],"objectRestSpread","objectRestSpread","dynamicImport","asyncGenerators","classProperties","classPrivateProperties"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.x86_64"},"sourceFileName":"imports/core/api/slack/server/slackNotifications.js","filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/api/slack/server/slackNotifications.js","inputSourceMap":{"version":3,"sources":["imports/core/api/slack/server/slackNotifications.js"],"names":["Meteor","getUserNameAndOrganisation","SlackService","referralOnlyNotification","currentUser","user","_id","userId","firstName","lastName","notifyAssignee","link","settings","public","subdomains","admin","title","propertyInviteNotification","property","address1","promotionInviteNotification","promotion","name","assignedEmployee","promotionId","email","message","assignee","notifyAlways","promotionLotBooked","promotionLot","lotName","promotionName","promotionLotSold","updateWatcherNotification","collection","docId","newAnonymousLoan","loanName","loanId","referral","newLoan","newUser","loans","length"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\n\nimport { getUserNameAndOrganisation } from 'core/api/helpers/index';\nimport SlackService from './SlackService';\n\nexport const referralOnlyNotification = ({ currentUser, user }) => {\n  const { _id: userId, firstName, lastName } = user;\n  SlackService.notifyAssignee({\n    currentUser,\n    link: `${Meteor.settings.public.subdomains.admin}/users/${userId}`,\n    title: `${firstName} ${lastName} a été invité sur e-Potek en referral uniquement`,\n  });\n};\n\nexport const propertyInviteNotification = ({ currentUser, property, user }) => {\n  const { _id: userId, firstName, lastName } = user;\n  const { address1 } = property;\n\n  SlackService.notifyAssignee({\n    currentUser,\n    link: `${Meteor.settings.public.subdomains.admin}/users/${userId}`,\n    title: `${firstName} ${lastName} a été invité au bien immo \"${address1}\"`,\n  });\n};\n\nexport const promotionInviteNotification = ({\n  currentUser,\n  promotion: { name, assignedEmployee, _id: promotionId },\n  user,\n}) => {\n  const { firstName, lastName, email } = user;\n\n  SlackService.notifyAssignee({\n    currentUser,\n    title: `Promotion ${name}`,\n    message: `${firstName} ${lastName} a été invité! ${email}`,\n    link: `${\n      Meteor.settings.public.subdomains.admin\n    }/promotions/${promotionId}`,\n    assignee: assignedEmployee,\n    notifyAlways: true,\n  });\n};\n\nexport const promotionLotBooked = ({\n  currentUser,\n  promotionLot,\n  user: { name },\n}) => {\n  const {\n    name: lotName,\n    promotion: { name: promotionName, assignedEmployee, _id: promotionId },\n  } = promotionLot;\n\n  SlackService.notifyAssignee({\n    currentUser,\n    title: `Promotion ${promotionName}`,\n    message: `Le lot ${lotName} a été réservé pour ${name}`,\n    link: `${\n      Meteor.settings.public.subdomains.admin\n    }/promotions/${promotionId}`,\n    assignee: assignedEmployee,\n    notifyAlways: true,\n  });\n};\n\nexport const promotionLotSold = ({\n  currentUser,\n  promotionLot,\n  user: { name },\n}) => {\n  const {\n    name: lotName,\n    promotion: { name: promotionName, assignedEmployee, _id: promotionId },\n  } = promotionLot;\n\n  SlackService.notifyAssignee({\n    currentUser,\n    title: `Promotion ${promotionName}`,\n    message: `Le lot ${lotName} a été vendu à ${name}`,\n    link: `${\n      Meteor.settings.public.subdomains.admin\n    }/promotions/${promotionId}`,\n    assignee: assignedEmployee,\n    notifyAlways: true,\n  });\n};\n\nexport const updateWatcherNotification = ({\n  user,\n  title,\n  collection,\n  docId,\n  message,\n}) => {\n  SlackService.notifyAssignee({\n    currentUser: user,\n    title,\n    link: `${Meteor.settings.public.subdomains.admin}/${collection}/${docId}`,\n    message,\n  });\n};\n\nexport const newAnonymousLoan = ({ loanName, loanId, property, referral }) => {\n  SlackService.notifyAssignee({\n    title: `Nouveau dossier anonyme: ${loanName}`,\n    link: `${Meteor.settings.public.subdomains.admin}/loans/${loanId}`,\n    message: property\n      ? `Pour le bien immo ${property.address1} ${\n        referral ? `de ${getUserNameAndOrganisation({ user: referral })}` : ''\n      }`\n      : '',\n  });\n};\n\nexport const newLoan = ({ loanId, loanName, currentUser }) => {\n  SlackService.notifyAssignee({\n    currentUser,\n    title: `Nouveau dossier: ${loanName}`,\n    link: `${Meteor.settings.public.subdomains.admin}/loans/${loanId}`,\n  });\n};\n\nexport const newUser = ({ loans = [], currentUser }) => {\n  SlackService.notifyAssignee({\n    currentUser,\n    title: `Nouvel utilisateur! ${\n      loans.length ? `(dossier ${loans[0].name})` : ''\n    }`,\n    link: `${Meteor.settings.public.subdomains.admin}/users/${currentUser._id}`,\n  });\n};\n"]},"passPerPreset":false,"envName":"development","cwd":"/Users/Florian/dev/epotek/microservices/backend","root":"/Users/Florian/dev/epotek/microservices/backend","plugins":[{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}}],"presets":[],"generatorOpts":{"filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/api/slack/server/slackNotifications.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/core/api/slack/server/slackNotifications.js"}},"code":"module.export({\n  referralOnlyNotification: () => referralOnlyNotification,\n  propertyInviteNotification: () => propertyInviteNotification,\n  promotionInviteNotification: () => promotionInviteNotification,\n  promotionLotBooked: () => promotionLotBooked,\n  promotionLotSold: () => promotionLotSold,\n  updateWatcherNotification: () => updateWatcherNotification,\n  newAnonymousLoan: () => newAnonymousLoan,\n  newLoan: () => newLoan,\n  newUser: () => newUser\n});\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet getUserNameAndOrganisation;\nmodule.link(\"../../helpers\", {\n  getUserNameAndOrganisation(v) {\n    getUserNameAndOrganisation = v;\n  }\n\n}, 1);\nlet SlackService;\nmodule.link(\"./SlackService\", {\n  default(v) {\n    SlackService = v;\n  }\n\n}, 2);\n\nconst referralOnlyNotification = ({\n  currentUser,\n  user\n}) => {\n  const {\n    _id: userId,\n    firstName,\n    lastName\n  } = user;\n  SlackService.notifyAssignee({\n    currentUser,\n    link: `${Meteor.settings.public.subdomains.admin}/users/${userId}`,\n    title: `${firstName} ${lastName} a été invité sur e-Potek en referral uniquement`\n  });\n};\n\nconst propertyInviteNotification = ({\n  currentUser,\n  property,\n  user\n}) => {\n  const {\n    _id: userId,\n    firstName,\n    lastName\n  } = user;\n  const {\n    address1\n  } = property;\n  SlackService.notifyAssignee({\n    currentUser,\n    link: `${Meteor.settings.public.subdomains.admin}/users/${userId}`,\n    title: `${firstName} ${lastName} a été invité au bien immo \"${address1}\"`\n  });\n};\n\nconst promotionInviteNotification = ({\n  currentUser,\n  promotion: {\n    name,\n    assignedEmployee,\n    _id: promotionId\n  },\n  user\n}) => {\n  const {\n    firstName,\n    lastName,\n    email\n  } = user;\n  SlackService.notifyAssignee({\n    currentUser,\n    title: `Promotion ${name}`,\n    message: `${firstName} ${lastName} a été invité! ${email}`,\n    link: `${Meteor.settings.public.subdomains.admin}/promotions/${promotionId}`,\n    assignee: assignedEmployee,\n    notifyAlways: true\n  });\n};\n\nconst promotionLotBooked = ({\n  currentUser,\n  promotionLot,\n  user: {\n    name\n  }\n}) => {\n  const {\n    name: lotName,\n    promotion: {\n      name: promotionName,\n      assignedEmployee,\n      _id: promotionId\n    }\n  } = promotionLot;\n  SlackService.notifyAssignee({\n    currentUser,\n    title: `Promotion ${promotionName}`,\n    message: `Le lot ${lotName} a été réservé pour ${name}`,\n    link: `${Meteor.settings.public.subdomains.admin}/promotions/${promotionId}`,\n    assignee: assignedEmployee,\n    notifyAlways: true\n  });\n};\n\nconst promotionLotSold = ({\n  currentUser,\n  promotionLot,\n  user: {\n    name\n  }\n}) => {\n  const {\n    name: lotName,\n    promotion: {\n      name: promotionName,\n      assignedEmployee,\n      _id: promotionId\n    }\n  } = promotionLot;\n  SlackService.notifyAssignee({\n    currentUser,\n    title: `Promotion ${promotionName}`,\n    message: `Le lot ${lotName} a été vendu à ${name}`,\n    link: `${Meteor.settings.public.subdomains.admin}/promotions/${promotionId}`,\n    assignee: assignedEmployee,\n    notifyAlways: true\n  });\n};\n\nconst updateWatcherNotification = ({\n  user,\n  title,\n  collection,\n  docId,\n  message\n}) => {\n  SlackService.notifyAssignee({\n    currentUser: user,\n    title,\n    link: `${Meteor.settings.public.subdomains.admin}/${collection}/${docId}`,\n    message\n  });\n};\n\nconst newAnonymousLoan = ({\n  loanName,\n  loanId,\n  property,\n  referral\n}) => {\n  SlackService.notifyAssignee({\n    title: `Nouveau dossier anonyme: ${loanName}`,\n    link: `${Meteor.settings.public.subdomains.admin}/loans/${loanId}`,\n    message: property ? `Pour le bien immo ${property.address1} ${referral ? `de ${getUserNameAndOrganisation({\n      user: referral\n    })}` : ''}` : ''\n  });\n};\n\nconst newLoan = ({\n  loanId,\n  loanName,\n  currentUser\n}) => {\n  SlackService.notifyAssignee({\n    currentUser,\n    title: `Nouveau dossier: ${loanName}`,\n    link: `${Meteor.settings.public.subdomains.admin}/loans/${loanId}`\n  });\n};\n\nconst newUser = ({\n  loans = [],\n  currentUser\n}) => {\n  SlackService.notifyAssignee({\n    currentUser,\n    title: `Nouvel utilisateur! ${loans.length ? `(dossier ${loans[0].name})` : ''}`,\n    link: `${Meteor.settings.public.subdomains.admin}/users/${currentUser._id}`\n  });\n};","map":{"version":3,"sources":["imports/core/api/slack/server/slackNotifications.js"],"names":["Meteor","referralOnlyNotification","user","_id","lastName","SlackService","link","admin","userId","title","firstName","propertyInviteNotification","address1","promotionInviteNotification","promotion","promotionId","email","name","message","assignee","notifyAlways","promotionLotBooked","promotionName","lotName","promotionLotSold","updateWatcherNotification","currentUser","collection","docId","newAnonymousLoan","referral","loanName","loanId","property","getUserNameAndOrganisation","newLoan","newUser","loans"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\n\nimport { getUserNameAndOrganisation } from 'core/api/helpers/index';\nimport SlackService from './SlackService';\n\nexport const referralOnlyNotification = ({ currentUser, user }) => {\n  const { _id: userId, firstName, lastName } = user;\n  SlackService.notifyAssignee({\n    currentUser,\n    link: `${Meteor.settings.public.subdomains.admin}/users/${userId}`,\n    title: `${firstName} ${lastName} a été invité sur e-Potek en referral uniquement`,\n  });\n};\n\nexport const propertyInviteNotification = ({ currentUser, property, user }) => {\n  const { _id: userId, firstName, lastName } = user;\n  const { address1 } = property;\n\n  SlackService.notifyAssignee({\n    currentUser,\n    link: `${Meteor.settings.public.subdomains.admin}/users/${userId}`,\n    title: `${firstName} ${lastName} a été invité au bien immo \"${address1}\"`,\n  });\n};\n\nexport const promotionInviteNotification = ({\n  currentUser,\n  promotion: { name, assignedEmployee, _id: promotionId },\n  user,\n}) => {\n  const { firstName, lastName, email } = user;\n\n  SlackService.notifyAssignee({\n    currentUser,\n    title: `Promotion ${name}`,\n    message: `${firstName} ${lastName} a été invité! ${email}`,\n    link: `${\n      Meteor.settings.public.subdomains.admin\n    }/promotions/${promotionId}`,\n    assignee: assignedEmployee,\n    notifyAlways: true,\n  });\n};\n\nexport const promotionLotBooked = ({\n  currentUser,\n  promotionLot,\n  user: { name },\n}) => {\n  const {\n    name: lotName,\n    promotion: { name: promotionName, assignedEmployee, _id: promotionId },\n  } = promotionLot;\n\n  SlackService.notifyAssignee({\n    currentUser,\n    title: `Promotion ${promotionName}`,\n    message: `Le lot ${lotName} a été réservé pour ${name}`,\n    link: `${\n      Meteor.settings.public.subdomains.admin\n    }/promotions/${promotionId}`,\n    assignee: assignedEmployee,\n    notifyAlways: true,\n  });\n};\n\nexport const promotionLotSold = ({\n  currentUser,\n  promotionLot,\n  user: { name },\n}) => {\n  const {\n    name: lotName,\n    promotion: { name: promotionName, assignedEmployee, _id: promotionId },\n  } = promotionLot;\n\n  SlackService.notifyAssignee({\n    currentUser,\n    title: `Promotion ${promotionName}`,\n    message: `Le lot ${lotName} a été vendu à ${name}`,\n    link: `${\n      Meteor.settings.public.subdomains.admin\n    }/promotions/${promotionId}`,\n    assignee: assignedEmployee,\n    notifyAlways: true,\n  });\n};\n\nexport const updateWatcherNotification = ({\n  user,\n  title,\n  collection,\n  docId,\n  message,\n}) => {\n  SlackService.notifyAssignee({\n    currentUser: user,\n    title,\n    link: `${Meteor.settings.public.subdomains.admin}/${collection}/${docId}`,\n    message,\n  });\n};\n\nexport const newAnonymousLoan = ({ loanName, loanId, property, referral }) => {\n  SlackService.notifyAssignee({\n    title: `Nouveau dossier anonyme: ${loanName}`,\n    link: `${Meteor.settings.public.subdomains.admin}/loans/${loanId}`,\n    message: property\n      ? `Pour le bien immo ${property.address1} ${\n        referral ? `de ${getUserNameAndOrganisation({ user: referral })}` : ''\n      }`\n      : '',\n  });\n};\n\nexport const newLoan = ({ loanId, loanName, currentUser }) => {\n  SlackService.notifyAssignee({\n    currentUser,\n    title: `Nouveau dossier: ${loanName}`,\n    link: `${Meteor.settings.public.subdomains.admin}/loans/${loanId}`,\n  });\n};\n\nexport const newUser = ({ loans = [], currentUser }) => {\n  SlackService.notifyAssignee({\n    currentUser,\n    title: `Nouvel utilisateur! ${\n      loans.length ? `(dossier ${loans[0].name})` : ''\n    }`,\n    link: `${Meteor.settings.public.subdomains.admin}/users/${currentUser._id}`,\n  });\n};\n"]},"sourceType":"script","hash":"92c47af5d88907c70734747ed05bc388a37af8a9"}
