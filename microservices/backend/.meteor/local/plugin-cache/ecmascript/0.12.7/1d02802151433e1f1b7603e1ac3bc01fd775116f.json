{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/Florian/dev/epotek/microservices/backend/imports/core/utils/testHelpers/testHelpers.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties",["flow",{}],"dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"imports/core/utils/testHelpers/testHelpers.js","filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/utils/testHelpers/testHelpers.js","inputSourceMap":{"version":3,"sources":["imports/core/utils/testHelpers/testHelpers.js"],"names":["Meteor","Random","Accounts","faker","expect","Users","testUserAccount","ROLES","createLoginToken","userId","loginToken","id","hashedToken","_hashLoginToken","update","$set","createEmailVerificationToken","email","token","_id","$push","address","when","Date","userLogin","password","role","userEmail","internet","userPassword","random","word","isServer","user","run","USER","loginWithPassword","Promise","resolve","isClient","then","reject","err","checkEmails","expected","options","call","emails","noExpect","length","to","equal","error","resetDatabase","res"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Random } from 'meteor/random';\nimport { Accounts } from 'meteor/accounts-base';\n\nimport faker from 'faker';\nimport { expect } from 'chai';\n\nimport { Users, testUserAccount } from '../../api';\nimport { ROLES } from '../../api/constants';\n\n/**\n * createLoginToken - Generate & saves a login token on the user with the given id\n *\n * @param {string} userId  A Meteor user id\n *\n * @return {string} the generated login token\n */\nexport const createLoginToken = (userId) => {\n  const loginToken = Random.id();\n  const hashedToken = Accounts._hashLoginToken(loginToken);\n\n  Users.update(userId, {\n    $set: {\n      'services.resume.loginTokens': [{ hashedToken }],\n    },\n  });\n\n  return loginToken;\n};\n\n/**\n * createEmailVerificationToken - Generate & saves a email verification token on the user with the given id\n *\n * @param {string} userId  A Meteor user id\n * @param {string} email  The email to be verified\n *\n * @return {string} the generated token\n */\nexport const createEmailVerificationToken = (userId, email) => {\n  const token = Random.id();\n\n  Users.update(\n    { _id: userId },\n    {\n      $push: {\n        'services.email.verificationTokens': {\n          // token has to be uniq in the Users collection\n          token,\n          address: email,\n          when: new Date(),\n        },\n      },\n    },\n  );\n\n  return token;\n};\n\nexport const userLogin = ({ email, password, role }) => {\n  const userEmail = email || faker.internet.email();\n  const userPassword = password || faker.random.word();\n\n  if (Meteor.isServer) {\n    const user = testUserAccount.run({\n      email: userEmail,\n      password: userPassword,\n      role: role || ROLES.USER,\n    });\n    Meteor.loginWithPassword({ id: user._id }, userPassword);\n    return Promise.resolve(user);\n  }\n\n  if (Meteor.isClient) {\n    return testUserAccount\n      .run({\n        email: userEmail,\n        password: userPassword,\n        role: role || ROLES.USER,\n      })\n      .then(user =>\n        new Promise((resolve, reject) => {\n          Meteor.loginWithPassword({ id: user._id }, userPassword, err =>\n            (err ? reject(err) : resolve(user)));\n        }));\n  }\n};\n\nexport const checkEmails = (expected, options = {}) =>\n  new Promise((resolve, reject) => {\n    Meteor.call('getAllTestEmails', { expected, ...options }, (err, emails) => {\n      if (err) {\n        reject(err);\n      }\n\n      try {\n        // getAllTestEmails returns when at least `expected` emails are found\n        // So it could be more. Make sure we always get exactly what we expect\n        if (expected && !options.noExpect) {\n          expect(emails.length).to.equal(expected);\n        }\n      } catch (error) {\n        reject(error);\n      }\n\n      resolve(emails);\n    });\n  });\n\nexport const resetDatabase = () =>\n  new Promise((resolve, reject) => {\n    Meteor.call('resetDatabase', (err, res) =>\n      (err ? reject(err) : resolve(res)));\n  });\n"]},"passPerPreset":false,"envName":"development","cwd":"/Users/Florian/dev/epotek/microservices/backend","root":"/Users/Florian/dev/epotek/microservices/backend","plugins":[{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/Florian/dev/epotek/microservices/backend/imports/core/utils/testHelpers/testHelpers.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/core/utils/testHelpers/testHelpers.js"}},"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread\"));\n\nmodule.export({\n  createLoginToken: function () {\n    return createLoginToken;\n  },\n  createEmailVerificationToken: function () {\n    return createEmailVerificationToken;\n  },\n  userLogin: function () {\n    return userLogin;\n  },\n  checkEmails: function () {\n    return checkEmails;\n  },\n  resetDatabase: function () {\n    return resetDatabase;\n  }\n});\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 0);\nvar Random;\nmodule.link(\"meteor/random\", {\n  Random: function (v) {\n    Random = v;\n  }\n}, 1);\nvar Accounts;\nmodule.link(\"meteor/accounts-base\", {\n  Accounts: function (v) {\n    Accounts = v;\n  }\n}, 2);\nvar faker;\nmodule.link(\"faker\", {\n  \"default\": function (v) {\n    faker = v;\n  }\n}, 3);\nvar expect;\nmodule.link(\"chai\", {\n  expect: function (v) {\n    expect = v;\n  }\n}, 4);\nvar Users, testUserAccount;\nmodule.link(\"../../api\", {\n  Users: function (v) {\n    Users = v;\n  },\n  testUserAccount: function (v) {\n    testUserAccount = v;\n  }\n}, 5);\nvar ROLES;\nmodule.link(\"../../api/constants\", {\n  ROLES: function (v) {\n    ROLES = v;\n  }\n}, 6);\n\nvar createLoginToken = function (userId) {\n  var loginToken = Random.id();\n\n  var hashedToken = Accounts._hashLoginToken(loginToken);\n\n  Users.update(userId, {\n    $set: {\n      'services.resume.loginTokens': [{\n        hashedToken: hashedToken\n      }]\n    }\n  });\n  return loginToken;\n};\n\nvar createEmailVerificationToken = function (userId, email) {\n  var token = Random.id();\n  Users.update({\n    _id: userId\n  }, {\n    $push: {\n      'services.email.verificationTokens': {\n        // token has to be uniq in the Users collection\n        token: token,\n        address: email,\n        when: new Date()\n      }\n    }\n  });\n  return token;\n};\n\nvar userLogin = function (_ref) {\n  var email = _ref.email,\n      password = _ref.password,\n      role = _ref.role;\n  var userEmail = email || faker.internet.email();\n  var userPassword = password || faker.random.word();\n\n  if (Meteor.isServer) {\n    var user = testUserAccount.run({\n      email: userEmail,\n      password: userPassword,\n      role: role || ROLES.USER\n    });\n    Meteor.loginWithPassword({\n      id: user._id\n    }, userPassword);\n    return Promise.resolve(user);\n  }\n\n  if (Meteor.isClient) {\n    return testUserAccount.run({\n      email: userEmail,\n      password: userPassword,\n      role: role || ROLES.USER\n    }).then(function (user) {\n      return new Promise(function (resolve, reject) {\n        Meteor.loginWithPassword({\n          id: user._id\n        }, userPassword, function (err) {\n          return err ? reject(err) : resolve(user);\n        });\n      });\n    });\n  }\n};\n\nvar checkEmails = function (expected) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  return new Promise(function (resolve, reject) {\n    Meteor.call('getAllTestEmails', (0, _objectSpread2.default)({\n      expected: expected\n    }, options), function (err, emails) {\n      if (err) {\n        reject(err);\n      }\n\n      try {\n        // getAllTestEmails returns when at least `expected` emails are found\n        // So it could be more. Make sure we always get exactly what we expect\n        if (expected && !options.noExpect) {\n          expect(emails.length).to.equal(expected);\n        }\n      } catch (error) {\n        reject(error);\n      }\n\n      resolve(emails);\n    });\n  });\n};\n\nvar resetDatabase = function () {\n  return new Promise(function (resolve, reject) {\n    Meteor.call('resetDatabase', function (err, res) {\n      return err ? reject(err) : resolve(res);\n    });\n  });\n};","map":{"version":3,"sources":["imports/core/utils/testHelpers/testHelpers.js"],"names":["Meteor","createLoginToken","userId","loginToken","Random","hashedToken","Accounts","Users","$set","createEmailVerificationToken","token","_id","$push","address","when","userLogin","role","userEmail","email","faker","userPassword","password","user","ROLES","USER","id","Promise","err","reject","resolve","checkEmails","options","expected","expect","emails","resetDatabase"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Random } from 'meteor/random';\nimport { Accounts } from 'meteor/accounts-base';\n\nimport faker from 'faker';\nimport { expect } from 'chai';\n\nimport { Users, testUserAccount } from '../../api';\nimport { ROLES } from '../../api/constants';\n\n/**\n * createLoginToken - Generate & saves a login token on the user with the given id\n *\n * @param {string} userId  A Meteor user id\n *\n * @return {string} the generated login token\n */\nexport const createLoginToken = (userId) => {\n  const loginToken = Random.id();\n  const hashedToken = Accounts._hashLoginToken(loginToken);\n\n  Users.update(userId, {\n    $set: {\n      'services.resume.loginTokens': [{ hashedToken }],\n    },\n  });\n\n  return loginToken;\n};\n\n/**\n * createEmailVerificationToken - Generate & saves a email verification token on the user with the given id\n *\n * @param {string} userId  A Meteor user id\n * @param {string} email  The email to be verified\n *\n * @return {string} the generated token\n */\nexport const createEmailVerificationToken = (userId, email) => {\n  const token = Random.id();\n\n  Users.update(\n    { _id: userId },\n    {\n      $push: {\n        'services.email.verificationTokens': {\n          // token has to be uniq in the Users collection\n          token,\n          address: email,\n          when: new Date(),\n        },\n      },\n    },\n  );\n\n  return token;\n};\n\nexport const userLogin = ({ email, password, role }) => {\n  const userEmail = email || faker.internet.email();\n  const userPassword = password || faker.random.word();\n\n  if (Meteor.isServer) {\n    const user = testUserAccount.run({\n      email: userEmail,\n      password: userPassword,\n      role: role || ROLES.USER,\n    });\n    Meteor.loginWithPassword({ id: user._id }, userPassword);\n    return Promise.resolve(user);\n  }\n\n  if (Meteor.isClient) {\n    return testUserAccount\n      .run({\n        email: userEmail,\n        password: userPassword,\n        role: role || ROLES.USER,\n      })\n      .then(user =>\n        new Promise((resolve, reject) => {\n          Meteor.loginWithPassword({ id: user._id }, userPassword, err =>\n            (err ? reject(err) : resolve(user)));\n        }));\n  }\n};\n\nexport const checkEmails = (expected, options = {}) =>\n  new Promise((resolve, reject) => {\n    Meteor.call('getAllTestEmails', { expected, ...options }, (err, emails) => {\n      if (err) {\n        reject(err);\n      }\n\n      try {\n        // getAllTestEmails returns when at least `expected` emails are found\n        // So it could be more. Make sure we always get exactly what we expect\n        if (expected && !options.noExpect) {\n          expect(emails.length).to.equal(expected);\n        }\n      } catch (error) {\n        reject(error);\n      }\n\n      resolve(emails);\n    });\n  });\n\nexport const resetDatabase = () =>\n  new Promise((resolve, reject) => {\n    Meteor.call('resetDatabase', (err, res) =>\n      (err ? reject(err) : resolve(res)));\n  });\n"]},"sourceType":"script","hash":"1d02802151433e1f1b7603e1ac3bc01fd775116f"}
