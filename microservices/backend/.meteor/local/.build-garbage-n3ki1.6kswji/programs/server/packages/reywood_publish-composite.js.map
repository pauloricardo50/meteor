{"version":3,"sources":["meteor://ðŸ’»app/packages/reywood:publish-composite/lib/publish_composite.js","meteor://ðŸ’»app/packages/reywood:publish-composite/lib/doc_ref_counter.js","meteor://ðŸ’»app/packages/reywood:publish-composite/lib/logging.js","meteor://ðŸ’»app/packages/reywood:publish-composite/lib/publication.js","meteor://ðŸ’»app/packages/reywood:publish-composite/lib/subscription.js","meteor://ðŸ’»app/packages/reywood:publish-composite/lib/published_document.js","meteor://ðŸ’»app/packages/reywood:publish-composite/lib/published_document_list.js"],"names":["module","export","enableDebugLogging","publishComposite","_","link","v","Meteor","Publication","default","Subscription","debugLog","name","options","publish","args","subscription","instanceOptions","prepareOptions","call","publications","forEach","opt","pub","push","defer","ready","onStop","unpublish","preparedOptions","apply","isArray","DocumentRefCounter","constructor","observer","heap","increment","collectionName","docId","key","valueOf","decrement","onChange","exportDefault","debugLoggingEnabled","source","message","paddedSource","length","console","log","Match","check","PublishedDocumentList","find","Function","children","Optional","OneOf","Object","String","childrenOptions","publishedDocs","unpublished","cursor","_getCursor","_getCollectionName","observeHandle","observe","added","bindEnvironment","doc","alreadyPublished","has","_id","unflagForRemoval","_republishChildrenOf","changed","add","_publishChildrenOf","newDoc","removed","_removeDoc","observeChangesHandle","observeChanges","id","fields","_stopObservingCursor","_unpublishAllDocuments","_republish","flagAllForRemoval","_removeFlaggedDocs","meteorSub","isFunction","each","createChildPublication","concat","addChildPub","eachChildPub","publication","eachDocument","stop","isFlaggedForRemoval","_unpublishChildrenOf","remove","docHash","refCounter","refCount","_removeDocHash","_hasDocChanged","_addDocHash","changes","_shouldSendChanges","_updateDocHash","buildHashKey","existingDoc","extend","_isDocPublished","any","keys","isEqual","PublishedDocument","childPublications","_isFlaggedForRemoval","childPublication","callback","flagForRemoval","documents","valueOfId","Error","get","context","execCallbackOnDoc","getIds","docIds"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAAA,MAAM,CAACC,MAAP,CAAc;AAACC,oBAAkB,EAAC,MAAIA,kBAAxB;AAA2CC,kBAAgB,EAAC,MAAIA;AAAhE,CAAd;;AAAiG,IAAIC,CAAJ;;AAAMJ,MAAM,CAACK,IAAP,CAAY,mBAAZ,EAAgC;AAACD,GAAC,CAACE,CAAD,EAAG;AAACF,KAAC,GAACE,CAAF;AAAI;;AAAV,CAAhC,EAA4C,CAA5C;AAA+C,IAAIC,MAAJ;AAAWP,MAAM,CAACK,IAAP,CAAY,eAAZ,EAA4B;AAACE,QAAM,CAACD,CAAD,EAAG;AAACC,UAAM,GAACD,CAAP;AAAS;;AAApB,CAA5B,EAAkD,CAAlD;AAAqD,IAAIE,WAAJ;AAAgBR,MAAM,CAACK,IAAP,CAAY,eAAZ,EAA4B;AAACI,SAAO,CAACH,CAAD,EAAG;AAACE,eAAW,GAACF,CAAZ;AAAc;;AAA1B,CAA5B,EAAwD,CAAxD;AAA2D,IAAII,YAAJ;AAAiBV,MAAM,CAACK,IAAP,CAAY,gBAAZ,EAA6B;AAACI,SAAO,CAACH,CAAD,EAAG;AAACI,gBAAY,GAACJ,CAAb;AAAe;;AAA3B,CAA7B,EAA0D,CAA1D;AAA6D,IAAIK,QAAJ,EAAaT,kBAAb;AAAgCF,MAAM,CAACK,IAAP,CAAY,WAAZ,EAAwB;AAACM,UAAQ,CAACL,CAAD,EAAG;AAACK,YAAQ,GAACL,CAAT;AAAW,GAAxB;;AAAyBJ,oBAAkB,CAACI,CAAD,EAAG;AAACJ,sBAAkB,GAACI,CAAnB;AAAqB;;AAApE,CAAxB,EAA8F,CAA9F;;AAQ/Y,SAASH,gBAAT,CAA0BS,IAA1B,EAAgCC,OAAhC,EAAyC;AACrC,SAAON,MAAM,CAACO,OAAP,CAAeF,IAAf,EAAqB,SAASE,OAAT,CAAiB,GAAGC,IAApB,EAA0B;AAClD,UAAMC,YAAY,GAAG,IAAIN,YAAJ,CAAiB,IAAjB,CAArB;AACA,UAAMO,eAAe,GAAGC,cAAc,CAACC,IAAf,CAAoB,IAApB,EAA0BN,OAA1B,EAAmCE,IAAnC,CAAxB;AACA,UAAMK,YAAY,GAAG,EAArB;AAEAH,mBAAe,CAACI,OAAhB,CAAyBC,GAAD,IAAS;AAC7B,YAAMC,GAAG,GAAG,IAAIf,WAAJ,CAAgBQ,YAAhB,EAA8BM,GAA9B,CAAZ;AACAF,kBAAY,CAACI,IAAb,CAAkBD,GAAlB;AACH,KAHD;AAKAhB,UAAM,CAACkB,KAAP,CAAa,MAAM;AACfL,kBAAY,CAACC,OAAb,CAAsBE,GAAD,IAAS;AAC1BA,WAAG,CAACT,OAAJ;AACH,OAFD;AAGAH,cAAQ,CAAC,gBAAD,EAAmB,OAAnB,CAAR;AACA,WAAKe,KAAL;AACH,KAND;AAQA,SAAKC,MAAL,CAAY,MAAM;AACdP,kBAAY,CAACC,OAAb,CAAqBE,GAAG,IAAIA,GAAG,CAACK,SAAJ,EAA5B;AACH,KAFD;AAGH,GArBM,CAAP;AAsBH,C,CAED;;;AACArB,MAAM,CAACJ,gBAAP,GAA0BA,gBAA1B;;AAEA,SAASe,cAAT,CAAwBL,OAAxB,EAAiCE,IAAjC,EAAuC;AACnC,MAAIc,eAAe,GAAGhB,OAAtB;;AAEA,MAAI,OAAOgB,eAAP,KAA2B,UAA/B,EAA2C;AACvCA,mBAAe,GAAGA,eAAe,CAACC,KAAhB,CAAsB,IAAtB,EAA4Bf,IAA5B,CAAlB;AACH;;AAED,MAAI,CAACc,eAAL,EAAsB;AAClB,WAAO,EAAP;AACH;;AAED,MAAI,CAACzB,CAAC,CAAC2B,OAAF,CAAUF,eAAV,CAAL,EAAiC;AAC7BA,mBAAe,GAAG,CAACA,eAAD,CAAlB;AACH;;AAED,SAAOA,eAAP;AACH,C;;;;;;;;;;;ACpDD,MAAMG,kBAAN,CAAyB;AACrBC,aAAW,CAACC,QAAD,EAAW;AAClB,SAAKC,IAAL,GAAY,EAAZ;AACA,SAAKD,QAAL,GAAgBA,QAAhB;AACH;;AAEDE,WAAS,CAACC,cAAD,EAAiBC,KAAjB,EAAwB;AAC7B,UAAMC,GAAG,GAAI,GAAEF,cAAe,IAAGC,KAAK,CAACE,OAAN,EAAgB,EAAjD;;AACA,QAAI,CAAC,KAAKL,IAAL,CAAUI,GAAV,CAAL,EAAqB;AACjB,WAAKJ,IAAL,CAAUI,GAAV,IAAiB,CAAjB;AACH;;AACD,SAAKJ,IAAL,CAAUI,GAAV,KAAkB,CAAlB;AACH;;AAEDE,WAAS,CAACJ,cAAD,EAAiBC,KAAjB,EAAwB;AAC7B,UAAMC,GAAG,GAAI,GAAEF,cAAe,IAAGC,KAAK,CAACE,OAAN,EAAgB,EAAjD;;AACA,QAAI,KAAKL,IAAL,CAAUI,GAAV,CAAJ,EAAoB;AAChB,WAAKJ,IAAL,CAAUI,GAAV,KAAkB,CAAlB;AAEA,WAAKL,QAAL,CAAcQ,QAAd,CAAuBL,cAAvB,EAAuCC,KAAvC,EAA8C,KAAKH,IAAL,CAAUI,GAAV,CAA9C;AACH;AACJ;;AArBoB;;AAAzBvC,MAAM,CAAC2C,aAAP,CAwBeX,kBAxBf,E;;;;;;;;;;;ACAAhC,MAAM,CAACC,MAAP,CAAc;AAACU,UAAQ,EAAC,MAAIA,QAAd;AAAuBT,oBAAkB,EAAC,MAAIA;AAA9C,CAAd;;AAAA;AAEA,IAAI0C,mBAAmB,GAAG,KAA1B;;AAEA,SAASjC,QAAT,CAAkBkC,MAAlB,EAA0BC,OAA1B,EAAmC;AAC/B,MAAI,CAACF,mBAAL,EAA0B;AAAE;AAAS;;AACrC,MAAIG,YAAY,GAAGF,MAAnB;;AACA,SAAOE,YAAY,CAACC,MAAb,GAAsB,EAA7B,EAAiC;AAAED,gBAAY,IAAI,GAAhB;AAAsB;;AACzDE,SAAO,CAACC,GAAR,CAAa,IAAGH,YAAa,KAAID,OAAQ,EAAzC;AACH;;AAED,SAAS5C,kBAAT,GAA8B;AAC1B0C,qBAAmB,GAAG,IAAtB;AACH,C;;;;;;;;;;;ACbD,IAAIrC,MAAJ;AAAWP,MAAM,CAACK,IAAP,CAAY,eAAZ,EAA4B;AAACE,QAAM,CAACD,CAAD,EAAG;AAACC,UAAM,GAACD,CAAP;AAAS;;AAApB,CAA5B,EAAkD,CAAlD;AAAqD,IAAI6C,KAAJ,EAAUC,KAAV;AAAgBpD,MAAM,CAACK,IAAP,CAAY,cAAZ,EAA2B;AAAC8C,OAAK,CAAC7C,CAAD,EAAG;AAAC6C,SAAK,GAAC7C,CAAN;AAAQ,GAAlB;;AAAmB8C,OAAK,CAAC9C,CAAD,EAAG;AAAC8C,SAAK,GAAC9C,CAAN;AAAQ;;AAApC,CAA3B,EAAiE,CAAjE;;AAAoE,IAAIF,CAAJ;;AAAMJ,MAAM,CAACK,IAAP,CAAY,mBAAZ,EAAgC;AAACD,GAAC,CAACE,CAAD,EAAG;AAACF,KAAC,GAACE,CAAF;AAAI;;AAAV,CAAhC,EAA4C,CAA5C;AAA+C,IAAIK,QAAJ;AAAaX,MAAM,CAACK,IAAP,CAAY,WAAZ,EAAwB;AAACM,UAAQ,CAACL,CAAD,EAAG;AAACK,YAAQ,GAACL,CAAT;AAAW;;AAAxB,CAAxB,EAAkD,CAAlD;AAAqD,IAAI+C,qBAAJ;AAA0BrD,MAAM,CAACK,IAAP,CAAY,2BAAZ,EAAwC;AAACI,SAAO,CAACH,CAAD,EAAG;AAAC+C,yBAAqB,GAAC/C,CAAtB;AAAwB;;AAApC,CAAxC,EAA8E,CAA9E;;AAQrS,MAAME,WAAN,CAAkB;AACdyB,aAAW,CAACjB,YAAD,EAAeH,OAAf,EAAwBE,IAAxB,EAA8B;AACrCqC,SAAK,CAACvC,OAAD,EAAU;AACXyC,UAAI,EAAEC,QADK;AAEXC,cAAQ,EAAEL,KAAK,CAACM,QAAN,CAAeN,KAAK,CAACO,KAAN,CAAY,CAACC,MAAD,CAAZ,EAAsBJ,QAAtB,CAAf,CAFC;AAGXlB,oBAAc,EAAEc,KAAK,CAACM,QAAN,CAAeG,MAAf;AAHL,KAAV,CAAL;AAMA,SAAK5C,YAAL,GAAoBA,YAApB;AACA,SAAKH,OAAL,GAAeA,OAAf;AACA,SAAKE,IAAL,GAAYA,IAAI,IAAI,EAApB;AACA,SAAK8C,eAAL,GAAuBhD,OAAO,CAAC2C,QAAR,IAAoB,EAA3C;AACA,SAAKM,aAAL,GAAqB,IAAIT,qBAAJ,EAArB;AACA,SAAKhB,cAAL,GAAsBxB,OAAO,CAACwB,cAA9B;AACA,SAAK0B,WAAL,GAAmB,KAAnB;AACH;;AAEDjD,SAAO,GAAG;AACN,QAAI,KAAKiD,WAAT,EAAsB;AAClB;AACH;;AAED,SAAKC,MAAL,GAAc,KAAKC,UAAL,EAAd;;AACA,QAAI,CAAC,KAAKD,MAAV,EAAkB;AAAE;AAAS;;AAE7B,UAAM3B,cAAc,GAAG,KAAK6B,kBAAL,EAAvB,CARM,CAUN;AACA;AACA;;;AACA,SAAKC,aAAL,GAAqB,KAAKH,MAAL,CAAYI,OAAZ,CAAoB;AACrCC,WAAK,EAAE9D,MAAM,CAAC+D,eAAP,CAAwBC,GAAD,IAAS;AACnC,YAAI,KAAKR,WAAT,EAAsB;AAClB;AACH;;AAED,cAAMS,gBAAgB,GAAG,KAAKV,aAAL,CAAmBW,GAAnB,CAAuBF,GAAG,CAACG,GAA3B,CAAzB;;AAEA,YAAIF,gBAAJ,EAAsB;AAClB7D,kBAAQ,CAAC,iCAAD,EAAqC,GAAE0B,cAAe,IAAGkC,GAAG,CAACG,GAAI,oBAAjE,CAAR;AACA,eAAKZ,aAAL,CAAmBa,gBAAnB,CAAoCJ,GAAG,CAACG,GAAxC;;AACA,eAAKE,oBAAL,CAA0BL,GAA1B;;AACA,eAAKvD,YAAL,CAAkB6D,OAAlB,CAA0BxC,cAA1B,EAA0CkC,GAAG,CAACG,GAA9C,EAAmDH,GAAnD;AACH,SALD,MAKO;AACH,eAAKT,aAAL,CAAmBgB,GAAnB,CAAuBzC,cAAvB,EAAuCkC,GAAG,CAACG,GAA3C;;AACA,eAAKK,kBAAL,CAAwBR,GAAxB;;AACA,eAAKvD,YAAL,CAAkBqD,KAAlB,CAAwBhC,cAAxB,EAAwCkC,GAAxC;AACH;AACJ,OAjBM,CAD8B;AAmBrCM,aAAO,EAAEtE,MAAM,CAAC+D,eAAP,CAAwBU,MAAD,IAAY;AACxC,YAAI,KAAKjB,WAAT,EAAsB;AAClB;AACH;;AACDpD,gBAAQ,CAAC,mCAAD,EAAuC,GAAE0B,cAAe,IAAG2C,MAAM,CAACN,GAAI,EAAtE,CAAR;;AACA,aAAKE,oBAAL,CAA0BI,MAA1B;AACH,OANQ,CAnB4B;AA0BrCC,aAAO,EAAGV,GAAD,IAAS;AACd,YAAI,KAAKR,WAAT,EAAsB;AAClB;AACH;;AACDpD,gBAAQ,CAAC,mCAAD,EAAuC,GAAE0B,cAAe,IAAGkC,GAAG,CAACG,GAAI,EAAnE,CAAR;;AACA,aAAKQ,UAAL,CAAgB7C,cAAhB,EAAgCkC,GAAG,CAACG,GAApC;AACH;AAhCoC,KAApB,CAArB;AAmCA,SAAKS,oBAAL,GAA4B,KAAKnB,MAAL,CAAYoB,cAAZ,CAA2B;AACnDP,aAAO,EAAE,CAACQ,EAAD,EAAKC,MAAL,KAAgB;AACrB,YAAI,KAAKvB,WAAT,EAAsB;AAClB;AACH;;AACDpD,gBAAQ,CAAC,0CAAD,EAA8C,GAAE0B,cAAe,IAAGgD,EAAG,EAArE,CAAR;AACA,aAAKrE,YAAL,CAAkB6D,OAAlB,CAA0BxC,cAA1B,EAA0CgD,EAA1C,EAA8CC,MAA9C;AACH;AAPkD,KAA3B,CAA5B;AASH;;AAED1D,WAAS,GAAG;AACRjB,YAAQ,CAAC,uBAAD,EAA0B,KAAKuD,kBAAL,EAA1B,CAAR;AACA,SAAKH,WAAL,GAAmB,IAAnB;;AACA,SAAKwB,oBAAL;;AACA,SAAKC,sBAAL;AACH;;AAEDC,YAAU,GAAG;AACT,SAAKF,oBAAL;;AAEA,SAAKzB,aAAL,CAAmB4B,iBAAnB;AAEA/E,YAAQ,CAAC,wBAAD,EAA2B,oBAA3B,CAAR;AACA,SAAKG,OAAL;AAEAH,YAAQ,CAAC,wBAAD,EAA2B,gCAA3B,CAAR;;AACA,SAAKgF,kBAAL;AACH;;AAED1B,YAAU,GAAG;AACT,WAAO,KAAKpD,OAAL,CAAayC,IAAb,CAAkBxB,KAAlB,CAAwB,KAAKd,YAAL,CAAkB4E,SAA1C,EAAqD,KAAK7E,IAA1D,CAAP;AACH;;AAEDmD,oBAAkB,GAAG;AACjB,WAAO,KAAK7B,cAAL,IAAwB,KAAK2B,MAAL,IAAe,KAAKA,MAAL,CAAYE,kBAAZ,EAA9C;AACH;;AAEDa,oBAAkB,CAACR,GAAD,EAAM;AACpB,UAAMf,QAAQ,GAAGpD,CAAC,CAACyF,UAAF,CAAa,KAAKhC,eAAlB,IACjB,KAAKA,eAAL,CAAqBU,GAArB,EAA0B,GAAG,KAAKxD,IAAlC,CADiB,GACyB,KAAK8C,eAD/C;;AAEAzD,KAAC,CAAC0F,IAAF,CAAOtC,QAAP,EAAiB,SAASuC,sBAAT,CAAgClF,OAAhC,EAAyC;AACtD,YAAMU,GAAG,GAAG,IAAIf,WAAJ,CAAgB,KAAKQ,YAArB,EAAmCH,OAAnC,EAA4C,CAAC0D,GAAD,EAAMyB,MAAN,CAAa,KAAKjF,IAAlB,CAA5C,CAAZ;AACA,WAAK+C,aAAL,CAAmBmC,WAAnB,CAA+B1B,GAAG,CAACG,GAAnC,EAAwCnD,GAAxC;AACAA,SAAG,CAACT,OAAJ;AACH,KAJD,EAIG,IAJH;AAKH;;AAED8D,sBAAoB,CAACL,GAAD,EAAM;AACtB,SAAKT,aAAL,CAAmBoC,YAAnB,CAAgC3B,GAAG,CAACG,GAApC,EAA0CyB,WAAD,IAAiB;AACtDA,iBAAW,CAACpF,IAAZ,CAAiB,CAAjB,IAAsBwD,GAAtB;;AACA4B,iBAAW,CAACV,UAAZ;AACH,KAHD;AAIH;;AAEDD,wBAAsB,GAAG;AACrB,SAAK1B,aAAL,CAAmBsC,YAAnB,CAAiC7B,GAAD,IAAS;AACrC,WAAKW,UAAL,CAAgBX,GAAG,CAAClC,cAApB,EAAoCkC,GAAG,CAACjC,KAAxC;AACH,KAFD,EAEG,IAFH;AAGH;;AAEDiD,sBAAoB,GAAG;AACnB5E,YAAQ,CAAC,kCAAD,EAAqC,uBAArC,CAAR;;AAEA,QAAI,KAAKwD,aAAT,EAAwB;AACpB,WAAKA,aAAL,CAAmBkC,IAAnB;AACA,aAAO,KAAKlC,aAAZ;AACH;;AAED,QAAI,KAAKgB,oBAAT,EAA+B;AAC3B,WAAKA,oBAAL,CAA0BkB,IAA1B;AACA,aAAO,KAAKlB,oBAAZ;AACH;AACJ;;AAEDQ,oBAAkB,GAAG;AACjB,SAAK7B,aAAL,CAAmBsC,YAAnB,CAAiC7B,GAAD,IAAS;AACrC,UAAIA,GAAG,CAAC+B,mBAAJ,EAAJ,EAA+B;AAC3B,aAAKpB,UAAL,CAAgBX,GAAG,CAAClC,cAApB,EAAoCkC,GAAG,CAACjC,KAAxC;AACH;AACJ,KAJD,EAIG,IAJH;AAKH;;AAED4C,YAAU,CAAC7C,cAAD,EAAiBC,KAAjB,EAAwB;AAC9B,SAAKtB,YAAL,CAAkBiE,OAAlB,CAA0B5C,cAA1B,EAA0CC,KAA1C;;AACA,SAAKiE,oBAAL,CAA0BjE,KAA1B;;AACA,SAAKwB,aAAL,CAAmB0C,MAAnB,CAA0BlE,KAA1B;AACH;;AAEDiE,sBAAoB,CAACjE,KAAD,EAAQ;AACxB3B,YAAQ,CAAC,kCAAD,EAAsC,4BAA2B,KAAKuD,kBAAL,EAA0B,IAAG5B,KAAM,EAApG,CAAR;AAEA,SAAKwB,aAAL,CAAmBoC,YAAnB,CAAgC5D,KAAhC,EAAwC6D,WAAD,IAAiB;AACpDA,iBAAW,CAACvE,SAAZ;AACH,KAFD;AAGH;;AAhKa;;AARlB5B,MAAM,CAAC2C,aAAP,CA2KenC,WA3Kf,E;;;;;;;;;;;ACAA,IAAIJ,CAAJ;;AAAMJ,MAAM,CAACK,IAAP,CAAY,mBAAZ,EAAgC;AAACD,GAAC,CAACE,CAAD,EAAG;AAACF,KAAC,GAACE,CAAF;AAAI;;AAAV,CAAhC,EAA4C,CAA5C;AAA+C,IAAI0B,kBAAJ;AAAuBhC,MAAM,CAACK,IAAP,CAAY,mBAAZ,EAAgC;AAACI,SAAO,CAACH,CAAD,EAAG;AAAC0B,sBAAkB,GAAC1B,CAAnB;AAAqB;;AAAjC,CAAhC,EAAmE,CAAnE;AAAsE,IAAIK,QAAJ;AAAaX,MAAM,CAACK,IAAP,CAAY,WAAZ,EAAwB;AAACM,UAAQ,CAACL,CAAD,EAAG;AAACK,YAAQ,GAACL,CAAT;AAAW;;AAAxB,CAAxB,EAAkD,CAAlD;;AAM/J,MAAMI,YAAN,CAAmB;AACfuB,aAAW,CAAC2D,SAAD,EAAY;AACnB,SAAKA,SAAL,GAAiBA,SAAjB;AACA,SAAKa,OAAL,GAAe,EAAf;AACA,SAAKC,UAAL,GAAkB,IAAI1E,kBAAJ,CAAuB;AACrCU,cAAQ,EAAE,CAACL,cAAD,EAAiBC,KAAjB,EAAwBqE,QAAxB,KAAqC;AAC3ChG,gBAAQ,CAAC,kCAAD,EAAsC,GAAE0B,cAAe,IAAGC,KAAK,CAACE,OAAN,EAAgB,IAAGmE,QAAS,EAAtF,CAAR;;AACA,YAAIA,QAAQ,IAAI,CAAhB,EAAmB;AACff,mBAAS,CAACX,OAAV,CAAkB5C,cAAlB,EAAkCC,KAAlC;;AACA,eAAKsE,cAAL,CAAoBvE,cAApB,EAAoCC,KAApC;AACH;AACJ;AAPoC,KAAvB,CAAlB;AASH;;AAED+B,OAAK,CAAChC,cAAD,EAAiBkC,GAAjB,EAAsB;AACvB,SAAKmC,UAAL,CAAgBtE,SAAhB,CAA0BC,cAA1B,EAA0CkC,GAAG,CAACG,GAA9C;;AAEA,QAAI,KAAKmC,cAAL,CAAoBxE,cAApB,EAAoCkC,GAAG,CAACG,GAAxC,EAA6CH,GAA7C,CAAJ,EAAuD;AACnD5D,cAAQ,CAAC,oBAAD,EAAwB,GAAE0B,cAAe,IAAGkC,GAAG,CAACG,GAAI,EAApD,CAAR;AACA,WAAKkB,SAAL,CAAevB,KAAf,CAAqBhC,cAArB,EAAqCkC,GAAG,CAACG,GAAzC,EAA8CH,GAA9C;;AACA,WAAKuC,WAAL,CAAiBzE,cAAjB,EAAiCkC,GAAjC;AACH;AACJ;;AAEDM,SAAO,CAACxC,cAAD,EAAiBgD,EAAjB,EAAqB0B,OAArB,EAA8B;AACjC,QAAI,KAAKC,kBAAL,CAAwB3E,cAAxB,EAAwCgD,EAAxC,EAA4C0B,OAA5C,CAAJ,EAA0D;AACtDpG,cAAQ,CAAC,sBAAD,EAA0B,GAAE0B,cAAe,IAAGgD,EAAG,EAAjD,CAAR;AACA,WAAKO,SAAL,CAAef,OAAf,CAAuBxC,cAAvB,EAAuCgD,EAAvC,EAA2C0B,OAA3C;;AACA,WAAKE,cAAL,CAAoB5E,cAApB,EAAoCgD,EAApC,EAAwC0B,OAAxC;AACH;AACJ;;AAED9B,SAAO,CAAC5C,cAAD,EAAiBgD,EAAjB,EAAqB;AACxB1E,YAAQ,CAAC,sBAAD,EAA0B,GAAE0B,cAAe,IAAGgD,EAAE,CAAC7C,OAAH,EAAa,EAA3D,CAAR;AACA,SAAKkE,UAAL,CAAgBjE,SAAhB,CAA0BJ,cAA1B,EAA0CgD,EAA1C;AACH;;AAEDyB,aAAW,CAACzE,cAAD,EAAiBkC,GAAjB,EAAsB;AAC7B,SAAKkC,OAAL,CAAaS,YAAY,CAAC7E,cAAD,EAAiBkC,GAAG,CAACG,GAArB,CAAzB,IAAsDH,GAAtD;AACH;;AAED0C,gBAAc,CAAC5E,cAAD,EAAiBgD,EAAjB,EAAqB0B,OAArB,EAA8B;AACxC,UAAMxE,GAAG,GAAG2E,YAAY,CAAC7E,cAAD,EAAiBgD,EAAjB,CAAxB;AACA,UAAM8B,WAAW,GAAG,KAAKV,OAAL,CAAalE,GAAb,KAAqB,EAAzC;AACA,SAAKkE,OAAL,CAAalE,GAAb,IAAoBnC,CAAC,CAACgH,MAAF,CAASD,WAAT,EAAsBJ,OAAtB,CAApB;AACH;;AAEDC,oBAAkB,CAAC3E,cAAD,EAAiBgD,EAAjB,EAAqB0B,OAArB,EAA8B;AAC5C,WAAO,KAAKM,eAAL,CAAqBhF,cAArB,EAAqCgD,EAArC,KACH,KAAKwB,cAAL,CAAoBxE,cAApB,EAAoCgD,EAApC,EAAwC0B,OAAxC,CADJ;AAEH;;AAEDM,iBAAe,CAAChF,cAAD,EAAiBgD,EAAjB,EAAqB;AAChC,UAAM9C,GAAG,GAAG2E,YAAY,CAAC7E,cAAD,EAAiBgD,EAAjB,CAAxB;AACA,WAAO,CAAC,CAAC,KAAKoB,OAAL,CAAalE,GAAb,CAAT;AACH;;AAEDsE,gBAAc,CAACxE,cAAD,EAAiBgD,EAAjB,EAAqBd,GAArB,EAA0B;AACpC,UAAM4C,WAAW,GAAG,KAAKV,OAAL,CAAaS,YAAY,CAAC7E,cAAD,EAAiBgD,EAAjB,CAAzB,CAApB;;AAEA,QAAI,CAAC8B,WAAL,EAAkB;AAAE,aAAO,IAAP;AAAc;;AAElC,WAAO/G,CAAC,CAACkH,GAAF,CAAMlH,CAAC,CAACmH,IAAF,CAAOhD,GAAP,CAAN,EAAmBhC,GAAG,IAAI,CAACnC,CAAC,CAACoH,OAAF,CAAUjD,GAAG,CAAChC,GAAD,CAAb,EAAoB4E,WAAW,CAAC5E,GAAD,CAA/B,CAA3B,CAAP;AACH;;AAEDqE,gBAAc,CAACvE,cAAD,EAAiBgD,EAAjB,EAAqB;AAC/B,UAAM9C,GAAG,GAAG2E,YAAY,CAAC7E,cAAD,EAAiBgD,EAAjB,CAAxB;AACA,WAAO,KAAKoB,OAAL,CAAalE,GAAb,CAAP;AACH;;AArEc;;AAwEnB,SAAS2E,YAAT,CAAsB7E,cAAtB,EAAsCgD,EAAtC,EAA0C;AACtC,SAAQ,GAAEhD,cAAe,KAAIgD,EAAE,CAAC7C,OAAH,EAAa,EAA1C;AACH;;AAhFDxC,MAAM,CAAC2C,aAAP,CAkFejC,YAlFf,E;;;;;;;;;;;ACAA,MAAM+G,iBAAN,CAAwB;AACpBxF,aAAW,CAACI,cAAD,EAAiBC,KAAjB,EAAwB;AAC/B,SAAKD,cAAL,GAAsBA,cAAtB;AACA,SAAKC,KAAL,GAAaA,KAAb;AACA,SAAKoF,iBAAL,GAAyB,EAAzB;AACA,SAAKC,oBAAL,GAA4B,KAA5B;AACH;;AAED1B,aAAW,CAAC2B,gBAAD,EAAmB;AAC1B,SAAKF,iBAAL,CAAuBlG,IAAvB,CAA4BoG,gBAA5B;AACH;;AAED1B,cAAY,CAAC2B,QAAD,EAAW;AACnB,SAAKH,iBAAL,CAAuBrG,OAAvB,CAA+BwG,QAA/B;AACH;;AAEDvB,qBAAmB,GAAG;AAClB,WAAO,KAAKqB,oBAAZ;AACH;;AAEDhD,kBAAgB,GAAG;AACf,SAAKgD,oBAAL,GAA4B,KAA5B;AACH;;AAEDG,gBAAc,GAAG;AACb,SAAKH,oBAAL,GAA4B,IAA5B;AACH;;AA1BmB;;AAAxB3H,MAAM,CAAC2C,aAAP,CA6Be8E,iBA7Bf,E;;;;;;;;;;;ACAA,IAAIrH,CAAJ;;AAAMJ,MAAM,CAACK,IAAP,CAAY,mBAAZ,EAAgC;AAACD,GAAC,CAACE,CAAD,EAAG;AAACF,KAAC,GAACE,CAAF;AAAI;;AAAV,CAAhC,EAA4C,CAA5C;AAA+C,IAAImH,iBAAJ;AAAsBzH,MAAM,CAACK,IAAP,CAAY,sBAAZ,EAAmC;AAACI,SAAO,CAACH,CAAD,EAAG;AAACmH,qBAAiB,GAACnH,CAAlB;AAAoB;;AAAhC,CAAnC,EAAqE,CAArE;;AAK3E,MAAM+C,qBAAN,CAA4B;AACxBpB,aAAW,GAAG;AACV,SAAK8F,SAAL,GAAiB,EAAjB;AACH;;AAEDjD,KAAG,CAACzC,cAAD,EAAiBC,KAAjB,EAAwB;AACvB,UAAMC,GAAG,GAAGyF,SAAS,CAAC1F,KAAD,CAArB;;AAEA,QAAI,CAAC,KAAKyF,SAAL,CAAexF,GAAf,CAAL,EAA0B;AACtB,WAAKwF,SAAL,CAAexF,GAAf,IAAsB,IAAIkF,iBAAJ,CAAsBpF,cAAtB,EAAsCC,KAAtC,CAAtB;AACH;AACJ;;AAED2D,aAAW,CAAC3D,KAAD,EAAQ6D,WAAR,EAAqB;AAC5B,QAAI,CAACA,WAAL,EAAkB;AAAE;AAAS;;AAE7B,UAAM5D,GAAG,GAAGyF,SAAS,CAAC1F,KAAD,CAArB;AACA,UAAMiC,GAAG,GAAG,KAAKwD,SAAL,CAAexF,GAAf,CAAZ;;AAEA,QAAI,OAAOgC,GAAP,KAAe,WAAnB,EAAgC;AAC5B,YAAM,IAAI0D,KAAJ,CAAW,0BAAyB1F,GAAI,EAAxC,CAAN;AACH;;AAED,SAAKwF,SAAL,CAAexF,GAAf,EAAoB0D,WAApB,CAAgCE,WAAhC;AACH;;AAED+B,KAAG,CAAC5F,KAAD,EAAQ;AACP,UAAMC,GAAG,GAAGyF,SAAS,CAAC1F,KAAD,CAArB;AACA,WAAO,KAAKyF,SAAL,CAAexF,GAAf,CAAP;AACH;;AAEDiE,QAAM,CAAClE,KAAD,EAAQ;AACV,UAAMC,GAAG,GAAGyF,SAAS,CAAC1F,KAAD,CAArB;AACA,WAAO,KAAKyF,SAAL,CAAexF,GAAf,CAAP;AACH;;AAEDkC,KAAG,CAACnC,KAAD,EAAQ;AACP,WAAO,CAAC,CAAC,KAAK4F,GAAL,CAAS5F,KAAT,CAAT;AACH;;AAED8D,cAAY,CAACyB,QAAD,EAAWM,OAAX,EAAoB;AAC5B/H,KAAC,CAAC0F,IAAF,CAAO,KAAKiC,SAAZ,EAAuB,SAASK,iBAAT,CAA2B7D,GAA3B,EAAgC;AACnDsD,cAAQ,CAAC1G,IAAT,CAAc,IAAd,EAAoBoD,GAApB;AACH,KAFD,EAEG4D,OAAO,IAAI,IAFd;AAGH;;AAEDjC,cAAY,CAAC5D,KAAD,EAAQuF,QAAR,EAAkB;AAC1B,UAAMtD,GAAG,GAAG,KAAK2D,GAAL,CAAS5F,KAAT,CAAZ;;AAEA,QAAIiC,GAAJ,EAAS;AACLA,SAAG,CAAC2B,YAAJ,CAAiB2B,QAAjB;AACH;AACJ;;AAEDQ,QAAM,GAAG;AACL,UAAMC,MAAM,GAAG,EAAf;AAEA,SAAKlC,YAAL,CAAmB7B,GAAD,IAAS;AACvB+D,YAAM,CAAC9G,IAAP,CAAY+C,GAAG,CAACjC,KAAhB;AACH,KAFD;AAIA,WAAOgG,MAAP;AACH;;AAED3D,kBAAgB,CAACrC,KAAD,EAAQ;AACpB,UAAMiC,GAAG,GAAG,KAAK2D,GAAL,CAAS5F,KAAT,CAAZ;;AAEA,QAAIiC,GAAJ,EAAS;AACLA,SAAG,CAACI,gBAAJ;AACH;AACJ;;AAEDe,mBAAiB,GAAG;AAChB,SAAKU,YAAL,CAAmB7B,GAAD,IAAS;AACvBA,SAAG,CAACuD,cAAJ;AACH,KAFD;AAGH;;AA5EuB;;AA+E5B,SAASE,SAAT,CAAmB1F,KAAnB,EAA0B;AACtB,MAAIA,KAAK,KAAK,IAAd,EAAoB;AAChB,UAAM,IAAI2F,KAAJ,CAAU,qBAAV,CAAN;AACH;;AACD,MAAI,OAAO3F,KAAP,KAAiB,WAArB,EAAkC;AAC9B,UAAM,IAAI2F,KAAJ,CAAU,0BAAV,CAAN;AACH;;AACD,SAAO3F,KAAK,CAACE,OAAN,EAAP;AACH;;AA5FDxC,MAAM,CAAC2C,aAAP,CA8FeU,qBA9Ff,E","file":"/packages/reywood_publish-composite.js","sourcesContent":["import { _ } from 'meteor/underscore';\nimport { Meteor } from 'meteor/meteor';\n\nimport Publication from './publication';\nimport Subscription from './subscription';\nimport { debugLog, enableDebugLogging } from './logging';\n\n\nfunction publishComposite(name, options) {\n    return Meteor.publish(name, function publish(...args) {\n        const subscription = new Subscription(this);\n        const instanceOptions = prepareOptions.call(this, options, args);\n        const publications = [];\n\n        instanceOptions.forEach((opt) => {\n            const pub = new Publication(subscription, opt);\n            publications.push(pub);\n        });\n\n        Meteor.defer(() => {\n            publications.forEach((pub) => {\n                pub.publish();\n            });\n            debugLog('Meteor.publish', 'ready');\n            this.ready();\n        });\n\n        this.onStop(() => {\n            publications.forEach(pub => pub.unpublish());\n        });\n    });\n}\n\n// For backwards compatibility\nMeteor.publishComposite = publishComposite;\n\nfunction prepareOptions(options, args) {\n    let preparedOptions = options;\n\n    if (typeof preparedOptions === 'function') {\n        preparedOptions = preparedOptions.apply(this, args);\n    }\n\n    if (!preparedOptions) {\n        return [];\n    }\n\n    if (!_.isArray(preparedOptions)) {\n        preparedOptions = [preparedOptions];\n    }\n\n    return preparedOptions;\n}\n\n\nexport {\n    enableDebugLogging,\n    publishComposite,\n};\n","class DocumentRefCounter {\n    constructor(observer) {\n        this.heap = {};\n        this.observer = observer;\n    }\n\n    increment(collectionName, docId) {\n        const key = `${collectionName}:${docId.valueOf()}`;\n        if (!this.heap[key]) {\n            this.heap[key] = 0;\n        }\n        this.heap[key] += 1;\n    }\n\n    decrement(collectionName, docId) {\n        const key = `${collectionName}:${docId.valueOf()}`;\n        if (this.heap[key]) {\n            this.heap[key] -= 1;\n\n            this.observer.onChange(collectionName, docId, this.heap[key]);\n        }\n    }\n}\n\nexport default DocumentRefCounter;\n","/* eslint-disable no-console */\n\nlet debugLoggingEnabled = false;\n\nfunction debugLog(source, message) {\n    if (!debugLoggingEnabled) { return; }\n    let paddedSource = source;\n    while (paddedSource.length < 35) { paddedSource += ' '; }\n    console.log(`[${paddedSource}] ${message}`);\n}\n\nfunction enableDebugLogging() {\n    debugLoggingEnabled = true;\n}\n\nexport {\n    debugLog,\n    enableDebugLogging,\n};\n","import { Meteor } from 'meteor/meteor';\nimport { Match, check } from 'meteor/check';\nimport { _ } from 'meteor/underscore';\n\nimport { debugLog } from './logging';\nimport PublishedDocumentList from './published_document_list';\n\n\nclass Publication {\n    constructor(subscription, options, args) {\n        check(options, {\n            find: Function,\n            children: Match.Optional(Match.OneOf([Object], Function)),\n            collectionName: Match.Optional(String),\n        });\n\n        this.subscription = subscription;\n        this.options = options;\n        this.args = args || [];\n        this.childrenOptions = options.children || [];\n        this.publishedDocs = new PublishedDocumentList();\n        this.collectionName = options.collectionName;\n        this.unpublished = false;\n    }\n\n    publish() {\n        if (this.unpublished) {\n            return;\n        }\n\n        this.cursor = this._getCursor();\n        if (!this.cursor) { return; }\n\n        const collectionName = this._getCollectionName();\n\n        // Use Meteor.bindEnvironment to make sure the callbacks are run with the same\n        // environmentVariables as when publishing the \"parent\".\n        // It's only needed when publish is being recursively run.\n        this.observeHandle = this.cursor.observe({\n            added: Meteor.bindEnvironment((doc) => {\n                if (this.unpublished) {\n                    return;\n                }\n\n                const alreadyPublished = this.publishedDocs.has(doc._id);\n\n                if (alreadyPublished) {\n                    debugLog('Publication.observeHandle.added', `${collectionName}:${doc._id} already published`);\n                    this.publishedDocs.unflagForRemoval(doc._id);\n                    this._republishChildrenOf(doc);\n                    this.subscription.changed(collectionName, doc._id, doc);\n                } else {\n                    this.publishedDocs.add(collectionName, doc._id);\n                    this._publishChildrenOf(doc);\n                    this.subscription.added(collectionName, doc);\n                }\n            }),\n            changed: Meteor.bindEnvironment((newDoc) => {\n                if (this.unpublished) {\n                    return;\n                }\n                debugLog('Publication.observeHandle.changed', `${collectionName}:${newDoc._id}`);\n                this._republishChildrenOf(newDoc);\n            }),\n            removed: (doc) => {\n                if (this.unpublished) {\n                    return;\n                }\n                debugLog('Publication.observeHandle.removed', `${collectionName}:${doc._id}`);\n                this._removeDoc(collectionName, doc._id);\n            },\n        });\n\n        this.observeChangesHandle = this.cursor.observeChanges({\n            changed: (id, fields) => {\n                if (this.unpublished) {\n                    return;\n                }\n                debugLog('Publication.observeChangesHandle.changed', `${collectionName}:${id}`);\n                this.subscription.changed(collectionName, id, fields);\n            },\n        });\n    }\n\n    unpublish() {\n        debugLog('Publication.unpublish', this._getCollectionName());\n        this.unpublished = true;\n        this._stopObservingCursor();\n        this._unpublishAllDocuments();\n    }\n\n    _republish() {\n        this._stopObservingCursor();\n\n        this.publishedDocs.flagAllForRemoval();\n\n        debugLog('Publication._republish', 'run .publish again');\n        this.publish();\n\n        debugLog('Publication._republish', 'unpublish docs from old cursor');\n        this._removeFlaggedDocs();\n    }\n\n    _getCursor() {\n        return this.options.find.apply(this.subscription.meteorSub, this.args);\n    }\n\n    _getCollectionName() {\n        return this.collectionName || (this.cursor && this.cursor._getCollectionName());\n    }\n\n    _publishChildrenOf(doc) {\n        const children = _.isFunction(this.childrenOptions) ?\n        this.childrenOptions(doc, ...this.args) : this.childrenOptions;\n        _.each(children, function createChildPublication(options) {\n            const pub = new Publication(this.subscription, options, [doc].concat(this.args));\n            this.publishedDocs.addChildPub(doc._id, pub);\n            pub.publish();\n        }, this);\n    }\n\n    _republishChildrenOf(doc) {\n        this.publishedDocs.eachChildPub(doc._id, (publication) => {\n            publication.args[0] = doc;\n            publication._republish();\n        });\n    }\n\n    _unpublishAllDocuments() {\n        this.publishedDocs.eachDocument((doc) => {\n            this._removeDoc(doc.collectionName, doc.docId);\n        }, this);\n    }\n\n    _stopObservingCursor() {\n        debugLog('Publication._stopObservingCursor', 'stop observing cursor');\n\n        if (this.observeHandle) {\n            this.observeHandle.stop();\n            delete this.observeHandle;\n        }\n\n        if (this.observeChangesHandle) {\n            this.observeChangesHandle.stop();\n            delete this.observeChangesHandle;\n        }\n    }\n\n    _removeFlaggedDocs() {\n        this.publishedDocs.eachDocument((doc) => {\n            if (doc.isFlaggedForRemoval()) {\n                this._removeDoc(doc.collectionName, doc.docId);\n            }\n        }, this);\n    }\n\n    _removeDoc(collectionName, docId) {\n        this.subscription.removed(collectionName, docId);\n        this._unpublishChildrenOf(docId);\n        this.publishedDocs.remove(docId);\n    }\n\n    _unpublishChildrenOf(docId) {\n        debugLog('Publication._unpublishChildrenOf', `unpublishing children of ${this._getCollectionName()}:${docId}`);\n\n        this.publishedDocs.eachChildPub(docId, (publication) => {\n            publication.unpublish();\n        });\n    }\n}\n\nexport default Publication;\n","import { _ } from 'meteor/underscore';\n\nimport DocumentRefCounter from './doc_ref_counter';\nimport { debugLog } from './logging';\n\n\nclass Subscription {\n    constructor(meteorSub) {\n        this.meteorSub = meteorSub;\n        this.docHash = {};\n        this.refCounter = new DocumentRefCounter({\n            onChange: (collectionName, docId, refCount) => {\n                debugLog('Subscription.refCounter.onChange', `${collectionName}:${docId.valueOf()} ${refCount}`);\n                if (refCount <= 0) {\n                    meteorSub.removed(collectionName, docId);\n                    this._removeDocHash(collectionName, docId);\n                }\n            },\n        });\n    }\n\n    added(collectionName, doc) {\n        this.refCounter.increment(collectionName, doc._id);\n\n        if (this._hasDocChanged(collectionName, doc._id, doc)) {\n            debugLog('Subscription.added', `${collectionName}:${doc._id}`);\n            this.meteorSub.added(collectionName, doc._id, doc);\n            this._addDocHash(collectionName, doc);\n        }\n    }\n\n    changed(collectionName, id, changes) {\n        if (this._shouldSendChanges(collectionName, id, changes)) {\n            debugLog('Subscription.changed', `${collectionName}:${id}`);\n            this.meteorSub.changed(collectionName, id, changes);\n            this._updateDocHash(collectionName, id, changes);\n        }\n    }\n\n    removed(collectionName, id) {\n        debugLog('Subscription.removed', `${collectionName}:${id.valueOf()}`);\n        this.refCounter.decrement(collectionName, id);\n    }\n\n    _addDocHash(collectionName, doc) {\n        this.docHash[buildHashKey(collectionName, doc._id)] = doc;\n    }\n\n    _updateDocHash(collectionName, id, changes) {\n        const key = buildHashKey(collectionName, id);\n        const existingDoc = this.docHash[key] || {};\n        this.docHash[key] = _.extend(existingDoc, changes);\n    }\n\n    _shouldSendChanges(collectionName, id, changes) {\n        return this._isDocPublished(collectionName, id) &&\n            this._hasDocChanged(collectionName, id, changes);\n    }\n\n    _isDocPublished(collectionName, id) {\n        const key = buildHashKey(collectionName, id);\n        return !!this.docHash[key];\n    }\n\n    _hasDocChanged(collectionName, id, doc) {\n        const existingDoc = this.docHash[buildHashKey(collectionName, id)];\n\n        if (!existingDoc) { return true; }\n\n        return _.any(_.keys(doc), key => !_.isEqual(doc[key], existingDoc[key]));\n    }\n\n    _removeDocHash(collectionName, id) {\n        const key = buildHashKey(collectionName, id);\n        delete this.docHash[key];\n    }\n}\n\nfunction buildHashKey(collectionName, id) {\n    return `${collectionName}::${id.valueOf()}`;\n}\n\nexport default Subscription;\n","class PublishedDocument {\n    constructor(collectionName, docId) {\n        this.collectionName = collectionName;\n        this.docId = docId;\n        this.childPublications = [];\n        this._isFlaggedForRemoval = false;\n    }\n\n    addChildPub(childPublication) {\n        this.childPublications.push(childPublication);\n    }\n\n    eachChildPub(callback) {\n        this.childPublications.forEach(callback);\n    }\n\n    isFlaggedForRemoval() {\n        return this._isFlaggedForRemoval;\n    }\n\n    unflagForRemoval() {\n        this._isFlaggedForRemoval = false;\n    }\n\n    flagForRemoval() {\n        this._isFlaggedForRemoval = true;\n    }\n}\n\nexport default PublishedDocument;\n","import { _ } from 'meteor/underscore';\n\nimport PublishedDocument from './published_document';\n\n\nclass PublishedDocumentList {\n    constructor() {\n        this.documents = {};\n    }\n\n    add(collectionName, docId) {\n        const key = valueOfId(docId);\n\n        if (!this.documents[key]) {\n            this.documents[key] = new PublishedDocument(collectionName, docId);\n        }\n    }\n\n    addChildPub(docId, publication) {\n        if (!publication) { return; }\n\n        const key = valueOfId(docId);\n        const doc = this.documents[key];\n\n        if (typeof doc === 'undefined') {\n            throw new Error(`Doc not found in list: ${key}`);\n        }\n\n        this.documents[key].addChildPub(publication);\n    }\n\n    get(docId) {\n        const key = valueOfId(docId);\n        return this.documents[key];\n    }\n\n    remove(docId) {\n        const key = valueOfId(docId);\n        delete this.documents[key];\n    }\n\n    has(docId) {\n        return !!this.get(docId);\n    }\n\n    eachDocument(callback, context) {\n        _.each(this.documents, function execCallbackOnDoc(doc) {\n            callback.call(this, doc);\n        }, context || this);\n    }\n\n    eachChildPub(docId, callback) {\n        const doc = this.get(docId);\n\n        if (doc) {\n            doc.eachChildPub(callback);\n        }\n    }\n\n    getIds() {\n        const docIds = [];\n\n        this.eachDocument((doc) => {\n            docIds.push(doc.docId);\n        });\n\n        return docIds;\n    }\n\n    unflagForRemoval(docId) {\n        const doc = this.get(docId);\n\n        if (doc) {\n            doc.unflagForRemoval();\n        }\n    }\n\n    flagAllForRemoval() {\n        this.eachDocument((doc) => {\n            doc.flagForRemoval();\n        });\n    }\n}\n\nfunction valueOfId(docId) {\n    if (docId === null) {\n        throw new Error('Document ID is null');\n    }\n    if (typeof docId === 'undefined') {\n        throw new Error('Document ID is undefined');\n    }\n    return docId.valueOf();\n}\n\nexport default PublishedDocumentList;\n"]}