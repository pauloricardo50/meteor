{"version":3,"sources":["meteor://ðŸ’»app/packages/peerlibrary_subscription-scope/client.coffee","meteor://ðŸ’»app/client.coffee"],"names":["Connection","originalCompileProjection","originalSubscribe","Meteor","connection","constructor","prototype","subscribe","handle","args","apply","scopeQuery","query","subscriptionId","$exists","_","bind","LocalCollection","_compileProjection","fields","fun","obj","field","res","lastIndexOf"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAAA,UAAA,EAAAC,yBAAA,EAAAC,iBAAA;AAAAF,UAAA,GAAaG,MAAM,CAACC,UAAP,CAAkBC,WAA/B;AAEAH,iBAAA,GAAoBF,UAAU,CAAAM,SAAV,CAAYC,SAAhC;;AACAP,UAAU,CAAAM,SAAV,CAAYC,SAAZ,GAAwB;AACtB,MAAAC,MAAA;;AADsB,oCAACC,IAAD;AAACA,QAAD;AAAA;;AACtBD,QAAA,GAASN,iBAAiB,CAACQ,KAAlB,CAAwB,IAAxB,EAA2BD,IAA3B,CAAT;;AAEAD,QAAM,CAACG,UAAP,GAAoB;AAClB,QAAAC,KAAA;AAAAA,SAAA,GAAQ,EAAR;AACAA,SAAM,WAAQJ,MAAM,CAACK,cAAf,CAAN,GACE;AAAAC,aAAA,EAAS;AAAT,KADF;ACOA,WDLAF,KCKA;ADTkB,GAApB;;ACWA,SDLAJ,MCKA;ADdsB,CAAxB,C,CCiBA;;;ADLAL,MAAM,CAACI,SAAP,GAAmBQ,CAAC,CAACC,IAAF,CAAOb,MAAM,CAACC,UAAP,CAAkBG,SAAzB,EAAoCJ,MAAM,CAACC,UAA3C,CAAnB;AAEAH,yBAAA,GAA4BgB,eAAe,CAACC,kBAA5C;;AACAD,eAAe,CAACC,kBAAhB,GAAqC,UAACC,MAAD;AACnC,MAAAC,GAAA;AAAAA,KAAA,GAAMnB,yBAAA,CAA0BkB,MAA1B,CAAN;ACSA,SDPA,UAACE,GAAD;AACE,QAAAC,KAAA,EAAAC,GAAA;AAAAA,OAAA,GAAMH,GAAA,CAAIC,GAAJ,CAAN;;AAEA,SAAAC,KAAA,2CAAAC,GAAA;ACQE,UDRoBD,KAAK,CAACE,WAAN,CAAkB,OAAlB,EAA2B,CAA3B,MAAiC,CCQrD,EDRqD;AACrD,eAAOD,GAAI,CAAAD,KAAA,CAAX;ACSC;ADVH;;ACYA,WDTAC,GCSA;ADfF,GCOA;ADVmC,CAArC,C","file":"/packages/peerlibrary_subscription-scope.js","sourcesContent":["Connection = Meteor.connection.constructor\n\noriginalSubscribe = Connection::subscribe\nConnection::subscribe = (args...) ->\n  handle = originalSubscribe.apply @, args\n\n  handle.scopeQuery = ->\n    query = {}\n    query[\"_sub_#{handle.subscriptionId}\"] =\n      $exists: true\n    query\n\n  handle\n\n# Recreate the convenience method.\nMeteor.subscribe = _.bind Meteor.connection.subscribe, Meteor.connection\n\noriginalCompileProjection = LocalCollection._compileProjection\nLocalCollection._compileProjection = (fields) ->\n  fun = originalCompileProjection fields\n\n  (obj) ->\n    res = fun obj\n\n    for field of res when field.lastIndexOf('_sub_', 0) is 0\n      delete res[field]\n\n    res\n","var Connection, originalCompileProjection, originalSubscribe;\n\nConnection = Meteor.connection.constructor;\n\noriginalSubscribe = Connection.prototype.subscribe;\n\nConnection.prototype.subscribe = function(...args) {\n  var handle;\n  handle = originalSubscribe.apply(this, args);\n  handle.scopeQuery = function() {\n    var query;\n    query = {};\n    query[`_sub_${handle.subscriptionId}`] = {\n      $exists: true\n    };\n    return query;\n  };\n  return handle;\n};\n\n// Recreate the convenience method.\nMeteor.subscribe = _.bind(Meteor.connection.subscribe, Meteor.connection);\n\noriginalCompileProjection = LocalCollection._compileProjection;\n\nLocalCollection._compileProjection = function(fields) {\n  var fun;\n  fun = originalCompileProjection(fields);\n  return function(obj) {\n    var field, res;\n    res = fun(obj);\n    for (field in res) {\n      if (field.lastIndexOf('_sub_', 0) === 0) {\n        delete res[field];\n      }\n    }\n    return res;\n  };\n};\n"]}