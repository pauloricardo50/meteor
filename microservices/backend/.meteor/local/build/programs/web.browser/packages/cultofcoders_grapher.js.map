{"version":3,"sources":["meteor://ðŸ’»app/packages/cultofcoders:grapher/main.client.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/compose.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/createQuery.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/extension.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/links/config.schema.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/links/constants.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/links/extension.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/links/linker.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/links/lib/createSearchFilters.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/links/linkTypes/base.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/links/linkTypes/linkMany.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/links/linkTypes/linkManyMeta.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/links/linkTypes/linkOne.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/links/linkTypes/linkOneMeta.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/links/linkTypes/lib/smartArguments.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/namedQuery/namedQuery.base.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/namedQuery/namedQuery.client.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/namedQuery/namedQuery.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/namedQuery/namedQuery.server.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/namedQuery/store.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/namedQuery/cache/BaseResultCacher.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/namedQuery/cache/MemoryResultCacher.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/query.base.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/query.client.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/query.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/query.server.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/counts/collection.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/counts/constants.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/counts/countSubscription.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/counts/createFauxSubscription.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/hypernova/aggregateSearchFilters.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/hypernova/assembleAggregateResults.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/hypernova/assembler.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/hypernova/buildAggregatePipeline.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/hypernova/constants.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/hypernova/hypernova.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/hypernova/storeHypernovaResults.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/hypernova/lib/cleanObjectForMetaFilters.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/hypernova/lib/snapBackDottedFields.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/lib/applyProps.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/lib/callWithPromise.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/lib/createGraph.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/lib/dotize.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/lib/fieldInProjection.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/lib/intersectDeep.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/lib/prepareForDelivery.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/lib/prepareForProcess.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/lib/recursiveFetch.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/nodes/collectionNode.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/nodes/fieldNode.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/nodes/reducerNode.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/reducers/extension.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/reducers/lib/addFieldMap.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/reducers/lib/applyReducers.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/reducers/lib/cleanReducerLeftovers.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/reducers/lib/createReducers.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/reducers/lib/embedReducerWithLink.js"],"names":["module","link","default","deepExtend","v","exportDefault","args","Query","NamedQuery","NamedQueryStore","name","body","options","_","isFunction","createNamedQuery","entryPointName","first","keys","collection","Mongo","Collection","get","Meteor","Error","isDevelopment","console","warn","params","createNormalQuery","namedQuery","query","add","clone","extend","prototype","createQuery","length","export","DenormalizeSchema","LinkConfigDefaults","LinkConfigSchema","Match","field","String","Object","bypassSchema","Maybe","Boolean","type","OneOf","Where","isObject","_collection","metadata","inversedBy","index","unique","autoremove","denormalize","ObjectIncluding","LINK_STORAGE","Linker","assign","addLinks","data","each","linkConfig","linkName","_name","linker","getLinks","getLinker","hasLink","getLink","objectOrId","linkData","object","isVirtual","findOne","fields","linkStorageField","_id","createLink","LinkMany","LinkManyMeta","LinkOne","LinkOneMeta","smartArguments","dot","check","access","constructor","mainCollection","_validateAndClean","_initAutoremove","_initDenormalization","_handleReferenceRemovalForVirtualLinks","_initIndex","oneTypes","strategy","isMany","relatedLinker","getLinkedCollection","isSingle","isMeta","contains","isOneResult","helperClass","_getHelperClass","collectionName","_prepareVirtual","_generateFieldName","startup","_setupVirtualConfig","virtualLinkConfig","cleanedCollectionName","replace","defaultFieldPrefix","after","remove","userId","doc","accessor","fetchAsArray","linkedObj","unset","isServer","_ensureIndex","sparse","$in","getIds","ids","find","fetch","map","item","packageExists","Package","cacheConfig","referenceFieldSuffix","inversedLink","referenceField","cacheField","cache","isDenormalized","isSubBodyDenormalized","cacheBody","cacheBodyFields","bodyFields","omit","difference","createSearchFilters","createOne","createOneVirtual","createOneMeta","createOneMetaVirtual","createMany","createManyVirtual","createManyMeta","createManyMetaVirtual","sift","fieldStorage","metaFilters","pick","value","undefined","filters","key","root","nested","split","arr","uniq","union","obj","join","pluck","$elemMatch","Link","SmartArgs","config","linkedCollection","$metaFilters","$meta","searchFilters","appliedFilters","others","result","clean","identifyId","what","saveToDatabase","getId","identifyIds","_validateIds","isArray","validIds","_checkWhat","_virtualAction","action","reversedLink","element","elementId","insert","set","_ids","modifier","$addToSet","$each","update","filter","$pull","metadatas","localMetadata","push","extendMetadata","existingMetadata","subfield","subfieldUpdate","$set","subWhat","NamedQueryBase","deepClone","globalConfig","setConfig","getConfig","isNamedQuery","queryName","resolver","subscriptionHandle","isExposed","isResolver","setParams","doValidateParams","validateParams","_validate","validationError","error","newParams","cacher","exposeConfig","validator","call","defaultOptions","CountSubscription","createGraph","recursiveFetch","prepareForProcess","callWithPromise","Base","LocalCollection","intersectDeep","subscribe","callback","subscribeCount","_counter","unsubscribe","stop","unsubscribeCount","fetchSync","fetchOneSync","callbackOrOptions","_fetchStatic","_fetchReactive","fetchOne","err","res","getCountSync","getCount","$body","allowSkip","$options","skip","scoped","NamedQueryClient","NamedQueryServer","MemoryResultCacher","context","_performSecurityChecks","_fetchResolverData","doEmbodimentIfItApplies","cacheId","generateQueryId","countCursor","getCursorForCounting","count","$filters","cacheResults","resolve","fn","self","_callFirewall","storage","getAll","BaseResultCacher","EJSON","stringify","fetchData","cloneDeep","DEFAULT_TTL","store","cacheData","storeData","ttl","setTimeout","QueryBase","isGlobalQuery","QueryClient","QueryServer","hypernova","node","COUNTS_COLLECTION_CLIENT","ReactiveVar","Tracker","Counts","createFauxSubscription","accessToken","fauxHandle","arg","equals","lastArgs","token","_markedForUnsubscribe","disconnectComputation","autorun","handleDisconnect","id","status","connected","_markedForResume","isSubscribed","countManager","ready","AggregateFilters","extractIdsFromArray","array","collectionNode","parentObjects","parent","results","create","eligibleObjects","storages","arrayOfIds","isValid","cleanObjectForMetaFilters","childCollectionNode","aggregateResults","allResults","metaFiltersTest","parentResult","eligibleAggregateResults","aggregateResult","datas","comparator","childLinkName","parentResults","forEach","Array","limit","resultsByKeyId","groupBy","filterAssembledData","slice","SAFE_DOTTED_FIELD_REPLACEMENT","containsDottedFields","pipeline","firewall","cleanUndefinedLeafs","$match","sort","$sort","dataPush","indexOf","safeField","$group","$push","$slice","$project","tree","a","hypernovaInit","applyProps","prepareForDelivery","storeHypernovaResults","collectionNodes","bypassFirewalls","userIdToPass","assemble","assembleAggregateResults","buildAggregatePipeline","snapBackDottedFields","aggregateFilters","filteredOptions","aggregate","aggregationResult","document","RegExp","restrictOptions","props","applyFields","method","myParameters","Promise","reject","reason","specialFields","createNodes","addFieldNode","getNodeNamespace","CollectionNode","FieldNode","ReducerNode","dotize","createReducers","fieldName","addProp","handleDenormalized","subroot","reducer","getReducer","reducerNode","fieldNodes","isProjectionOperatorExpression","dotted","convert","fieldNode","parts","n","reverse","snapCache","prefix","newObj","recurse","o","p","isArrayItem","f","isEmptyArray","getFieldName","isEmptyObj","isNumber","isNaN","parseInt","prop","hasOwnProperty","expandField","isFieldInProjection","i","projection","checkNested","some","EXTENDED_SPECIAL_FIELDS","isClientValueValid","values","every","nestedValue","intersectFields","allowed","client","intersection","pairs","clientValue","serverValue","allowedBody","clientBody","build","applyPostFilters","applyPostOptions","getResultsArray","removeLinkStorages","storeOneResults","assembleMetadata","applyReducers","cleanReducerLeftovers","Minimongo","snapBackCaches","cloneMetaChildren","applyPostFilter","postFilters","$postFilters","$postOptions","sorter","Sorter","getComparator","start","end","$postFilter","isUndefined","sameLevelResults","removeStorageField","shouldCleanStorage","removeFromResult","removeEmptyRoot","isEmpty","childResults","childResult","storeMetadata","parentElement","$metadata","storageItem","snapCaches","snapCachesSingles","shoudStoreLinkStorage","defaultFilterFunction","applyFilterRecursive","isRoot","$filter","Function","applyPagination","_params","_body","parentObject","fetchOptions","scopeQuery","$exists","collectionNodeResults","runFieldSanityChecks","nodes","scheduledForDeletion","reducers","reducerNodes","_shouldCleanStorage","_node","hasAddedAnyField","projectionOperator","has","hasField","getField","hasCollectionNode","hasReducerNode","getReducerNode","getCollectionNode","getName","subLinkName","isProjectionOperator","reduce","reduceFunction","dependencies","compute","addFieldMap","addReducers","reducerConfig","reducerName","dbField","processedReducers","reducersQueue","shift","allDependenciesComputed","all","dep","includes","flatten","cleanNestedFields","snapCacheField","handleAddElement","handleAddReducer","handleAddLink","handleAddField","embedReducerWithLink","childReducerNode","dots","addFieldIfRequired","nestedFields","startsWith","reducerBody"],"mappings":"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","file":"/packages/cultofcoders_grapher.js","sourcesContent":["import './lib/extension.js';\nimport './lib/links/extension.js';\nimport './lib/query/reducers/extension.js';\n\nexport { default as createQuery } from './lib/createQuery.js';\n\nexport {\n    default as prepareForProcess,\n} from './lib/query/lib/prepareForProcess';\n\nexport { default as Query } from './lib/query/query.client';\n\nexport { default as NamedQuery } from './lib/namedQuery/namedQuery.client';\n\nexport { default as compose } from './lib/compose';\n","import deepExtend from 'deep-extend';\n\nexport default function (...args) {\n    return deepExtend({}, ...args);\n}","import Query from './query/query.js';\nimport NamedQuery from './namedQuery/namedQuery.js';\nimport NamedQueryStore from './namedQuery/store.js';\n\n/**\n * This is a polymorphic function, it allows you to create a query as an object\n * or it also allows you to re-use an existing query if it's a named one\n *\n * @param args\n * @returns {*}\n */\nexport default (...args) => {\n    if (typeof args[0] === 'string') {\n        let [name, body, options] = args;\n        options = options || {};\n\n        // It's a resolver query\n        if (_.isFunction(body)) {\n            return createNamedQuery(name, null, body, options);\n        }\n\n        const entryPointName = _.first(_.keys(body));\n        const collection = Mongo.Collection.get(entryPointName);\n\n        if (!collection) {\n            throw new Meteor.Error('invalid-name', `We could not find any collection with the name \"${entryPointName}\". Make sure it is imported prior to using this`)\n        }\n\n        return createNamedQuery(name, collection, body[entryPointName], options);\n    } else {\n        // Query Creation, it can have an endpoint as collection or as a NamedQuery\n        let [body, options] = args;\n        options = options || {};\n\n        const entryPointName = _.first(_.keys(body));\n        const collection = Mongo.Collection.get(entryPointName);\n\n        if (!collection) {\n            if (Meteor.isDevelopment && !NamedQueryStore.get(entryPointName)) {\n                console.warn(`You are creating a query with the entry point \"${entryPointName}\", but there was no collection found for it (maybe you forgot to import it client-side?). It's assumed that it's referencing a NamedQuery.`)\n            }\n\n            return createNamedQuery(entryPointName, null, {}, {params: body[entryPointName]});\n        } else {\n            return createNormalQuery(collection, body[entryPointName], options);\n        }\n    }\n}\n\nfunction createNamedQuery(name, collection, body, options = {}) {\n    // if it exists already, we re-use it\n    const namedQuery = NamedQueryStore.get(name);\n    let query;\n\n    if (!namedQuery) {\n        query = new NamedQuery(name, collection, body, options);\n        NamedQueryStore.add(name, query);\n    } else {\n        query = namedQuery.clone(options.params);\n    }\n\n    return query;\n}\n\nfunction createNormalQuery(collection, body, options)  {\n    return new Query(collection, body, options);\n}\n","import Query from './query/query.js';\nimport NamedQuery from './namedQuery/namedQuery.js';\nimport NamedQueryStore from './namedQuery/store.js';\n\n_.extend(Mongo.Collection.prototype, {\n    createQuery(...args) {\n        if (args.length === 0) {\n            return new Query(this, {}, {});\n        }\n        \n        if (typeof args[0] === 'string') {\n            //NamedQuery\n            const [name, body, options] = args;\n            const query = new NamedQuery(name, this, body, options);\n            NamedQueryStore.add(name, query);\n\n            return query;\n        } else {\n            const [body, options] = args;\n\n            return new Query(this, body, options);\n        }\n    },\n});\n","import {Match} from 'meteor/check';\nimport {Mongo} from 'meteor/mongo';\n\nexport const DenormalizeSchema = {\n    field: String,\n    body: Object,\n    bypassSchema: Match.Maybe(Boolean)\n};\n\nexport const LinkConfigDefaults = {\n    type: 'one',\n};\n\nexport const LinkConfigSchema = {\n    type: Match.Maybe(Match.OneOf('one', 'many', '1', '*')),\n    collection: Match.Maybe(\n        Match.Where(collection => {\n            // We do like this so it works with other types of collections \n            // like FS.Collection\n            return _.isObject(collection) && (\n                collection instanceof Mongo.Collection\n                || \n                !!collection._collection\n            );\n        })\n    ),\n    field: Match.Maybe(String),\n    metadata: Match.Maybe(Boolean),\n    inversedBy: Match.Maybe(String),\n    index: Match.Maybe(Boolean),\n    unique: Match.Maybe(Boolean),\n    autoremove: Match.Maybe(Boolean),\n    denormalize: Match.Maybe(Match.ObjectIncluding(DenormalizeSchema)),\n};","export const LINK_STORAGE = '__links';\n","import { Mongo } from 'meteor/mongo';\nimport { LINK_STORAGE } from './constants.js';\nimport Linker from './linker.js';\n\nObject.assign(Mongo.Collection.prototype, {\n    /**\n     * The data we add should be valid for config.schema.js\n     */\n    addLinks(data) {\n        if (!this[LINK_STORAGE]) {\n            this[LINK_STORAGE] = {};\n        }\n\n        _.each(data, (linkConfig, linkName) => {\n            if (this[LINK_STORAGE][linkName]) {\n                throw new Meteor.Error(\n                    `You cannot add the link with name: ${linkName} because it was already added to ${\n                        this._name\n                    } collection`\n                );\n            }\n\n            const linker = new Linker(this, linkName, linkConfig);\n\n            _.extend(this[LINK_STORAGE], {\n                [linkName]: linker,\n            });\n        });\n    },\n\n    getLinks() {\n        return this[LINK_STORAGE];\n    },\n\n    getLinker(name) {\n        if (this[LINK_STORAGE]) {\n            return this[LINK_STORAGE][name];\n        }\n    },\n\n    hasLink(name) {\n        if (!this[LINK_STORAGE]) {\n            return false;\n        }\n\n        return !!this[LINK_STORAGE][name];\n    },\n\n    getLink(objectOrId, name) {\n        let linkData = this[LINK_STORAGE];\n\n        if (!linkData) {\n            throw new Meteor.Error(\n                `There are no links defined for collection: ${this._name}`\n            );\n        }\n\n        if (!linkData[name]) {\n            throw new Meteor.Error(\n                `There is no link ${name} for collection: ${this._name}`\n            );\n        }\n\n        const linker = linkData[name];\n        let object = objectOrId;\n        if (typeof objectOrId == 'string') {\n            if (!linker.isVirtual()) {\n                object = this.findOne(objectOrId, {\n                    fields: {\n                        [linker.linkStorageField]: 1,\n                    },\n                });\n            } else {\n                object = { _id: objectOrId };\n            }\n\n            if (!object) {\n                throw new Meteor.Error(\n                    `We could not find any object with _id: \"${objectOrId}\" within the collection: ${\n                        this._name\n                    }`\n                );\n            }\n        }\n\n        return linkData[name].createLink(object);\n    },\n});\n","import LinkMany from './linkTypes/linkMany.js';\nimport LinkManyMeta from './linkTypes/linkManyMeta.js';\nimport LinkOne from './linkTypes/linkOne.js';\nimport LinkOneMeta from './linkTypes/linkOneMeta.js';\nimport { LinkConfigSchema, LinkConfigDefaults } from './config.schema.js';\nimport smartArguments from './linkTypes/lib/smartArguments';\nimport dot from 'dot-object';\nimport { check } from 'meteor/check';\nimport { _ } from 'meteor/underscore';\nimport { access } from 'fs';\n\nexport default class Linker {\n    /**\n     * @param mainCollection\n     * @param linkName\n     * @param linkConfig\n     */\n    constructor(mainCollection, linkName, linkConfig) {\n        this.mainCollection = mainCollection;\n        this.linkConfig = Object.assign({}, LinkConfigDefaults, linkConfig);\n        this.linkName = linkName;\n\n        // check linkName must not exist in schema\n        this._validateAndClean();\n\n        // initialize cascade removal hooks.\n        this._initAutoremove();\n        this._initDenormalization();\n\n        if (this.isVirtual()) {\n            // if it's a virtual field make sure that when this is deleted, it will be removed from the references\n            if (!linkConfig.autoremove) {\n                this._handleReferenceRemovalForVirtualLinks();\n            }\n        } else {\n            this._initIndex();\n        }\n    }\n\n    /**\n     * Values which represent for the relation a single link\n     * @returns {string[]}\n     */\n    get oneTypes() {\n        return ['one', '1'];\n    }\n\n    /**\n     * Returns the strategies: one, many, one-meta, many-meta\n     * @returns {string}\n     */\n    get strategy() {\n        let strategy = this.isMany() ? 'many' : 'one';\n        if (this.linkConfig.metadata) {\n            strategy += '-meta';\n        }\n\n        return strategy;\n    }\n\n    /**\n     * Returns the field name in the document where the actual relationships are stored.\n     * @returns string\n     */\n    get linkStorageField() {\n        if (this.isVirtual()) {\n            return this.linkConfig.relatedLinker.linkStorageField;\n        }\n\n        return this.linkConfig.field;\n    }\n\n    /**\n     * The collection that is linked with the current collection\n     * @returns Mongo.Collection\n     */\n    getLinkedCollection() {\n        return this.linkConfig.collection;\n    }\n\n    /**\n     * If the relationship for this link is of \"many\" type.\n     */\n    isMany() {\n        return !this.isSingle();\n    }\n\n    /**\n     * If the relationship for this link contains metadata\n     */\n    isMeta() {\n        if (this.isVirtual()) {\n            return this.linkConfig.relatedLinker.isMeta();\n        }\n\n        return !!this.linkConfig.metadata;\n    }\n\n    /**\n     * @returns {boolean}\n     */\n    isSingle() {\n        if (this.isVirtual()) {\n            return this.linkConfig.relatedLinker.isSingle();\n        }\n\n        return _.contains(this.oneTypes, this.linkConfig.type);\n    }\n\n    /**\n     * @returns {boolean}\n     */\n    isVirtual() {\n        return !!this.linkConfig.inversedBy;\n    }\n\n    /**\n     * Should return a single result.\n     */\n    isOneResult() {\n        return (\n            (this.isVirtual() &&\n                this.linkConfig.relatedLinker.linkConfig.unique) ||\n            (!this.isVirtual() && this.isSingle())\n        );\n    }\n\n    /**\n     * @param object\n     * @param collection To impersonate the getLinkedCollection() of the \"Linker\"\n     *\n     * @returns {LinkOne|LinkMany|LinkManyMeta|LinkOneMeta|LinkResolve}\n     */\n    createLink(object, collection = null) {\n        let helperClass = this._getHelperClass();\n\n        return new helperClass(this, object, collection);\n    }\n\n    /**\n     * @returns {*}\n     * @private\n     */\n    _validateAndClean() {\n        if (!this.linkConfig.collection) {\n            throw new Meteor.Error(\n                'invalid-config',\n                `For the link ${\n                    this.linkName\n                } you did not provide a collection.`\n            );\n        }\n\n        if (typeof this.linkConfig.collection === 'string') {\n            const collectionName = this.linkConfig.collection;\n            this.linkConfig.collection = Mongo.Collection.get(collectionName);\n\n            if (!this.linkConfig.collection) {\n                throw new Meteor.Error(\n                    'invalid-collection',\n                    `Could not find a collection with the name: ${collectionName}`\n                );\n            }\n        }\n\n        if (this.isVirtual()) {\n            return this._prepareVirtual();\n        } else {\n            if (!this.linkConfig.type) {\n                this.linkConfig.type = 'one';\n            }\n\n            if (!this.linkConfig.field) {\n                this.linkConfig.field = this._generateFieldName();\n            } else {\n                if (this.linkConfig.field == this.linkName) {\n                    throw new Meteor.Error(\n                        'invalid-config',\n                        `For the link ${\n                            this.linkName\n                        } you must not use the same name for the field, otherwise it will cause conflicts when fetching data`\n                    );\n                }\n            }\n        }\n\n        check(this.linkConfig, LinkConfigSchema);\n    }\n\n    /**\n     * We need to apply same type of rules in this case.\n     * @private\n     */\n    _prepareVirtual() {\n        const { collection, inversedBy } = this.linkConfig;\n        let linker = collection.getLinker(inversedBy);\n\n        if (!linker) {\n            // it is possible that the collection doesn't have a linker created yet.\n            // so we will create it on startup after all links have been defined\n            Meteor.startup(() => {\n                linker = collection.getLinker(inversedBy);\n                if (!linker) {\n                    throw new Meteor.Error(\n                        `You tried setting up an inversed link in \"${\n                            this.mainCollection._name\n                        }\" pointing to collection: \"${\n                            collection._name\n                        }\" link: \"${inversedBy}\", but no such link was found. Maybe a typo ?`\n                    );\n                } else {\n                    this._setupVirtualConfig(linker);\n                }\n            });\n        } else {\n            this._setupVirtualConfig(linker);\n        }\n    }\n\n    /**\n     * @param linker\n     * @private\n     */\n    _setupVirtualConfig(linker) {\n        const virtualLinkConfig = linker.linkConfig;\n\n        if (!virtualLinkConfig) {\n            throw new Meteor.Error(\n                `There is no link-config for the related collection on ${inversedBy}. Make sure you added the direct links before specifying virtual ones.`\n            );\n        }\n\n        _.extend(this.linkConfig, {\n            metadata: virtualLinkConfig.metadata,\n            relatedLinker: linker,\n        });\n    }\n\n    /**\n     * Depending on the strategy, we create the proper helper class\n     * @private\n     */\n    _getHelperClass() {\n        switch (this.strategy) {\n            case 'many-meta':\n                return LinkManyMeta;\n            case 'many':\n                return LinkMany;\n            case 'one-meta':\n                return LinkOneMeta;\n            case 'one':\n                return LinkOne;\n        }\n\n        throw new Meteor.Error(\n            'invalid-strategy',\n            `${this.strategy} is not a valid strategy`\n        );\n    }\n\n    /**\n     * If field name not present, we generate it.\n     * @private\n     */\n    _generateFieldName() {\n        let cleanedCollectionName = this.linkConfig.collection._name.replace(\n            /\\./g,\n            '_'\n        );\n        let defaultFieldPrefix = this.linkName + '_' + cleanedCollectionName;\n\n        switch (this.strategy) {\n            case 'many-meta':\n                return `${defaultFieldPrefix}_metas`;\n            case 'many':\n                return `${defaultFieldPrefix}_ids`;\n            case 'one-meta':\n                return `${defaultFieldPrefix}_meta`;\n            case 'one':\n                return `${defaultFieldPrefix}_id`;\n        }\n    }\n\n    /**\n     * When a link that is declared virtual is removed, the reference will be removed from every other link.\n     * @private\n     */\n    _handleReferenceRemovalForVirtualLinks() {\n        this.mainCollection.after.remove((userId, doc) => {\n            // this problem may occur when you do a .remove() before Meteor.startup()\n            if (!this.linkConfig.relatedLinker) {\n                console.warn(\n                    `There was an error finding the link for removal for collection: \"${\n                        this.mainCollection._name\n                    }\" with link: \"${\n                        this.linkName\n                    }\". This may occur when you do a .remove() before Meteor.startup()`\n                );\n                return;\n            }\n\n            const accessor = this.createLink(doc);\n\n            _.each(accessor.fetchAsArray(), linkedObj => {\n                const { relatedLinker } = this.linkConfig;\n                // We do this check, to avoid self-referencing hell when defining virtual links\n                // Virtual links if not found \"compile-time\", we will try again to reprocess them on Meteor.startup\n                // if a removal happens before Meteor.startup this may fail\n                if (relatedLinker) {\n                    let link = relatedLinker.createLink(linkedObj);\n\n                    if (relatedLinker.isSingle()) {\n                        link.unset();\n                    } else {\n                        link.remove(doc);\n                    }\n                }\n            });\n        });\n    }\n\n    _initIndex() {\n        if (Meteor.isServer) {\n            let field = this.linkConfig.field;\n            if (this.linkConfig.metadata) {\n                field = field + '._id';\n            }\n\n            if (this.linkConfig.index) {\n                if (this.isVirtual()) {\n                    throw new Meteor.Error(\n                        'You cannot set index on an inversed link.'\n                    );\n                }\n\n                let options;\n                if (this.linkConfig.unique) {\n                    options = { unique: true };\n                }\n\n                this.mainCollection._ensureIndex({ [field]: 1 }, options);\n            } else {\n                if (this.linkConfig.unique) {\n                    if (this.isVirtual()) {\n                        throw new Meteor.Error(\n                            'You cannot set unique property on an inversed link.'\n                        );\n                    }\n\n                    this.mainCollection._ensureIndex(\n                        {\n                            [field]: 1,\n                        },\n                        { unique: true, sparse: true }\n                    );\n                }\n            }\n        }\n    }\n\n    _initAutoremove() {\n        if (!this.linkConfig.autoremove) {\n            return;\n        }\n\n        if (!this.isVirtual()) {\n            this.mainCollection.after.remove((userId, doc) => {\n                this.getLinkedCollection().remove({\n                    _id: {\n                        $in: smartArguments.getIds(doc[this.linkStorageField]),\n                    },\n                });\n            });\n        } else {\n            this.mainCollection.after.remove((userId, doc) => {\n                const linker = this.mainCollection.getLink(doc, this.linkName);\n                const ids = linker\n                    .find({}, { fields: { _id: 1 } })\n                    .fetch()\n                    .map(item => item._id);\n\n                this.getLinkedCollection().remove({\n                    _id: { $in: ids },\n                });\n            });\n        }\n    }\n\n    /**\n     * Initializes denormalization using herteby:denormalize\n     * @private\n     */\n    _initDenormalization() {\n        if (!this.linkConfig.denormalize || !Meteor.isServer) {\n            return;\n        }\n\n        const packageExists = !!Package['herteby:denormalize'];\n        if (!packageExists) {\n            throw new Meteor.Error(\n                'missing-package',\n                `Please add the herteby:denormalize package to your Meteor application in order to make caching work`\n            );\n        }\n\n        const { field, body, bypassSchema } = this.linkConfig.denormalize;\n        let cacheConfig;\n\n        let referenceFieldSuffix = '';\n        if (this.isMeta()) {\n            referenceFieldSuffix = this.isSingle() ? '._id' : ':_id';\n        }\n\n        if (this.isVirtual()) {\n            let inversedLink = this.linkConfig.relatedLinker.linkConfig;\n\n            let type =\n                inversedLink.type == 'many' ? 'many-inverse' : 'inversed';\n\n            cacheConfig = {\n                type: type,\n                collection: this.linkConfig.collection,\n                fields: body,\n                referenceField: inversedLink.field + referenceFieldSuffix,\n                cacheField: field,\n                bypassSchema: !!bypassSchema,\n            };\n        } else {\n            cacheConfig = {\n                type: this.linkConfig.type,\n                collection: this.linkConfig.collection,\n                fields: body,\n                referenceField: this.linkConfig.field + referenceFieldSuffix,\n                cacheField: field,\n                bypassSchema: !!bypassSchema,\n            };\n        }\n\n        if (this.isVirtual()) {\n            Meteor.startup(() => {\n                this.mainCollection.cache(cacheConfig);\n            });\n        } else {\n            this.mainCollection.cache(cacheConfig);\n        }\n    }\n\n    /**\n     * Verifies if this linker is denormalized. It can be denormalized from the inverse side as well.\n     *\n     * @returns {boolean}\n     * @private\n     */\n    isDenormalized() {\n        return !!this.linkConfig.denormalize;\n    }\n\n    /**\n     * Verifies if the body of the linked element does not contain fields outside the cache body\n     *\n     * @param body\n     * @returns {boolean}\n     * @private\n     */\n    isSubBodyDenormalized(body) {\n        const cacheBody = this.linkConfig.denormalize.body;\n\n        const cacheBodyFields = _.keys(dot.dot(cacheBody));\n        const bodyFields = _.keys(dot.dot(_.omit(body, '_id')));\n\n        return _.difference(bodyFields, cacheBodyFields).length === 0;\n    }\n}\n","import sift from 'sift';\nimport dot from 'dot-object';\n\nexport default function createSearchFilters(object, fieldStorage, strategy, isVirtual, metaFilters) {\n    if (!isVirtual) {\n        switch (strategy) {\n            case 'one': return createOne(object, fieldStorage);\n            case 'one-meta': return createOneMeta(object, fieldStorage, metaFilters);\n            case 'many': return createMany(object, fieldStorage);\n            case 'many-meta': return createManyMeta(object, fieldStorage, metaFilters);\n            default:\n                throw new Meteor.Error(`Invalid linking strategy: ${strategy}`)\n        }\n    } else {\n        switch (strategy) {\n            case 'one': return createOneVirtual(object, fieldStorage);\n            case 'one-meta': return createOneMetaVirtual(object, fieldStorage, metaFilters);\n            case 'many': return createManyVirtual(object, fieldStorage);\n            case 'many-meta': return createManyMetaVirtual(object, fieldStorage, metaFilters);\n            default:\n                throw new Meteor.Error(`Invalid linking strategy: ${strategy}`)\n        }\n    }\n}\n\nexport function createOne(object, fieldStorage) {\n    return {\n        _id: dot.pick(fieldStorage, object)\n    };\n}\n\nexport function createOneVirtual(object, fieldStorage) {\n    return {\n        [fieldStorage]: object._id\n    };\n}\n\nexport function createOneMeta(object, fieldStorage, metaFilters) {\n    const value = object[fieldStorage];\n\n    if (metaFilters) {\n        if (!sift(metaFilters)(value)) {\n            return {_id: undefined};\n        }\n    }\n\n    return {\n        _id: value ? value._id : value\n    };\n}\n\nexport function createOneMetaVirtual(object, fieldStorage, metaFilters) {\n    let filters = {};\n    if (metaFilters) {\n        _.each(metaFilters, (value, key) => {\n            filters[fieldStorage + '.' + key] = value;\n        })\n    }\n\n    filters[fieldStorage + '._id'] = object._id;\n\n    return filters;\n}\n\nexport function createMany(object, fieldStorage) {\n    const [root, ...nested] = fieldStorage.split('.');\n    if (nested.length > 0) {\n        const arr = object[root];\n        const ids = arr ? _.uniq(_.union(arr.map(obj => _.isObject(obj) ? dot.pick(nested.join('.'), obj) : []))) : [];\n        return {\n            _id: {$in: ids}\n        };\n    }\n    return {\n        _id: {\n            $in: object[fieldStorage] || []\n        }\n    };\n}\n\nexport function createManyVirtual(object, fieldStorage) {\n    return {\n        [fieldStorage]: object._id\n    };\n}\n\nexport function createManyMeta(object, fieldStorage, metaFilters) {\n    let value = object[fieldStorage];\n\n    if (metaFilters) {\n        value = sift(metaFilters, value)\n    }\n\n    return {\n        _id: {\n            $in: _.pluck(value, '_id') || []\n        }\n    };\n}\n\nexport function createManyMetaVirtual(object, fieldStorage, metaFilters) {\n    let filters = {};\n    if (metaFilters) {\n        _.each(metaFilters, (value, key) => {\n            filters[key] = value;\n        })\n    }\n\n    filters._id = object._id;\n\n    return {\n        [fieldStorage]: {$elemMatch: filters}\n    };\n}","import SmartArgs from './lib/smartArguments.js';\nimport createSearchFilters from '../lib/createSearchFilters';\n\nexport default class Link {\n    get config() { return this.linker.linkConfig; }\n\n    get isVirtual() { return this.linker.isVirtual() }\n\n    constructor(linker, object, collection) {\n        this.linker = linker;\n        this.object = object;\n        this.linkedCollection = (collection) ? collection : linker.getLinkedCollection();\n\n        if (this.linker.isVirtual()) {\n            this.linkStorageField = this.config.relatedLinker.linkConfig.field;\n        } else {\n            this.linkStorageField = this.config.field;\n        }\n    }\n\n    /**\n     * Gets the stored link information value\n     * @returns {*}\n     */\n    value() {\n        if (this.isVirtual) {\n            throw new Meteor.Error('You can only take the value from the main link.');\n        }\n\n        return this.object[this.linkStorageField];\n    }\n\n    /**\n     * Finds linked data.\n     *\n     * @param filters\n     * @param options\n     * @returns {*}\n     * @param userId\n     */\n    find(filters = {}, options = {}, userId = undefined) {\n        let linker = this.linker;\n        const linkedCollection = this.linkedCollection;\n\n        let $metaFilters;\n        if (filters.$meta) {\n            $metaFilters = filters.$meta;\n            delete filters.$meta;\n        }\n\n        const searchFilters = createSearchFilters(\n            this.object,\n            this.linkStorageField,\n            linker.strategy,\n            linker.isVirtual(),\n            $metaFilters\n        );\n\n        let appliedFilters = _.extend({}, filters, searchFilters);\n\n        // see https://github.com/cult-of-coders/grapher/issues/134\n        // happens due to recursive importing of modules\n        // TODO: find another way to do this\n        if (linkedCollection.find) {\n            return linkedCollection.find(appliedFilters, options, userId)\n        } else {\n            return linkedCollection.default.find(appliedFilters, options, userId);\n        }\n    }\n\n    /**\n     * @param filters\n     * @param options\n     * @param others\n     * @returns {*|{content}|any}\n     */\n    fetch(filters, options, ...others) {\n        let result = this.find(filters, options, ...others).fetch();\n\n        if (this.linker.isOneResult()) {\n            return _.first(result);\n        }\n\n        return result;\n    }\n\n    /**\n     * This is just like fetch() but forces to get an array even if it's single result\n     * \n     * @param {*} filters \n     * @param {*} options \n     * @param  {...any} others \n     */\n    fetchAsArray(filters, options, ...others) {\n        return this.find(filters, options, ...others).fetch()\n    }\n\n    /**\n     * When we are dealing with multiple type relationships, $in would require an array. If the field value is null, it will fail\n     * We use clean to make it an empty array by default.\n     */\n    clean() {}\n\n    /**\n     * Extracts a single id\n     */\n    identifyId(what, saveToDatabase) {\n        return SmartArgs.getId(what, {\n            saveToDatabase,\n            collection: this.linkedCollection\n        });\n    }\n\n    /**\n     * Extracts the ids of object(s) or strings and returns an array.\n     */\n    identifyIds(what, saveToDatabase) {\n        return SmartArgs.getIds(what, {\n            saveToDatabase,\n            collection: this.linkedCollection\n        });\n    }\n\n    /**\n     * Checks when linking data, if the ids are valid with the linked collection.\n     * @throws Meteor.Error\n     * @param ids\n     *\n     * @protected\n     */\n    _validateIds(ids) {\n        if (!_.isArray(ids)) {\n            ids = [ids];\n        }\n\n        const validIds = this.linkedCollection.find({\n            _id: {$in: ids}\n        }, {fields: {_id: 1}}).fetch().map(doc => doc._id);\n\n        if (validIds.length != ids.length) {\n            throw new Meteor.Error('not-found', `You tried to create links with non-existing id(s) inside \"${this.linkedCollection._name}\": ${_.difference(ids, validIds).join(', ')}`)\n        }\n    }\n\n    _checkWhat(what) {\n        if (what === undefined || what === null) {\n            throw new Error(`The argument passed: ${what} is not accepted.`);\n        }\n    }\n\n    /**\n     * This is for allowing commands such as set/unset/add/remove/metadata from the virtual link.\n     *\n     * @param action\n     * @param what\n     * @param metadata\n     *\n     * @protected\n     */\n    _virtualAction(action, what, metadata) {\n        const linker = this.linker.linkConfig.relatedLinker;\n\n        // its an unset operation most likely.\n        if (what === undefined) {\n            const reversedLink = linker.createLink(this.fetch());\n            reversedLink.unset();\n\n            return;\n        }\n\n        if (!_.isArray(what)) {\n            what = [what];\n        }\n\n        what = _.map(what, element => {\n            if (!_.isObject(element)) {\n                return linker.mainCollection.findOne(element);\n            } else {\n                if (!element._id) {\n                    const elementId = linker.mainCollection.insert(element);\n                    _.extend(element, linker.mainCollection.findOne(elementId));\n                }\n\n                return element;\n            }\n        });\n\n        return _.map(what, element => {\n            const reversedLink = linker.createLink(element);\n\n            if (action == 'metadata') {\n                if (linker.isSingle()) {\n                    return reversedLink.metadata(metadata);\n                } else {\n                    return reversedLink.metadata(this.object, metadata);\n                }\n            } else if (action == 'add' || action == 'set') {\n                if (linker.isSingle()) {\n                    reversedLink.set(this.object, metadata);\n                } else {\n                    reversedLink.add(this.object, metadata);\n                }\n            } else {\n                if (linker.isSingle()) {\n                    reversedLink.unset();\n                } else {\n                    reversedLink.remove(this.object);\n                }\n            }\n        });\n    }\n}\n","import Link from './base.js';\nimport dot from 'dot-object';\nimport SmartArgs from './lib/smartArguments.js';\n\nexport default class LinkMany extends Link {\n    clean() {\n        if (!this.object[this.linkStorageField]) {\n            this.object[this.linkStorageField] = [];\n        }\n    }\n\n    /**\n     * Ads the _ids to the object.\n     * @param what\n     */\n    add(what) {\n        this._checkWhat(what);\n\n        if (this.isVirtual) {\n            this._virtualAction('add', what);\n            return this;\n        }\n\n        //if (this.isVirtual) throw new Meteor.Error('not-allowed', 'Add/remove operations must be done from the owning-link of the relationship');\n\n        this.clean();\n\n        const _ids = this.identifyIds(what, true);\n        this._validateIds(_ids);\n\n        const field = this.linkStorageField;\n\n        // update the field\n        this.object[field] = _.union(this.object[field], _ids);\n\n        // update the db\n        let modifier = {\n            $addToSet: {\n                [field]: {$each: _ids}\n            }\n        };\n\n        this.linker.mainCollection.update(this.object._id, modifier);\n\n        return this;\n    }\n\n    /**\n     * @param what\n     */\n    remove(what) {\n        this._checkWhat(what);\n\n        if (this.isVirtual) {\n            this._virtualAction('remove', what);\n            return this;\n        }\n\n        if (this.isVirtual) throw new Meteor.Error('not-allowed', 'Add/Remove operations should be done from the owner of the relationship');\n\n        this.clean();\n        const field = this.linkStorageField;\n        const [root, ...nested] = field.split('.');\n\n        const _ids = this.identifyIds(what);\n\n        // update the field\n        this.object[root] = _.filter(\n            this.object[root],\n    _id => !_.contains(_ids, nested.length > 0 ? dot.pick(nested.join('.'), _id) : _id)\n        );\n\n        // update the db\n        let modifier = {\n            $pull: {\n                [root]: nested.length > 0 ? {[nested.join('.')]: {$in: _ids}} : {$in: _ids},\n            },\n        };\n\n        this.linker.mainCollection.update(this.object._id, modifier);\n\n        return this;\n    }\n\n    set(what) {\n        this._checkWhat(what);\n\n        if (this.isVirtual) {\n            this._virtualAction('set', what);\n            return this;\n        }\n\n        throw new Meteor.Error('invalid-command', 'You are trying to *set* in a relationship that is single. Please use add/remove for *many* relationships');\n    }\n\n    unset(what) {\n        this._checkWhat(what);\n\n        if (this.isVirtual) {\n            this._virtualAction('unset', what);\n            return this;\n        }\n\n        throw new Meteor.Error('invalid-command', 'You are trying to *unset* in a relationship that is single. Please use add/remove for *many* relationships');\n    }\n}","import Link from './base.js';\nimport SmartArgs from './lib/smartArguments.js';\n\nexport default class LinkManyMeta extends Link {\n    clean() {\n        if (!this.object[this.linkStorageField]) {\n            this.object[this.linkStorageField] = [];\n        }\n    }\n\n    /**\n     * @param what\n     * @param metadata\n     */\n    add(what, metadata = {}) {\n        this._checkWhat(what);\n\n        if (this.isVirtual) {\n            this._virtualAction('add', what, metadata);\n            return this;\n        }\n\n        const _ids = this.identifyIds(what, true);\n        this._validateIds(_ids);\n\n        let field = this.linkStorageField;\n\n        this.object[field] = this.object[field] || [];\n        let metadatas = [];\n\n        _.each(_ids, _id => {\n            let localMetadata = _.clone(metadata);\n            localMetadata._id = _id;\n\n            this.object[field].push(localMetadata);\n            metadatas.push(localMetadata);\n        });\n\n        let modifier = {\n            $addToSet: {\n                [field]: {$each: metadatas}\n            }\n        };\n\n        this.linker.mainCollection.update(this.object._id, modifier);\n\n        return this;\n    }\n\n    /**\n     * @param what\n     * @param extendMetadata\n     */\n    metadata(what, extendMetadata) {\n        if (this.isVirtual) {\n            this._virtualAction('metadata', what, extendMetadata);\n\n            return this;\n        }\n\n        let field = this.linkStorageField;\n\n        if (what === undefined) {\n            return this.object[field];\n        }\n\n        if (_.isArray(what)) {\n            throw new Meteor.Error('not-allowed', 'Metadata updates should be made for one entity only, not multiple');\n        }\n\n        const _id = this.identifyId(what);\n\n        let existingMetadata = _.find(this.object[field], metadata => metadata._id == _id);\n        if (extendMetadata === undefined) {\n            return existingMetadata;\n        } else {\n            _.extend(existingMetadata, extendMetadata);\n            let subfield = field + '._id';\n            let subfieldUpdate = field + '.$';\n\n            this.linker.mainCollection.update({\n                _id: this.object._id,\n                [subfield]: _id\n            }, {\n               $set: {\n                   [subfieldUpdate]: existingMetadata\n               }\n            });\n        }\n\n        return this;\n    }\n\n    remove(what) {\n        this._checkWhat(what);\n\n        if (this.isVirtual) {\n            this._virtualAction('remove', what);\n            return this;\n        }\n\n        const _ids = this.identifyIds(what);\n        let field = this.linkStorageField;\n\n        this.object[field] = _.filter(this.object[field], link => !_.contains(_ids, link._id));\n\n        let modifier = {\n            $pull: {\n                [field]: {\n                    _id: {\n                        $in: _ids\n                    }\n                }\n            }\n        };\n\n        this.linker.mainCollection.update(this.object._id, modifier);\n\n        return this;\n    }\n\n    set(what, metadata) {\n        this._checkWhat(what);\n\n        if (this.isVirtual) {\n            this._virtualAction('set', what, metadata);\n            return this;\n        }\n\n        throw new Meteor.Error('invalid-command', 'You are trying to *set* in a relationship that is single. Please use add/remove for *many* relationships');\n    }\n\n    unset(what) {\n        this._checkWhat(what);\n\n        if (this.isVirtual) {\n            this._virtualAction('unset', what);\n            return this;\n        }\n\n        throw new Meteor.Error('invalid-command', 'You are trying to *unset* in a relationship that is single. Please use add/remove for *many* relationships');\n    }\n}","import Link from './base.js';\nimport SmartArgs from './lib/smartArguments.js';\n\nexport default class LinkOne extends Link {\n    set(what) {\n        this._checkWhat(what);\n\n        if (this.isVirtual) {\n            this._virtualAction('set', what);\n            return this;\n        }\n\n        let field = this.linkStorageField;\n        const _id = this.identifyId(what, true);\n        this._validateIds([_id]);\n\n        this.object[field] = _id;\n\n        this.linker.mainCollection.update(this.object._id, {\n            $set: {\n                [field]: _id\n            }\n        });\n\n        return this;\n    }\n\n    unset() {\n        if (this.isVirtual) {\n            this._virtualAction('unset', what);\n            return this;\n        }\n\n        let field = this.linkStorageField;\n        this.object[field] = null;\n\n        this.linker.mainCollection.update(this.object._id, {\n            $set: {\n                [field]: null\n            }\n        });\n\n        return this;\n    }\n\n    add(what) {\n        this._checkWhat(what);\n\n        if (this.isVirtual) {\n            this._virtualAction('add', what);\n            return this;\n        }\n\n        throw new Meteor.Error('invalid-command', 'You are trying to *add* in a relationship that is single. Please use set/unset for *single* relationships');\n    }\n\n    remove(what) {\n        this._checkWhat(what);\n\n        if (this.isVirtual) {\n            this._virtualAction('remove', what);\n            return this;\n        }\n\n        throw new Meteor.Error('invalid-command', 'You are trying to *remove* in a relationship that is single. Please use set/unset for *single* relationships');\n    }\n}","import Link from './base.js';\nimport SmartArgs from './lib/smartArguments.js';\n\nexport default class LinkOneMeta extends Link {\n    set(what, metadata = {}) {\n        this._checkWhat(what);\n\n        metadata = Object.assign({}, metadata);\n        \n        if (this.isVirtual) {\n            this._virtualAction('set', what, metadata);\n            return this;\n        }\n\n        let field = this.linkStorageField;\n        metadata._id = this.identifyId(what, true);\n        this._validateIds([metadata._id]);\n\n        this.object[field] = metadata;\n\n        this.linker.mainCollection.update(this.object._id, {\n            $set: {\n                [field]: metadata\n            }\n        });\n\n        return this;\n    }\n\n    metadata(extendMetadata) {\n        if (this.isVirtual) {\n            this._virtualAction('metadata', undefined, extendMetadata);\n\n            return this;\n        }\n\n        let field = this.linkStorageField;\n\n        if (!extendMetadata) {\n            return this.object[field];\n        } else {\n            _.extend(this.object[field], extendMetadata);\n\n            this.linker.mainCollection.update(this.object._id, {\n                $set: {\n                    [field]: this.object[field]\n                }\n            });\n        }\n\n        return this;\n    }\n\n    unset() {\n        if (this.isVirtual) {\n            this._virtualAction('unset');\n            return this;\n        }\n\n        let field = this.linkStorageField;\n        this.object[field] = {};\n\n        this.linker.mainCollection.update(this.object._id, {\n            $set: {\n                [field]: {}\n            }\n        });\n\n        return this;\n    }\n\n    add(what, metadata) {\n        this._checkWhat(what);\n\n        if (this.isVirtual) {\n            this._virtualAction('add', what, metadata);\n            return this;\n        }\n\n        throw new Meteor.Error('invalid-command', 'You are trying to *add* in a relationship that is single. Please use set/unset for *single* relationships');\n    }\n\n    remove(what) {\n        this._checkWhat(what);\n\n        if (this.isVirtual) {\n            this._virtualAction('remove', what);\n            return this;\n        }\n\n        throw new Meteor.Error('invalid-command', 'You are trying to *remove* in a relationship that is single. Please use set/unset for *single* relationships');\n    }\n}","/**\n * When you work with add/remove set/unset\n * You have the ability to pass strings, array of strings, objects, array of objects\n * If you are adding something and you want to save them in db, you can pass objects without ids.\n */\nexport default new class {\n    getIds(what, options) {\n        if (_.isArray(what)) {\n            return _.map(what, (subWhat) => {\n                return this.getId(subWhat, options)\n            })\n        } else {\n            return [this.getId(what, options)];\n        }\n\n        throw new Meteor.Error('invalid-type', `Unrecognized type: ${typeof what} for managing links`);\n    }\n\n    getId(what, options) {\n        if (typeof what === 'string') {\n            return what;\n        }\n\n        if (typeof what === 'object') {\n            if (!what._id && options.saveToDatabase) {\n                what._id = options.collection.insert(what);\n            }\n\n            return what._id\n        }\n    }\n}","import deepClone from 'lodash.clonedeep';\n\nlet globalConfig = {};\n\nexport default class NamedQueryBase {\n    static setConfig(config) {\n        globalConfig = config;\n    }\n\n    static getConfig() {\n        return globalConfig;\n    }\n\n    isNamedQuery = true;\n\n    constructor(name, collection, body, options = {}) {\n        this.queryName = name;\n\n        if (_.isFunction(body)) {\n            this.resolver = body;\n        } else {\n            this.body = deepClone(body);\n        }\n\n        this.subscriptionHandle = null;\n        this.params = options.params || {};\n        this.options = Object.assign({}, globalConfig, options);\n        this.collection = collection;\n        this.isExposed = false;\n    }\n\n    get name() {\n        return `named_query_${this.queryName}`;\n    }\n\n    get isResolver() {\n        return !!this.resolver;\n    }\n\n    setParams(params) {\n        this.params = _.extend({}, this.params, params);\n\n        return this;\n    }\n\n    /**\n     * Validates the parameters\n     */\n    doValidateParams(params) {\n        params = params || this.params;\n\n        const {validateParams} = this.options;\n        if (!validateParams) return;\n\n        try {\n            this._validate(validateParams, params);\n        } catch (validationError) {\n            console.error(`Invalid parameters supplied to the query \"${this.queryName}\"\\n`, validationError);\n            throw validationError; // rethrow\n        }\n    }\n\n    clone(newParams) {\n        const params = _.extend({}, deepClone(this.params), newParams);\n\n        let clone = new this.constructor(\n            this.queryName,\n            this.collection,\n            this.isResolver ? this.resolver : deepClone(this.body),\n            {\n                ...this.options,\n                params,\n            }\n        );\n\n        clone.cacher = this.cacher;\n        if (this.exposeConfig) {\n            clone.exposeConfig = this.exposeConfig;\n        }\n\n        return clone;\n    }\n\n    /**\n     * @param {function|object} validator\n     * @param {object} params\n     * @private\n     */\n    _validate(validator, params) {\n        if (_.isFunction(validator)) {\n            validator.call(null, params)\n        } else {\n            check(params, validator)\n        }\n    }\n}\n\nNamedQueryBase.defaultOptions = {};","import CountSubscription from '../query/counts/countSubscription';\nimport createGraph from '../query/lib/createGraph.js';\nimport recursiveFetch from '../query/lib/recursiveFetch.js';\nimport prepareForProcess from '../query/lib/prepareForProcess.js';\nimport {_} from 'meteor/underscore';\nimport callWithPromise from '../query/lib/callWithPromise';\nimport Base from './namedQuery.base';\nimport {LocalCollection} from 'meteor/minimongo';\nimport intersectDeep from '../query/lib/intersectDeep';\n\nexport default class extends Base {\n    /**\n     * Subscribe\n     *\n     * @param callback\n     * @returns {null|any|*}\n     */\n    subscribe(callback) {\n        if (this.isResolver) {\n            throw new Meteor.Error('not-allowed', `You cannot subscribe to a resolver query`);\n        }\n\n        this.subscriptionHandle = Meteor.subscribe(\n            this.name,\n            this.params,\n            callback\n        );\n\n        return this.subscriptionHandle;\n    }\n\n    /**\n     * Subscribe to the counts for this query\n     *\n     * @param callback\n     * @returns {Object}\n     */\n    subscribeCount(callback) {\n        if (this.isResolver) {\n            throw new Meteor.Error('not-allowed', `You cannot subscribe to a resolver query`);\n        }\n\n        if (!this._counter) {\n            this._counter = new CountSubscription(this);\n        }\n\n        return this._counter.subscribe(this.params, callback);\n    }\n\n    /**\n     * Unsubscribe if an existing subscription exists\n     */\n    unsubscribe() {\n        if (this.subscriptionHandle) {\n            this.subscriptionHandle.stop();\n        }\n\n        this.subscriptionHandle = null;\n    }\n\n    /**\n     * Unsubscribe to the counts if a subscription exists.\n     */\n    unsubscribeCount() {\n        if (this._counter) {\n            this._counter.unsubscribe();\n            this._counter = null;\n        }\n    }\n\n    /**\n     * Fetches elements in sync using promises\n     * @return {*}\n     */\n    async fetchSync() {\n        if (this.subscriptionHandle) {\n            throw new Meteor.Error('This query is reactive, meaning you cannot use promises to fetch the data.');\n        }\n\n        return await callWithPromise(this.name, this.params);\n    }\n\n    /**\n     * Fetches one element in sync\n     * @return {*}\n     */\n    async fetchOneSync() {\n        return _.first(await this.fetchSync())\n    }\n\n    /**\n     * Retrieves the data.\n     * @param callbackOrOptions\n     * @returns {*}\n     */\n    fetch(callbackOrOptions) {\n        if (!this.subscriptionHandle) {\n            return this._fetchStatic(callbackOrOptions)\n        } else {\n            return this._fetchReactive(callbackOrOptions);\n        }\n    }\n\n    /**\n     * @param args\n     * @returns {*}\n     */\n    fetchOne(...args) {\n        if (!this.subscriptionHandle) {\n            const callback = args[0];\n            if (!_.isFunction(callback)) {\n                throw new Meteor.Error('You did not provide a valid callback');\n            }\n\n            this.fetch((err, res) => {\n                callback(err, res ? _.first(res) : null);\n            })\n        } else {\n            return _.first(this.fetch(...args));\n        }\n    }\n\n    /**\n     * Gets the count of matching elements in sync.\n     * @returns {any}\n     */\n    async getCountSync() {\n        if (this._counter) {\n            throw new Meteor.Error('This query is reactive, meaning you cannot use promises to fetch the data.');\n        }\n\n        return await callWithPromise(this.name + '.count', this.params);\n    }\n\n    /**\n     * Gets the count of matching elements.\n     * @param callback\n     * @returns {any}\n     */\n    getCount(callback) {\n        if (this._counter) {\n            return this._counter.getCount();\n        } else {\n            if (!callback) {\n                throw new Meteor.Error('not-allowed', 'You are on client so you must either provide a callback to get the count or subscribe first.');\n            } else {\n                return Meteor.call(this.name + '.count', this.params, callback);\n            }\n        }\n    }\n\n    /**\n     * Fetching non-reactive queries\n     * @param callback\n     * @private\n     */\n    _fetchStatic(callback) {\n        if (!callback) {\n            throw new Meteor.Error('not-allowed', 'You are on client so you must either provide a callback to get the data or subscribe first.');\n        }\n\n        Meteor.call(this.name, this.params, callback);\n    }\n\n    /**\n     * Fetching when we've got an active publication\n     *\n     * @param options\n     * @returns {*}\n     * @private\n     */\n    _fetchReactive(options = {}) {\n        let body = this.body;\n        if (this.params.$body) {\n            body = intersectDeep(body, this.params.$body);\n        }\n\n        body = prepareForProcess(body, this.params);\n        if (!options.allowSkip && body.$options && body.$options.skip) {\n            delete body.$options.skip;\n        }\n\n        return recursiveFetch(\n            createGraph(this.collection, body),\n            undefined, {\n                scoped: this.options.scoped,\n                subscriptionHandle: this.subscriptionHandle\n            });\n    }\n}\n","import NamedQueryClient from './namedQuery.client';\nimport NamedQueryServer from './namedQuery.server';\n\nlet NamedQuery;\n\nif (Meteor.isServer) {\n    NamedQuery = NamedQueryServer;\n} else {\n    NamedQuery = NamedQueryClient;\n}\n\nexport default NamedQuery;","import prepareForProcess from '../query/lib/prepareForProcess.js';\nimport Base from './namedQuery.base';\nimport deepClone from 'lodash.clonedeep';\nimport MemoryResultCacher from './cache/MemoryResultCacher';\nimport intersectDeep from '../query/lib/intersectDeep';\n\nexport default class extends Base {\n    /**\n     * Retrieves the data.\n     * @returns {*}\n     */\n    fetch(context) {\n        this._performSecurityChecks(context, this.params);\n\n        if (this.isResolver) {\n            return this._fetchResolverData(context);\n        } else {\n            body = deepClone(this.body);\n            if (this.params.$body) {\n                body = intersectDeep(body, this.params.$body);\n            }\n            \n            // we must apply emobdyment here\n            this.doEmbodimentIfItApplies(body, this.params);\n\n            const query = this.collection.createQuery(\n                deepClone(body),\n                {\n                    params: deepClone(this.params)\n                }\n            );\n\n            if (this.cacher) {\n                const cacheId = this.cacher.generateQueryId(this.queryName, this.params);\n                return this.cacher.fetch(cacheId, {query});\n            }\n\n            return query.fetch();\n        }\n    }\n\n    /**\n     * @param args\n     * @returns {*}\n     */\n    fetchOne(...args) {\n        return _.first(this.fetch(...args));\n    }\n\n    /**\n     * Gets the count of matching elements.\n     *\n     * @returns {any}\n     */\n    getCount(context) {\n        this._performSecurityChecks(context, this.params);\n\n        const countCursor = this.getCursorForCounting();\n\n        if (this.cacher) {\n            const cacheId = 'count::' + this.cacher.generateQueryId(this.queryName, this.params);\n\n            return this.cacher.fetch(cacheId, {countCursor});\n        }\n\n        return countCursor.count();\n    }\n\n    /**\n     * Returns the cursor for counting\n     * This is most likely used for counts cursor\n     */\n    getCursorForCounting() {\n        let body = deepClone(this.body);\n        this.doEmbodimentIfItApplies(body, this.params);\n        body = prepareForProcess(body, this.params);\n\n        return this.collection.find(body.$filters || {}, {fields: {_id: 1}});\n    }\n\n    /**\n     * @param cacher\n     */\n    cacheResults(cacher) {\n        if (!cacher) {\n            cacher = new MemoryResultCacher();\n        }\n\n        this.cacher = cacher;\n    }\n\n    /**\n     * Configure resolve. This doesn't actually call the resolver, it just sets it\n     * @param fn\n     */\n    resolve(fn) {\n        if (!this.isResolver) {\n            throw new Meteor.Error('invalid-call', `You cannot use resolve() on a non resolver NamedQuery`);\n        }\n\n        this.resolver = fn;\n    }\n\n    /**\n     * @returns {*}\n     * @private\n     */\n    _fetchResolverData(context) {\n        const resolver = this.resolver;\n        const self = this;\n        const query = {\n            fetch() {\n                return resolver.call(context, self.params);\n            }\n        };\n\n        if (this.cacher) {\n            const cacheId = this.cacher.generateQueryId(this.queryName, this.params);\n            return this.cacher.fetch(cacheId, {query});\n        }\n\n        return query.fetch();\n    }\n\n    /**\n     * @param context Meteor method/publish context\n     * @param params\n     *\n     * @private\n     */\n    _performSecurityChecks(context, params) {\n        if (context && this.exposeConfig) {\n            this._callFirewall(context, context.userId, params);\n        }\n\n        this.doValidateParams(params);\n    }\n}\n","export default new class {\n    constructor() {\n        this.storage = {};\n    }\n\n    add(key, value) {\n        if (this.storage[key]) {\n            throw new Meteor.Error('invalid-name', `You have previously defined another namedQuery with the same name: \"${key}\". Named Query names should be unique.`);\n        }\n\n        this.storage[key] = value;\n    }\n\n    get(key) {\n        return this.storage[key];\n    }\n\n    getAll() {\n        return this.storage;\n    }\n}","import {EJSON} from 'meteor/ejson';\n\n/**\n * This is a very basic in-memory result caching functionality\n */\nexport default class BaseResultCacher {\n    constructor(config = {}) {\n        this.config = config;\n    }\n\n    /**\n     * @param queryName\n     * @param params\n     * @returns {string}\n     */\n    generateQueryId(queryName, params) {\n        return `${queryName}::${EJSON.stringify(params)}`;\n    }\n\n    /**\n     * Dummy function\n     */\n    fetch(cacheId, {query, countCursor}) {\n        throw 'Not implemented';\n    }\n\n    /**\n     * @param query\n     * @param countCursor\n     * @returns {*}\n     */\n    static fetchData({query, countCursor}) {\n        if (query) {\n            return query.fetch();\n        } else {\n            return countCursor.count();\n        }\n    }\n}\n","import {Meteor} from 'meteor/meteor';\nimport cloneDeep from 'lodash.clonedeep';\nimport BaseResultCacher from './BaseResultCacher';\n\nconst DEFAULT_TTL = 60000;\n\n/**\n * This is a very basic in-memory result caching functionality\n */\nexport default class MemoryResultCacher extends BaseResultCacher {\n    constructor(config = {}) {\n        super(config);\n        this.store = {};\n    }\n\n    /**\n     * @param cacheId\n     * @param query\n     * @param countCursor\n     * @returns {*}\n     */\n    fetch(cacheId, {query, countCursor}) {\n        const cacheData = this.store[cacheId];\n        if (cacheData !== undefined) {\n            return cloneDeep(cacheData);\n        }\n\n        const data = BaseResultCacher.fetchData({query, countCursor});\n        this.storeData(cacheId, data);\n\n        return data;\n    }\n\n\n    /**\n     * @param cacheId\n     * @param data\n     */\n    storeData(cacheId, data) {\n        const ttl = this.config.ttl || DEFAULT_TTL;\n        this.store[cacheId] = cloneDeep(data);\n\n        Meteor.setTimeout(() => {\n            delete this.store[cacheId];\n        }, ttl)\n    }\n}\n","import deepClone from 'lodash.clonedeep';\nimport {check} from 'meteor/check';\n\nexport default class QueryBase {\n    isGlobalQuery = true;\n\n    constructor(collection, body, options = {}) {\n        this.collection = collection;\n\n        this.body = deepClone(body);\n\n        this.params = options.params || {};\n        this.options = options;\n    }\n\n    clone(newParams) {\n        const params = _.extend({}, deepClone(this.params), newParams);\n\n        return new this.constructor(\n            this.collection,\n            deepClone(this.body),\n            {\n                params,\n                ...this.options\n            }\n        );\n    }\n\n    get name() {\n        return `exposure_${this.collection._name}`;\n    }\n\n    /**\n     * Validates the parameters\n     */\n    doValidateParams() {\n        const {validateParams} = this.options;\n        if (!validateParams) return;\n\n        if (_.isFunction(validateParams)) {\n            validateParams.call(null, this.params)\n        } else {\n            check(this.params)\n        }\n    }\n\n    /**\n     * Merges the params with previous params.\n     *\n     * @param params\n     * @returns {Query}\n     */\n    setParams(params) {\n        this.params = _.extend({}, this.params, params);\n\n        return this;\n    }\n}","import { _ } from 'meteor/underscore';\nimport CountSubscription from './counts/countSubscription';\nimport createGraph from './lib/createGraph.js';\nimport recursiveFetch from './lib/recursiveFetch.js';\nimport prepareForProcess from './lib/prepareForProcess.js';\nimport callWithPromise from './lib/callWithPromise';\nimport Base from './query.base';\n\nexport default class Query extends Base {\n    /**\n     * Subscribe\n     *\n     * @param callback {Function} optional\n     * @returns {null|any|*}\n     */\n    subscribe(callback) {\n        this.doValidateParams();\n\n        this.subscriptionHandle = Meteor.subscribe(\n            this.name,\n            prepareForProcess(this.body, this.params),\n            callback\n        );\n\n        return this.subscriptionHandle;\n    }\n\n    /**\n     * Subscribe to the counts for this query\n     *\n     * @param callback\n     * @returns {Object}\n     */\n    subscribeCount(callback) {\n        this.doValidateParams();\n\n        if (!this._counter) {\n            this._counter = new CountSubscription(this);\n        }\n\n        return this._counter.subscribe(\n            prepareForProcess(this.body, this.params),\n            callback\n        );\n    }\n\n    /**\n     * Unsubscribe if an existing subscription exists\n     */\n    unsubscribe() {\n        if (this.subscriptionHandle) {\n            this.subscriptionHandle.stop();\n        }\n\n        this.subscriptionHandle = null;\n    }\n\n    /**\n     * Unsubscribe to the counts if a subscription exists.\n     */\n    unsubscribeCount() {\n        if (this._counter) {\n            this._counter.unsubscribe();\n            this._counter = null;\n        }\n    }\n\n    /**\n     * Fetches elements in sync using promises\n     * @return {*}\n     */\n    async fetchSync() {\n        this.doValidateParams();\n\n        if (this.subscriptionHandle) {\n            throw new Meteor.Error('This query is reactive, meaning you cannot use promises to fetch the data.');\n        }\n\n        return await callWithPromise(this.name, prepareForProcess(this.body, this.params));\n    }\n\n    /**\n     * Fetches one element in sync\n     * @return {*}\n     */\n    async fetchOneSync() {\n        return _.first(await this.fetchSync())\n    }\n\n    /**\n     * Retrieves the data.\n     * @param callbackOrOptions\n     * @returns {*}\n     */\n    fetch(callbackOrOptions) {\n        this.doValidateParams();\n\n        if (!this.subscriptionHandle) {\n            return this._fetchStatic(callbackOrOptions)\n        } else {\n            return this._fetchReactive(callbackOrOptions);\n        }\n    }\n\n    /**\n     * @param args\n     * @returns {*}\n     */\n    fetchOne(...args) {\n        if (!this.subscriptionHandle) {\n            const callback = args[0];\n            if (!_.isFunction(callback)) {\n                throw new Meteor.Error('You did not provide a valid callback');\n            }\n\n            this.fetch((err, res) => {\n                callback(err, res ? _.first(res) : null);\n            })\n        } else {\n            return _.first(this.fetch(...args));\n        }\n    }\n\n    /**\n     * Gets the count of matching elements in sync.\n     * @returns {any}\n     */\n    async getCountSync() {\n        if (this._counter) {\n            throw new Meteor.Error('This query is reactive, meaning you cannot use promises to fetch the data.');\n        }\n\n        return await callWithPromise(this.name + '.count', prepareForProcess(this.body, this.params));\n    }\n\n    /**\n     * Gets the count of matching elements.\n     * @param callback\n     * @returns {any}\n     */\n    getCount(callback) {\n        if (this._counter) {\n            return this._counter.getCount();\n        } else {\n            if (!callback) {\n                throw new Meteor.Error('not-allowed', 'You are on client so you must either provide a callback to get the count or subscribe first.');\n            } else {\n                return Meteor.call(\n                    this.name + '.count',\n                    prepareForProcess(this.body, this.params),\n                    callback\n                );\n            }\n        }\n    }\n\n    /**\n     * Fetching non-reactive queries\n     * @param callback\n     * @private\n     */\n    _fetchStatic(callback) {\n        if (!callback) {\n            throw new Meteor.Error('not-allowed', 'You are on client so you must either provide a callback to get the data or subscribe first.');\n        }\n\n        Meteor.call(this.name, prepareForProcess(this.body, this.params), callback);\n    }\n\n    /**\n     * Fetching when we've got an active publication\n     *\n     * @param options\n     * @returns {*}\n     * @private\n     */\n    _fetchReactive(options = {}) {\n        let body = prepareForProcess(this.body, this.params);\n        if (!options.allowSkip && body.$options && body.$options.skip) {\n            delete body.$options.skip;\n        }\n\n        return recursiveFetch(\n            createGraph(this.collection, body),\n            this.params\n        );\n    }\n}\n","import QueryClient from './query.client';\nimport QueryServer from './query.server';\n\nlet Query;\n\nif (Meteor.isServer) {\n    Query = QueryServer;\n} else {\n    Query = QueryClient;\n}\n\nexport default Query;","import createGraph from './lib/createGraph.js';\nimport prepareForProcess from './lib/prepareForProcess.js';\nimport hypernova from './hypernova/hypernova.js';\nimport Base from './query.base';\n\nexport default class Query extends Base {\n    /**\n     * Retrieves the data.\n     * @param context\n     * @returns {*}\n     */\n    fetch(context = {}) {\n        const node = createGraph(\n            this.collection,\n            prepareForProcess(this.body, this.params)\n        );\n\n        return hypernova(node, context.userId, {params: this.params});\n    }\n\n    /**\n     * @param args\n     * @returns {*}\n     */\n    fetchOne(...args) {\n        return _.first(this.fetch(...args));\n    }\n\n    /**\n     * Gets the count of matching elements.\n     * @returns {integer}\n     */\n    getCount() {\n        return this.collection.find(this.body.$filters || {}, {}).count();\n    }\n}","import { Mongo } from 'meteor/mongo';\nimport { COUNTS_COLLECTION_CLIENT } from './constants';\n\n/**\n * Internal collection used to store counts on the client.\n */\nexport default new Mongo.Collection(COUNTS_COLLECTION_CLIENT);\n","export const COUNTS_COLLECTION_CLIENT = 'grapher_counts';\n","import { EJSON } from 'meteor/ejson';\nimport { Meteor } from 'meteor/meteor';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport { Tracker } from 'meteor/tracker';\n\nimport Counts from './collection';\nimport createFauxSubscription from './createFauxSubscription';\nimport prepareForProcess from '../lib/prepareForProcess.js';\nimport NamedQueryBase from '../../namedQuery/namedQuery.base';\n\nexport default class CountSubscription {\n    /**\n     * @param {*} query - The query to use when fetching counts\n     */\n    constructor(query) {\n        this.accessToken = new ReactiveVar(null);\n        this.fauxHandle = null;\n        this.query = query;\n    }\n\n    /**\n     * Starts a subscription request for reactive counts.\n     *\n     * @param {*} arg - The argument to pass to {name}.count.subscribe\n     * @param {*} callback\n     */\n    subscribe(arg, callback) {\n        // Don't try to resubscribe if arg hasn't changed\n        if (EJSON.equals(this.lastArgs, arg) && this.fauxHandle) {\n            return this.fauxHandle;\n        }\n\n        this.accessToken.set(null);\n        this.lastArgs = arg;\n\n        Meteor.call(this.query.name + '.count.subscribe', arg, (error, token) => {\n            if (!this._markedForUnsubscribe) {\n                this.subscriptionHandle = Meteor.subscribe(this.query.name + '.count', token, callback);\n                this.accessToken.set(token);\n\n                this.disconnectComputation = Tracker.autorun(() => this.handleDisconnect());\n            }\n\n            this._markedForUnsubscribe = false;\n        });\n\n        this.fauxHandle = createFauxSubscription(this);\n        return this.fauxHandle;\n    }\n\n    /**\n     * Unsubscribes from the count endpoint, if there is such a subscription.\n     */\n    unsubscribe() {\n        if (this.subscriptionHandle) {\n            this.disconnectComputation.stop();\n            this.subscriptionHandle.stop();\n        } else {\n            // If we hit this branch, then Meteor.call in subscribe hasn't finished yet\n            // so set a flag to stop the subscription from being created\n            this._markedForUnsubscribe = true;\n        }\n\n        this.accessToken.set(null);\n        this.fauxHandle = null;\n        this.subscriptionHandle = null;\n    }\n\n    /**\n     * Reactively fetch current document count. Returns null if the subscription is not ready yet.\n     *\n     * @returns {Number|null} - Current document count\n     */\n    getCount() {\n        const id = this.accessToken.get();\n        if (id === null) return null;\n\n        const doc = Counts.findOne(id);\n        return doc.count;\n    }\n\n    /**\n     * All session info gets deleted when the server goes down, so when the client attempts to\n     * optimistically resume the '.count' publication, the server will throw a 'no-request' error.\n     *\n     * This function prevents that by manually stopping and restarting the subscription when the\n     * connection to the server is lost.\n     */\n    handleDisconnect() {\n        const status = Meteor.status();\n        if (!status.connected) {\n            this._markedForResume = true;\n            this.fauxHandle = null;\n            this.subscriptionHandle.stop();\n        }\n\n        if (status.connected && this._markedForResume) {\n            this._markedForResume = false;\n            this.subscribe(this.lastArgs);\n        }\n    }\n\n    /**\n     * Returns whether or not a subscription request has been made.\n     */\n    isSubscribed() {\n        return this.accessToken.get() !== null;\n    }\n}\n","/**\n * This method creates a \"fake\" subscription handle so that users of CountSubscription#subscribe\n * have an interface consistent with normal subscriptions.\n *\n * @param {CountSubscription} countManager\n */\nexport default (countManager) => ({\n    ready: () => countManager.accessToken.get() !== null && countManager.subscriptionHandle.ready(),\n    stop: () => countManager.unsubscribe(),\n});\n","import sift from 'sift';\nimport dot from 'dot-object';\n\nfunction extractIdsFromArray(array, field) {\n    return (array || []).map(obj => _.isObject(obj) ? dot.pick(field, obj) : undefined).filter(v => !!v);\n}\n\n/**\n * Its purpose is to create filters to get the related data in one request.\n */\nexport default class AggregateFilters {\n    constructor(collectionNode, metaFilters) {\n        this.collectionNode = collectionNode;\n        this.linker = collectionNode.linker;\n        this.metaFilters = metaFilters;\n        this.isVirtual = this.linker.isVirtual();\n\n        this.linkStorageField = this.linker.linkStorageField;\n    }\n\n    get parentObjects() {\n        return this.collectionNode.parent.results;\n    }\n\n    create() {\n        switch (this.linker.strategy) {\n            case 'one':\n                return this.createOne();\n            case 'one-meta':\n                return this.createOneMeta();\n            case 'many':\n                return this.createMany();\n            case 'many-meta':\n                return this.createManyMeta();\n            default:\n                throw new Meteor.Error(`Invalid linker type: ${this.linker.type}`);\n        }\n    }\n\n    createOne() {\n        if (!this.isVirtual) {\n            return {\n                _id: {\n                    $in: _.uniq(extractIdsFromArray(this.parentObjects, this.linkStorageField))\n                }\n            };\n        } else {\n            return {\n                [this.linkStorageField]: {\n                    $in: _.uniq(\n                        _.pluck(this.parentObjects, '_id')\n                    )\n                }\n            };\n        }\n    }\n\n    createOneMeta() {\n        if (!this.isVirtual) {\n            let eligibleObjects = this.parentObjects;\n\n            if (this.metaFilters) {\n                eligibleObjects = _.filter(this.parentObjects, object => {\n                    return sift(this.metaFilters)(object[this.linkStorageField]);\n                });\n            }\n\n            const storages = _.pluck(eligibleObjects, this.linkStorageField);\n            let ids = [];\n            _.each(storages, storage => {\n                if (storage) {\n                    ids.push(storage._id);\n                }\n            });\n\n            return {\n                _id: {$in: _.uniq(ids)}\n            };\n        } else {\n            let filters = {};\n            if (this.metaFilters) {\n                _.each(this.metaFilters, (value, key) => {\n                    filters[this.linkStorageField + '.' + key] = value;\n                })\n            }\n\n            filters[this.linkStorageField + '._id'] = {\n                $in: _.uniq(\n                    _.pluck(this.parentObjects, '_id')\n                )\n            };\n\n            return filters;\n        }\n    }\n\n    createMany() {\n        if (!this.isVirtual) {\n            const [root, ...nested] = this.linkStorageField.split('.');\n            const arrayOfIds = _.union(...extractIdsFromArray(this.parentObjects, root));\n            return {\n                _id: {\n                    $in: _.uniq(nested.length > 0 ? extractIdsFromArray(arrayOfIds, nested.join('.')) : arrayOfIds)\n                }\n            };\n        } else {\n            const arrayOfIds = _.pluck(this.parentObjects, '_id');\n            return {\n                [this.linkStorageField]: {\n                    $in: _.uniq(\n                        _.union(...arrayOfIds)\n                    )\n                }\n            };\n        }\n    }\n\n    createManyMeta() {\n        if (!this.isVirtual) {\n            let ids = [];\n\n            _.each(this.parentObjects, object => {\n                if (object[this.linkStorageField]) {\n                    if (this.metaFilters) {\n                        const isValid = sift(this.metaFilters);\n                        _.each(object[this.linkStorageField], object => {\n                            if (isValid(object)) {\n                                ids.push(object._id);\n                            }\n                        });\n                    } else {\n                        _.each(object[this.linkStorageField], object => {\n                            ids.push(object._id);\n                        });\n                    }\n                }\n            });\n\n            return {\n                _id: {$in: _.uniq(ids)}\n            };\n        } else {\n            let filters = {};\n            if (this.metaFilters) {\n                _.each(this.metaFilters, (value, key) => {\n                    filters[key] = value;\n                })\n            }\n\n            filters._id = {\n                $in: _.uniq(\n                    _.pluck(this.parentObjects, '_id')\n                )\n            };\n\n            return {\n                [this.linkStorageField]: {\n                    $elemMatch: filters\n                }\n            };\n        }\n    }\n}","import sift from 'sift';\nimport cleanObjectForMetaFilters from './lib/cleanObjectForMetaFilters';\n\n/**\n * This only applies to inversed links. It will assemble the data in a correct manner.\n */\nexport default function(childCollectionNode, aggregateResults, metaFilters) {\n    const linker = childCollectionNode.linker;\n    const linkStorageField = linker.linkStorageField;\n    const linkName = childCollectionNode.linkName;\n    const isMeta = linker.isMeta();\n    const isMany = linker.isMany();\n\n    let allResults = [];\n\n    if (isMeta && metaFilters) {\n        const metaFiltersTest = sift(metaFilters);\n        _.each(childCollectionNode.parent.results, parentResult => {\n            cleanObjectForMetaFilters(\n                parentResult,\n                linkStorageField,\n                metaFiltersTest\n            );\n        });\n    }\n\n    if (isMeta && isMany) {\n        // This case is treated differently because we get an array response from the pipeline.\n\n        _.each(childCollectionNode.parent.results, parentResult => {\n            parentResult[linkName] = parentResult[linkName] || [];\n\n            const eligibleAggregateResults = _.filter(\n                aggregateResults,\n                aggregateResult => {\n                    return _.contains(aggregateResult._id, parentResult._id);\n                }\n            );\n\n            if (eligibleAggregateResults.length) {\n                const datas = _.pluck(eligibleAggregateResults, 'data'); /// [ [x1, x2], [x2, x3] ]\n\n                _.each(datas, data => {\n                    _.each(data, item => {\n                        parentResult[linkName].push(item);\n                    });\n                });\n            }\n        });\n\n        _.each(aggregateResults, aggregateResult => {\n            _.each(aggregateResult.data, item => allResults.push(item));\n        });\n    } else {\n        let comparator;\n        if (isMany) {\n            comparator = (aggregateResult, result) =>\n                _.contains(aggregateResult._id, result._id);\n        } else {\n            comparator = (aggregateResult, result) =>\n                aggregateResult._id == result._id;\n        }\n\n        const childLinkName = childCollectionNode.linkName;\n        const parentResults = childCollectionNode.parent.results;\n\n        parentResults.forEach(parentResult => {\n            // We are now finding the data from the pipeline that is related to the _id of the parent\n            const eligibleAggregateResults = aggregateResults.filter(\n                aggregateResult => comparator(aggregateResult, parentResult)\n            );\n\n            eligibleAggregateResults.forEach(aggregateResult => {\n                if (Array.isArray(parentResult[childLinkName])) {\n                    parentResult[childLinkName].push(...aggregateResult.data);\n                } else {\n                    parentResult[childLinkName] = [...aggregateResult.data];\n                }\n            });\n        });\n\n        aggregateResults.forEach(aggregateResult => {\n            allResults.push(...aggregateResult.data);\n        });\n    }\n\n    childCollectionNode.results = allResults;\n}\n","import createSearchFilters from '../../links/lib/createSearchFilters';\nimport cleanObjectForMetaFilters from './lib/cleanObjectForMetaFilters';\nimport sift from 'sift';\nimport dot from 'dot-object';\n\nexport default (childCollectionNode, { limit, skip, metaFilters }) => {\n    if (childCollectionNode.results.length === 0) {\n        return;\n    }\n\n    const parent = childCollectionNode.parent;\n    const linker = childCollectionNode.linker;\n\n    const strategy = linker.strategy;\n    const isSingle = linker.isSingle();\n    const isMeta = linker.isMeta();\n    const fieldStorage = linker.linkStorageField;\n\n    // cleaning the parent results from a child\n    // this may be the wrong approach but it works for now\n    if (isMeta && metaFilters) {\n        const metaFiltersTest = sift(metaFilters);\n        _.each(parent.results, parentResult => {\n            cleanObjectForMetaFilters(\n                parentResult,\n                fieldStorage,\n                metaFiltersTest\n            );\n        });\n    }\n\n    const resultsByKeyId = _.groupBy(childCollectionNode.results, '_id');\n\n    if (strategy === 'one') {\n        parent.results.forEach(parentResult => {\n            const value = dot.pick(fieldStorage, parentResult);\n            if (!value) {\n                return;\n            }\n\n            parentResult[childCollectionNode.linkName] = filterAssembledData(\n                resultsByKeyId[value],\n                { limit, skip }\n            );\n        });\n    }\n\n    if (strategy === 'many') {\n        parent.results.forEach(parentResult => {\n            // support dotted fields\n            const [root, ...nested] = fieldStorage.split('.');\n            const value = dot.pick(root, parentResult);\n            if (!value) {\n                return;\n            }\n\n\n            const data = [];\n            value.forEach(v => {\n                const _id = nested.length > 0 ? dot.pick(nested.join('.'), v) : v;\n                data.push(_.first(resultsByKeyId[_id]));\n            });\n\n            parentResult[childCollectionNode.linkName] = filterAssembledData(\n                data,\n                { limit, skip }\n            );\n        });\n    }\n\n    if (strategy === 'one-meta') {\n        parent.results.forEach(parentResult => {\n            if (!parentResult[fieldStorage]) {\n                return;\n            }\n\n            const _id = parentResult[fieldStorage]._id;\n            parentResult[childCollectionNode.linkName] = filterAssembledData(\n                resultsByKeyId[_id],\n                { limit, skip }\n            );\n        });\n    }\n\n    if (strategy === 'many-meta') {\n        parent.results.forEach(parentResult => {\n            const _ids = _.pluck(parentResult[fieldStorage], '_id');\n            let data = [];\n            _ids.forEach(_id => {\n                data.push(_.first(resultsByKeyId[_id]));\n            });\n\n            parentResult[childCollectionNode.linkName] = filterAssembledData(\n                data,\n                { limit, skip }\n            );\n        });\n    }\n};\n\nfunction filterAssembledData(data, { limit, skip }) {\n    if (limit && Array.isArray(data)) {\n        return data.slice(skip, limit);\n    }\n\n    return data;\n}\n","import { _ } from 'meteor/underscore';\nimport {SAFE_DOTTED_FIELD_REPLACEMENT} from './constants';\n\nexport default function (childCollectionNode, filters, options, userId) {\n    let containsDottedFields = false;\n    const linker = childCollectionNode.linker;\n    const linkStorageField = linker.linkStorageField;\n    const collection = childCollectionNode.collection;\n\n    let pipeline = [];\n\n    if (collection.firewall) {\n        collection.firewall(filters, options, userId);\n    }\n\n    filters = cleanUndefinedLeafs(filters);\n\n    pipeline.push({$match: filters});\n\n    if (options.sort && _.keys(options.sort).length > 0) {\n        pipeline.push({$sort: options.sort})\n    }\n\n    let _id = linkStorageField;\n    if (linker.isMeta()) {\n        _id += '._id';\n    }\n\n    let dataPush = {\n        _id: '$_id'\n    };\n\n    _.each(options.fields, (value, field) => {\n        if (field.indexOf('.') >= 0) {\n            containsDottedFields = true;\n        }\n        const safeField = field.replace(/\\./g, SAFE_DOTTED_FIELD_REPLACEMENT);\n        dataPush[safeField] = '$' + field\n    });\n\n    if (linker.isMeta()) {\n        dataPush[linkStorageField] = '$' + linkStorageField;\n    }\n\n    pipeline.push({\n        $group: {\n            _id: \"$\" + _id,\n            data: {\n                $push: dataPush\n            }\n        }\n    });\n\n    if (options.limit || options.skip) {\n        let $slice = [\"$data\"];\n        if (options.skip) $slice.push(options.skip);\n        if (options.limit) $slice.push(options.limit);\n\n        pipeline.push({\n            $project: {\n                _id: 1,\n                data: {$slice}\n            }\n        })\n    }\n\n    function cleanUndefinedLeafs(tree) {\n        const a = Object.assign({}, tree);\n        _.each(a, (value, key) => {\n            if (value === undefined) {\n                delete a[key];\n            }\n\n            if (!_.isArray(value) && _.isObject(value)) {\n                a[key] = cleanUndefinedLeafs(value);\n            }\n        })\n\n        return a;\n    }\n\n    return {pipeline, containsDottedFields};\n}","export const SAFE_DOTTED_FIELD_REPLACEMENT = '___';","import applyProps from '../lib/applyProps.js';\nimport prepareForDelivery from '../lib/prepareForDelivery.js';\nimport storeHypernovaResults from './storeHypernovaResults.js';\n\nfunction hypernova(collectionNode, userId) {\n    _.each(collectionNode.collectionNodes, childCollectionNode => {\n        let {filters, options} = applyProps(childCollectionNode);\n\n        storeHypernovaResults(childCollectionNode, userId);\n        hypernova(childCollectionNode, userId);\n    });\n}\n\nexport default function hypernovaInit(collectionNode, userId, config = {}) {\n    const bypassFirewalls = config.bypassFirewalls || false;\n    const params = config.params || {};\n\n    let {filters, options} = applyProps(collectionNode);\n\n    const collection = collectionNode.collection;\n\n    collectionNode.results = collection.find(filters, options, userId).fetch();\n\n    const userIdToPass = (config.bypassFirewalls) ? undefined : userId;\n    hypernova(collectionNode, userIdToPass);\n\n    prepareForDelivery(collectionNode, params);\n\n    return collectionNode.results;\n}\n","import applyProps from '../lib/applyProps.js';\nimport AggregateFilters from './aggregateSearchFilters.js';\nimport assemble from './assembler.js';\nimport assembleAggregateResults from './assembleAggregateResults.js';\nimport buildAggregatePipeline from './buildAggregatePipeline.js';\nimport snapBackDottedFields from './lib/snapBackDottedFields';\n\nexport default function storeHypernovaResults(childCollectionNode, userId) {\n    if (childCollectionNode.parent.results.length === 0) {\n        return (childCollectionNode.results = []);\n    }\n\n    let { filters, options } = applyProps(childCollectionNode);\n\n    const metaFilters = filters.$meta;\n    const aggregateFilters = new AggregateFilters(\n        childCollectionNode,\n        metaFilters\n    );\n    delete filters.$meta;\n\n    const linker = childCollectionNode.linker;\n    const isVirtual = linker.isVirtual();\n    const collection = childCollectionNode.collection;\n\n\n    _.extend(filters, aggregateFilters.create());\n\n    // if it's not virtual then we retrieve them and assemble them here.\n    if (!isVirtual) {\n        const filteredOptions = _.omit(options, 'limit');\n\n        childCollectionNode.results = collection\n            .find(filters, filteredOptions, userId)\n            .fetch();\n\n        assemble(childCollectionNode, {\n            ...options,\n            metaFilters,\n        });\n    } else {\n        // virtuals arrive here\n        let { pipeline, containsDottedFields } = buildAggregatePipeline(\n            childCollectionNode,\n            filters,\n            options,\n            userId\n        );\n\n        let aggregateResults = collection.aggregate(pipeline);\n\n        /**\n         * If in aggregation it contains '.', we replace it with a custom string '___'\n         * And then after aggregation is complete we need to snap-it back to how it was.\n         */\n        if (containsDottedFields) {\n            snapBackDottedFields(aggregateResults);\n        }\n\n        assembleAggregateResults(\n            childCollectionNode,\n            aggregateResults,\n            metaFilters\n        );\n    }\n}\n","export default function (object, field, metaFiltersTest) {\n    if (object[field]) {\n        if (_.isArray(object[field])) {\n            object[field] = object[field].filter(metaFiltersTest)\n        } else {\n            if (!metaFiltersTest(object[field])) {\n                object[field] = null;\n            }\n        }\n    }\n}","import {SAFE_DOTTED_FIELD_REPLACEMENT} from '../constants';\nimport dot from 'dot-object';\n\nexport default function (aggregationResult) {\n    aggregationResult.forEach(result => {\n        result.data = result.data.map(document => {\n            _.each(document, (value, key) => {\n                if (key.indexOf(SAFE_DOTTED_FIELD_REPLACEMENT) >= 0) {\n                    document[key.replace(new RegExp(SAFE_DOTTED_FIELD_REPLACEMENT, 'g'), '.')] = value;\n                    delete document[key];\n                }\n            });\n\n            return dot.object(document);\n        })\n    })\n}","const restrictOptions = [\n    'disableOplog',\n    'pollingIntervalMs',\n    'pollingThrottleMs'\n];\n\nexport default function applyProps(node) {\n    let filters = Object.assign({}, node.props.$filters);\n    let options = Object.assign({}, node.props.$options);\n\n    options = _.omit(options, ...restrictOptions);\n    options.fields = options.fields || {};\n\n    node.applyFields(filters, options);\n    \n    return {filters, options};\n}\n","export default (method, myParameters) => {\n    return new Promise((resolve, reject) => {\n        Meteor.call(method, myParameters, (err, res) => {\n            if (err) reject(err.reason || 'Something went wrong.');\n\n            resolve(res);\n        });\n    });\n};","import CollectionNode from '../nodes/collectionNode.js';\nimport FieldNode from '../nodes/fieldNode.js';\nimport ReducerNode from '../nodes/reducerNode.js';\nimport dotize from './dotize.js';\nimport createReducers from '../reducers/lib/createReducers';\n\nexport const specialFields = [\n    '$filters',\n    '$options',\n    '$postFilters',\n    '$postOptions',\n    '$postFilter'\n];\n\n/**\n * Creates node objects from the body. The root is always a collection node.\n *\n * @param root\n */\nexport function createNodes(root) {\n    // this is a fix for phantomjs tests (don't really understand it.)\n    if (!_.isObject(root.body)) {\n        return;\n    }\n\n    _.each(root.body, (body, fieldName) => {\n        if (!body) {\n            return;\n        }\n\n        // if it's a prop\n        if (_.contains(specialFields, fieldName)) {\n            root.addProp(fieldName, body);\n\n            return;\n        }\n\n        // workaround, see https://github.com/cult-of-coders/grapher/issues/134\n        // TODO: find another way to do this\n        if (root.collection.default) {\n          root.collection = root.collection.default;\n        }\n\n        // checking if it is a link.\n        let linker = root.collection.getLinker(fieldName);\n\n        if (linker) {\n            // check if it is a cached link\n            // if yes, then we need to explicitly define this at collection level\n            // so when we transform the data for delivery, we move it to the link name\n            if (linker.isDenormalized()) {\n                if (linker.isSubBodyDenormalized(body)) {\n                    handleDenormalized(root, linker, body, fieldName);\n                    return;\n                }\n            }\n\n            let subroot = new CollectionNode(linker.getLinkedCollection(), body, fieldName);\n            // must be before adding linker because _shouldCleanStorage method\n            createNodes(subroot);\n            root.add(subroot, linker);\n\n            return;\n        }\n\n        // checking if it's a reducer\n        const reducer = root.collection.getReducer(fieldName);\n\n        if (reducer) {\n            let reducerNode = new ReducerNode(fieldName, reducer);\n            root.add(reducerNode);\n        }\n\n        // it's most likely a field then\n        addFieldNode(body, fieldName, root);\n    });\n\n    createReducers(root);\n\n    if (root.fieldNodes.length === 0) {\n        root.add(new FieldNode('_id', 1));\n    }\n}\n\nfunction isProjectionOperatorExpression(body) {\n    if (_.isObject(body)) {\n        const keys = _.keys(body);\n        return keys.length === 1 && _.contains(['$elemMatch', '$meta', '$slice'], keys[0]);\n    }\n    return false;\n}\n\n/**\n * @param body\n * @param fieldName\n * @param root\n */\nexport function addFieldNode(body, fieldName, root) {\n    // it's not a link and not a special variable => we assume it's a field\n    if (_.isObject(body)) {\n        if (!isProjectionOperatorExpression(body)) {\n            let dotted = dotize.convert({[fieldName]: body});\n            _.each(dotted, (value, key) => {\n                root.add(new FieldNode(key, value));\n            });\n        }\n        else {\n            root.add(new FieldNode(fieldName, body, true));\n        }\n    } else {\n        let fieldNode = new FieldNode(fieldName, body);\n        root.add(fieldNode);\n    }\n}\n\n/**\n * Returns namespace for node when using query path scoping.\n *\n * @param node\n * @returns {String}\n */\nexport function getNodeNamespace(node) {\n    const parts = [];\n    let n = node;\n    while (n) {\n        const name = n.linker ? n.linker.linkName : n.collection._name;\n        parts.push(name);\n        // console.log('linker', node.linker ? node.linker.linkName : node.collection._name);\n        n = n.parent;\n    }\n    return parts.reverse().join('_');\n}\n\n/**\n * @param collection\n * @param body\n * @returns {CollectionNode}\n */\nexport default function (collection, body) {\n    let root = new CollectionNode(collection, body);\n    createNodes(root);\n\n    return root;\n};\n\n/**\n * Ads denormalization config properly, including _id\n *\n * @param root\n * @param linker\n * @param body\n * @param fieldName\n */\nfunction handleDenormalized(root, linker, body, fieldName) {\n    Object.assign(body, {_id: 1});\n\n    const cacheField = linker.linkConfig.denormalize.field;\n    root.snapCache(cacheField, fieldName);\n\n    // if it's one and direct also include the link storage\n    if (!linker.isMany() && !linker.isVirtual()) {\n        addFieldNode(1, linker.linkStorageField, root);\n    }\n\n    addFieldNode(body, cacheField, root);\n}","// https://github.com/vardars/dotize\nexport default dotize = {};\n\ndotize.convert = function(obj, prefix) {\n    if ((!obj || typeof obj != \"object\") && !Array.isArray(obj)) {\n        if (prefix) {\n            var newObj = {};\n            newObj[prefix] = obj;\n            return newObj;\n        } else {\n            return obj;\n        }\n    }\n\n    var newObj = {};\n\n    function recurse(o, p, isArrayItem) {\n        for (var f in o) {\n            if (o[f] && typeof o[f] === \"object\") {\n                if (Array.isArray(o[f])) {\n                    if (isEmptyArray(o[f])) {\n                        newObj[getFieldName(f, p, true)] = o[f]; // empty array\n                    } else {\n                        newObj = recurse(o[f], getFieldName(f, p, false, true), true); // array\n                    }\n                } else {\n                    if (isArrayItem) {\n                        if (isEmptyObj(o[f])) {\n                            newObj[getFieldName(f, p, true)] = o[f]; // empty object\n                        } else {\n                            newObj = recurse(o[f], getFieldName(f, p, true)); // array item object\n                        }\n                    } else {\n                        if (isEmptyObj(o[f])) {\n                            newObj[getFieldName(f, p)] = o[f]; // empty object\n                        } else {\n                            newObj = recurse(o[f], getFieldName(f, p)); // object\n                        }\n                    }\n                }\n            } else {\n                if (isArrayItem || isNumber(f)) {\n                    newObj[getFieldName(f, p, true)] = o[f]; // array item primitive\n                } else {\n                    newObj[getFieldName(f, p)] = o[f]; // primitive\n                }\n            }\n        }\n\n        if (isEmptyObj(newObj))\n            return obj;\n\n        return newObj;\n    }\n\n    function isNumber(f) {\n        return !isNaN(parseInt(f));\n    }\n\n    function isEmptyObj(obj) {\n        for (var prop in obj) {\n            if (Object.hasOwnProperty.call(obj, prop))\n                return false;\n        }\n\n        return true;\n    }\n\n    function isEmptyArray(o) {\n        if (Array.isArray(o) && o.length == 0)\n            return true;\n        return false;\n    }\n\n    function getFieldName(field, prefix, isArrayItem, isArray) {\n        if (isArray)\n            return (prefix ? prefix : \"\") + (isNumber(field) ? \"[\" + field + \"]\" : \".\" + field);\n        else if (isArrayItem)\n            return (prefix ? prefix : \"\") + \"[\" + field + \"]\";\n        else\n            return (prefix ? prefix + \".\" : \"\") + field;\n    }\n\n    return recurse(obj, prefix, Array.isArray(obj));\n};","/**\n * Helper method which expands profile.phone.verified into\n * ['profile', 'profile.phone', 'profile.phone.verified']\n * @param fieldName\n */\nexport function expandField(fieldName) {\n    const parts = fieldName.split('.');\n    const result = [];\n\n    for (let i = 0; i < parts.length; i++) {\n        result.push(parts.slice(0, i + 1).join('.'));\n    }\n\n    return result;\n}\n\nexport function isFieldInProjection(projection, fieldName, checkNested) {\n    // for checkNested flag expand the field\n    const fields = checkNested ? expandField(fieldName) : [fieldName];\n    return fields.some(field => projection[field]);\n}\n","import {_} from 'meteor/underscore';\nimport {specialFields} from './createGraph';\n\nconst EXTENDED_SPECIAL_FIELDS = [...specialFields, '$filter', '$paginate'];\n\nfunction isClientValueValid(value) {\n    if (_.isObject(value) && !_.isArray(value)) {\n        return _.values(value).every(nestedValue => isClientValueValid(nestedValue));\n    }\n    else if (value === 1) {\n        return true;\n    }\n    return false;\n}\n\n/**\n * \n * Recursive function which intersects the fields of the body objects.\n * \n * @param {object} allowed allowed body object - intersection can only be a subset of it\n * @param {object} client client body - can shrink main body, but not expand\n */\nfunction intersectFields(allowed, client) {\n    const intersection = {};\n    _.pairs(client).forEach(([field, clientValue]) => {\n        if (_.contains(EXTENDED_SPECIAL_FIELDS, field)) {\n            return;\n        }\n\n        const serverValue = allowed[field];\n        if (serverValue === 1) { // server allows everything\n            if (isClientValueValid(clientValue)) {\n                intersection[field] = clientValue;\n            }\n        }\n        else if (_.isObject(serverValue)) {\n            if (_.isObject(clientValue) && !_.isArray(clientValue)) {\n                intersection[field] = intersectFields(serverValue, clientValue);\n            }\n            else if (clientValue === 1) {\n                // if client wants everything, serverValue is more restrictive here\n                intersection[field] = serverValue;\n            }\n        }\n    });\n    return intersection;\n}\n\n/**\n * Given a named query that has a specific body, you can query its subbody\n * This performs an intersection of the bodies allowed in each\n *\n * @param allowedBody\n * @param clientBody\n */\nexport default function (allowedBody, clientBody) {\n    const build = intersectFields(allowedBody, clientBody);\n    // Add back special fields to the new body\n    Object.assign(build, _.pick(allowedBody, ...EXTENDED_SPECIAL_FIELDS));\n    return build;\n}\n","// 1. Clone children with meta relationships\n// 2. Apply $metadata to children\n// 3. Removes link storage (if not specified)\n// 4. Stores oneResult links as a single object instead of array\nimport applyReducers from '../reducers/lib/applyReducers';\nimport cleanReducerLeftovers from '../reducers/lib/cleanReducerLeftovers';\nimport sift from 'sift';\nimport dot from 'dot-object';\nimport {Minimongo} from 'meteor/minimongo';\n\nexport default (node, params) => {\n    snapBackCaches(node);\n    storeOneResults(node, node.results);\n\n    applyReducers(node, params);\n\n    _.each(node.collectionNodes, collectionNode => {\n        cloneMetaChildren(collectionNode, node.results)\n    });\n\n    _.each(node.collectionNodes, collectionNode => {\n        assembleMetadata(collectionNode, node.results)\n    });\n\n    cleanReducerLeftovers(node, node.results);\n\n    removeLinkStorages(node, node.results);\n\n    applyPostFilters(node);\n    applyPostOptions(node);\n    applyPostFilter(node, params);\n}\n\nexport function applyPostFilters(node) {\n    const postFilters = node.props.$postFilters;\n    if (postFilters) {\n        node.results = sift(postFilters, node.results);\n    }\n}\n\nexport function applyPostOptions(node) {\n    const options = node.props.$postOptions;\n    if (options) {\n        if (options.sort) {\n            const sorter = new Minimongo.Sorter(options.sort);\n            node.results.sort(sorter.getComparator());\n        }\n        if (options.limit || options.skip) {\n            const start = options.skip || 0;\n            const end = options.limit ? options.limit + start : node.results.length;\n            node.results = node.results.slice(start, end);\n        }\n    }\n}\n\n\n/**\n * Optionally applies a post filtering option\n */\nfunction applyPostFilter(node, params) {\n    if (node.props.$postFilter) {\n        const filter = node.props.$postFilter;\n\n        if (_.isArray(filter)) {\n            filter.forEach(f => {\n                node.results = f(node.results, params);\n            })\n        } else {\n            node.results = filter(node.results, params);\n        }\n    }\n}\n\n/**\n *\n * Helper function which transforms results into the array.\n * Results are an object for 'one' links.\n *\n * @param results\n * @return array\n */\nexport function getResultsArray(results) {\n    if (_.isArray(results)) {\n        return results;\n    }\n    else if (_.isUndefined(results)) {\n        return [];\n    }\n    return [results];\n}\n\nexport function removeLinkStorages(node, sameLevelResults) {\n    if (!sameLevelResults) {\n        return;\n    }\n\n    sameLevelResults = getResultsArray(sameLevelResults);\n\n    _.each(node.collectionNodes, collectionNode => {\n        const removeStorageField = collectionNode.shouldCleanStorage;\n        _.each(sameLevelResults, result => {\n            if (removeStorageField) {\n                const isSingle = collectionNode.linker.isSingle();\n                const [root, ...nested] = collectionNode.linkStorageField.split('.');\n\n                const removeFromResult = (result, removeEmptyRoot = false) => {\n                    if (isSingle) {\n                        dot.pick(collectionNode.linkStorageField, result, true);\n                        if (removeEmptyRoot && nested.length > 0 && _.isEmpty(result[root])) {\n                            delete result[root];\n                        }\n                    }\n                    else {\n                        if (nested.length > 0) {\n                            const arr = result[root] || [];\n                            if (_.isArray(arr)) {\n                                arr.forEach(obj => dot.pick(nested.join('.'), obj, true));\n                                if (removeEmptyRoot && nested.length > 0 && arr.every(obj => _.isEmpty(obj))) {\n                                    delete result[root];\n                                }\n                            }\n                        }\n                        else {\n                            delete result[collectionNode.linkStorageField];\n                        }\n                    }\n                };\n\n                if (collectionNode.isVirtual) {\n                    const childResults = getResultsArray(result[collectionNode.linkName]);\n                    _.each(childResults, childResult => {\n                        removeFromResult(childResult);\n                    });\n                } else {\n                    removeFromResult(result);\n                }\n            }\n\n            removeLinkStorages(collectionNode, result[collectionNode.linkName]);\n        })\n    })\n}\n\nexport function storeOneResults(node, sameLevelResults) {\n    if (!sameLevelResults) {\n        return;\n    }\n\n    node.collectionNodes.forEach(collectionNode => {\n        _.each(sameLevelResults, result => {\n            // The reason we are doing this is that if the requested link does not exist\n            // It will fail when we try to get undefined[something] below\n            if (result === undefined) {\n                return;\n            }\n\n            storeOneResults(collectionNode, result[collectionNode.linkName]);\n        });\n\n        if (collectionNode.isOneResult) {\n            _.each(sameLevelResults, result => {\n                if (result[collectionNode.linkName] && _.isArray(result[collectionNode.linkName])) {\n                    result[collectionNode.linkName] = result[collectionNode.linkName]\n                        ? _.first(result[collectionNode.linkName])\n                        : undefined;\n                }\n            })\n        }\n    })\n}\n\nfunction cloneMetaChildren(node, parentResults) {\n    if (!parentResults) {\n        return;\n    }\n\n    const linkName = node.linkName;\n    const isMeta = node.isMeta;\n\n    // parentResults might be an object (for type==one links)\n    parentResults = getResultsArray(parentResults);\n\n    parentResults.forEach(parentResult => {\n        if (isMeta && parentResult[linkName]) {\n            if (node.isOneResult) {\n                parentResult[linkName] = Object.assign({}, parentResult[linkName]);\n            }\n            else {\n                parentResult[linkName] = parentResult[linkName].map(object => {\n                    return Object.assign({}, object);\n                });\n            }\n        }\n\n        node.collectionNodes.forEach(collectionNode => {\n            cloneMetaChildren(collectionNode, parentResult[linkName]);\n        });\n    });\n}\n\nexport function assembleMetadata(node, parentResults) {\n    parentResults = getResultsArray(parentResults);\n\n    // assembling metadata is depth first\n    node.collectionNodes.forEach(collectionNode => {\n        _.each(parentResults, result => {\n            assembleMetadata(collectionNode, result[node.linkName])\n        });\n    });\n\n    if (node.isMeta) {\n        if (node.isVirtual) {\n            _.each(parentResults, parentResult => {\n                const childResult = parentResult[node.linkName];\n\n                if (node.isOneResult) {\n                    if (_.isObject(childResult)) {\n                        const storage = childResult[node.linkStorageField];\n                        storeMetadata(childResult, parentResult, storage, true);\n                    }\n                } else {\n                    _.each(childResult, object => {\n                        const storage = object[node.linkStorageField];\n                        storeMetadata(object, parentResult, storage, true);\n                    });\n                }\n            })\n        } else {\n            _.each(parentResults, parentResult => {\n                const childResult = parentResult[node.linkName];\n                const storage = parentResult[node.linkStorageField];\n\n                if (node.isOneResult) {\n                    if (childResult) {\n                        storeMetadata(childResult, parentResult, storage, false);\n                    }\n                } else {\n                    _.each(childResult, object => {\n                        storeMetadata(object, parentResult, storage, false);\n                    });\n                }\n            })\n        }\n    }\n}\n\nfunction storeMetadata(element, parentElement, storage, isVirtual) {\n    if (isVirtual) {\n        let $metadata;\n        if (_.isArray(storage)) {\n            $metadata = _.find(storage, storageItem => storageItem._id == parentElement._id);\n        } else {\n            $metadata = storage;\n        }\n\n        element.$metadata = _.omit($metadata, '_id')\n    } else {\n        let $metadata;\n        if (_.isArray(storage)) {\n            $metadata = _.find(storage, storageItem => storageItem._id == element._id);\n        } else {\n            $metadata = storage;\n        }\n\n        element.$metadata = _.omit($metadata, '_id');\n    }\n}\n\nfunction snapBackCaches(node) {\n    node.collectionNodes.forEach(collectionNode => {\n        snapBackCaches(collectionNode);\n    });\n\n    if (!_.isEmpty(node.snapCaches)) {\n        // process stuff\n        _.each(node.snapCaches, (linkName, cacheField) => {\n            const isSingle = _.contains(node.snapCachesSingles, cacheField);\n            const linker = node.collection.getLinker(linkName);\n            // we do this because for one direct and one meta direct, id is not stored\n            const shoudStoreLinkStorage = !linker.isMany() && !linker.isVirtual();\n\n            node.results.forEach(result => {\n                if (result[cacheField]) {\n                    if (shoudStoreLinkStorage) {\n                        Object.assign(result[cacheField], {\n                            _id: linker.isMeta()\n                                ? result[linker.linkStorageField]._id\n                                : result[linker.linkStorageField]\n                        });\n                    }\n\n                    if (isSingle && _.isArray(result[cacheField])) {\n                        result[linkName] = _.first(result[cacheField]);\n                    } else {\n                        result[linkName] = result[cacheField];\n                    }\n\n                    delete result[cacheField];\n                }\n            })\n        })\n    }\n}\n","import {check, Match} from 'meteor/check';\nimport deepClone from 'lodash.clonedeep';\n\nfunction defaultFilterFunction({\n    filters,\n    options,\n    params\n}) {\n    if (params.filters) {\n        Object.assign(filters, params.filters);\n    }\n    if (params.options) {\n        Object.assign(options, params.options);\n    }\n}\n\nfunction applyFilterRecursive(data, params = {}, isRoot = false) {\n    if (isRoot && !_.isFunction(data.$filter)) {\n        data.$filter = defaultFilterFunction;\n    }\n\n    if (data.$filter) {\n        check(data.$filter, Match.OneOf(Function, [Function]));\n\n        data.$filters = data.$filters || {};\n        data.$options = data.$options || {};\n\n        if (_.isArray(data.$filter)) {\n            data.$filter.forEach(filter => {\n                filter.call(null, {\n                    filters: data.$filters,\n                    options: data.$options,\n                    params: params\n                })\n            });\n        } else {\n            data.$filter({\n                filters: data.$filters,\n                options: data.$options,\n                params: params\n            });\n        }\n\n        data.$filter = null;\n        delete(data.$filter);\n    }\n\n    _.each(data, (value, key) => {\n        if (_.isObject(value)) {\n            return applyFilterRecursive(value, params);\n        }\n    })\n}\n\nfunction applyPagination(body, _params) {\n    if (body['$paginate'] && _params) {\n        if (!body.$options) {\n            body.$options = {};\n        }\n\n        if (_params.limit) {\n            _.extend(body.$options, {\n                limit: _params.limit\n            })\n        }\n\n        if (_params.skip) {\n            _.extend(body.$options, {\n                skip: _params.skip\n            })\n        }\n\n        delete body['$paginate'];\n    }\n}\n\nexport default (_body, _params = {}) => {\n    let body = deepClone(_body);\n    let params = deepClone(_params);\n\n    applyPagination(body, params);\n    applyFilterRecursive(body, params, true);\n\n    return body;\n}\n","import applyProps from './applyProps.js';\nimport { assembleMetadata, removeLinkStorages, storeOneResults } from './prepareForDelivery';\nimport prepareForDelivery from './prepareForDelivery';\nimport {getNodeNamespace} from './createGraph';\nimport {isFieldInProjection} from '../lib/fieldInProjection';\n\n/**\n * This is always run client side to build the data graph out of client-side collections.\n *\n * @param node\n * @param parentObject\n * @param fetchOptions\n * @returns {*}\n */\nfunction fetch(node, parentObject, fetchOptions = {}) {\n    let {filters, options} = applyProps(node);\n    // add subscription filter\n    if (fetchOptions.scoped && fetchOptions.subscriptionHandle) {\n        _.extend(filters, fetchOptions.subscriptionHandle.scopeQuery());\n    }\n    // add query path filter\n    if (fetchOptions.scoped) {\n        _.extend(filters, {[`_query_path_${getNodeNamespace(node)}`]: {$exists: true}});\n    }\n\n    let results = [];\n\n    if (parentObject) {\n        let accessor = node.linker.createLink(parentObject, node.collection);\n\n        if (node.isVirtual) {\n            options.fields = options.fields || {};\n            if (!isFieldInProjection(options.fields, node.linkStorageField, true)) {\n                _.extend(options.fields, {\n                    [node.linkStorageField]: 1\n                });\n            }\n        }\n\n        results = accessor.find(filters, options).fetch();\n    } else {\n        results = node.collection.find(filters, options).fetch();\n    }\n\n    _.each(node.collectionNodes, collectionNode => {\n        _.each(results, result => {\n            const collectionNodeResults = fetch(collectionNode, result);\n            result[collectionNode.linkName] = collectionNodeResults;\n            //delete result[node.linker.linkStorageField];\n\n            /**\n             * Push into the results, because snapBackCaches() in prepareForDelivery does not work otherwise.\n             * This is non-optimal, can we be sure that every item in results contains _id and add only if not in\n             * the results?\n             *\n             * Other possible ways:\n             * - do something like assemble() in storeHypernovaResults\n             * - pass node.results to accessor above and find with sift\n             */\n\n            collectionNode.results.push(...collectionNodeResults);\n\n            // this was not working because all references must be replaced in snapBackCaches, not only the ones that are \n            // found first\n            // const currentIds = _.pluck(collectionNode.results, '_id');\n            // collectionNode.results.push(...collectionNodeResults.filter(res => !_.contains(currentIds, res._id)));\n        })\n    });\n\n    return results;\n}\n\nexport default (node, params, fetchOptions) => {\n    node.results = fetch(node, null, fetchOptions);\n\n    prepareForDelivery(node, params);\n\n    return node.results;\n}\n","import FieldNode from './fieldNode.js';\nimport ReducerNode from './reducerNode.js';\nimport deepClone from 'lodash.clonedeep';\nimport {check, Match} from 'meteor/check';\nimport {expandField, isFieldInProjection} from '../lib/fieldInProjection';\n\nexport default class CollectionNode {\n    constructor(collection, body = {}, linkName = null) {\n        if (collection && !_.isObject(body)) {\n            throw new Meteor.Error('invalid-body', `The field \"${linkName}\" is a collection link, and should have its body defined as an object.`);\n        }\n\n        this.body = deepClone(body);\n        this.linkName = linkName;\n        this.collection = collection;\n\n        this.nodes = [];\n        this.props = {};\n        this.parent = null;\n        this.linker = null;\n        this.linkStorageField = null;\n        this.scheduledForDeletion = false;\n        this.reducers = [];\n        this.results = [];\n        this.snapCaches = {}; // {cacheField: linkName}\n        this.snapCachesSingles = []; // [cacheField1, cacheField2]\n    }\n\n    get collectionNodes() {\n        return _.filter(this.nodes, n => n instanceof CollectionNode)\n    }\n\n    get fieldNodes() {\n        return _.filter(this.nodes, n => n instanceof FieldNode);\n    }\n\n    get reducerNodes() {\n        return _.filter(this.nodes, n => n instanceof ReducerNode);\n    }\n\n    /**\n     * Adds children to itself\n     *\n     * @param node\n     * @param linker\n     */\n    add(node, linker) {\n        node.parent = this;\n\n        if (node instanceof FieldNode) {\n            runFieldSanityChecks(node.name);\n        }\n        \n        if (linker) {\n            node.linker = linker;\n            node.linkStorageField = linker.linkStorageField;\n            node.isMeta = linker.isMeta();\n            node.isVirtual = linker.isVirtual();\n            node.isOneResult = linker.isOneResult();\n            node.shouldCleanStorage = this._shouldCleanStorage(node);\n        }\n\n        this.nodes.push(node);\n    }\n\n    /**\n     * @param prop\n     * @param value\n     */\n    addProp(prop, value) {\n        if (prop === '$postFilter') {\n            check(value, Match.OneOf(Function, [Function]))\n        }\n\n        Object.assign(this.props, {\n            [prop]: value\n        });\n    }\n\n    /**\n     * @param _node\n     */\n    remove(_node) {\n        this.nodes = _.filter(this.nodes, node => _node !== node);\n    }\n\n    /**\n     * @param filters\n     * @param options\n     */\n    applyFields(filters, options) {\n        let hasAddedAnyField = false;\n\n        _.each(this.fieldNodes, n => {\n            /**\n             * $meta field should be added to the options.fields, but MongoDB does not exclude other fields.\n             * Therefore, we do not count this as a field addition.\n             * \n             * See: https://docs.mongodb.com/manual/reference/operator/projection/meta/\n             * The $meta expression specifies the inclusion of the field to the result set \n             * and does not specify the exclusion of the other fields.\n             */\n            if (n.projectionOperator !== '$meta') {\n                hasAddedAnyField = true;\n            }\n            n.applyFields(options.fields)\n        });\n\n        // it will only get here if it has collectionNodes children\n        _.each(this.collectionNodes, (collectionNode) => {\n            let linker = collectionNode.linker;\n\n            if (linker && !linker.isVirtual()) {\n                if (!isFieldInProjection(options.fields, linker.linkStorageField, true)) {\n                    options.fields[linker.linkStorageField] = 1;\n                    hasAddedAnyField = true;\n                }\n            }\n        });\n\n        // if he selected filters, we should automatically add those fields\n        _.each(filters, (value, field) => {\n            // special handling for the $meta filter, conditional operators and text search\n            if (!_.contains(['$or', '$nor', '$not', '$and', '$meta', '$text'], field)) {\n                // if the field or the parent of the field already exists, don't add it\n                if (!_.has(options.fields, field.split('.')[0])){\n                    hasAddedAnyField = true;\n                    options.fields[field] = 1;\n                }\n            }\n        });\n\n        if (!hasAddedAnyField) {\n            options.fields = {\n                _id: 1,\n                // fields might contain $meta expression, so it should be added here,\n                ...options.fields,\n            };\n        }\n    }\n\n    /**\n     * @param fieldName\n     * @returns {boolean}\n     */\n    hasField(fieldName, checkNested = false) {\n        // for checkNested flag it expands profile.phone.verified into \n        // ['profile', 'profile.phone', 'profile.phone.verified']\n        // if any of these fields match it means that field exists\n\n        const options = checkNested ? expandField(fieldName) : [fieldName];\n\n        const result = !!_.find(this.fieldNodes, fieldNode => {\n            return _.contains(options, fieldNode.name);\n        });\n\n        return result;\n    }\n\n    /**\n     * @param fieldName\n     * @returns {FieldNode}\n     */\n    getField(fieldName) {\n        return _.find(this.fieldNodes, fieldNode => {\n            return fieldNode.name == fieldName\n        })\n    }\n\n    /**\n     * @param name\n     * @returns {boolean}\n     */\n    hasCollectionNode(name) {\n        return !!_.find(this.collectionNodes, node => {\n            return node.linkName == name\n        })\n    }\n\n    /**\n     * @param name\n     * @returns {boolean}\n     */\n    hasReducerNode(name) {\n        return !!_.find(this.reducerNodes, node => {\n            return node.name == name\n        })\n    }\n\n    /**\n     * @param name\n     * @returns {ReducerNode}\n     */\n    getReducerNode(name) {\n        return _.find(this.reducerNodes, node => {\n            return node.name == name\n        })\n    }\n\n    /**\n     * @param name\n     * @returns {CollectionNode}\n     */\n    getCollectionNode(name) {\n        return _.find(this.collectionNodes, node => {\n            return node.linkName == name\n        })\n    }\n\n    /**\n     * @returns {*}\n     */\n    getName() {\n        return this.linkName\n            ? this.linkName\n            : (this.collection ? this.collection._name : 'N/A');\n    }\n\n    /**\n     * This is used for caching links\n     *\n     * @param cacheField\n     * @param subLinkName\n     */\n    snapCache(cacheField, subLinkName) {\n        this.snapCaches[cacheField] = subLinkName;\n\n        if (this.collection.getLinker(subLinkName).isOneResult()) {\n            this.snapCachesSingles.push(cacheField);\n        }\n    }\n\n    /**\n     * This method verifies whether to remove the linkStorageField form the results\n     * unless you specify it in your query.\n     *\n     * @param node\n     * @returns {boolean}\n     * @private\n     */\n    _shouldCleanStorage(node) {\n        if (node.linkStorageField === '_id') {\n            return false;\n        } else {\n            if (node.isVirtual) {\n                return !node.hasField(node.linkStorageField, true);\n            } else {\n                return !this.hasField(node.linkStorageField, true);\n            }\n        }\n    }\n}\n\n/**\n * Make sure that the field is ok to be added\n * @param {*} fieldName \n */\nexport function runFieldSanityChecks(fieldName) {\n    // Run sanity checks on the field\n    if (fieldName[0] === '$') {\n        throw new Error(`You are not allowed to use fields that start with $ inside a reducer's body: ${fieldName}`);\n    }\n\n    return true;\n}\n","export default class FieldNode {\n    constructor(name, body, isProjectionOperator = false) {\n        this.name = name;\n        this.projectionOperator = isProjectionOperator ? _.keys(body)[0] : null;\n        this.body = !_.isObject(body) || isProjectionOperator ? body : 1;\n        this.scheduledForDeletion = false;\n    }\n\n    applyFields(fields) {\n        fields[this.name] = this.body;\n    }\n}\n","export default class ReducerNode {\n    constructor(name, {body, reduce}) {\n        this.name = name;\n        this.body = body;\n        this.reduceFunction = reduce;\n        this.dependencies = []; // This is a list of the reducer this reducer uses.\n    }\n\n    /**\n     * When computing we also pass the parameters\n     * \n     * @param {*} object \n     * @param {*} args \n     */\n    compute(object, ...args) {\n        object[this.name] = this.reduce.call(this, object, ...args);\n    }\n\n    reduce(object, ...args) {\n        return this.reduceFunction.call(this, object, ...args);\n    }\n}","import { check } from 'meteor/check';\nimport addFieldMap from './lib/addFieldMap';\n\nconst storage = '__reducers';\nObject.assign(Mongo.Collection.prototype, {\n    /**\n     * @param data\n     */\n    addReducers(data) {\n        if (!this[storage]) {\n            this[storage] = {};\n        }\n\n        _.each(data, (reducerConfig, reducerName) => {\n            if (!this[reducerConfig]) {\n                this[reducerConfig] = {};\n            }\n\n            if (this.getLinker(reducerName)) {\n                throw new Meteor.Error(\n                    `You cannot add the reducer with name: ${reducerName} because it is already defined as a link in ${\n                        this._name\n                    } collection`\n                );\n            }\n\n            if (this[reducerConfig][reducerName]) {\n                throw new Meteor.Error(\n                    `You cannot add the reducer with name: ${reducerName} because it was already added to ${\n                        this._name\n                    } collection`\n                );\n            }\n\n            check(reducerConfig, {\n                body: Object,\n                reduce: Function,\n            });\n\n            _.extend(this[storage], {\n                [reducerName]: reducerConfig,\n            });\n        });\n    },\n\n    /**\n     * @param name\n     * @returns {*}\n     */\n    getReducer(name) {\n        if (this[storage]) {\n            return this[storage][name];\n        }\n    },\n\n    /**\n     * This creates reducers that makes sort of aliases for the database fields we use\n     */\n    addFieldMap,\n});\n","/**\n * @param {[niceField: string]: dbField} map\n */\nexport default function addFieldMap(map) {\n    const collection = this;\n    let reducers = {};\n    for (let key in map) {\n        const dbField = map[key];\n        reducers[key] = {\n            body: {\n                [dbField]: 1,\n            },\n            reduce(obj) {\n                return obj[dbField];\n            },\n        };\n    }\n\n    collection.addReducers(reducers);\n}\n","export default function applyReducers(root, params) {\n    _.each(root.collectionNodes, node => {\n        applyReducers(node, params);\n    });\n\n    const processedReducers = [];\n    let reducersQueue = [...root.reducerNodes];\n\n    // TODO: find out if there's an infinite reducer inter-deendency\n\n    while (reducersQueue.length) {\n        const reducerNode = reducersQueue.shift();\n\n        // If this reducer depends on other reducers\n        if (reducerNode.dependencies.length) {\n            // If there is an unprocessed reducer, move it at the end of the queue\n            const allDependenciesComputed = _.all(reducerNode.dependencies, dep => processedReducers.includes(dep));\n            if (allDependenciesComputed) {\n                root.results.forEach(result => {\n                    reducerNode.compute(result, params);\n                });\n                processedReducers.push(reducerNode.name);\n            } else {\n                // Move it at the end of the queue\n                reducersQueue.push(reducerNode);\n            }\n        } else {\n            root.results.forEach(result => {\n                reducerNode.compute(result, params);\n            });\n\n            processedReducers.push(reducerNode.name);\n        }\n    }\n}\n","import dot from 'dot-object';\n\n/**\n * @param root\n */\nexport default function cleanReducerLeftovers(root, results) {\n    _.each(root.collectionNodes, node => {\n        if (node.scheduledForDeletion) {\n            results.forEach(result => {\n                delete result[node.linkName];\n            })\n        }\n    });\n\n    _.each(root.collectionNodes, node => {\n        let childResults;\n        if (node.isOneResult) {\n            childResults = results.map(result => result[node.linkName]).filter(element => !!element);\n        } else {\n            childResults = _.flatten(results.map(result => result[node.linkName]).filter(element => !!element));\n        }\n        \n        cleanReducerLeftovers(node, childResults);\n    });\n\n    _.each(root.fieldNodes, node => {\n        if (node.scheduledForDeletion) {\n            cleanNestedFields(node.name.split('.'), results, root);\n        }\n    });\n\n\n    _.each(root.reducerNodes, node => {\n        if (node.scheduledForDeletion) {\n            results.forEach(result => {\n                delete result[node.name];\n            })\n        }\n    });\n}\n\n\n// if we store a field like: 'profile.firstName'\n// then we need to delete profile: { firstName }\n// if profile will have empty keys, we need to delete profile.\n\n/**\n * Cleans what reducers needed to be computed and not used.\n * @param parts\n * @param results\n */\nfunction cleanNestedFields(parts, results, root) {\n    const snapCacheField = root.snapCaches[parts[0]];\n    const fieldName = snapCacheField ? snapCacheField : parts[0];\n\n    if (parts.length === 1) {\n        results.forEach(result => {\n            if (_.isObject(result) && fieldName !== '_id') {\n                delete result[fieldName];\n            }\n        });\n\n        return;\n    }\n\n    parts.shift();\n    cleanNestedFields(\n        parts, \n        results\n            .filter(result => !!result[fieldName])\n            .map(result => result[fieldName]),\n        root\n    );\n    \n    results.forEach(result => {\n        if (_.isObject(result[fieldName]) && _.keys(result[fieldName]).length === 0) {\n            if (fieldName !== '_id') {\n                delete result[fieldName];\n            }\n        }\n    })\n}\n","import dot from 'dot-object';\nimport { createNodes } from '../../lib/createGraph';\nimport CollectionNode from '../../nodes/collectionNode';\nimport FieldNode from '../../nodes/fieldNode';\nimport ReducerNode from '../../nodes/reducerNode';\nimport embedReducerWithLink from './embedReducerWithLink';\nimport { specialFields } from '../../lib/createGraph';\n\nexport default function addReducers(root) {\n    // we add reducers last, after we have added all the fields.\n    root.reducerNodes.forEach(reducer => {\n        _.each(reducer.body, (body, fieldName) => {\n            handleAddElement(reducer, root, fieldName, body);\n        })\n    });\n}\n\n/**\n * @param root\n * @param fieldName\n * @param body\n */\nexport function handleAddElement(reducerNode, root, fieldName, body) {\n    // if it's a link\n    const collection = root.collection;\n    const linker = collection.getLinker(fieldName);\n    if (linker) {\n        return handleAddLink(reducerNode, fieldName, body, root, linker);\n    }\n\n    const reducer = collection.getReducer(fieldName);\n    if (reducer) {\n        reducerNode.dependencies.push(fieldName);\n        return handleAddReducer(fieldName, reducer, root);\n    }\n\n    // we assume it's a field in this case\n    return handleAddField(fieldName, body, root);\n}\n\n/**\n * @param fieldName\n * @param reducer\n * @param root\n */\nexport function handleAddReducer(fieldName, {body, reduce}, root) {\n    if (!root.hasReducerNode(fieldName)) {\n        let childReducerNode = new ReducerNode(fieldName, {body, reduce});\n        root.add(childReducerNode);\n        childReducerNode.scheduledForDeletion = true;\n\n        _.each(childReducerNode.body, (body, fieldName) => {\n            handleAddElement(childReducerNode, root, fieldName, body);\n        })\n    }\n}\n\n/**\n * @param fieldName\n * @param body\n * @param root\n * @param linker\n */\nexport function handleAddLink(reducerNode, fieldName, body, parent, linker) {\n    if (parent.hasCollectionNode(fieldName)) {\n        const collectionNode = parent.getCollectionNode(fieldName);\n\n        embedReducerWithLink(reducerNode, body, collectionNode);\n    } else {\n        // add\n        let collectionNode = new CollectionNode(linker.getLinkedCollection(), body, fieldName);\n        collectionNode.scheduledForDeletion = true;\n        parent.add(collectionNode, linker);\n\n        createNodes(collectionNode);\n    }\n}\n\n/**\n * @param fieldName\n * @param body\n * @param root\n */\nexport function handleAddField(fieldName, body, root) {\n    if (_.contains(specialFields, fieldName)) {\n        root.addProp(fieldName, body);\n\n        return;\n    }\n\n    if (_.isObject(body)) {\n        // if reducer specifies a nested field\n        // if it's a prop\n        const dots = dot.dot({\n            [fieldName]: body\n        });\n\n        _.each(dots, (value, key) => {\n            addFieldIfRequired(root, key, value);\n        });\n    } else {\n        // if reducer does not specify a nested field, and the field does not exist.\n        addFieldIfRequired(root, fieldName, body);\n    }\n}\n\nfunction addFieldIfRequired(root, fieldName, body) {\n    if (!root.hasField(fieldName, true)) {\n        /**\n         * Check if there are any nested fields for this field.\n         * Adding root field here and scheduling for deletion would not work if there is already nested field, \n         * for example:\n         * when trying to add meta: 1, it should be checked that there are no meta.* fields\n         * */\n\n        const nestedFields = root.fieldNodes.filter(({name}) => name.startsWith(`${fieldName}.`));\n        // remove nested fields - important for minimongo which complains for these situations\n        // TODO: excess fields are not removed (caused by adding the root field and removing nested fields) but there\n        // should probably be a way to handle this in post-processing - for example by keeping a whitelist of fields\n        // and removing anything else\n        nestedFields.forEach(node => root.remove(node));\n \n        let fieldNode = new FieldNode(fieldName, body);\n        // delete only if all nested fields are scheduled for deletion (that includes the case of 0 nested fields)\n        fieldNode.scheduledForDeletion = nestedFields.every(field => field.scheduledForDeletion);\n\n        root.add(fieldNode);\n    }\n}\n","import {handleAddField, handleAddElement, handleAddReducer} from './createReducers';\n\n/**\n * Embeds the reducer body with a collection body\n * @param reducerBody\n * @param collectionNode\n */\nexport default function embedReducerWithLink(reducerNode, reducerBody, collectionNode) {\n    _.each(reducerBody, (value, key) => {\n        const collection = collectionNode.collection;\n\n        if (_.isObject(value)) {\n            // nested field or link\n            if (collectionNode.body[key]) {\n                // if it exists\n                const linker = collection.getLinker(key);\n\n                // if it's a link\n                if (linker) {\n                    if (linker.isDenormalized()) {\n                        if (linker.isSubBodyDenormalized(value)) {\n                            const cacheField = linker.linkConfig.denormalize.field;\n                            handleAddField(cacheField, value, collectionNode);\n                            return;\n                        }\n                    }\n\n                    embedReducerWithLink(reducerNode, value, collectionNode.getCollectionNode(key));\n                    return;\n                }\n\n                handleAddField(key, value, collectionNode);\n            } else {\n                // does not exist, so it may be a link/reducer/field\n                handleAddElement(reducerNode, collectionNode, key, value);\n            }\n        } else {\n            // if this field or other reducer exists within the collection\n\n            if (!collectionNode.body[key]) {\n                // can only be field or another reducer for this.\n                const reducer = collection.getReducer(key);\n                if (reducer) {\n                    // if it's another reducer\n                    return handleAddReducer(key, reducer, collectionNode);\n                }\n\n                return handleAddField(key, value, collectionNode);\n            }\n        }\n    })\n}"]}