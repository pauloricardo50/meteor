[{"type":"js","data":"//////////////////////////////////////////////////////////////////////////\n//                                                                      //\n// This is a generated file. You can view the original                  //\n// source in your browser if your browser supports source maps.         //\n// Source maps are supported by all recent versions of Chrome, Safari,  //\n// and Firefox, and by Internet Explorer 11.                            //\n//                                                                      //\n//////////////////////////////////////////////////////////////////////////\n\n\n(function () {\n\n/* Imports */\nvar Meteor = Package.meteor.Meteor;\nvar global = Package.meteor.global;\nvar meteorEnv = Package.meteor.meteorEnv;\nvar check = Package.check.check;\nvar Match = Package.check.Match;\nvar meteorInstall = Package.modules.meteorInstall;\nvar meteorBabelHelpers = Package['babel-runtime'].meteorBabelHelpers;\nvar Promise = Package.promise.Promise;\n\nvar require = meteorInstall({\"node_modules\":{\"meteor\":{\"cultofcoders:mutations\":{\"main.js\":function(require,exports,module){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                   //\n// packages/cultofcoders_mutations/main.js                                                                           //\n//                                                                                                                   //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                     //\nmodule.export({\n  Mutation: () => Mutation,\n  wrap: () => wrap\n});\nlet wrap;\nmodule.link(\"./lib/wrap\", {\n  default(v) {\n    wrap = v;\n  }\n\n}, 0);\nlet Mutation;\nmodule.link(\"./lib/mutation.class\", {\n  default(v) {\n    Mutation = v;\n  }\n\n}, 1);\nmodule.link(\"./lib/debug\");\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"lib\":{\"aop.js\":function(require,exports,module){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                   //\n// packages/cultofcoders_mutations/lib/aop.js                                                                        //\n//                                                                                                                   //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                     //\nclass AOP {\n  constructor() {\n    this.befores = [];\n    this.afters = [];\n  }\n\n  addBefore(fn) {\n    check(fn, Function);\n    this.befores.push(fn);\n  }\n\n  addAfter(fn) {\n    check(fn, Function);\n    this.afters.push(fn);\n  }\n\n  executeBefores() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    this.befores.forEach(fn => fn.call(null, ...args));\n  }\n\n  executeAfters() {\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    this.afters.forEach(fn => fn.call(null, ...args));\n  }\n\n}\n\nmodule.exportDefault(AOP);\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"debug.js\":function(require,exports,module){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                   //\n// packages/cultofcoders_mutations/lib/debug.js                                                                      //\n//                                                                                                                   //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                     //\nlet Mutation;\nmodule.link(\"./mutation.class\", {\n  default(v) {\n    Mutation = v;\n  }\n\n}, 0);\nObject.assign(Mutation, {\n  isDebugEnabled: Meteor.isDevelopment || process.env.MUTATION_DEBUG_ENABLED\n});\nMutation.addBeforeCall((_ref) => {\n  let {\n    config,\n    params,\n    context\n  } = _ref;\n\n  if (Mutation.isDebugEnabled) {\n    console.log(\"[mutations][\".concat(config.name, \"] Calling with params:\"), params);\n  }\n});\nMutation.addAfterCall((_ref2) => {\n  let {\n    config,\n    params,\n    context,\n    result,\n    error\n  } = _ref2;\n\n  if (Mutation.isDebugEnabled) {\n    const time = new Date();\n\n    if (!error) {\n      console.log(\"[mutations][\".concat(config.name, \"] Received result:\"), result);\n    } else {\n      console.error(\"[mutations][\".concat(config.name, \"] Received error:\"), error);\n    }\n  }\n});\nMutation.addBeforeExecution((_ref3) => {\n  let {\n    config,\n    params,\n    context\n  } = _ref3;\n\n  if (Mutation.isDebugEnabled) {\n    const time = new Date();\n    console.log(\"[mutations][\".concat(config.name, \"] Received call with params: \").concat(JSON.stringify(params)));\n  }\n});\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"mutation.class.js\":function(require,exports,module){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                   //\n// packages/cultofcoders_mutations/lib/mutation.class.js                                                             //\n//                                                                                                                   //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                     //\nmodule.export({\n  default: () => Mutation\n});\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet AOP;\nmodule.link(\"./aop\", {\n  default(v) {\n    AOP = v;\n  }\n\n}, 1);\nlet check, Match;\nmodule.link(\"meteor/check\", {\n  check(v) {\n    check = v;\n  },\n\n  Match(v) {\n    Match = v;\n  }\n\n}, 2);\n\nclass Mutation {\n  constructor(config) {\n    Mutation.checkDefaultConfig(config);\n    this.config = config;\n    this.callAOP = new AOP();\n    this.executionAOP = new AOP();\n  }\n  /**\n   * @param {Function} fn\n   */\n\n\n  static addBeforeCall(fn) {\n    this.callAOP.addBefore(fn);\n  }\n  /**\n   * @param {Function} fn\n   */\n\n\n  static addAfterCall(fn) {\n    this.callAOP.addAfter(fn);\n  }\n  /**\n   * @param {Function} fn\n   */\n\n\n  static addBeforeExecution(fn) {\n    this.executionAOP.addBefore(fn);\n  }\n  /**\n   * @param {Function} fn\n   */\n\n\n  static addAfterExecution(fn) {\n    this.executionAOP.addAfter(fn);\n  }\n  /**\n   * @param {Object} config\n   */\n\n\n  static checkDefaultConfig(config) {\n    check(config, Object);\n\n    if (typeof config.name !== 'string') {\n      throw new Meteor.Error('invalid-config', 'You must provide a \"name\" property to your mutation config.');\n    }\n  }\n  /**\n   * @param {Function} fn\n   */\n\n\n  addBeforeCall(fn) {\n    this.callAOP.addBefore(fn);\n  }\n  /**\n   * @param {Function} fn\n   */\n\n\n  addAfterCall(fn) {\n    this.callAOP.addAfter(fn);\n  }\n  /**\n   * @param {Function} fn\n   */\n\n\n  addBeforeExecution(fn) {\n    this.executionAOP.addBefore(fn);\n  }\n  /**\n   * @param {Function} fn\n   */\n\n\n  addAfterExecution(fn) {\n    this.executionAOP.addAfter(fn);\n  }\n  /**\n   * Runs the mutation inside a promise\n   * @param {Object} callParams\n   * @param {Object} options Meteor options https://docs.meteor.com/api/methods.html#Meteor-apply\n   * @returns {Promise}\n   */\n\n\n  run(callParams) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const config = this.config;\n    const aopData = {\n      config,\n      params: callParams\n    };\n    Mutation.callAOP.executeBefores(aopData);\n    this.callAOP.executeBefores(aopData);\n    const {\n      name,\n      params\n    } = config;\n    return new Promise((resolve, reject) => {\n      Meteor.apply(name, [callParams], options, (error, result) => {\n        const aopData = {\n          config,\n          params: callParams,\n          result,\n          error\n        };\n        Mutation.callAOP.executeAfters(aopData);\n        this.callAOP.executeAfters(aopData);\n\n        if (error) {\n          reject(error);\n        } else {\n          resolve(result);\n        }\n      });\n    });\n  }\n  /**\n   * Creates the Meteor Method and the handler for it\n   * @param {Function} fn\n   */\n\n\n  setHandler(fn) {\n    const config = this.config;\n    const {\n      name,\n      params\n    } = config;\n    const self = this;\n    Meteor.methods({\n      [name]() {\n        let params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n        if (config.params) {\n          check(params, config.params);\n        }\n\n        let aopData = {\n          context: this,\n          config,\n          params\n        };\n        Mutation.executionAOP.executeBefores(aopData);\n        self.executionAOP.executeBefores(aopData);\n        let error, result;\n\n        try {\n          result = fn.call(null, this, params);\n        } catch (e) {\n          error = e;\n        }\n\n        aopData = {\n          context: this,\n          config,\n          params,\n          result,\n          error\n        };\n        Mutation.executionAOP.executeAfters(aopData);\n        self.executionAOP.executeAfters(aopData);\n\n        if (error) {\n          throw error;\n        }\n\n        return result;\n      }\n\n    });\n  }\n\n}\n\nMutation.callAOP = new AOP();\nMutation.executionAOP = new AOP();\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"wrap.js\":function(require,exports,module){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                   //\n// packages/cultofcoders_mutations/lib/wrap.js                                                                       //\n//                                                                                                                   //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                     //\nmodule.export({\n  default: () => wrap\n});\nlet Mutation;\nmodule.link(\"./mutation.class\", {\n  default(v) {\n    Mutation = v;\n  }\n\n}, 0);\n\nfunction wrap(config) {\n  return new Mutation(config);\n}\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}}}}},{\n  \"extensions\": [\n    \".js\",\n    \".json\"\n  ]\n});\n\nvar exports = require(\"/node_modules/meteor/cultofcoders:mutations/main.js\");\n\n/* Exports */\nPackage._define(\"cultofcoders:mutations\", exports);\n\n})();\n","servePath":"/packages/cultofcoders_mutations.js","sourceMap":{"version":3,"sources":["packages/cultofcoders:mutations/main.js","packages/cultofcoders:mutations/lib/aop.js","packages/cultofcoders:mutations/lib/debug.js","packages/cultofcoders:mutations/lib/mutation.class.js","packages/cultofcoders:mutations/lib/wrap.js"],"names":["module","export","Mutation","wrap","link","default","v","AOP","befores","afters","addBefore","fn","check","Function","push","addAfter","executeBefores","args","forEach","call","executeAfters","exportDefault","Object","assign","isDebugEnabled","Meteor","isDevelopment","process","env","MUTATION_DEBUG_ENABLED","addBeforeCall","config","params","context","console","log","name","addAfterCall","result","error","time","Date","addBeforeExecution","JSON","stringify","Match","constructor","checkDefaultConfig","callAOP","executionAOP","addAfterExecution","Error","run","callParams","options","aopData","Promise","resolve","reject","apply","setHandler","self","methods","e"],"mappings":"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","file":"/packages/cultofcoders_mutations.js","sourcesContent":["import wrap from './lib/wrap';\nimport Mutation from './lib/mutation.class';\nimport './lib/debug';\n\nexport { Mutation, wrap };\n","class AOP {\n    befores = [];\n    afters = [];\n\n    addBefore(fn) {\n        check(fn, Function);\n\n        this.befores.push(fn);\n    }\n\n    addAfter(fn) {\n        check(fn, Function);\n\n        this.afters.push(fn);\n    }\n\n    executeBefores(...args) {\n        this.befores.forEach(fn => fn.call(null, ...args));\n    }\n\n    executeAfters(...args) {\n        this.afters.forEach(fn => fn.call(null, ...args));\n    }\n}\n\nexport default AOP;\n","import Mutation from './mutation.class';\n\nObject.assign(Mutation, {\n    isDebugEnabled: Meteor.isDevelopment || process.env.MUTATION_DEBUG_ENABLED,\n});\n\nMutation.addBeforeCall(({ config, params, context }) => {\n    if (Mutation.isDebugEnabled) {\n        console.log(`[mutations][${config.name}] Calling with params:`, params);\n    }\n});\n\nMutation.addAfterCall(({ config, params, context, result, error }) => {\n    if (Mutation.isDebugEnabled) {\n        const time = new Date();\n\n        if (!error) {\n            console.log(`[mutations][${config.name}] Received result:`, result);\n        } else {\n            console.error(`[mutations][${config.name}] Received error:`, error);\n        }\n    }\n});\n\nMutation.addBeforeExecution(({ config, params, context }) => {\n    if (Mutation.isDebugEnabled) {\n        const time = new Date();\n        console.log(\n            `[mutations][${\n                config.name\n            }] Received call with params: ${JSON.stringify(params)}`\n        );\n    }\n});\n","import { Meteor } from 'meteor/meteor';\nimport AOP from './aop';\nimport { check, Match } from 'meteor/check';\n\nexport default class Mutation {\n    static callAOP = new AOP();\n    static executionAOP = new AOP();\n\n    constructor(config) {\n        Mutation.checkDefaultConfig(config);\n\n        this.config = config;\n        this.callAOP = new AOP();\n        this.executionAOP = new AOP();\n    }\n\n    /**\n     * @param {Function} fn\n     */\n    static addBeforeCall(fn) {\n        this.callAOP.addBefore(fn);\n    }\n\n    /**\n     * @param {Function} fn\n     */\n    static addAfterCall(fn) {\n        this.callAOP.addAfter(fn);\n    }\n\n    /**\n     * @param {Function} fn\n     */\n    static addBeforeExecution(fn) {\n        this.executionAOP.addBefore(fn);\n    }\n\n    /**\n     * @param {Function} fn\n     */\n    static addAfterExecution(fn) {\n        this.executionAOP.addAfter(fn);\n    }\n\n    /**\n     * @param {Object} config\n     */\n    static checkDefaultConfig(config) {\n        check(config, Object);\n        if (typeof config.name !== 'string') {\n            throw new Meteor.Error(\n                'invalid-config',\n                'You must provide a \"name\" property to your mutation config.'\n            );\n        }\n    }\n\n    /**\n     * @param {Function} fn\n     */\n    addBeforeCall(fn) {\n        this.callAOP.addBefore(fn);\n    }\n\n    /**\n     * @param {Function} fn\n     */\n    addAfterCall(fn) {\n        this.callAOP.addAfter(fn);\n    }\n\n    /**\n     * @param {Function} fn\n     */\n    addBeforeExecution(fn) {\n        this.executionAOP.addBefore(fn);\n    }\n\n    /**\n     * @param {Function} fn\n     */\n    addAfterExecution(fn) {\n        this.executionAOP.addAfter(fn);\n    }\n\n    /**\n     * Runs the mutation inside a promise\n     * @param {Object} callParams\n     * @param {Object} options Meteor options https://docs.meteor.com/api/methods.html#Meteor-apply\n     * @returns {Promise}\n     */\n    run(callParams, options = {}) {\n        const config = this.config;\n\n        const aopData = { config, params: callParams };\n        Mutation.callAOP.executeBefores(aopData);\n        this.callAOP.executeBefores(aopData);\n\n        const { name, params } = config;\n\n        return new Promise((resolve, reject) => {\n            Meteor.apply(name, [callParams], options, (error, result) => {\n                const aopData = {\n                    config,\n                    params: callParams,\n                    result,\n                    error,\n                };\n\n                Mutation.callAOP.executeAfters(aopData);\n                this.callAOP.executeAfters(aopData);\n\n                if (error) {\n                    reject(error);\n                } else {\n                    resolve(result);\n                }\n            });\n        });\n    }\n\n    /**\n     * Creates the Meteor Method and the handler for it\n     * @param {Function} fn\n     */\n    setHandler(fn) {\n        const config = this.config;\n        const { name, params } = config;\n        const self = this;\n\n        Meteor.methods({\n            [name](params = {}) {\n                if (config.params) {\n                    check(params, config.params);\n                }\n\n                let aopData = {\n                    context: this,\n                    config,\n                    params,\n                };\n\n                Mutation.executionAOP.executeBefores(aopData);\n                self.executionAOP.executeBefores(aopData);\n\n                let error, result;\n                try {\n                    result = fn.call(null, this, params);\n                } catch (e) {\n                    error = e;\n                }\n\n                aopData = {\n                    context: this,\n                    config,\n                    params,\n                    result,\n                    error,\n                };\n\n                Mutation.executionAOP.executeAfters(aopData);\n                self.executionAOP.executeAfters(aopData);\n\n                if (error) {\n                    throw error;\n                }\n\n                return result;\n            },\n        });\n    }\n}\n","import Mutation from './mutation.class';\n\nexport default function wrap(config) {\n    return new Mutation(config);\n}\n"]}}]