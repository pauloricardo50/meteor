{"version":3,"sources":["meteor://ðŸ’»app/packages/hwillson:stub-collections/stub_collections.js"],"names":["_","module","watch","require","v","Mongo","sinon","StubCollections","publicApi","privateApi","add","collections","push","stub","pendingCollections","concat","forEach","collection","pairs","_name","options","transform","_transform","pair","localCollection","constructor","stubPair","restore","sandbox","create","symbols","symbol","Collection","prototype","isFunction","bind","exportDefault"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA,IAAIA,CAAJ;;AAAMC,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACH,IAAEI,CAAF,EAAI;AAACJ,QAAEI,CAAF;AAAI;;AAAV,CAA1C,EAAsD,CAAtD;AAAyD,IAAIC,KAAJ;AAAUJ,OAAOC,KAAP,CAAaC,QAAQ,cAAR,CAAb,EAAqC;AAACE,QAAMD,CAAN,EAAQ;AAACC,YAAMD,CAAN;AAAQ;;AAAlB,CAArC,EAAyD,CAAzD;AAA4D,IAAIE,KAAJ;AAAUL,OAAOC,KAAP,CAAaC,QAAQ,8BAAR,CAAb,EAAqD;AAACG,QAAMF,CAAN,EAAQ;AAACE,YAAMF,CAAN;AAAQ;;AAAlB,CAArD,EAAyE,CAAzE;;AAI/I,MAAMG,kBAAkB,CAAC,MAAM;AAC7B,QAAMC,YAAY,EAAlB;AACA,QAAMC,aAAa,EAAnB,CAF6B,CAI7B;;AAEAD,YAAUE,GAAV,GAAiBC,WAAD,IAAiB;AAC/BF,eAAWE,WAAX,CAAuBC,IAAvB,CAA4B,GAAGD,WAA/B;AACD,GAFD;;AAIAH,YAAUK,IAAV,GAAkBF,WAAD,IAAiB;AAChC,UAAMG,qBAAqBH,eAAeF,WAAWE,WAArD;AACA,OAAGI,MAAH,CAAUD,kBAAV,EAA8BE,OAA9B,CAAuCC,UAAD,IAAgB;AACpD,UAAI,CAACR,WAAWS,KAAX,CAAiBD,WAAWE,KAA5B,CAAL,EAAyC;AACvC,cAAMC,UAAU;AACdC,qBAAWJ,WAAWK;AADR,SAAhB;AAGA,cAAMC,OAAO;AACXC,2BAAiB,IAAIP,WAAWQ,WAAf,CAA2B,IAA3B,EAAiCL,OAAjC,CADN;AAEXH;AAFW,SAAb;AAIAR,mBAAWiB,QAAX,CAAoBH,IAApB;AACAd,mBAAWS,KAAX,CAAiBD,WAAWE,KAA5B,IAAqCI,IAArC;AACD;AACF,KAZD;AAaD,GAfD;;AAiBAf,YAAUmB,OAAV,GAAoB,MAAM;AACxBlB,eAAWmB,OAAX,CAAmBD,OAAnB;AACAlB,eAAWS,KAAX,GAAmB,EAAnB;AACD,GAHD,CA3B6B,CAgC7B;;AAEAT,aAAWmB,OAAX,GAAqBtB,MAAMsB,OAAN,CAAcC,MAAd,EAArB;AACApB,aAAWS,KAAX,GAAmB,EAAnB;AACAT,aAAWE,WAAX,GAAyB,EAAzB;AACAF,aAAWqB,OAAX,GAAqB,EAArB;;AACA,OAAK,IAAIC,MAAT,IAAmB1B,MAAM2B,UAAN,CAAiBC,SAApC,EAA+C;AAC7CxB,eAAWqB,OAAX,CAAmBlB,IAAnB,CAAwBmB,MAAxB;AACD;;AAEDtB,aAAWiB,QAAX,GAAuBH,IAAD,IAAU;AAC9Bd,eAAWqB,OAAX,CAAmBd,OAAnB,CAA4Be,MAAD,IAAY;AACrC,UAAI/B,EAAEkC,UAAF,CAAaX,KAAKC,eAAL,CAAqBO,MAArB,CAAb,KACGA,UAAU,cADjB,EACiC;AAC/BtB,mBAAWmB,OAAX,CAAmBf,IAAnB,CACEU,KAAKN,UADP,EAEEc,MAFF,EAGE/B,EAAEmC,IAAF,CAAOZ,KAAKC,eAAL,CAAqBO,MAArB,CAAP,EAAqCR,KAAKC,eAA1C,CAHF;AAKD;AACF,KATD;AAUD,GAXD;;AAaA,SAAOhB,SAAP;AACD,CAxDuB,GAAxB;;AAJAP,OAAOmC,aAAP,CA8De7B,eA9Df,E","file":"/packages/hwillson_stub-collections.js","sourcesContent":["import { _ } from 'meteor/underscore';\nimport { Mongo } from 'meteor/mongo';\nimport { sinon } from 'meteor/practicalmeteor:sinon';\n\nconst StubCollections = (() => {\n  const publicApi = {};\n  const privateApi = {};\n\n  /* Public API */\n\n  publicApi.add = (collections) => {\n    privateApi.collections.push(...collections);\n  };\n\n  publicApi.stub = (collections) => {\n    const pendingCollections = collections || privateApi.collections;\n    [].concat(pendingCollections).forEach((collection) => {\n      if (!privateApi.pairs[collection._name]) {\n        const options = {\n          transform: collection._transform,\n        };\n        const pair = {\n          localCollection: new collection.constructor(null, options),\n          collection,\n        };\n        privateApi.stubPair(pair);\n        privateApi.pairs[collection._name] = pair;\n      }\n    });\n  };\n\n  publicApi.restore = () => {\n    privateApi.sandbox.restore();\n    privateApi.pairs = {};\n  };\n\n  /* Private API */\n\n  privateApi.sandbox = sinon.sandbox.create();\n  privateApi.pairs = {};\n  privateApi.collections = [];\n  privateApi.symbols = [];\n  for (let symbol in Mongo.Collection.prototype) {\n    privateApi.symbols.push(symbol);\n  }\n\n  privateApi.stubPair = (pair) => {\n    privateApi.symbols.forEach((symbol) => {\n      if (_.isFunction(pair.localCollection[symbol]) \n          && symbol != 'simpleSchema') {\n        privateApi.sandbox.stub(\n          pair.collection,\n          symbol,\n          _.bind(pair.localCollection[symbol], pair.localCollection)\n        );\n      }\n    });\n  };\n\n  return publicApi;\n})();\n\nexport default StubCollections;\n"]}