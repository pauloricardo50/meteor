{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"meteor/meteor","imported":["Meteor"],"specifiers":[{"kind":"named","imported":"Meteor","local":"Meteor"}]},{"source":"../..","imported":["SecurityService","createMutator"],"specifiers":[{"kind":"named","imported":"SecurityService","local":"SecurityService"},{"kind":"named","imported":"createMutator","local":"createMutator"}]},{"source":"../OfferService","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"OfferService"}]},{"source":"../mutationDefinitions","imported":["*"],"specifiers":[{"kind":"namespace","local":"defs"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"imports/core/api/offers/server/mutations.js","filenameRelative":"imports/core/api/offers/server/mutations.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"useNativeAsyncAwait":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"imports/core/api/offers/server/mutations.js.map","sourceFileName":"imports/core/api/offers/server/mutations.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"mutations"},"ignored":false,"code":"\"use strict\";\n\nvar _Meteor = void 0;\n\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function Meteor(v) {\n    _Meteor = v;\n  }\n}, 0);\n\nvar _SecurityService = void 0,\n    _createMutator = void 0;\n\nmodule.watch(require(\"../..\"), {\n  SecurityService: function SecurityService(v) {\n    _SecurityService = v;\n  },\n  createMutator: function createMutator(v) {\n    _createMutator = v;\n  }\n}, 1);\nvar OfferService = void 0;\nmodule.watch(require(\"../OfferService\"), {\n  default: function _default(v) {\n    OfferService = v;\n  }\n}, 2);\nvar defs = void 0;\nmodule.watch(require(\"../mutationDefinitions\"), {\n  \"*\": function _(v) {\n    defs = v;\n  }\n}, 3);\n\n_createMutator(defs.OFFER_INSERT, function (_ref) {\n  var offer = _ref.offer,\n      userId = _ref.userId;\n  var userIdIsDefined = userId !== undefined;\n\n  if (userIdIsDefined) {\n    _SecurityService.checkCurrentUserIsAdmin();\n  } else {\n    _SecurityService.offers.isAllowedToInsert();\n  }\n\n  return OfferService.insert({\n    offer: offer,\n    userId: userIdIsDefined ? userId : _Meteor.userId()\n  });\n});\n\n_createMutator(defs.OFFER_INSERT_ADMIN, function (_ref2) {\n  var offer = _ref2.offer,\n      loan = _ref2.loan;\n\n  _SecurityService.checkLoggedIn();\n\n  if (_SecurityService.currentUserIsAdmin()) {\n    return OfferService.insertAdminOffer({\n      offer: offer,\n      loan: loan\n    });\n  }\n\n  return null;\n});\n\n_createMutator(defs.OFFER_UPDATE, function (_ref3) {\n  var offerId = _ref3.offerId,\n      offer = _ref3.offer;\n\n  _SecurityService.offers.isAllowedToUpdate(offerId);\n\n  return OfferService.update({\n    offerId: offerId,\n    offer: offer\n  });\n});\n\n_createMutator(defs.OFFER_DELETE, function (_ref4) {\n  var offerId = _ref4.offerId;\n\n  _SecurityService.offers.isAllowedToDelete(offerId);\n\n  return OfferService.remove({\n    offerId: offerId\n  });\n});","map":{"version":3,"sources":["imports/core/api/offers/server/mutations.js"],"names":["Meteor","module","watch","require","v","SecurityService","createMutator","OfferService","default","defs","OFFER_INSERT","offer","userId","userIdIsDefined","undefined","checkCurrentUserIsAdmin","offers","isAllowedToInsert","insert","OFFER_INSERT_ADMIN","loan","checkLoggedIn","currentUserIsAdmin","insertAdminOffer","OFFER_UPDATE","offerId","isAllowedToUpdate","update","OFFER_DELETE","isAllowedToDelete","remove"],"mappings":";;AAAA,IAAIA,gBAAJ;;AAAWC,OAAOC,KAAP,CAAaC,QAAQ,eAAR,CAAb,EAAsC;AAACH,QAAD,kBAAQI,CAAR,EAAU;AAACJ,cAAOI,CAAP;AAAS;AAApB,CAAtC,EAA4D,CAA5D;;AAA+D,IAAIC,yBAAJ;AAAA,IAAoBC,uBAApB;;AAAkCL,OAAOC,KAAP,CAAaC,QAAQ,OAAR,CAAb,EAA8B;AAACE,iBAAD,2BAAiBD,CAAjB,EAAmB;AAACC,uBAAgBD,CAAhB;AAAkB,GAAtC;AAAuCE,eAAvC,yBAAqDF,CAArD,EAAuD;AAACE,qBAAcF,CAAd;AAAgB;AAAxE,CAA9B,EAAwG,CAAxG;AAA2G,IAAIG,qBAAJ;AAAiBN,OAAOC,KAAP,CAAaC,QAAQ,iBAAR,CAAb,EAAwC;AAACK,SAAD,oBAASJ,CAAT,EAAW;AAACG,mBAAaH,CAAb;AAAe;AAA3B,CAAxC,EAAqE,CAArE;AAAwE,IAAIK,aAAJ;AAASR,OAAOC,KAAP,CAAaC,QAAQ,wBAAR,CAAb,EAA+C;AAAC,KAAD,aAAKC,CAAL,EAAO;AAACK,WAAKL,CAAL;AAAO;AAAf,CAA/C,EAAgE,CAAhE;;AAMzTE,eAAcG,KAAKC,YAAnB,EAAiC,gBAAuB;AAAA,MAApBC,KAAoB,QAApBA,KAAoB;AAAA,MAAbC,MAAa,QAAbA,MAAa;AACtD,MAAMC,kBAAkBD,WAAWE,SAAnC;;AACA,MAAID,eAAJ,EAAqB;AACnBR,qBAAgBU,uBAAhB;AACD,GAFD,MAEO;AACLV,qBAAgBW,MAAhB,CAAuBC,iBAAvB;AACD;;AAED,SAAOV,aAAaW,MAAb,CAAoB;AACzBP,gBADyB;AAEzBC,YAAQC,kBAAkBD,MAAlB,GAA2BZ,QAAOY,MAAP;AAFV,GAApB,CAAP;AAID,CAZD;;AAcAN,eAAcG,KAAKU,kBAAnB,EAAuC,iBAAqB;AAAA,MAAlBR,KAAkB,SAAlBA,KAAkB;AAAA,MAAXS,IAAW,SAAXA,IAAW;;AAC1Df,mBAAgBgB,aAAhB;;AACA,MAAIhB,iBAAgBiB,kBAAhB,EAAJ,EAA0C;AACxC,WAAOf,aAAagB,gBAAb,CAA8B;AAAEZ,kBAAF;AAASS;AAAT,KAA9B,CAAP;AACD;;AACD,SAAO,IAAP;AACD,CAND;;AAQAd,eAAcG,KAAKe,YAAnB,EAAiC,iBAAwB;AAAA,MAArBC,OAAqB,SAArBA,OAAqB;AAAA,MAAZd,KAAY,SAAZA,KAAY;;AACvDN,mBAAgBW,MAAhB,CAAuBU,iBAAvB,CAAyCD,OAAzC;;AACA,SAAOlB,aAAaoB,MAAb,CAAoB;AAAEF,oBAAF;AAAWd;AAAX,GAApB,CAAP;AACD,CAHD;;AAKAL,eAAcG,KAAKmB,YAAnB,EAAiC,iBAAiB;AAAA,MAAdH,OAAc,SAAdA,OAAc;;AAChDpB,mBAAgBW,MAAhB,CAAuBa,iBAAvB,CAAyCJ,OAAzC;;AACA,SAAOlB,aAAauB,MAAb,CAAoB;AAAEL;AAAF,GAApB,CAAP;AACD,CAHD","file":"imports/core/api/offers/server/mutations.js.map","sourcesContent":["import { Meteor } from 'meteor/meteor';\n\nimport { SecurityService, createMutator } from '../..';\nimport OfferService from '../OfferService';\nimport * as defs from '../mutationDefinitions';\n\ncreateMutator(defs.OFFER_INSERT, ({ offer, userId }) => {\n  const userIdIsDefined = userId !== undefined;\n  if (userIdIsDefined) {\n    SecurityService.checkCurrentUserIsAdmin();\n  } else {\n    SecurityService.offers.isAllowedToInsert();\n  }\n\n  return OfferService.insert({\n    offer,\n    userId: userIdIsDefined ? userId : Meteor.userId(),\n  });\n});\n\ncreateMutator(defs.OFFER_INSERT_ADMIN, ({ offer, loan }) => {\n  SecurityService.checkLoggedIn();\n  if (SecurityService.currentUserIsAdmin()) {\n    return OfferService.insertAdminOffer({ offer, loan });\n  }\n  return null;\n});\n\ncreateMutator(defs.OFFER_UPDATE, ({ offerId, offer }) => {\n  SecurityService.offers.isAllowedToUpdate(offerId);\n  return OfferService.update({ offerId, offer });\n});\n\ncreateMutator(defs.OFFER_DELETE, ({ offerId }) => {\n  SecurityService.offers.isAllowedToDelete(offerId);\n  return OfferService.remove({ offerId });\n});\n"]},"hash":"18573e737fe0e905239bc4d5186fd4fca2ba2905"}
