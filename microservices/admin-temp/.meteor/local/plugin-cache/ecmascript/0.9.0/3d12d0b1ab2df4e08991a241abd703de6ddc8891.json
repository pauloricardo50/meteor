{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"../config/constants","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"constants"}]},{"source":"../api/constants","imported":["USAGE_TYPE"],"specifiers":[{"kind":"named","imported":"USAGE_TYPE","local":"USAGE_TYPE"}]}],"exports":{"exported":["getMinIncome","getMinFortune","changeProperty","changeFortune","changeIncome","getRealMonthly","getTheoreticalMonthly","getIncomeRatio","getBorrowRatio","isFinished","getProject","getBonusIncome","getIncome","getOtherIncome","getFortune","getInsuranceFortune","getRealEstateFortune","getRealEstateValue","getRealEstateDebt","getExpenses","getMonthly","getMonthlyReal","calculateProperty","getLenderCount","getRatio","getBorrow","getRetirement","getMaxLoan"],"specifiers":[{"kind":"local","local":"getMinIncome","exported":"getMinIncome"},{"kind":"local","local":"getMinFortune","exported":"getMinFortune"},{"kind":"local","local":"changeProperty","exported":"changeProperty"},{"kind":"local","local":"changeFortune","exported":"changeFortune"},{"kind":"local","local":"changeIncome","exported":"changeIncome"},{"kind":"local","local":"getRealMonthly","exported":"getRealMonthly"},{"kind":"local","local":"getTheoreticalMonthly","exported":"getTheoreticalMonthly"},{"kind":"local","local":"getIncomeRatio","exported":"getIncomeRatio"},{"kind":"local","local":"getBorrowRatio","exported":"getBorrowRatio"},{"kind":"local","local":"isFinished","exported":"isFinished"},{"kind":"local","local":"getProject","exported":"getProject"},{"kind":"local","local":"getBonusIncome","exported":"getBonusIncome"},{"kind":"local","local":"getIncome","exported":"getIncome"},{"kind":"local","local":"getOtherIncome","exported":"getOtherIncome"},{"kind":"local","local":"getFortune","exported":"getFortune"},{"kind":"local","local":"getInsuranceFortune","exported":"getInsuranceFortune"},{"kind":"local","local":"getRealEstateFortune","exported":"getRealEstateFortune"},{"kind":"local","local":"getRealEstateValue","exported":"getRealEstateValue"},{"kind":"local","local":"getRealEstateDebt","exported":"getRealEstateDebt"},{"kind":"local","local":"getExpenses","exported":"getExpenses"},{"kind":"local","local":"getMonthly","exported":"getMonthly"},{"kind":"local","local":"getMonthlyReal","exported":"getMonthlyReal"},{"kind":"local","local":"calculateProperty","exported":"calculateProperty"},{"kind":"local","local":"getLenderCount","exported":"getLenderCount"},{"kind":"local","local":"getRatio","exported":"getRatio"},{"kind":"local","local":"getBorrow","exported":"getBorrow"},{"kind":"local","local":"getRetirement","exported":"getRetirement"},{"kind":"local","local":"getMaxLoan","exported":"getMaxLoan"}]}}},"options":{"filename":"imports/core/utils/startFunctions.js","filenameRelative":"imports/core/utils/startFunctions.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"useNativeAsyncAwait":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"imports/core/utils/startFunctions.js.map","sourceFileName":"imports/core/utils/startFunctions.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"startFunctions"},"ignored":false,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nmodule.export({\n  getMinIncome: function getMinIncome() {\n    return _getMinIncome;\n  },\n  getMinFortune: function getMinFortune() {\n    return _getMinFortune;\n  },\n  changeProperty: function changeProperty() {\n    return _changeProperty;\n  },\n  changeFortune: function changeFortune() {\n    return _changeFortune;\n  },\n  changeIncome: function changeIncome() {\n    return _changeIncome;\n  },\n  getRealMonthly: function getRealMonthly() {\n    return _getRealMonthly;\n  },\n  getTheoreticalMonthly: function getTheoreticalMonthly() {\n    return _getTheoreticalMonthly;\n  },\n  getIncomeRatio: function getIncomeRatio() {\n    return _getIncomeRatio;\n  },\n  getBorrowRatio: function getBorrowRatio() {\n    return _getBorrowRatio;\n  },\n  isFinished: function isFinished() {\n    return _isFinished;\n  },\n  getProject: function getProject() {\n    return _getProject;\n  },\n  getBonusIncome: function getBonusIncome() {\n    return _getBonusIncome;\n  },\n  getIncome: function getIncome() {\n    return _getIncome;\n  },\n  getOtherIncome: function getOtherIncome() {\n    return _getOtherIncome;\n  },\n  getFortune: function getFortune() {\n    return _getFortune;\n  },\n  getInsuranceFortune: function getInsuranceFortune() {\n    return _getInsuranceFortune;\n  },\n  getRealEstateFortune: function getRealEstateFortune() {\n    return _getRealEstateFortune;\n  },\n  getRealEstateValue: function getRealEstateValue() {\n    return _getRealEstateValue;\n  },\n  getRealEstateDebt: function getRealEstateDebt() {\n    return _getRealEstateDebt;\n  },\n  getExpenses: function getExpenses() {\n    return _getExpenses;\n  },\n  getMonthly: function getMonthly() {\n    return _getMonthly;\n  },\n  getMonthlyReal: function getMonthlyReal() {\n    return _getMonthlyReal;\n  },\n  calculateProperty: function calculateProperty() {\n    return _calculateProperty;\n  },\n  getLenderCount: function getLenderCount() {\n    return _getLenderCount;\n  },\n  getRatio: function getRatio() {\n    return _getRatio;\n  },\n  getBorrow: function getBorrow() {\n    return _getBorrow;\n  },\n  getRetirement: function getRetirement() {\n    return _getRetirement;\n  },\n  getMaxLoan: function getMaxLoan() {\n    return _getMaxLoan;\n  }\n});\nvar constants = void 0;\nmodule.watch(require(\"../config/constants\"), {\n  default: function _default(v) {\n    constants = v;\n  }\n}, 0);\n\nvar _USAGE_TYPE = void 0;\n\nexports.getMinIncome = _getMinIncome;\nmodule.watch(require(\"../api/constants\"), {\n  USAGE_TYPE: function USAGE_TYPE(v) {\n    _USAGE_TYPE = v;\n  }\n}, 1);\n\n// if 2 values are not in auto mode, set both of their minValues to 0\nvar setDefaultMinValues = function setDefaultMinValues(s, o) {\n  var isNonAuto = [s.property, s.fortune, s.income].map(function (i) {\n    return !i.auto && true;\n  });\n  var labels = ['property', 'fortune', 'income'];\n  var count = isNonAuto.reduce(function (tot, val) {\n    return val ? tot + 1 : tot;\n  }, 0);\n\n  if (count === 2) {\n    labels.forEach(function (label, i) {\n      if (isNonAuto[i]) {\n        o[label].minValue = 0;\n      }\n    });\n  }\n\n  return o;\n};\n\nvar _getMinIncome = function _getMinIncome(property, fortune) {\n  var loan = property * (1 + constants.notaryFees) - fortune;\n  var m = constants.maintenance;\n  var i = constants.interests;\n  var mR = constants.maxRatio;\n  var withAmortizing = (property * m + loan * (i + (loan - 0.65 * property) / (15 * loan))) / mR;\n  var withoutAmortizing = (property * m + loan * i) / mR;\n  return Math.ceil(Math.max(withAmortizing, withoutAmortizing) + 1);\n};\n\nvar _getMinFortune = function _getMinFortune(property, income) {\n  var m = constants.maintenance;\n  var i = constants.interests;\n  var mR = constants.maxRatio;\n  var nF = constants.notaryFees; // It has to cover 20% and notaryfees\n\n  var basicValue = property * (0.2 + nF); // When there is very little income, go to rank 1 (basically, amortization = 0)\n\n  var rank1Fortune = (property * (m + i * (1 + nF)) - mR * income) / i; // For the case that there is a reasonable amount of fortune, go to rank 2\n  // Here amortization is complex and depends on the borrow Ratio\n\n  var rank2Fortune = (property * (15 * m + nF + 0.35 + 15 * i * (1 + nF)) - mR * 15 * income) / (15 * i + 1);\n  var rankFortune = Math.max(rank1Fortune, rank2Fortune);\n  var maxFortune = Math.ceil(Math.max(0, rankFortune, basicValue)); // Make sure fortune never goes above the property value\n\n  return Math.min(maxFortune, property);\n};\n\nvar _changeProperty = function _changeProperty(state, o, property) {\n  if (state.fortune.auto && state.income.auto) {\n    o.fortune.minValue = property * (0.2 + 0.05);\n    o.income.minValue = 3 * property * (constants.maintenance + 0.8 * constants.loanCost(0.8));\n  } else if (state.fortune.auto) {\n    o.fortune.minValue = _getMinFortune(state.property.value, state.income.value);\n  } else if (state.income.auto) {\n    o.income.minValue = _getMinIncome(state.property.value, state.fortune.value);\n  }\n\n  o = setDefaultMinValues(state, o);\n  return o;\n};\n\nvar _changeFortune = function _changeFortune(state, o, fortune) {\n  if (state.property.auto && state.income.auto) {\n    o.property.minValue = fortune / (0.2 + 0.05);\n    o.income.minValue = fortune / (0.2 + 0.05) * constants.propertyToIncome(_USAGE_TYPE.PRIMARY, 0.8);\n  } else if (state.property.auto) {\n    o.property.minValue = constants.maxProperty(state.income.value, fortune);\n  } else if (state.income.auto) {\n    o.income.minValue = _getMinIncome(state.property.value, state.fortune.value);\n  }\n\n  o = setDefaultMinValues(state, o);\n  return o;\n};\n\nvar _changeIncome = function _changeIncome(state, o, income) {\n  if (state.property.auto && state.fortune.auto) {\n    o.property.minValue = income / constants.propertyToIncome(_USAGE_TYPE.PRIMARY, 0.8);\n    o.fortune.minValue = o.property.minValue * (0.2 + 0.05);\n  } else if (state.property.auto) {\n    o.property.minValue = constants.maxProperty(income, state.fortune.value);\n  } else if (state.fortune.auto) {\n    o.fortune.minValue = _getMinFortune(state.property.value, state.income.value);\n  }\n\n  o = setDefaultMinValues(state, o);\n  return o;\n};\n\nvar _getRealMonthly = function _getRealMonthly(fortune, property, borrow, interestRate) {\n  if (interestRate) {\n    return Math.max((property * constants.maintenanceReal + (property - fortune) * constants.loanCostReal(borrow, 15, interestRate)) / 12, 0);\n  }\n\n  return Math.max((property * constants.maintenanceReal + (property - fortune) * constants.loanCostReal(borrow)) / 12, 0);\n};\n\nvar _getTheoreticalMonthly = function _getTheoreticalMonthly(fortune, property, borrow) {\n  return Math.max((property * constants.maintenance + (property - fortune) * constants.loanCost(borrow)) / 12, 0);\n};\n\nvar _getIncomeRatio = function _getIncomeRatio(monthly, income) {\n  return monthly / (income / 12);\n};\n\nvar _getBorrowRatio = function _getBorrowRatio(property, fortune) {\n  return Math.max((property * 1.05 - fortune) / property, 0);\n};\n\nvar _isFinished = function _isFinished(state, minFortune) {\n  return state.finalized && !state.error && (state.fortuneUsed + (state.insuranceFortuneUsed || 0) >= minFortune || state.type === 'test');\n};\n\nvar _getProject = function _getProject(state) {\n  var property = state.propertyValue || _calculateProperty(state) || 0;\n  var project = property + (state.propertyWork || 0) + property * constants.notaryFees + (state.insuranceFortuneUsed * constants.lppFees || 0);\n  return project || 0;\n};\n\nvar _getBonusIncome = function _getBonusIncome() {\n  var arr = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n\n  if (arr.length > 4) {\n    // Ignore any value beyond the first 4\n    arr = arr.slice(0, 4);\n  } // Sum all values, remove the lowest one, and return 50% of their average\n\n\n  var safeArray = arr.map(function (v) {\n    return v || 0;\n  });\n  var sum = safeArray.reduce(function (tot, val) {\n    return tot + val;\n  }, 0);\n  var bestSum = sum - Math.min.apply(Math, _toConsumableArray(safeArray));\n  return 0.5 * (bestSum / 3) || 0;\n};\n\nvar _getIncome = function _getIncome(state) {\n  var s = state;\n\n  var bonus1 = _getBonusIncome([s.bonus11, s.bonus21, s.bonus31, s.bonus41]);\n\n  var bonus2 = _getBonusIncome([s.bonus12, s.bonus22, s.bonus32, s.bonus42]);\n\n  return [state.usageType === _USAGE_TYPE.INVESTMENT ? s.propertyRent * 12 : 0, s.income1, s.income2, bonus1, bonus2, _getOtherIncome(s.otherIncome)].reduce(function (tot, val) {\n    return val > 0 && tot + val || tot;\n  }, 0);\n};\n\nvar _getOtherIncome = function _getOtherIncome() {\n  var array = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  return [].concat(_toConsumableArray(array.map(function (i) {\n    return i.value || 0;\n  }))).reduce(function (tot, val) {\n    return val > 0 && tot + val || tot;\n  }, 0);\n};\n\nvar _getFortune = function _getFortune(state) {\n  return [state.fortune1, state.fortune2].reduce(function (tot, val) {\n    return val > 0 && tot + val || tot;\n  }, 0);\n};\n\nvar _getInsuranceFortune = function _getInsuranceFortune(state) {\n  return [state.insurance11, state.insurance12, state.insurance21, state.insurance22].reduce(function (tot, val) {\n    return val > 0 && tot + val || tot;\n  }, 0);\n};\n\nvar _getRealEstateFortune = function _getRealEstateFortune() {\n  var array = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  return [].concat(_toConsumableArray(array.map(function (i) {\n    return i.value - i.loan || 0;\n  }))).reduce(function (tot, val) {\n    return val > 0 && tot + val || tot;\n  }, 0);\n};\n\nvar _getRealEstateValue = function _getRealEstateValue() {\n  var array = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  return [].concat(_toConsumableArray(array.map(function (i) {\n    return i.value || 0;\n  }))).reduce(function (tot, val) {\n    return val > 0 && tot + val || tot;\n  }, 0);\n};\n\nvar _getRealEstateDebt = function _getRealEstateDebt() {\n  var array = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  return [].concat(_toConsumableArray(array.map(function (i) {\n    return i.loan || 0;\n  }))).reduce(function (tot, val) {\n    return val > 0 && tot + val || tot;\n  }, 0);\n};\n\nvar _getExpenses = function _getExpenses() {\n  var array = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  return [].concat(_toConsumableArray(array.map(function (i) {\n    return i.value;\n  }))).reduce(function (tot, val) {\n    return val > 0 && tot + val || tot;\n  }, 0);\n};\n\nvar _getMonthly = function _getMonthly(state, borrow, toRetirement) {\n  var s = state;\n\n  var projectValue = _getProject(state);\n\n  var propAndWork = s.propertyValue + (s.propertyWorkExists ? s.propertyWork : 0);\n  var maintenance = propAndWork * constants.maintenance;\n  var interestsAndAmortizing = (projectValue - (s.fortuneUsed || 0) - (s.insuranceFortuneUsed || 0)) * constants.loanCost(borrow, toRetirement);\n  var cost = (maintenance + interestsAndAmortizing) / 12;\n  return Math.max(cost, 0);\n};\n\nvar _getMonthlyReal = function _getMonthlyReal(state, borrow, toRetirement) {\n  var s = state;\n\n  var projectValue = _getProject(state);\n\n  var propAndWork = s.propertyValue + (s.propertyWork || 0);\n  return Math.max((propAndWork * constants.maintenanceReal + (projectValue - (s.fortuneUsed || 0) - (s.insuranceFortuneUsed || 0)) * constants.loanCostReal(borrow, toRetirement)) / 12, 0);\n};\n\nvar _calculateProperty = function _calculateProperty(fortune, insuranceFortune, income, usageType, toRetirement) {\n  return constants.maxProperty(income, fortune, insuranceFortune, usageType, toRetirement);\n};\n\nvar _getLenderCount = function _getLenderCount(borrow, ratio) {\n  if (ratio > 0.38) {\n    return 0;\n  } else if (ratio > 1 / 3) {\n    return 4;\n  } else if (borrow <= 0.65) {\n    return 30;\n  } else if (borrow > 0.65 && borrow <= 0.9) {\n    return 20;\n  }\n\n  return 0;\n};\n\nvar _getRatio = function _getRatio(income, expenses, monthly) {\n  return income - expenses !== 0 && monthly / ((income - expenses) / 12);\n};\n\nvar _getBorrow = function _getBorrow(totalFortune, propAndWork, fees) {\n  return totalFortune && propAndWork !== 0 && Math.max((propAndWork - (totalFortune - fees)) / propAndWork, 0) || 0;\n};\n\nvar _getRetirement = function _getRetirement(state) {\n  var multiple = state.borrowerCount > 1;\n  var age = multiple ? state.oldestAge : state.age;\n  var gender = multiple ? state.oldestGender : state.gender;\n\n  if (age && gender) {\n    var retirement = gender === 'f' ? 64 : 65;\n    return Math.max(retirement - age, 0);\n  }\n\n  return 100;\n};\n\nvar _getMaxLoan = function _getMaxLoan(state, income, fortune, insuranceFortune, toRetirement, propAndWork) {\n  var property = state.propertyValue;\n  var maintenance = property * constants.maintenance;\n  var mR = constants.maxRatio;\n  var i = constants.interests;\n  var maxLoan = state.usageType === _USAGE_TYPE.SECONDARY ? Math.floor(0.7 * propAndWork) : Math.floor(0.8 * propAndWork); // Check LaTeX document, equation 15, and solve for the loan\n\n  var calculatedMaxLoan = (toRetirement * (mR * income - maintenance) + 0.65 * property) / (i * toRetirement + 1); // Floor this value to make sure the user can afford it if any rounding\n  // happens, If it had to round up, it would be too expensive\n\n  return Math.floor(Math.min(maxLoan, calculatedMaxLoan));\n};","map":{"version":3,"sources":["imports/core/utils/startFunctions.js"],"names":["module","export","getMinIncome","getMinFortune","changeProperty","changeFortune","changeIncome","getRealMonthly","getTheoreticalMonthly","getIncomeRatio","getBorrowRatio","isFinished","getProject","getBonusIncome","getIncome","getOtherIncome","getFortune","getInsuranceFortune","getRealEstateFortune","getRealEstateValue","getRealEstateDebt","getExpenses","getMonthly","getMonthlyReal","calculateProperty","getLenderCount","getRatio","getBorrow","getRetirement","getMaxLoan","constants","watch","require","default","v","USAGE_TYPE","setDefaultMinValues","s","o","isNonAuto","property","fortune","income","map","i","auto","labels","count","reduce","tot","val","forEach","label","minValue","loan","notaryFees","m","maintenance","interests","mR","maxRatio","withAmortizing","withoutAmortizing","Math","ceil","max","nF","basicValue","rank1Fortune","rank2Fortune","rankFortune","maxFortune","min","state","loanCost","value","propertyToIncome","PRIMARY","maxProperty","borrow","interestRate","maintenanceReal","loanCostReal","monthly","minFortune","finalized","error","fortuneUsed","insuranceFortuneUsed","type","propertyValue","project","propertyWork","lppFees","arr","length","slice","safeArray","sum","bestSum","bonus1","bonus11","bonus21","bonus31","bonus41","bonus2","bonus12","bonus22","bonus32","bonus42","usageType","INVESTMENT","propertyRent","income1","income2","otherIncome","array","fortune1","fortune2","insurance11","insurance12","insurance21","insurance22","toRetirement","projectValue","propAndWork","propertyWorkExists","interestsAndAmortizing","cost","insuranceFortune","ratio","expenses","totalFortune","fees","multiple","borrowerCount","age","oldestAge","gender","oldestGender","retirement","maxLoan","SECONDARY","floor","calculatedMaxLoan"],"mappings":"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","file":"imports/core/utils/startFunctions.js.map","sourcesContent":["import constants from '../config/constants';\nimport { USAGE_TYPE } from '../api/constants';\n\n// if 2 values are not in auto mode, set both of their minValues to 0\nconst setDefaultMinValues = (s, o) => {\n  const isNonAuto = [s.property, s.fortune, s.income].map(i => !i.auto && true);\n  const labels = ['property', 'fortune', 'income'];\n  const count = isNonAuto.reduce((tot, val) => (val ? tot + 1 : tot), 0);\n\n  if (count === 2) {\n    labels.forEach((label, i) => {\n      if (isNonAuto[i]) {\n        o[label].minValue = 0;\n      }\n    });\n  }\n\n  return o;\n};\n\nexport const getMinIncome = (property, fortune) => {\n  const loan = property * (1 + constants.notaryFees) - fortune;\n  const m = constants.maintenance;\n  const i = constants.interests;\n  const mR = constants.maxRatio;\n\n  const withAmortizing =\n    (property * m + loan * (i + (loan - 0.65 * property) / (15 * loan))) / mR;\n\n  const withoutAmortizing = (property * m + loan * i) / mR;\n\n  return Math.ceil(Math.max(withAmortizing, withoutAmortizing) + 1);\n};\n\nexport const getMinFortune = (property, income) => {\n  const m = constants.maintenance;\n  const i = constants.interests;\n  const mR = constants.maxRatio;\n  const nF = constants.notaryFees;\n\n  // It has to cover 20% and notaryfees\n  const basicValue = property * (0.2 + nF);\n\n  // When there is very little income, go to rank 1 (basically, amortization = 0)\n  const rank1Fortune = (property * (m + i * (1 + nF)) - mR * income) / i;\n\n  // For the case that there is a reasonable amount of fortune, go to rank 2\n  // Here amortization is complex and depends on the borrow Ratio\n  const rank2Fortune =\n    (property * (15 * m + nF + 0.35 + 15 * i * (1 + nF)) - mR * 15 * income) /\n    (15 * i + 1);\n\n  const rankFortune = Math.max(rank1Fortune, rank2Fortune);\n\n  const maxFortune = Math.ceil(Math.max(0, rankFortune, basicValue));\n\n  // Make sure fortune never goes above the property value\n  return Math.min(maxFortune, property);\n};\n\nexport const changeProperty = (state, o, property) => {\n  if (state.fortune.auto && state.income.auto) {\n    o.fortune.minValue = property * (0.2 + 0.05);\n    o.income.minValue =\n      3 * property * (constants.maintenance + 0.8 * constants.loanCost(0.8));\n  } else if (state.fortune.auto) {\n    o.fortune.minValue = getMinFortune(\n      state.property.value,\n      state.income.value,\n    );\n  } else if (state.income.auto) {\n    o.income.minValue = getMinIncome(state.property.value, state.fortune.value);\n  }\n\n  o = setDefaultMinValues(state, o);\n\n  return o;\n};\n\nexport const changeFortune = (state, o, fortune) => {\n  if (state.property.auto && state.income.auto) {\n    o.property.minValue = fortune / (0.2 + 0.05);\n    o.income.minValue =\n      fortune /\n      (0.2 + 0.05) *\n      constants.propertyToIncome(USAGE_TYPE.PRIMARY, 0.8);\n  } else if (state.property.auto) {\n    o.property.minValue = constants.maxProperty(state.income.value, fortune);\n  } else if (state.income.auto) {\n    o.income.minValue = getMinIncome(state.property.value, state.fortune.value);\n  }\n\n  o = setDefaultMinValues(state, o);\n\n  return o;\n};\n\nexport const changeIncome = (state, o, income) => {\n  if (state.property.auto && state.fortune.auto) {\n    o.property.minValue =\n      income / constants.propertyToIncome(USAGE_TYPE.PRIMARY, 0.8);\n    o.fortune.minValue = o.property.minValue * (0.2 + 0.05);\n  } else if (state.property.auto) {\n    o.property.minValue = constants.maxProperty(income, state.fortune.value);\n  } else if (state.fortune.auto) {\n    o.fortune.minValue = getMinFortune(\n      state.property.value,\n      state.income.value,\n    );\n  }\n\n  o = setDefaultMinValues(state, o);\n\n  return o;\n};\n\nexport const getRealMonthly = (fortune, property, borrow, interestRate) => {\n  if (interestRate) {\n    return Math.max(\n      (property * constants.maintenanceReal +\n        (property - fortune) *\n          constants.loanCostReal(borrow, 15, interestRate)) /\n        12,\n      0,\n    );\n  }\n  return Math.max(\n    (property * constants.maintenanceReal +\n      (property - fortune) * constants.loanCostReal(borrow)) /\n      12,\n    0,\n  );\n};\n\nexport const getTheoreticalMonthly = (fortune, property, borrow) =>\n  Math.max(\n    (property * constants.maintenance +\n      (property - fortune) * constants.loanCost(borrow)) /\n      12,\n    0,\n  );\n\nexport const getIncomeRatio = (monthly, income) => monthly / (income / 12);\n\nexport const getBorrowRatio = (property, fortune) =>\n  Math.max((property * 1.05 - fortune) / property, 0);\n\n//\n// The following functions are used in Start 2 Form\n//\n\nexport const isFinished = (state, minFortune) =>\n  state.finalized &&\n  !state.error &&\n  (state.fortuneUsed + (state.insuranceFortuneUsed || 0) >= minFortune ||\n    state.type === 'test');\n\nexport const getProject = (state) => {\n  const property = state.propertyValue || calculateProperty(state) || 0;\n  const project =\n    property +\n    (state.propertyWork || 0) +\n    property * constants.notaryFees +\n    (state.insuranceFortuneUsed * constants.lppFees || 0);\n  return project || 0;\n};\n\nexport const getBonusIncome = (arr = []) => {\n  if (arr.length > 4) {\n    // Ignore any value beyond the first 4\n    arr = arr.slice(0, 4);\n  }\n  // Sum all values, remove the lowest one, and return 50% of their average\n  const safeArray = arr.map(v => v || 0);\n  const sum = safeArray.reduce((tot, val) => tot + val, 0);\n  const bestSum = sum - Math.min(...safeArray);\n  return 0.5 * (bestSum / 3) || 0;\n};\n\nexport const getIncome = (state) => {\n  const s = state;\n  const bonus1 = getBonusIncome([s.bonus11, s.bonus21, s.bonus31, s.bonus41]);\n  const bonus2 = getBonusIncome([s.bonus12, s.bonus22, s.bonus32, s.bonus42]);\n  return [\n    state.usageType === USAGE_TYPE.INVESTMENT ? s.propertyRent * 12 : 0,\n    s.income1,\n    s.income2,\n    bonus1,\n    bonus2,\n    getOtherIncome(s.otherIncome),\n  ].reduce((tot, val) => (val > 0 && tot + val) || tot, 0);\n};\n\nexport const getOtherIncome = (array = []) =>\n  [...array.map(i => i.value || 0)].reduce(\n    (tot, val) => (val > 0 && tot + val) || tot,\n    0,\n  );\n\nexport const getFortune = state =>\n  [state.fortune1, state.fortune2].reduce(\n    (tot, val) => (val > 0 && tot + val) || tot,\n    0,\n  );\n\nexport const getInsuranceFortune = state =>\n  [\n    state.insurance11,\n    state.insurance12,\n    state.insurance21,\n    state.insurance22,\n  ].reduce((tot, val) => (val > 0 && tot + val) || tot, 0);\n\nexport const getRealEstateFortune = (array = []) =>\n  [...array.map(i => i.value - i.loan || 0)].reduce(\n    (tot, val) => (val > 0 && tot + val) || tot,\n    0,\n  );\n\nexport const getRealEstateValue = (array = []) =>\n  [...array.map(i => i.value || 0)].reduce(\n    (tot, val) => (val > 0 && tot + val) || tot,\n    0,\n  );\n\nexport const getRealEstateDebt = (array = []) =>\n  [...array.map(i => i.loan || 0)].reduce(\n    (tot, val) => (val > 0 && tot + val) || tot,\n    0,\n  );\n\nexport const getExpenses = (array = []) =>\n  [...array.map(i => i.value)].reduce(\n    (tot, val) => (val > 0 && tot + val) || tot,\n    0,\n  );\n\nexport const getMonthly = (state, borrow, toRetirement) => {\n  const s = state;\n  const projectValue = getProject(state);\n  const propAndWork =\n    s.propertyValue + (s.propertyWorkExists ? s.propertyWork : 0);\n\n  const maintenance = propAndWork * constants.maintenance;\n  const interestsAndAmortizing =\n    (projectValue - (s.fortuneUsed || 0) - (s.insuranceFortuneUsed || 0)) *\n    constants.loanCost(borrow, toRetirement);\n  const cost = (maintenance + interestsAndAmortizing) / 12;\n\n  return Math.max(cost, 0);\n};\n\nexport const getMonthlyReal = (state, borrow, toRetirement) => {\n  const s = state;\n  const projectValue = getProject(state);\n  const propAndWork = s.propertyValue + (s.propertyWork || 0);\n  return Math.max(\n    (propAndWork * constants.maintenanceReal +\n      (projectValue - (s.fortuneUsed || 0) - (s.insuranceFortuneUsed || 0)) *\n        constants.loanCostReal(borrow, toRetirement)) /\n      12,\n    0,\n  );\n};\n\nexport const calculateProperty = (\n  fortune,\n  insuranceFortune,\n  income,\n  usageType,\n  toRetirement,\n) =>\n  constants.maxProperty(\n    income,\n    fortune,\n    insuranceFortune,\n    usageType,\n    toRetirement,\n  );\n\nexport const getLenderCount = (borrow, ratio) => {\n  if (ratio > 0.38) {\n    return 0;\n  } else if (ratio > 1 / 3) {\n    return 4;\n  } else if (borrow <= 0.65) {\n    return 30;\n  } else if (borrow > 0.65 && borrow <= 0.9) {\n    return 20;\n  }\n\n  return 0;\n};\n\nexport const getRatio = (income, expenses, monthly) =>\n  income - expenses !== 0 && monthly / ((income - expenses) / 12);\n\nexport const getBorrow = (totalFortune, propAndWork, fees) =>\n  (totalFortune &&\n    propAndWork !== 0 &&\n    Math.max((propAndWork - (totalFortune - fees)) / propAndWork, 0)) ||\n  0;\n\nexport const getRetirement = (state) => {\n  const multiple = state.borrowerCount > 1;\n\n  const age = multiple ? state.oldestAge : state.age;\n  const gender = multiple ? state.oldestGender : state.gender;\n\n  if (age && gender) {\n    const retirement = gender === 'f' ? 64 : 65;\n\n    return Math.max(retirement - age, 0);\n  }\n\n  return 100;\n};\n\nexport const getMaxLoan = (\n  state,\n  income,\n  fortune,\n  insuranceFortune,\n  toRetirement,\n  propAndWork,\n) => {\n  const property = state.propertyValue;\n  const maintenance = property * constants.maintenance;\n  const mR = constants.maxRatio;\n  const i = constants.interests;\n\n  const maxLoan =\n    state.usageType === USAGE_TYPE.SECONDARY\n      ? Math.floor(0.7 * propAndWork)\n      : Math.floor(0.8 * propAndWork);\n\n  // Check LaTeX document, equation 15, and solve for the loan\n  const calculatedMaxLoan =\n    (toRetirement * (mR * income - maintenance) + 0.65 * property) /\n    (i * toRetirement + 1);\n\n  // Floor this value to make sure the user can afford it if any rounding\n  // happens, If it had to round up, it would be too expensive\n  return Math.floor(Math.min(maxLoan, calculatedMaxLoan));\n};\n"]},"hash":"3d12d0b1ab2df4e08991a241abd703de6ddc8891"}
