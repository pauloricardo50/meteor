{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"meteor/meteor","imported":["Meteor"],"specifiers":[{"kind":"named","imported":"Meteor","local":"Meteor"}]},{"source":"meteor/ddp-rate-limiter","imported":["DDPRateLimiter"],"specifiers":[{"kind":"named","imported":"DDPRateLimiter","local":"DDPRateLimiter"}]},{"source":"meteor/underscore","imported":["_"],"specifiers":[{"kind":"named","imported":"_","local":"_"}]}],"exports":{"exported":["rateLimit","options"],"specifiers":[{"kind":"local","local":"rateLimit","exported":"default"},{"kind":"local","local":"options","exported":"default"}]}}},"options":{"filename":"imports/core/utils/rate-limit.js","filenameRelative":"imports/core/utils/rate-limit.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"imports/core/utils/rate-limit.js.map","sourceFileName":"imports/core/utils/rate-limit.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"rate-limit"},"ignored":false,"code":"\"use strict\";\n\nmodule.export({\n  \"default\": function () {\n    function _default() {\n      return rateLimit;\n    }\n\n    return _default;\n  }()\n});\n\nvar _Meteor = void 0;\n\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function () {\n    function Meteor(v) {\n      _Meteor = v;\n    }\n\n    return Meteor;\n  }()\n}, 0);\n\nvar _DDPRateLimiter = void 0;\n\nmodule.watch(require(\"meteor/ddp-rate-limiter\"), {\n  DDPRateLimiter: function () {\n    function DDPRateLimiter(v) {\n      _DDPRateLimiter = v;\n    }\n\n    return DDPRateLimiter;\n  }()\n}, 1);\n\nvar _2 = void 0;\n\nmodule.watch(require(\"meteor/underscore\"), {\n  _: function () {\n    function _(v) {\n      _2 = v;\n    }\n\n    return _;\n  }()\n}, 2);\n\n// DDPRateLimiter.setErrorMessage(({ timeToReset }) => {\n//   const time = Math.ceil(timeToReset / 1000);\n//   const seconds = time === 1 ? 'second' : 'seconds';\n//   return `Easy on the gas, buddy. Too many loans. Try again in ${time} ${seconds}.`;\n// });\nvar fetchMethodNames = function () {\n  function fetchMethodNames(methods) {\n    return _2.pluck(methods, 'name');\n  }\n\n  return fetchMethodNames;\n}();\n\nvar assignLimits = function () {\n  function assignLimits(_ref) {\n    var methods = _ref.methods,\n        _ref$limit = _ref.limit,\n        limit = _ref$limit === undefined ? 5 : _ref$limit,\n        _ref$timeRange = _ref.timeRange,\n        timeRange = _ref$timeRange === undefined ? 1000 : _ref$timeRange;\n    var methodNames = fetchMethodNames(methods);\n\n    if (_Meteor.isServer) {\n      _DDPRateLimiter.addRule({\n        name: function () {\n          function name(_name) {\n            return _2.contains(methodNames, _name);\n          }\n\n          return name;\n        }(),\n        connectionId: function () {\n          function connectionId() {\n            return true;\n          }\n\n          return connectionId;\n        }()\n      }, limit, timeRange);\n    }\n  }\n\n  return assignLimits;\n}();\n\nfunction rateLimit(options) {\n  return assignLimits(options);\n}","map":{"version":3,"sources":["imports/core/utils/rate-limit.js"],"names":["module","export","rateLimit","Meteor","watch","require","v","DDPRateLimiter","_","fetchMethodNames","pluck","methods","assignLimits","limit","timeRange","methodNames","isServer","addRule","name","contains","connectionId","options"],"mappings":";;AAAAA,OAAOC,MAAP,CAAc;AAAC;AAAQ;AAAA,aAAIC,SAAJ;AAAA;;AAAR;AAAA;AAAD,CAAd;;AAAuC,IAAIC,gBAAJ;;AAAWH,OAAOI,KAAP,CAAaC,QAAQ,eAAR,CAAb,EAAsC;AAACF,QAAD;AAAA,oBAAQG,CAAR,EAAU;AAACH,gBAAOG,CAAP;AAAS;;AAApB;AAAA;AAAA,CAAtC,EAA4D,CAA5D;;AAA+D,IAAIC,wBAAJ;;AAAmBP,OAAOI,KAAP,CAAaC,QAAQ,yBAAR,CAAb,EAAgD;AAACE,gBAAD;AAAA,4BAAgBD,CAAhB,EAAkB;AAACC,wBAAeD,CAAf;AAAiB;;AAApC;AAAA;AAAA,CAAhD,EAAsF,CAAtF;;AAAyF,IAAIE,WAAJ;;AAAMR,OAAOI,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACG,GAAD;AAAA,eAAGF,CAAH,EAAK;AAACE,WAAEF,CAAF;AAAI;;AAAV;AAAA;AAAA,CAA1C,EAAsD,CAAtD;;AAInO;AACA;AACA;AACA;AACA;AAEA,IAAMG;AAAmB,WAAnBA,gBAAmB;AAAA,WAAWD,GAAEE,KAAF,CAAQC,OAAR,EAAiB,MAAjB,CAAX;AAAA;;AAAnB;AAAA,GAAN;;AAEA,IAAMC;AAAe,WAAfA,YAAe,OAA8C;AAAA,QAA3CD,OAA2C,QAA3CA,OAA2C;AAAA,0BAAlCE,KAAkC;AAAA,QAAlCA,KAAkC,8BAA1B,CAA0B;AAAA,8BAAvBC,SAAuB;AAAA,QAAvBA,SAAuB,kCAAX,IAAW;AACjE,QAAMC,cAAcN,iBAAiBE,OAAjB,CAApB;;AAEA,QAAIR,QAAOa,QAAX,EAAqB;AACnBT,sBAAeU,OAAf,CACE;AACEC,YADF;AAAA,wBACOA,KADP,EACa;AACT,mBAAOV,GAAEW,QAAF,CAAWJ,WAAX,EAAwBG,KAAxB,CAAP;AACD;;AAHH;AAAA;AAIEE,oBAJF;AAAA,kCAIiB;AACb,mBAAO,IAAP;AACD;;AANH;AAAA;AAAA,OADF,EASEP,KATF,EAUEC,SAVF;AAYD;AACF;;AAjBK;AAAA,GAAN;;AAmBe,SAASZ,SAAT,CAAmBmB,OAAnB,EAA4B;AACzC,SAAOT,aAAaS,OAAb,CAAP;AACD","file":"imports/core/utils/rate-limit.js.map","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { DDPRateLimiter } from 'meteor/ddp-rate-limiter';\nimport { _ } from 'meteor/underscore';\n\n// DDPRateLimiter.setErrorMessage(({ timeToReset }) => {\n//   const time = Math.ceil(timeToReset / 1000);\n//   const seconds = time === 1 ? 'second' : 'seconds';\n//   return `Easy on the gas, buddy. Too many loans. Try again in ${time} ${seconds}.`;\n// });\n\nconst fetchMethodNames = methods => _.pluck(methods, 'name');\n\nconst assignLimits = ({ methods, limit = 5, timeRange = 1000 }) => {\n  const methodNames = fetchMethodNames(methods);\n\n  if (Meteor.isServer) {\n    DDPRateLimiter.addRule(\n      {\n        name(name) {\n          return _.contains(methodNames, name);\n        },\n        connectionId() {\n          return true;\n        },\n      },\n      limit,\n      timeRange,\n    );\n  }\n};\n\nexport default function rateLimit(options) {\n  return assignLimits(options);\n}\n"]},"hash":"66d6b301b8b3aeda518a4453b2fd171b0466ff0c"}
