{"metadata":{"usedHelpers":["createClass","classCallCheck","interopRequireDefault"],"marked":[],"modules":{"imports":[{"source":"meteor/meteor","imported":["Meteor"],"specifiers":[{"kind":"named","imported":"Meteor","local":"Meteor"}]},{"source":"meteor/alanning:roles","imported":["Roles"],"specifiers":[{"kind":"named","imported":"Roles","local":"Roles"}]},{"source":"../constants","imported":["ROLES"],"specifiers":[{"kind":"named","imported":"ROLES","local":"ROLES"}]}],"exports":{"exported":["SECURITY_ERROR","Security"],"specifiers":[{"kind":"local","local":"SECURITY_ERROR","exported":"SECURITY_ERROR"},{"kind":"local","local":"Security","exported":"default"}]}}},"options":{"filename":"imports/core/api/security/Security.js","filenameRelative":"imports/core/api/security/Security.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"imports/core/api/security/Security.js.map","sourceFileName":"imports/core/api/security/Security.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"Security"},"ignored":false,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SECURITY_ERROR = undefined;\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require(\"babel-runtime/helpers/createClass\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nmodule.export({\n  SECURITY_ERROR: function () {\n    function SECURITY_ERROR() {\n      return _SECURITY_ERROR;\n    }\n\n    return SECURITY_ERROR;\n  }(),\n  \"default\": function () {\n    function _default() {\n      return Security;\n    }\n\n    return _default;\n  }()\n});\n\nvar _Meteor = void 0;\n\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function () {\n    function Meteor(v) {\n      _Meteor = v;\n    }\n\n    return Meteor;\n  }()\n}, 0);\n\nvar _Roles = void 0;\n\nexports.SECURITY_ERROR = _SECURITY_ERROR;\nmodule.watch(require(\"meteor/alanning:roles\"), {\n  Roles: function () {\n    function Roles(v) {\n      _Roles = v;\n    }\n\n    return Roles;\n  }()\n}, 1);\n\nvar _ROLES = void 0;\n\nmodule.watch(require(\"../constants\"), {\n  ROLES: function () {\n    function ROLES(v) {\n      _ROLES = v;\n    }\n\n    return ROLES;\n  }()\n}, 2);\nvar _SECURITY_ERROR = 'NOT_AUTHORIZED';\n\nvar Security = function () {\n  function Security() {\n    (0, _classCallCheck3.default)(this, Security);\n  }\n\n  (0, _createClass3.default)(Security, null, [{\n    key: \"hasRole\",\n    value: function () {\n      function hasRole(userId, role) {\n        return _Roles.userIsInRole(userId, role);\n      }\n\n      return hasRole;\n    }()\n  }, {\n    key: \"handleUnauthorized\",\n    value: function () {\n      function handleUnauthorized(message) {\n        throw new _Meteor.Error(_SECURITY_ERROR, message);\n      }\n\n      return handleUnauthorized;\n    }()\n  }, {\n    key: \"checkRole\",\n    value: function () {\n      function checkRole(userId, role) {\n        if (!this.hasRole(userId, role)) {\n          this.handleUnauthorized(\"Checking role: \" + role);\n        }\n      }\n\n      return checkRole;\n    }()\n  }, {\n    key: \"checkLoggedIn\",\n    value: function () {\n      function checkLoggedIn() {\n        if (!_Meteor.userId()) {\n          this.handleUnauthorized('Checking if logged in');\n        }\n      }\n\n      return checkLoggedIn;\n    }()\n  }, {\n    key: \"currentUserHasRole\",\n    value: function () {\n      function currentUserHasRole(role) {\n        return this.hasRole(_Meteor.userId(), role);\n      }\n\n      return currentUserHasRole;\n    }()\n  }, {\n    key: \"currentUserIsAdmin\",\n    value: function () {\n      function currentUserIsAdmin() {\n        return this.hasRole(_Meteor.userId(), _ROLES.ADMIN) || this.hasRole(_Meteor.userId(), _ROLES.DEV);\n      }\n\n      return currentUserIsAdmin;\n    }()\n  }, {\n    key: \"checkCurrentUserIsAdmin\",\n    value: function () {\n      function checkCurrentUserIsAdmin() {\n        if (!this.currentUserIsAdmin()) {\n          this.handleUnauthorized('Checking if current user is admin');\n        }\n      }\n\n      return checkCurrentUserIsAdmin;\n    }()\n  }, {\n    key: \"checkOwnership\",\n    value: function () {\n      function checkOwnership(doc) {\n        if (_Meteor.userId() !== doc.userId) {\n          this.handleUnauthorized('Checking ownership');\n        }\n      }\n\n      return checkOwnership;\n    }()\n  }]);\n  return Security;\n}();","map":{"version":3,"sources":["imports/core/api/security/Security.js"],"names":["module","export","SECURITY_ERROR","Security","Meteor","watch","require","v","Roles","ROLES","userId","role","userIsInRole","message","Error","hasRole","handleUnauthorized","ADMIN","DEV","currentUserIsAdmin","doc"],"mappings":";;;;;;;;;;;;;;;;;AAAAA,OAAOC,MAAP,CAAc;AAACC;AAAe;AAAA,aAAIA,eAAJ;AAAA;;AAAf;AAAA,KAAD;AAAmC;AAAQ;AAAA,aAAIC,QAAJ;AAAA;;AAAR;AAAA;AAAnC,CAAd;;AAAwE,IAAIC,gBAAJ;;AAAWJ,OAAOK,KAAP,CAAaC,QAAQ,eAAR,CAAb,EAAsC;AAACF,QAAD;AAAA,oBAAQG,CAAR,EAAU;AAACH,gBAAOG,CAAP;AAAS;;AAApB;AAAA;AAAA,CAAtC,EAA4D,CAA5D;;AAA+D,IAAIC,eAAJ;;;AAAUR,OAAOK,KAAP,CAAaC,QAAQ,uBAAR,CAAb,EAA8C;AAACE,OAAD;AAAA,mBAAOD,CAAP,EAAS;AAACC,eAAMD,CAAN;AAAQ;;AAAlB;AAAA;AAAA,CAA9C,EAAkE,CAAlE;;AAAqE,IAAIE,eAAJ;;AAAUT,OAAOK,KAAP,CAAaC,QAAQ,cAAR,CAAb,EAAqC;AAACG,OAAD;AAAA,mBAAOF,CAAP,EAAS;AAACE,eAAMF,CAAN;AAAQ;;AAAlB;AAAA;AAAA,CAArC,EAAyD,CAAzD;AAKpO,IAAML,kBAAiB,gBAAvB;;IAEcC,Q;;;;;;;;uBACJO,M,EAAQC,I,EAAM;AAC3B,eAAOH,OAAMI,YAAN,CAAmBF,MAAnB,EAA2BC,IAA3B,CAAP;AACD;;;;;;;kCAEyBE,O,EAAS;AACjC,cAAM,IAAIT,QAAOU,KAAX,CAAiBZ,eAAjB,EAAiCW,OAAjC,CAAN;AACD;;;;;;;yBAEgBH,M,EAAQC,I,EAAM;AAC7B,YAAI,CAAC,KAAKI,OAAL,CAAaL,MAAb,EAAqBC,IAArB,CAAL,EAAiC;AAC/B,eAAKK,kBAAL,qBAA0CL,IAA1C;AACD;AACF;;;;;;;+BAEsB;AACrB,YAAI,CAACP,QAAOM,MAAP,EAAL,EAAsB;AACpB,eAAKM,kBAAL,CAAwB,uBAAxB;AACD;AACF;;;;;;;kCAEyBL,I,EAAM;AAC9B,eAAO,KAAKI,OAAL,CAAaX,QAAOM,MAAP,EAAb,EAA8BC,IAA9B,CAAP;AACD;;;;;;;oCAE2B;AAC1B,eACE,KAAKI,OAAL,CAAaX,QAAOM,MAAP,EAAb,EAA8BD,OAAMQ,KAApC,KACA,KAAKF,OAAL,CAAaX,QAAOM,MAAP,EAAb,EAA8BD,OAAMS,GAApC,CAFF;AAID;;;;;;;yCAEgC;AAC/B,YAAI,CAAC,KAAKC,kBAAL,EAAL,EAAgC;AAC9B,eAAKH,kBAAL,CAAwB,mCAAxB;AACD;AACF;;;;;;;8BAEqBI,G,EAAK;AACzB,YAAIhB,QAAOM,MAAP,OAAoBU,IAAIV,MAA5B,EAAoC;AAClC,eAAKM,kBAAL,CAAwB,oBAAxB;AACD;AACF","file":"imports/core/api/security/Security.js.map","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Roles } from 'meteor/alanning:roles';\n\nimport { ROLES } from '../constants';\n\nexport const SECURITY_ERROR = 'NOT_AUTHORIZED';\n\nexport default class Security {\n  static hasRole(userId, role) {\n    return Roles.userIsInRole(userId, role);\n  }\n\n  static handleUnauthorized(message) {\n    throw new Meteor.Error(SECURITY_ERROR, message);\n  }\n\n  static checkRole(userId, role) {\n    if (!this.hasRole(userId, role)) {\n      this.handleUnauthorized(`Checking role: ${role}`);\n    }\n  }\n\n  static checkLoggedIn() {\n    if (!Meteor.userId()) {\n      this.handleUnauthorized('Checking if logged in');\n    }\n  }\n\n  static currentUserHasRole(role) {\n    return this.hasRole(Meteor.userId(), role);\n  }\n\n  static currentUserIsAdmin() {\n    return (\n      this.hasRole(Meteor.userId(), ROLES.ADMIN) ||\n      this.hasRole(Meteor.userId(), ROLES.DEV)\n    );\n  }\n\n  static checkCurrentUserIsAdmin() {\n    if (!this.currentUserIsAdmin()) {\n      this.handleUnauthorized('Checking if current user is admin');\n    }\n  }\n\n  static checkOwnership(doc) {\n    if (Meteor.userId() !== doc.userId) {\n      this.handleUnauthorized('Checking ownership');\n    }\n  }\n}\n"]},"hash":"bf4eb49b011af57165d51c1c420ee9609bc30445"}
