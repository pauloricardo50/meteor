{"metadata":{"usedHelpers":["extends","interopRequireDefault"],"marked":[],"modules":{"imports":[{"source":"meteor/react-meteor-data","imported":["withTracker"],"specifiers":[{"kind":"named","imported":"withTracker","local":"withTracker"}]},{"source":"meteor/reactive-var","imported":["ReactiveVar"],"specifiers":[{"kind":"named","imported":"ReactiveVar","local":"ReactiveVar"}]}],"exports":{"exported":["withReactiveContainer","handler","config","QueryComponent"],"specifiers":[{"kind":"local","local":"withReactiveContainer","exported":"default"},{"kind":"local","local":"handler","exported":"default"},{"kind":"local","local":"config","exported":"default"},{"kind":"local","local":"QueryComponent","exported":"default"}]}}},"options":{"filename":"packages/cultofcoders:grapher-react/lib/withReactiveQuery.js","filenameRelative":"packages/cultofcoders:grapher-react/lib/withReactiveQuery.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"useNativeAsyncAwait":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"packages/cultofcoders:grapher-react/lib/withReactiveQuery.js.map","sourceFileName":"packages/cultofcoders:grapher-react/lib/withReactiveQuery.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"withReactiveQuery"},"ignored":false,"code":"var _extends2 = require(\"babel-runtime/helpers/extends\");\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nmodule.export({\n    default: () => withReactiveContainer\n});\nlet withTracker;\nmodule.watch(require(\"meteor/react-meteor-data\"), {\n    withTracker(v) {\n        withTracker = v;\n    }\n\n}, 0);\nlet ReactiveVar;\nmodule.watch(require(\"meteor/reactive-var\"), {\n    ReactiveVar(v) {\n        ReactiveVar = v;\n    }\n\n}, 1);\n\nfunction withReactiveContainer(handler, config, QueryComponent) {\n    let subscriptionError = new ReactiveVar();\n    return withTracker(props => {\n        const query = handler(props);\n        const subscriptionHandle = query.subscribe({\n            onStop(err) {\n                if (err) {\n                    subscriptionError.set(err);\n                }\n            },\n\n            onReady() {\n                subscriptionError.set(null);\n            }\n\n        });\n        const isReady = subscriptionHandle.ready();\n        const data = query.fetch();\n        return {\n            grapher: {\n                isLoading: !isReady,\n                data,\n                error: subscriptionError\n            },\n            query,\n            config,\n            props\n        };\n    })(errorTracker(QueryComponent));\n}\n\nconst errorTracker = withTracker(props => {\n    const error = props.grapher.error.get();\n    return (0, _extends3.default)({}, props, {\n        grapher: (0, _extends3.default)({}, props.grapher, {\n            error\n        })\n    });\n});","map":{"version":3,"sources":["packages/cultofcoders:grapher-react/lib/withReactiveQuery.js"],"names":["module","export","default","withReactiveContainer","withTracker","watch","require","v","ReactiveVar","handler","config","QueryComponent","subscriptionError","props","query","subscriptionHandle","subscribe","onStop","err","set","onReady","isReady","ready","data","fetch","grapher","isLoading","error","errorTracker","get"],"mappings":";;;;;;AAAAA,OAAOC,MAAP,CAAc;AAACC,aAAQ,MAAIC;AAAb,CAAd;AAAmD,IAAIC,WAAJ;AAAgBJ,OAAOK,KAAP,CAAaC,QAAQ,0BAAR,CAAb,EAAiD;AAACF,gBAAYG,CAAZ,EAAc;AAACH,sBAAYG,CAAZ;AAAc;;AAA9B,CAAjD,EAAiF,CAAjF;AAAoF,IAAIC,WAAJ;AAAgBR,OAAOK,KAAP,CAAaC,QAAQ,qBAAR,CAAb,EAA4C;AAACE,gBAAYD,CAAZ,EAAc;AAACC,sBAAYD,CAAZ;AAAc;;AAA9B,CAA5C,EAA4E,CAA5E;;AAUxJ,SAASJ,qBAAT,CAA+BM,OAA/B,EAAwCC,MAAxC,EAAgDC,cAAhD,EAAgE;AAC3E,QAAIC,oBAAoB,IAAIJ,WAAJ,EAAxB;AAEA,WAAOJ,YAAaS,KAAD,IAAW;AAC1B,cAAMC,QAAQL,QAAQI,KAAR,CAAd;AAEA,cAAME,qBAAqBD,MAAME,SAAN,CAAgB;AACvCC,mBAAOC,GAAP,EAAY;AACR,oBAAIA,GAAJ,EAAS;AACLN,sCAAkBO,GAAlB,CAAsBD,GAAtB;AACH;AACJ,aALsC;;AAMvCE,sBAAU;AACNR,kCAAkBO,GAAlB,CAAsB,IAAtB;AACH;;AARsC,SAAhB,CAA3B;AAWA,cAAME,UAAUN,mBAAmBO,KAAnB,EAAhB;AAEA,cAAMC,OAAOT,MAAMU,KAAN,EAAb;AAEA,eAAO;AACHC,qBAAS;AACLC,2BAAW,CAACL,OADP;AAELE,oBAFK;AAGLI,uBAAOf;AAHF,aADN;AAMHE,iBANG;AAOHJ,kBAPG;AAQHG;AARG,SAAP;AAUH,KA5BM,EA4BJe,aAAajB,cAAb,CA5BI,CAAP;AA6BH;;AAED,MAAMiB,eAAexB,YAAaS,KAAD,IAAW;AACxC,UAAMc,QAAQd,MAAMY,OAAN,CAAcE,KAAd,CAAoBE,GAApB,EAAd;AAEA,sCACOhB,KADP;AAEIY,4CACOZ,MAAMY,OADb;AAEIE;AAFJ;AAFJ;AAOH,CAVoB,CAArB","file":"packages/cultofcoders:grapher-react/lib/withReactiveQuery.js.map","sourcesContent":["import {withTracker} from 'meteor/react-meteor-data';\nimport {ReactiveVar} from 'meteor/reactive-var';\n\n/**\n * Wraps the query and provides reactive data fetching utility\n *\n * @param handler\n * @param config\n * @param QueryComponent\n */\nexport default function withReactiveContainer(handler, config, QueryComponent) {\n    let subscriptionError = new ReactiveVar();\n\n    return withTracker((props) => {\n        const query = handler(props);\n\n        const subscriptionHandle = query.subscribe({\n            onStop(err) {\n                if (err) {\n                    subscriptionError.set(err);\n                }\n            },\n            onReady() {\n                subscriptionError.set(null);\n            }\n        });\n\n        const isReady = subscriptionHandle.ready();\n\n        const data = query.fetch();\n\n        return {\n            grapher: {\n                isLoading: !isReady,\n                data,\n                error: subscriptionError,\n            },\n            query,\n            config,\n            props,\n        }\n    })(errorTracker(QueryComponent))\n}\n\nconst errorTracker = withTracker((props) => {\n    const error = props.grapher.error.get();\n\n    return {\n        ...props,\n        grapher: {\n            ...props.grapher,\n            error,\n        }\n    };\n});"]},"hash":"159520ab6baf64ce001a2fe143c65c674d12336d"}
