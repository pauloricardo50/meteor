{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"react","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"React"}]},{"source":"lodash/get","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"get"}]},{"source":"lodash/isArray","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"isArray"}]},{"source":"./BorrowerFormArray","imported":["getBorrowerInfoArray"],"specifiers":[{"kind":"named","imported":"getBorrowerInfoArray","local":"getBorrowerInfoArray"}]},{"source":"../api/files/files","imported":["borrowerFiles","loanFiles","propertyFiles"],"specifiers":[{"kind":"named","imported":"borrowerFiles","local":"borrowerFiles"},{"kind":"named","imported":"loanFiles","local":"loanFiles"},{"kind":"named","imported":"propertyFiles","local":"propertyFiles"}]},{"source":"./PropertyFormArray","imported":["getPropertyArray","getPropertyLoanArray"],"specifiers":[{"kind":"named","imported":"getPropertyArray","local":"getPropertyArray"},{"kind":"named","imported":"getPropertyLoanArray","local":"getPropertyLoanArray"}]},{"source":"../utils/loanFunctions","imported":["strategyDone","getPropertyCompletion"],"specifiers":[{"kind":"named","imported":"strategyDone","local":"strategyDone"},{"kind":"named","imported":"getPropertyCompletion","local":"getPropertyCompletion"}]},{"source":"../utils/general","imported":["arrayify"],"specifiers":[{"kind":"named","imported":"arrayify","local":"arrayify"}]},{"source":"../utils/browserFunctions","imported":["isDemo"],"specifiers":[{"kind":"named","imported":"isDemo","local":"isDemo"}]},{"source":"../api/constants","imported":["LOAN_STATUS","AUCTION_STATUS","FILE_STATUS","CLOSING_STEPS_STATUS","CLOSING_STEPS_TYPE"],"specifiers":[{"kind":"named","imported":"LOAN_STATUS","local":"LOAN_STATUS"},{"kind":"named","imported":"AUCTION_STATUS","local":"AUCTION_STATUS"},{"kind":"named","imported":"FILE_STATUS","local":"FILE_STATUS"},{"kind":"named","imported":"CLOSING_STEPS_STATUS","local":"CLOSING_STEPS_STATUS"},{"kind":"named","imported":"CLOSING_STEPS_TYPE","local":"CLOSING_STEPS_TYPE"}]}],"exports":{"exported":["previousDone","getPercent","shouldCountField","getCountedArray","personalInfoPercent","propertyPercent","auctionFilesPercent","filesPercent","getAllFilesPercent","closingPercent"],"specifiers":[{"kind":"local","local":"previousDone","exported":"previousDone"},{"kind":"local","local":"getPercent","exported":"getPercent"},{"kind":"local","local":"shouldCountField","exported":"shouldCountField"},{"kind":"local","local":"getCountedArray","exported":"getCountedArray"},{"kind":"local","local":"personalInfoPercent","exported":"personalInfoPercent"},{"kind":"local","local":"propertyPercent","exported":"propertyPercent"},{"kind":"local","local":"auctionFilesPercent","exported":"auctionFilesPercent"},{"kind":"local","local":"filesPercent","exported":"filesPercent"},{"kind":"local","local":"getAllFilesPercent","exported":"getAllFilesPercent"},{"kind":"local","local":"closingPercent","exported":"closingPercent"}]}}},"options":{"filename":"imports/core/arrays/steps.js","filenameRelative":"imports/core/arrays/steps.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"imports/core/arrays/steps.js.map","sourceFileName":"imports/core/arrays/steps.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"steps"},"ignored":false,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nmodule.export({\n  previousDone: function () {\n    function previousDone() {\n      return _previousDone;\n    }\n\n    return previousDone;\n  }(),\n  getPercent: function () {\n    function getPercent() {\n      return _getPercent;\n    }\n\n    return getPercent;\n  }(),\n  shouldCountField: function () {\n    function shouldCountField() {\n      return _shouldCountField;\n    }\n\n    return shouldCountField;\n  }(),\n  getCountedArray: function () {\n    function getCountedArray() {\n      return _getCountedArray;\n    }\n\n    return getCountedArray;\n  }(),\n  personalInfoPercent: function () {\n    function personalInfoPercent() {\n      return _personalInfoPercent;\n    }\n\n    return personalInfoPercent;\n  }(),\n  propertyPercent: function () {\n    function propertyPercent() {\n      return _propertyPercent;\n    }\n\n    return propertyPercent;\n  }(),\n  auctionFilesPercent: function () {\n    function auctionFilesPercent() {\n      return _auctionFilesPercent;\n    }\n\n    return auctionFilesPercent;\n  }(),\n  filesPercent: function () {\n    function filesPercent() {\n      return _filesPercent;\n    }\n\n    return filesPercent;\n  }(),\n  getAllFilesPercent: function () {\n    function getAllFilesPercent() {\n      return _getAllFilesPercent;\n    }\n\n    return getAllFilesPercent;\n  }(),\n  closingPercent: function () {\n    function closingPercent() {\n      return _closingPercent;\n    }\n\n    return closingPercent;\n  }()\n});\nvar React = void 0;\nmodule.watch(require(\"react\"), {\n  \"default\": function () {\n    function _default(v) {\n      React = v;\n    }\n\n    return _default;\n  }()\n}, 0);\nvar get = void 0;\nmodule.watch(require(\"lodash/get\"), {\n  \"default\": function () {\n    function _default(v) {\n      get = v;\n    }\n\n    return _default;\n  }()\n}, 1);\nvar isArray = void 0;\nmodule.watch(require(\"lodash/isArray\"), {\n  \"default\": function () {\n    function _default(v) {\n      isArray = v;\n    }\n\n    return _default;\n  }()\n}, 2);\n\nvar _getBorrowerInfoArray = void 0;\n\nmodule.watch(require(\"./BorrowerFormArray\"), {\n  getBorrowerInfoArray: function () {\n    function getBorrowerInfoArray(v) {\n      _getBorrowerInfoArray = v;\n    }\n\n    return getBorrowerInfoArray;\n  }()\n}, 3);\n\nvar _borrowerFiles = void 0,\n    _loanFiles = void 0,\n    _propertyFiles = void 0;\n\nmodule.watch(require(\"../api/files/files\"), {\n  borrowerFiles: function () {\n    function borrowerFiles(v) {\n      _borrowerFiles = v;\n    }\n\n    return borrowerFiles;\n  }(),\n  loanFiles: function () {\n    function loanFiles(v) {\n      _loanFiles = v;\n    }\n\n    return loanFiles;\n  }(),\n  propertyFiles: function () {\n    function propertyFiles(v) {\n      _propertyFiles = v;\n    }\n\n    return propertyFiles;\n  }()\n}, 4);\n\nvar _getPropertyArray = void 0,\n    _getPropertyLoanArray = void 0;\n\nmodule.watch(require(\"./PropertyFormArray\"), {\n  getPropertyArray: function () {\n    function getPropertyArray(v) {\n      _getPropertyArray = v;\n    }\n\n    return getPropertyArray;\n  }(),\n  getPropertyLoanArray: function () {\n    function getPropertyLoanArray(v) {\n      _getPropertyLoanArray = v;\n    }\n\n    return getPropertyLoanArray;\n  }()\n}, 5);\n\nvar _strategyDone = void 0,\n    _getPropertyCompletion = void 0;\n\nexports.previousDone = _previousDone;\nmodule.watch(require(\"../utils/loanFunctions\"), {\n  strategyDone: function () {\n    function strategyDone(v) {\n      _strategyDone = v;\n    }\n\n    return strategyDone;\n  }(),\n  getPropertyCompletion: function () {\n    function getPropertyCompletion(v) {\n      _getPropertyCompletion = v;\n    }\n\n    return getPropertyCompletion;\n  }()\n}, 6);\n\nvar _arrayify = void 0;\n\nmodule.watch(require(\"../utils/general\"), {\n  arrayify: function () {\n    function arrayify(v) {\n      _arrayify = v;\n    }\n\n    return arrayify;\n  }()\n}, 7);\n\nvar _isDemo = void 0;\n\nmodule.watch(require(\"../utils/browserFunctions\"), {\n  isDemo: function () {\n    function isDemo(v) {\n      _isDemo = v;\n    }\n\n    return isDemo;\n  }()\n}, 8);\n\nvar _LOAN_STATUS = void 0,\n    _AUCTION_STATUS = void 0,\n    _FILE_STATUS = void 0,\n    _CLOSING_STEPS_STATUS = void 0,\n    _CLOSING_STEPS_TYPE = void 0;\n\nmodule.watch(require(\"../api/constants\"), {\n  LOAN_STATUS: function () {\n    function LOAN_STATUS(v) {\n      _LOAN_STATUS = v;\n    }\n\n    return LOAN_STATUS;\n  }(),\n  AUCTION_STATUS: function () {\n    function AUCTION_STATUS(v) {\n      _AUCTION_STATUS = v;\n    }\n\n    return AUCTION_STATUS;\n  }(),\n  FILE_STATUS: function () {\n    function FILE_STATUS(v) {\n      _FILE_STATUS = v;\n    }\n\n    return FILE_STATUS;\n  }(),\n  CLOSING_STEPS_STATUS: function () {\n    function CLOSING_STEPS_STATUS(v) {\n      _CLOSING_STEPS_STATUS = v;\n    }\n\n    return CLOSING_STEPS_STATUS;\n  }(),\n  CLOSING_STEPS_TYPE: function () {\n    function CLOSING_STEPS_TYPE(v) {\n      _CLOSING_STEPS_TYPE = v;\n    }\n\n    return CLOSING_STEPS_TYPE;\n  }()\n}, 9);\n\nvar getSteps = function () {\n  function getSteps(props) {\n    var loan = props.loan,\n        borrowers = props.borrowers,\n        property = props.property,\n        serverTime = props.serverTime;\n    var steps = [{\n      nb: 0,\n      items: []\n    }, {\n      nb: 1,\n      items: [{\n        id: 'personal',\n        link: \"/loans/\" + loan._id + \"/borrowers/\" + borrowers[0]._id + \"/personal\",\n        percent: function () {\n          function percent() {\n            return _personalInfoPercent(borrowers);\n          }\n\n          return percent;\n        }(),\n        isDone: function () {\n          function isDone() {\n            return this.percent() >= 1;\n          }\n\n          return isDone;\n        }()\n      }, {\n        id: 'finance',\n        link: \"/loans/\" + loan._id + \"/borrowers/\" + borrowers[0]._id + \"/finance\",\n        isDone: function () {\n          function isDone() {\n            return borrowers.reduce(function (res, b) {\n              return res && b.logic.hasValidatedFinances;\n            }, true);\n          }\n\n          return isDone;\n        }(),\n        percent: function () {\n          function percent() {\n            return borrowers.reduce(function (res, b) {\n              return b.logic.hasValidatedFinances ? res + 1 : res;\n            }, 0) / borrowers.length;\n          }\n\n          return percent;\n        }()\n      }, {\n        id: 'files',\n        link: \"/loans/\" + loan._id + \"/borrowers/\" + borrowers[0]._id + \"/files\",\n        percent: function () {\n          function percent() {\n            return _filesPercent(borrowers, _borrowerFiles, 'auction');\n          }\n\n          return percent;\n        }(),\n        isDone: function () {\n          function isDone() {\n            return this.percent() >= 1;\n          }\n\n          return isDone;\n        }()\n      }, {\n        id: 'property',\n        link: \"/loans/\" + loan._id + \"/property\",\n        percent: function () {\n          function percent() {\n            return _getPropertyCompletion(props);\n          }\n\n          return percent;\n        }(),\n        isDone: function () {\n          function isDone() {\n            return this.percent() >= 1;\n          }\n\n          return isDone;\n        }()\n      }, {\n        id: 'verification',\n        link: \"/loans/\" + loan._id + \"/verification\",\n        waiting: function () {\n          function waiting() {\n            return loan.logic.verification.requested && !loan.logic.verification.validated;\n          }\n\n          return waiting;\n        }(),\n        isDone: function () {\n          function isDone() {\n            return loan.logic.verification.validated === true;\n          }\n\n          return isDone;\n        }()\n      }]\n    }, {\n      nb: 2,\n      items: [{\n        id: 'structure',\n        link: \"/loans/\" + loan._id + \"/structure\",\n        isDone: function () {\n          function isDone() {\n            return loan.logic.hasValidatedStructure;\n          }\n\n          return isDone;\n        }(),\n        disabled: loan.logic.step < 2\n      }, {\n        id: 'auction',\n        link: \"/loans/\" + loan._id + \"/auction\",\n        waiting: function () {\n          function waiting() {\n            return loan.logic.auction.status === _AUCTION_STATUS.STARTED;\n          }\n\n          return waiting;\n        }(),\n        isDone: function () {\n          function isDone() {\n            return loan.logic.auction.status === _AUCTION_STATUS.ENDED;\n          }\n\n          return isDone;\n        }(),\n        disabled: loan.logic.step < 2\n      }, {\n        id: 'strategy',\n        link: \"/loans/\" + loan._id + \"/strategy\",\n        isDone: function () {\n          function isDone() {\n            return _strategyDone({\n              loan: loan\n            });\n          }\n\n          return isDone;\n        }()\n      }, {\n        id: 'offerPicker',\n        link: \"/loans/\" + loan._id + \"/offerpicker\",\n        isDone: function () {\n          function isDone() {\n            return !!(loan.logic.lender && loan.logic.lender.offerId);\n          }\n\n          return isDone;\n        }()\n      }]\n    }, {\n      nb: 3,\n      items: [{\n        id: 'contract',\n        link: \"/loans/\" + loan._id + \"/contract\",\n        disabled: loan.logic.step < 3 && !(loan.logic.lender && loan.logic.lender.offerId),\n        percent: function () {\n          function percent() {\n            return _getAllFilesPercent({\n              loan: loan,\n              borrowers: borrowers,\n              property: property\n            }, 'contract');\n          }\n\n          return percent;\n        }(),\n        waiting: function () {\n          function waiting() {\n            return loan.logic.lender.contractRequested && !loan.logic.lender.contract;\n          }\n\n          return waiting;\n        }(),\n        isDone: function () {\n          function isDone() {\n            return loan.files.contract && loan.files.contract.length;\n          }\n\n          return isDone;\n        }()\n      }, {\n        id: 'closing',\n        link: \"/loans/\" + loan._id + \"/closing\",\n        // FIXME: true && value used because of weird linting...\n        disabled: (true && _getAllFilesPercent({\n          loan: loan,\n          borrowers: borrowers,\n          property: property\n        }, 'contract')) < 1 || loan.logic.step < 3,\n        percent: function () {\n          function percent() {\n            return _closingPercent(loan);\n          }\n\n          return percent;\n        }(),\n        isDone: function () {\n          function isDone() {\n            return loan.status === _LOAN_STATUS.DONE;\n          }\n\n          return isDone;\n        }()\n      }]\n    }, {\n      nb: 4,\n      title: React.createElement(\"span\", {\n        className: \"fa fa-home fa-2x\",\n        style: {\n          color: '#ADB5BD',\n          paddingLeft: 8\n        }\n      }),\n      disabled: true,\n      // TODO\n      subtitle: null,\n      items: []\n    }]; // Make sure these indices correspond\n    // Verify all 3 items before item 4 are done\n\n    steps[1].items[4].disabled = !_previousDone(steps, 1, 4); // Vérification e-Potek\n    // steps[0].items[6].disabled = !previousDone(steps, 0, 6); // Expertise\n\n    steps[2].items[1].disabled = !_previousDone(steps, 2, 1); // Enchères\n\n    steps[2].items[2].disabled = !_previousDone(steps, 2, 2); // Stratégie\n\n    steps[2].items[3].disabled = !_previousDone(steps, 2, 3); // Choix du prêteur\n\n    return steps;\n  }\n\n  return getSteps;\n}();\n\nmodule.exportDefault(getSteps);\n\n// Returns the current value of an autoForm input\nvar getCurrentValue = function () {\n  function getCurrentValue(input, doc) {\n    return get(doc, input.id);\n  }\n\n  return getCurrentValue;\n}(); /**\n      * previousDone - Checks if all previous subSteps have been finished upto this\n      * item\n      *\n      * @param {array} steps  An array of subSteps/items\n      * @param {number} stepNb The step Number\n      * @param {number} itemNb The number of the item that is concerned\n      *\n      * @return {boolean} Description\n      */\n\nvar _previousDone = function () {\n  function _previousDone(steps, stepNb, itemNb) {\n    if (stepNb >= steps.length) {\n      throw new Error('invalid stepNb');\n    } else if (itemNb >= steps[stepNb].items.length) {\n      throw new Error('invalid itemNb');\n    }\n\n    return steps[stepNb].items.slice(0, itemNb).reduce(function (res, i) {\n      return res && i.isDone();\n    }, true);\n  }\n\n  return _previousDone;\n}(); /**\n      * getPercent - Given an array of values, any value that is undefined or null\n      * will be counted as incomplete, make sure we don't divide by 0\n      *\n      * @param {array} array Array of numbers, strings, or dates\n      *\n      * @return {number} a value between 0 and 1\n      */\n\nvar _getPercent = function () {\n  function _getPercent() {\n    var array = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    var percent = array.reduce(function (tot, val) {\n      if (isArray(val)) {\n        return tot + (val.length ? 1 : 0);\n      } else if (val !== undefined && val !== null) {\n        return tot + 1;\n      }\n\n      return tot;\n    }, 0) / array.length;\n    return isFinite(percent) ? percent : 0;\n  }\n\n  return _getPercent;\n}();\n\nvar _shouldCountField = function () {\n  function _shouldCountField(f) {\n    return (f.condition === undefined || f.condition === true) && f.required !== false && !f.disabled && f.type !== 'h3';\n  }\n\n  return _shouldCountField;\n}();\n\nvar _getCountedArray = function () {\n  function _getCountedArray(formArray, doc) {\n    var arr = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n    formArray.forEach(function (i) {\n      if (_shouldCountField(i)) {\n        if (i.type === 'conditionalInput') {\n          if (getCurrentValue(i.inputs[0], doc) === i.conditionalTrueValue) {\n            // If the conditional input is triggering the next input, add all values\n            i.inputs.forEach(function (input) {\n              return arr.push(getCurrentValue(input, doc));\n            });\n          } else {\n            // If conditional value is not triggering\n            arr.push(getCurrentValue(i.inputs[0], doc));\n          }\n        } else {\n          arr.push(getCurrentValue(i, doc));\n        }\n      }\n    });\n    return arr;\n  }\n\n  return _getCountedArray;\n}();\n\nvar _personalInfoPercent = function () {\n  function _personalInfoPercent(borrowers) {\n    var a = [];\n\n    _arrayify(borrowers).forEach(function (b) {\n      var formArray = _getBorrowerInfoArray({\n        borrowers: _arrayify(borrowers),\n        borrowerId: b._id\n      });\n\n      _getCountedArray(formArray, b, a);\n    });\n\n    return _getPercent(a);\n  }\n\n  return _personalInfoPercent;\n}();\n\nvar _propertyPercent = function () {\n  function _propertyPercent(loan, borrowers, property) {\n    var formArray1 = _getPropertyArray({\n      loan: loan,\n      borrowers: borrowers,\n      property: property\n    });\n\n    var formArray2 = _getPropertyLoanArray({\n      loan: loan,\n      borrowers: borrowers,\n      property: property\n    });\n\n    var a = _getCountedArray(formArray1, property);\n\n    a = [].concat(_toConsumableArray(a), [_getCountedArray(formArray2, loan)]);\n    return _getPercent(a);\n  }\n\n  return _propertyPercent;\n}();\n\nvar _auctionFilesPercent = function () {\n  function _auctionFilesPercent(borrowers) {\n    var a = [];\n\n    _arrayify(borrowers).forEach(function (b) {\n      var fileArray = _borrowerFiles(b).auction;\n\n      if (_isDemo()) {\n        a.push(b.files[fileArray[0].id]);\n      } else {\n        fileArray.forEach(function (f) {\n          return f.condition !== false && a.push(b.files[f.id]);\n        });\n      }\n    });\n\n    return _getPercent(a);\n  }\n\n  return _auctionFilesPercent;\n}();\n\nvar _filesPercent = function () {\n  function _filesPercent(doc, fileArrayFunc, step, checkValidity) {\n    var a = [];\n\n    var iterate = function () {\n      function iterate(files, doc2) {\n        if (!doc2 || !doc2.files) {\n          return;\n        }\n\n        if (_isDemo()) {\n          a.push(doc2.files[files[0].id]);\n        } else {\n          files.forEach(function (f) {\n            if (!(f.required === false || f.condition === false)) {\n              if (checkValidity) {\n                a.push(isArray(doc2.files[f.id]) && doc2.files[f.id].every(function (file) {\n                  return file.status === _FILE_STATUS.VALID;\n                }) ? true : undefined);\n              } else {\n                a.push(doc2.files[f.id]);\n              }\n            }\n          });\n        }\n      }\n\n      return iterate;\n    }();\n\n    if (isArray(doc)) {\n      doc.forEach(function (item) {\n        var fileArray = fileArrayFunc(item)[step];\n        iterate(fileArray, item);\n      });\n    } else {\n      var fileArray = fileArrayFunc(doc)[step];\n      iterate(fileArray, doc);\n    }\n\n    return _getPercent(a);\n  }\n\n  return _filesPercent;\n}();\n\nvar _getAllFilesPercent = function () {\n  function _getAllFilesPercent(_ref, step) {\n    var loan = _ref.loan,\n        borrowers = _ref.borrowers,\n        property = _ref.property;\n    var array = [];\n\n    if (loan) {\n      array.push(_filesPercent(loan, _loanFiles, step));\n    }\n\n    if (borrowers) {\n      array.push(_filesPercent(borrowers, _borrowerFiles, step));\n    }\n\n    if (property) {\n      array.push(_filesPercent(property, _propertyFiles, step));\n    } // Sum and divide by amount of them\n\n\n    return array.reduce(function (a, b) {\n      return a + b;\n    }, 0) / array.length;\n  }\n\n  return _getAllFilesPercent;\n}();\n\nvar _closingPercent = function () {\n  function _closingPercent(loan) {\n    var closingSteps = loan.logic.closingSteps;\n    var arr = [];\n    closingSteps.forEach(function (step) {\n      if (step.type === _CLOSING_STEPS_TYPE.TODO) {\n        arr.push(step.status === _CLOSING_STEPS_STATUS.VALID ? true : undefined);\n      } else {\n        arr.push(isArray(loan.files[step.id]) && loan.files[step.id].every(function (file) {\n          return file.status === _CLOSING_STEPS_STATUS.VALID;\n        }) ? true : undefined);\n      }\n    });\n    return _getPercent(arr);\n  }\n\n  return _closingPercent;\n}();","map":{"version":3,"sources":["imports/core/arrays/steps.js"],"names":["module","export","previousDone","getPercent","shouldCountField","getCountedArray","personalInfoPercent","propertyPercent","auctionFilesPercent","filesPercent","getAllFilesPercent","closingPercent","React","watch","require","v","get","isArray","getBorrowerInfoArray","borrowerFiles","loanFiles","propertyFiles","getPropertyArray","getPropertyLoanArray","strategyDone","getPropertyCompletion","arrayify","isDemo","LOAN_STATUS","AUCTION_STATUS","FILE_STATUS","CLOSING_STEPS_STATUS","CLOSING_STEPS_TYPE","getSteps","props","loan","borrowers","property","serverTime","steps","nb","items","id","link","_id","percent","isDone","reduce","res","b","logic","hasValidatedFinances","length","waiting","verification","requested","validated","hasValidatedStructure","disabled","step","auction","status","STARTED","ENDED","lender","offerId","contractRequested","contract","files","DONE","title","color","paddingLeft","subtitle","exportDefault","getCurrentValue","input","doc","stepNb","itemNb","Error","slice","i","array","tot","val","undefined","isFinite","f","condition","required","type","formArray","arr","forEach","inputs","conditionalTrueValue","push","a","borrowerId","formArray1","formArray2","fileArray","fileArrayFunc","checkValidity","iterate","doc2","every","file","VALID","item","closingSteps","TODO"],"mappings":"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","file":"imports/core/arrays/steps.js.map","sourcesContent":["import React from 'react';\nimport get from 'lodash/get';\nimport isArray from 'lodash/isArray';\n\nimport { getBorrowerInfoArray } from './BorrowerFormArray';\nimport { borrowerFiles, loanFiles, propertyFiles } from '../api/files/files';\nimport { getPropertyArray, getPropertyLoanArray } from './PropertyFormArray';\nimport { strategyDone, getPropertyCompletion } from 'core/utils/loanFunctions';\nimport { arrayify } from '../utils/general';\nimport { isDemo } from 'core/utils/browserFunctions';\nimport {\n  LOAN_STATUS,\n  AUCTION_STATUS,\n  FILE_STATUS,\n  CLOSING_STEPS_STATUS,\n  CLOSING_STEPS_TYPE,\n} from '../api/constants';\n\nconst getSteps = (props) => {\n  const { loan, borrowers, property, serverTime } = props;\n\n  const steps = [\n    {\n      nb: 0,\n      items: [],\n    },\n\n    {\n      nb: 1,\n      items: [\n        {\n          id: 'personal',\n          link: `/loans/${loan._id}/borrowers/${borrowers[0]._id}/personal`,\n          percent: () => personalInfoPercent(borrowers),\n          isDone() {\n            return this.percent() >= 1;\n          },\n        },\n        {\n          id: 'finance',\n          link: `/loans/${loan._id}/borrowers/${borrowers[0]._id}/finance`,\n\n          isDone: () =>\n            borrowers.reduce(\n              (res, b) => res && b.logic.hasValidatedFinances,\n              true,\n            ),\n          percent: () =>\n            borrowers.reduce(\n              (res, b) => (b.logic.hasValidatedFinances ? res + 1 : res),\n              0,\n            ) / borrowers.length,\n        },\n        {\n          id: 'files',\n          link: `/loans/${loan._id}/borrowers/${borrowers[0]._id}/files`,\n          percent: () => filesPercent(borrowers, borrowerFiles, 'auction'),\n          isDone() {\n            return this.percent() >= 1;\n          },\n        },\n        {\n          id: 'property',\n          link: `/loans/${loan._id}/property`,\n          percent: () => getPropertyCompletion(props),\n          isDone() {\n            return this.percent() >= 1;\n          },\n        },\n        {\n          id: 'verification',\n          link: `/loans/${loan._id}/verification`,\n          waiting: () =>\n            loan.logic.verification.requested &&\n            !loan.logic.verification.validated,\n          isDone: () => loan.logic.verification.validated === true,\n        },\n      ],\n    },\n\n    {\n      nb: 2,\n      items: [\n        {\n          id: 'structure',\n          link: `/loans/${loan._id}/structure`,\n          isDone: () => loan.logic.hasValidatedStructure,\n          disabled: loan.logic.step < 2,\n        },\n        {\n          id: 'auction',\n          link: `/loans/${loan._id}/auction`,\n          waiting: () => loan.logic.auction.status === AUCTION_STATUS.STARTED,\n          isDone: () => loan.logic.auction.status === AUCTION_STATUS.ENDED,\n          disabled: loan.logic.step < 2,\n        },\n        {\n          id: 'strategy',\n          link: `/loans/${loan._id}/strategy`,\n          isDone: () => strategyDone({ loan }),\n        },\n        {\n          id: 'offerPicker',\n          link: `/loans/${loan._id}/offerpicker`,\n          isDone: () => !!(loan.logic.lender && loan.logic.lender.offerId),\n        },\n      ],\n    },\n\n    {\n      nb: 3,\n      items: [\n        {\n          id: 'contract',\n          link: `/loans/${loan._id}/contract`,\n          disabled:\n            loan.logic.step < 3 &&\n            !(loan.logic.lender && loan.logic.lender.offerId),\n          percent: () =>\n            getAllFilesPercent({ loan, borrowers, property }, 'contract'),\n          waiting: () =>\n            loan.logic.lender.contractRequested && !loan.logic.lender.contract,\n          isDone() {\n            return loan.files.contract && loan.files.contract.length;\n          },\n        },\n        {\n          id: 'closing',\n          link: `/loans/${loan._id}/closing`,\n          // FIXME: true && value used because of weird linting...\n          disabled:\n            (true &&\n              getAllFilesPercent({ loan, borrowers, property }, 'contract')) <\n              1 || loan.logic.step < 3,\n          percent: () => closingPercent(loan),\n          isDone: () => loan.status === LOAN_STATUS.DONE,\n        },\n      ],\n    },\n\n    {\n      nb: 4,\n      title: (\n        <span\n          className=\"fa fa-home fa-2x\"\n          style={{ color: '#ADB5BD', paddingLeft: 8 }}\n        />\n      ),\n      disabled: true, // TODO\n      subtitle: null,\n      items: [],\n    },\n  ];\n\n  // Make sure these indices correspond\n  // Verify all 3 items before item 4 are done\n  steps[1].items[4].disabled = !previousDone(steps, 1, 4); // Vérification e-Potek\n  // steps[0].items[6].disabled = !previousDone(steps, 0, 6); // Expertise\n\n  steps[2].items[1].disabled = !previousDone(steps, 2, 1); // Enchères\n  steps[2].items[2].disabled = !previousDone(steps, 2, 2); // Stratégie\n  steps[2].items[3].disabled = !previousDone(steps, 2, 3); // Choix du prêteur\n\n  return steps;\n};\n\nexport default getSteps;\n\n// Returns the current value of an autoForm input\nconst getCurrentValue = (input, doc) => get(doc, input.id);\n\n/**\n * previousDone - Checks if all previous subSteps have been finished upto this\n * item\n *\n * @param {array} steps  An array of subSteps/items\n * @param {number} stepNb The step Number\n * @param {number} itemNb The number of the item that is concerned\n *\n * @return {boolean} Description\n */\nexport const previousDone = (steps, stepNb, itemNb) => {\n  if (stepNb >= steps.length) {\n    throw new Error('invalid stepNb');\n  } else if (itemNb >= steps[stepNb].items.length) {\n    throw new Error('invalid itemNb');\n  }\n\n  return steps[stepNb].items\n    .slice(0, itemNb)\n    .reduce((res, i) => res && i.isDone(), true);\n};\n\n/**\n * getPercent - Given an array of values, any value that is undefined or null\n * will be counted as incomplete, make sure we don't divide by 0\n *\n * @param {array} array Array of numbers, strings, or dates\n *\n * @return {number} a value between 0 and 1\n */\nexport const getPercent = (array = []) => {\n  const percent =\n    array.reduce((tot, val) => {\n      if (isArray(val)) {\n        return tot + (val.length ? 1 : 0);\n      } else if (val !== undefined && val !== null) {\n        return tot + 1;\n      }\n      return tot;\n    }, 0) / array.length;\n  return isFinite(percent) ? percent : 0;\n};\n\n/**\n * shouldCountField - A boolean to determine if a field in an array\n * should be counted or not\n *\n * @param {object} f A formArray field object\n *\n * @return {boolean} Description\n */\nexport const shouldCountField = f =>\n  (f.condition === undefined || f.condition === true) &&\n  f.required !== false &&\n  !f.disabled &&\n  f.type !== 'h3';\n\n/**\n * getCountedArray - Returns an array of values that are mandatory and should\n * be counted to determine a completion percentage of a form\n *\n * @param {array}  formArray Description\n * @param {object}  doc       Description\n * @param {array} [arr=[]]  Description\n *\n * @return {array} an array with all the currentValues that are mandatory\n */\nexport const getCountedArray = (formArray, doc, arr = []) => {\n  formArray.forEach((i) => {\n    if (shouldCountField(i)) {\n      if (i.type === 'conditionalInput') {\n        if (getCurrentValue(i.inputs[0], doc) === i.conditionalTrueValue) {\n          // If the conditional input is triggering the next input, add all values\n          i.inputs.forEach(input => arr.push(getCurrentValue(input, doc)));\n        } else {\n          // If conditional value is not triggering\n          arr.push(getCurrentValue(i.inputs[0], doc));\n        }\n      } else {\n        arr.push(getCurrentValue(i, doc));\n      }\n    }\n  });\n\n  return arr;\n};\n\n/**\n * personalInfoPercent - Determines the completion rate of the borrower's\n * personal information forms\n *\n * @param {object} borrowers Description\n *\n * @return {number} A value between 0 and 1\n */\nexport const personalInfoPercent = (borrowers) => {\n  const a = [];\n  arrayify(borrowers).forEach((b) => {\n    const formArray = getBorrowerInfoArray({\n      borrowers: arrayify(borrowers),\n      borrowerId: b._id,\n    });\n    getCountedArray(formArray, b, a);\n  });\n\n  return getPercent(a);\n};\n\n/**\n * propertyPercent - Determines the completion rate of the property forms\n *\n * @param {object} loan Description\n * @param {object} borrowers   Description\n *\n * @return {number} A percentage between 0 and 1\n */\nexport const propertyPercent = (loan, borrowers, property) => {\n  const formArray1 = getPropertyArray({ loan, borrowers, property });\n  const formArray2 = getPropertyLoanArray({\n    loan,\n    borrowers,\n    property,\n  });\n\n  let a = getCountedArray(formArray1, property);\n  a = [...a, getCountedArray(formArray2, loan)];\n\n  return getPercent(a);\n};\n\nexport const auctionFilesPercent = (borrowers) => {\n  const a = [];\n  arrayify(borrowers).forEach((b) => {\n    const fileArray = borrowerFiles(b).auction;\n\n    if (isDemo()) {\n      a.push(b.files[fileArray[0].id]);\n    } else {\n      fileArray.forEach(f => f.condition !== false && a.push(b.files[f.id]));\n    }\n  });\n\n  return getPercent(a);\n};\n\n/**\n * filesPercent - Determines the completion rate of file upload for a given\n * step, doc and array of files\n *\n * @param {object} doc           The mongoDB document where files are saved\n * @param {function} fileArrayFunc A function that returns an array of files\n * @param {number} step          The step that determines which files are\n * required at this moment\n *\n * @return {number} a value between 0 and 1 indicating the percentage of\n * completion, 1 is complete, 0 is not started\n */\nexport const filesPercent = (doc, fileArrayFunc, step, checkValidity) => {\n  const a = [];\n  const iterate = (files, doc2) => {\n    if (!doc2 || !doc2.files) {\n      return;\n    }\n\n    if (isDemo()) {\n      a.push(doc2.files[files[0].id]);\n    } else {\n      files.forEach((f) => {\n        if (!(f.required === false || f.condition === false)) {\n          if (checkValidity) {\n            a.push(isArray(doc2.files[f.id]) &&\n              doc2.files[f.id].every(file => file.status === FILE_STATUS.VALID)\n              ? true\n              : undefined);\n          } else {\n            a.push(doc2.files[f.id]);\n          }\n        }\n      });\n    }\n  };\n\n  if (isArray(doc)) {\n    doc.forEach((item) => {\n      const fileArray = fileArrayFunc(item)[step];\n      iterate(fileArray, item);\n    });\n  } else {\n    const fileArray = fileArrayFunc(doc)[step];\n    iterate(fileArray, doc);\n  }\n\n  return getPercent(a);\n};\n\nexport const getAllFilesPercent = ({ loan, borrowers, property }, step) => {\n  const array = [];\n  if (loan) {\n    array.push(filesPercent(loan, loanFiles, step));\n  }\n\n  if (borrowers) {\n    array.push(filesPercent(borrowers, borrowerFiles, step));\n  }\n\n  if (property) {\n    array.push(filesPercent(property, propertyFiles, step));\n  }\n\n  // Sum and divide by amount of them\n  return array.reduce((a, b) => a + b, 0) / array.length;\n};\n\nexport const closingPercent = (loan) => {\n  const { closingSteps } = loan.logic;\n  const arr = [];\n\n  closingSteps.forEach((step) => {\n    if (step.type === CLOSING_STEPS_TYPE.TODO) {\n      arr.push(step.status === CLOSING_STEPS_STATUS.VALID ? true : undefined);\n    } else {\n      arr.push(isArray(loan.files[step.id]) &&\n        loan.files[step.id].every(file => file.status === CLOSING_STEPS_STATUS.VALID)\n        ? true\n        : undefined);\n    }\n  });\n\n  return getPercent(arr);\n};\n"]},"hash":"08d613b6a27667ac06de2734052798fb844daf6f"}
