{"metadata":{"usedHelpers":["extends","interopRequireDefault"],"marked":[],"modules":{"imports":[{"source":"moment","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"moment"}]},{"source":"../../events","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"EventService"}]},{"source":"../../mutations","imported":["mutations"],"specifiers":[{"kind":"named","imported":"mutations","local":"mutations"}]},{"source":"../..","imported":["Loans"],"specifiers":[{"kind":"named","imported":"Loans","local":"Loans"}]},{"source":"../emailConstants","imported":["EMAIL_IDS"],"specifiers":[{"kind":"named","imported":"EMAIL_IDS","local":"EMAIL_IDS"}]},{"source":"./emailMethods","imported":["sendEmail"],"specifiers":[{"kind":"named","imported":"sendEmail","local":"sendEmail"}]},{"source":"../../../utils/loanFunctions","imported":["getAuctionEndTime"],"specifiers":[{"kind":"named","imported":"getAuctionEndTime","local":"getAuctionEndTime"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"imports/core/api/email/server/emailListeners.js","filenameRelative":"imports/core/api/email/server/emailListeners.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"useNativeAsyncAwait":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"imports/core/api/email/server/emailListeners.js.map","sourceFileName":"imports/core/api/email/server/emailListeners.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"emailListeners"},"ignored":false,"code":"\"use strict\";\n\nvar _extends2 = require(\"babel-runtime/helpers/extends\");\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar moment = void 0;\nmodule.watch(require(\"moment\"), {\n  default: function _default(v) {\n    moment = v;\n  }\n}, 0);\nvar EventService = void 0;\nmodule.watch(require(\"../../events\"), {\n  default: function _default(v) {\n    EventService = v;\n  }\n}, 1);\n\nvar _mutations = void 0;\n\nmodule.watch(require(\"../../mutations\"), {\n  mutations: function mutations(v) {\n    _mutations = v;\n  }\n}, 2);\n\nvar _Loans = void 0;\n\nmodule.watch(require(\"../..\"), {\n  Loans: function Loans(v) {\n    _Loans = v;\n  }\n}, 3);\n\nvar _EMAIL_IDS = void 0;\n\nmodule.watch(require(\"../emailConstants\"), {\n  EMAIL_IDS: function EMAIL_IDS(v) {\n    _EMAIL_IDS = v;\n  }\n}, 4);\n\nvar _sendEmail = void 0;\n\nmodule.watch(require(\"./emailMethods\"), {\n  sendEmail: function sendEmail(v) {\n    _sendEmail = v;\n  }\n}, 5);\n\nvar _getAuctionEndTime = void 0;\n\nmodule.watch(require(\"../../../utils/loanFunctions\"), {\n  getAuctionEndTime: function getAuctionEndTime(v) {\n    _getAuctionEndTime = v;\n  }\n}, 6);\nEventService.addMutationListener(_mutations.REQUEST_LOAN_VERIFICATION, function (params) {\n  var loanId = params.loanId;\n\n  var _Loans$findOne = _Loans.findOne(loanId),\n      userId = _Loans$findOne.userId;\n\n  return _sendEmail({\n    emailId: _EMAIL_IDS.VERIFICATION_REQUESTED,\n    userId: userId,\n    params: params\n  });\n});\nEventService.addMutationListener(_mutations.START_AUCTION, function (params) {\n  var loanId = params.loanId;\n\n  var _Loans$findOne2 = _Loans.findOne(loanId),\n      userId = _Loans$findOne2.userId;\n\n  return _sendEmail({\n    emailId: _EMAIL_IDS.AUCTION_STARTED,\n    userId: userId,\n    params: (0, _extends3.default)({}, params, {\n      auctionEndTime: _getAuctionEndTime(moment())\n    })\n  });\n});\nEventService.addMutationListener(_mutations.END_AUCTION, function (params) {\n  var loanId = params.loanId;\n\n  var _Loans$findOne3 = _Loans.findOne(loanId),\n      userId = _Loans$findOne3.userId;\n\n  return _sendEmail({\n    emailId: _EMAIL_IDS.AUCTION_ENDED,\n    userId: userId,\n    params: params\n  });\n});\nEventService.addMutationListener(_mutations.CANCEL_AUCTION, function (params) {\n  var loanId = params.loanId;\n\n  var _Loans$findOne4 = _Loans.findOne(loanId),\n      userId = _Loans$findOne4.userId;\n\n  return _sendEmail({\n    emailId: _EMAIL_IDS.AUCTION_CANCELLED,\n    userId: userId,\n    params: params\n  });\n});","map":{"version":3,"sources":["imports/core/api/email/server/emailListeners.js"],"names":["moment","module","watch","require","default","v","EventService","mutations","Loans","EMAIL_IDS","sendEmail","getAuctionEndTime","addMutationListener","REQUEST_LOAN_VERIFICATION","params","loanId","findOne","userId","emailId","VERIFICATION_REQUESTED","START_AUCTION","AUCTION_STARTED","auctionEndTime","END_AUCTION","AUCTION_ENDED","CANCEL_AUCTION","AUCTION_CANCELLED"],"mappings":"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","file":"imports/core/api/email/server/emailListeners.js.map","sourcesContent":["import moment from 'moment';\nimport EventService from '../../events';\nimport { mutations } from '../../mutations';\nimport { Loans } from '../..';\nimport { EMAIL_IDS } from '../emailConstants';\nimport { sendEmail } from './emailMethods';\nimport { getAuctionEndTime } from '../../../utils/loanFunctions';\n\nEventService.addMutationListener(\n  mutations.REQUEST_LOAN_VERIFICATION,\n  (params) => {\n    const { loanId } = params;\n    const { userId } = Loans.findOne(loanId);\n\n    return sendEmail({\n      emailId: EMAIL_IDS.VERIFICATION_REQUESTED,\n      userId,\n      params,\n    });\n  },\n);\n\nEventService.addMutationListener(mutations.START_AUCTION, (params) => {\n  const { loanId } = params;\n  const { userId } = Loans.findOne(loanId);\n\n  return sendEmail({\n    emailId: EMAIL_IDS.AUCTION_STARTED,\n    userId,\n    params: { ...params, auctionEndTime: getAuctionEndTime(moment()) },\n  });\n});\n\nEventService.addMutationListener(mutations.END_AUCTION, (params) => {\n  const { loanId } = params;\n  const { userId } = Loans.findOne(loanId);\n\n  return sendEmail({\n    emailId: EMAIL_IDS.AUCTION_ENDED,\n    userId,\n    params,\n  });\n});\n\nEventService.addMutationListener(mutations.CANCEL_AUCTION, (params) => {\n  const { loanId } = params;\n  const { userId } = Loans.findOne(loanId);\n\n  return sendEmail({\n    emailId: EMAIL_IDS.AUCTION_CANCELLED,\n    userId,\n    params,\n  });\n});\n"]},"hash":"f028aceb1dc520904886629fc3685661db10199b"}
