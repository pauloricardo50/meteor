{"metadata":{"usedHelpers":["classCallCheck","interopRequireDefault"],"marked":[],"modules":{"imports":[{"source":"meteor/meteor","imported":["Meteor"],"specifiers":[{"kind":"named","imported":"Meteor","local":"Meteor"}]},{"source":"../tasks","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"Tasks"}]},{"source":"./tasksConstants","imported":["TASK_STATUS","TASK_TYPE"],"specifiers":[{"kind":"named","imported":"TASK_STATUS","local":"TASK_STATUS"},{"kind":"named","imported":"TASK_TYPE","local":"TASK_TYPE"}]},{"source":"./queries/tasksUnassigned","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"unassignedTasksQuery"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"imports/core/api/tasks/TaskService.js","filenameRelative":"imports/core/api/tasks/TaskService.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"imports/core/api/tasks/TaskService.js.map","sourceFileName":"imports/core/api/tasks/TaskService.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"TaskService"},"ignored":false,"code":"\"use strict\";\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nvar _Meteor = void 0;\n\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function () {\n    function Meteor(v) {\n      _Meteor = v;\n    }\n\n    return Meteor;\n  }()\n}, 0);\nvar Tasks = void 0;\nmodule.watch(require(\"../tasks\"), {\n  \"default\": function () {\n    function _default(v) {\n      Tasks = v;\n    }\n\n    return _default;\n  }()\n}, 1);\n\nvar _TASK_STATUS = void 0,\n    _TASK_TYPE = void 0;\n\nmodule.watch(require(\"./tasksConstants\"), {\n  TASK_STATUS: function () {\n    function TASK_STATUS(v) {\n      _TASK_STATUS = v;\n    }\n\n    return TASK_STATUS;\n  }(),\n  TASK_TYPE: function () {\n    function TASK_TYPE(v) {\n      _TASK_TYPE = v;\n    }\n\n    return TASK_TYPE;\n  }()\n}, 2);\nvar unassignedTasksQuery = void 0;\nmodule.watch(require(\"./queries/tasksUnassigned\"), {\n  \"default\": function () {\n    function _default(v) {\n      unassignedTasksQuery = v;\n    }\n\n    return _default;\n  }()\n}, 3);\n\nvar TaskService = function () {\n  function TaskService() {\n    var _this = this;\n\n    (0, _classCallCheck3.default)(this, TaskService);\n\n    this.insert = function (_ref) {\n      var type = _ref.type,\n          loanId = _ref.loanId,\n          assignedTo = _ref.assignedTo,\n          createdBy = _ref.createdBy;\n\n      if (type !== _TASK_TYPE.ADD_ASSIGNED_TO) {\n        var existingTask = Tasks.findOne({\n          type: type,\n          loanId: loanId,\n          status: _TASK_STATUS.ACTIVE\n        });\n\n        if (existingTask) {\n          throw new _Meteor.Error('duplicate active task');\n        }\n      } // check userId in loan and pass it as assignedTo\n\n\n      return Tasks.insert({\n        type: type,\n        loanId: loanId,\n        assignedTo: assignedTo,\n        createdBy: createdBy\n      });\n    };\n\n    this.remove = function (_ref2) {\n      var taskId = _ref2.taskId;\n      return Tasks.remove(taskId);\n    };\n\n    this.update = function (_ref3) {\n      var taskId = _ref3.taskId,\n          task = _ref3.task;\n      return Tasks.update(taskId, {\n        $set: task\n      });\n    };\n\n    this.complete = function (_ref4) {\n      var taskId = _ref4.taskId;\n      return _this.update({\n        taskId: taskId,\n        task: {\n          status: _TASK_STATUS.COMPLETED,\n          completedAt: new Date()\n        }\n      });\n    };\n\n    this.completeByType = function (_ref5) {\n      var type = _ref5.type,\n          loanId = _ref5.loanId,\n          newStatus = _ref5.newStatus;\n      var taskToComplete = Tasks.findOne({\n        loanId: loanId,\n        type: type,\n        status: _TASK_STATUS.ACTIVE\n      });\n\n      if (!taskToComplete) {\n        throw new _Meteor.Error(\"task couldn't be found\");\n      }\n\n      return _this.update({\n        taskId: taskToComplete._id,\n        task: {\n          status: newStatus || _TASK_STATUS.COMPLETED,\n          completedAt: new Date()\n        }\n      });\n    };\n\n    this.changeStatus = function (_ref6) {\n      var taskId = _ref6.taskId,\n          newStatus = _ref6.newStatus;\n      return _this.update({\n        taskId: taskId,\n        task: {\n          status: newStatus\n        }\n      });\n    };\n\n    this.changeUser = function (_ref7) {\n      var taskId = _ref7.taskId,\n          newUser = _ref7.newUser;\n      return _this.update({\n        taskId: taskId,\n        task: {\n          userId: newUser\n        }\n      });\n    };\n\n    this.changeAssignedTo = function (_ref8) {\n      var taskId = _ref8.taskId,\n          userId = _ref8.userId,\n          newAssignee = _ref8.newAssignee;\n      return _this.update({\n        taskId: taskId,\n        task: {\n          userId: userId,\n          assignedTo: newAssignee\n        }\n      });\n    };\n\n    this.getAssignee = function (_ref9) {\n      var task = _ref9.task;\n\n      if (task.userId) {\n        return task.userId;\n      }\n\n      if (task.borrower.borrowerAssignee) {\n        return task.borrower.borrowerAssignee;\n      }\n\n      if (task.loan.loanAssignee) {\n        return task.loan.loanAssignee;\n      }\n\n      if (task.property.propertyAssignee) {\n        return task.property.propertyAssignee;\n      }\n\n      return undefined;\n    };\n\n    this.assignAllTasksToAdmin = function (_ref10) {\n      var userId = _ref10.userId,\n          newAssignee = _ref10.newAssignee;\n      // fetch all queries...map results with update\n      var unassignedTasks = unassignedTasksQuery.fetch();\n      console.log(unassignedTasks); // this.update({\n      //   taskId,\n      //   task: { assignedTo: newAssignee },\n      // });\n    };\n  }\n\n  return TaskService;\n}();\n\nmodule.exportDefault(new TaskService());","map":{"version":3,"sources":["imports/core/api/tasks/TaskService.js"],"names":["Meteor","module","watch","require","v","Tasks","TASK_STATUS","TASK_TYPE","unassignedTasksQuery","TaskService","insert","type","loanId","assignedTo","createdBy","ADD_ASSIGNED_TO","existingTask","findOne","status","ACTIVE","Error","remove","taskId","update","task","$set","complete","COMPLETED","completedAt","Date","completeByType","newStatus","taskToComplete","_id","changeStatus","changeUser","newUser","userId","changeAssignedTo","newAssignee","getAssignee","borrower","borrowerAssignee","loan","loanAssignee","property","propertyAssignee","undefined","assignAllTasksToAdmin","unassignedTasks","fetch","console","log","exportDefault"],"mappings":";;;;;;;;AAAA,IAAIA,gBAAJ;;AAAWC,OAAOC,KAAP,CAAaC,QAAQ,eAAR,CAAb,EAAsC;AAACH,QAAD;AAAA,oBAAQI,CAAR,EAAU;AAACJ,gBAAOI,CAAP;AAAS;;AAApB;AAAA;AAAA,CAAtC,EAA4D,CAA5D;AAA+D,IAAIC,cAAJ;AAAUJ,OAAOC,KAAP,CAAaC,QAAQ,UAAR,CAAb,EAAiC;AAAA;AAAA,sBAASC,CAAT,EAAW;AAACC,cAAMD,CAAN;AAAQ;;AAApB;AAAA;AAAA,CAAjC,EAAuD,CAAvD;;AAA0D,IAAIE,qBAAJ;AAAA,IAAgBC,mBAAhB;;AAA0BN,OAAOC,KAAP,CAAaC,QAAQ,kBAAR,CAAb,EAAyC;AAACG,aAAD;AAAA,yBAAaF,CAAb,EAAe;AAACE,qBAAYF,CAAZ;AAAc;;AAA9B;AAAA;AAA+BG,WAA/B;AAAA,uBAAyCH,CAAzC,EAA2C;AAACG,mBAAUH,CAAV;AAAY;;AAAxD;AAAA;AAAA,CAAzC,EAAmG,CAAnG;AAAsG,IAAII,6BAAJ;AAAyBP,OAAOC,KAAP,CAAaC,QAAQ,2BAAR,CAAb,EAAkD;AAAA;AAAA,sBAASC,CAAT,EAAW;AAACI,6BAAqBJ,CAArB;AAAuB;;AAAnC;AAAA;AAAA,CAAlD,EAAuF,CAAvF;;IAKjSK,W;;;;;;SACJC,M,GAAS,gBAA6C;AAAA,UAA1CC,IAA0C,QAA1CA,IAA0C;AAAA,UAApCC,MAAoC,QAApCA,MAAoC;AAAA,UAA5BC,UAA4B,QAA5BA,UAA4B;AAAA,UAAhBC,SAAgB,QAAhBA,SAAgB;;AACpD,UAAIH,SAASJ,WAAUQ,eAAvB,EAAwC;AACtC,YAAMC,eAAeX,MAAMY,OAAN,CAAc;AACjCN,oBADiC;AAEjCC,wBAFiC;AAGjCM,kBAAQZ,aAAYa;AAHa,SAAd,CAArB;;AAKA,YAAIH,YAAJ,EAAkB;AAChB,gBAAM,IAAIhB,QAAOoB,KAAX,CAAiB,uBAAjB,CAAN;AACD;AACF,OAVmD,CAWpD;;;AACA,aAAOf,MAAMK,MAAN,CAAa;AAClBC,kBADkB;AAElBC,sBAFkB;AAGlBC,8BAHkB;AAIlBC;AAJkB,OAAb,CAAP;AAMD,K;;SAEDO,M,GAAS;AAAA,UAAGC,MAAH,SAAGA,MAAH;AAAA,aAAgBjB,MAAMgB,MAAN,CAAaC,MAAb,CAAhB;AAAA,K;;SAETC,M,GAAS;AAAA,UAAGD,MAAH,SAAGA,MAAH;AAAA,UAAWE,IAAX,SAAWA,IAAX;AAAA,aAAsBnB,MAAMkB,MAAN,CAAaD,MAAb,EAAqB;AAAEG,cAAMD;AAAR,OAArB,CAAtB;AAAA,K;;SAETE,Q,GAAW;AAAA,UAAGJ,MAAH,SAAGA,MAAH;AAAA,aACT,MAAKC,MAAL,CAAY;AACVD,sBADU;AAEVE,cAAM;AACJN,kBAAQZ,aAAYqB,SADhB;AAEJC,uBAAa,IAAIC,IAAJ;AAFT;AAFI,OAAZ,CADS;AAAA,K;;SASXC,c,GAAiB,iBAAiC;AAAA,UAA9BnB,IAA8B,SAA9BA,IAA8B;AAAA,UAAxBC,MAAwB,SAAxBA,MAAwB;AAAA,UAAhBmB,SAAgB,SAAhBA,SAAgB;AAChD,UAAMC,iBAAiB3B,MAAMY,OAAN,CAAc;AACnCL,sBADmC;AAEnCD,kBAFmC;AAGnCO,gBAAQZ,aAAYa;AAHe,OAAd,CAAvB;;AAMA,UAAI,CAACa,cAAL,EAAqB;AACnB,cAAM,IAAIhC,QAAOoB,KAAX,CAAiB,wBAAjB,CAAN;AACD;;AAED,aAAO,MAAKG,MAAL,CAAY;AACjBD,gBAAQU,eAAeC,GADN;AAEjBT,cAAM;AACJN,kBAAQa,aAAazB,aAAYqB,SAD7B;AAEJC,uBAAa,IAAIC,IAAJ;AAFT;AAFW,OAAZ,CAAP;AAOD,K;;SAEDK,Y,GAAe;AAAA,UAAGZ,MAAH,SAAGA,MAAH;AAAA,UAAWS,SAAX,SAAWA,SAAX;AAAA,aACb,MAAKR,MAAL,CAAY;AAAED,sBAAF;AAAUE,cAAM;AAAEN,kBAAQa;AAAV;AAAhB,OAAZ,CADa;AAAA,K;;SAGfI,U,GAAa;AAAA,UAAGb,MAAH,SAAGA,MAAH;AAAA,UAAWc,OAAX,SAAWA,OAAX;AAAA,aACX,MAAKb,MAAL,CAAY;AACVD,sBADU;AAEVE,cAAM;AAAEa,kBAAQD;AAAV;AAFI,OAAZ,CADW;AAAA,K;;SAMbE,gB,GAAmB;AAAA,UAAGhB,MAAH,SAAGA,MAAH;AAAA,UAAWe,MAAX,SAAWA,MAAX;AAAA,UAAmBE,WAAnB,SAAmBA,WAAnB;AAAA,aACjB,MAAKhB,MAAL,CAAY;AACVD,sBADU;AAEVE,cAAM;AAAEa,wBAAF;AAAUxB,sBAAY0B;AAAtB;AAFI,OAAZ,CADiB;AAAA,K;;SAMjBC,W,GAAc,iBAAc;AAAA,UAAXhB,IAAW,SAAXA,IAAW;;AAC1B,UAAIA,KAAKa,MAAT,EAAiB;AACf,eAAOb,KAAKa,MAAZ;AACD;;AACD,UAAIb,KAAKiB,QAAL,CAAcC,gBAAlB,EAAoC;AAClC,eAAOlB,KAAKiB,QAAL,CAAcC,gBAArB;AACD;;AACD,UAAIlB,KAAKmB,IAAL,CAAUC,YAAd,EAA4B;AAC1B,eAAOpB,KAAKmB,IAAL,CAAUC,YAAjB;AACD;;AACD,UAAIpB,KAAKqB,QAAL,CAAcC,gBAAlB,EAAoC;AAClC,eAAOtB,KAAKqB,QAAL,CAAcC,gBAArB;AACD;;AACD,aAAOC,SAAP;AACD,K;;SAEHC,qB,GAAwB,kBAA6B;AAAA,UAA1BX,MAA0B,UAA1BA,MAA0B;AAAA,UAAlBE,WAAkB,UAAlBA,WAAkB;AACnD;AACA,UAAMU,kBAAkBzC,qBAAqB0C,KAArB,EAAxB;AACAC,cAAQC,GAAR,CAAYH,eAAZ,EAHmD,CAInD;AACA;AACA;AACA;AACD,K;;;;;;AAlGHhD,OAAOoD,aAAP,CAqGe,IAAI5C,WAAJ,EArGf","file":"imports/core/api/tasks/TaskService.js.map","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport Tasks from '../tasks';\nimport { TASK_STATUS, TASK_TYPE } from './tasksConstants';\nimport unassignedTasksQuery from 'core/api/tasks/queries/tasksUnassigned';\n\nclass TaskService {\n  insert = ({ type, loanId, assignedTo, createdBy }) => {\n    if (type !== TASK_TYPE.ADD_ASSIGNED_TO) {\n      const existingTask = Tasks.findOne({\n        type,\n        loanId,\n        status: TASK_STATUS.ACTIVE,\n      });\n      if (existingTask) {\n        throw new Meteor.Error('duplicate active task');\n      }\n    }\n    // check userId in loan and pass it as assignedTo\n    return Tasks.insert({\n      type,\n      loanId,\n      assignedTo,\n      createdBy,\n    });\n  };\n\n  remove = ({ taskId }) => Tasks.remove(taskId);\n\n  update = ({ taskId, task }) => Tasks.update(taskId, { $set: task });\n\n  complete = ({ taskId }) =>\n    this.update({\n      taskId,\n      task: {\n        status: TASK_STATUS.COMPLETED,\n        completedAt: new Date(),\n      },\n    });\n\n  completeByType = ({ type, loanId, newStatus }) => {\n    const taskToComplete = Tasks.findOne({\n      loanId,\n      type,\n      status: TASK_STATUS.ACTIVE,\n    });\n\n    if (!taskToComplete) {\n      throw new Meteor.Error(\"task couldn't be found\");\n    }\n\n    return this.update({\n      taskId: taskToComplete._id,\n      task: {\n        status: newStatus || TASK_STATUS.COMPLETED,\n        completedAt: new Date(),\n      },\n    });\n  };\n\n  changeStatus = ({ taskId, newStatus }) =>\n    this.update({ taskId, task: { status: newStatus } });\n\n  changeUser = ({ taskId, newUser }) =>\n    this.update({\n      taskId,\n      task: { userId: newUser },\n    });\n\n  changeAssignedTo = ({ taskId, userId, newAssignee }) =>\n    this.update({\n      taskId,\n      task: { userId, assignedTo: newAssignee },\n    });\n  \n    getAssignee = ({ task }) => {\n      if (task.userId) {\n        return task.userId;\n      }\n      if (task.borrower.borrowerAssignee) {\n        return task.borrower.borrowerAssignee;\n      }\n      if (task.loan.loanAssignee) {\n        return task.loan.loanAssignee;\n      }\n      if (task.property.propertyAssignee) {\n        return task.property.propertyAssignee;\n      }\n      return undefined;\n    }\n\n  assignAllTasksToAdmin = ({ userId, newAssignee }) => {\n    // fetch all queries...map results with update\n    const unassignedTasks = unassignedTasksQuery.fetch();\n    console.log(unassignedTasks);\n    // this.update({\n    //   taskId,\n    //   task: { assignedTo: newAssignee },\n    // });\n  };\n}\n\nexport default new TaskService();\n"]},"hash":"90a87d31f12a4af5f3e7f57c1c1737d40b155213"}
