{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"meteor/wylio:mandrill","imported":["Mandrill"],"specifiers":[{"kind":"named","imported":"Mandrill","local":"Mandrill"}]},{"source":"meteor/meteor","imported":["Meteor"],"specifiers":[{"kind":"named","imported":"Meteor","local":"Meteor"}]},{"source":"./emailHelpers","imported":["getEmailFooter"],"specifiers":[{"kind":"named","imported":"getEmailFooter","local":"getEmailFooter"}]}],"exports":{"exported":["setupMandrill","getSimpleMandrillTemplate","getMandrillTemplate","renderMandrillTemplate","sendMandrillTemplate"],"specifiers":[{"kind":"local","local":"setupMandrill","exported":"setupMandrill"},{"kind":"local","local":"getSimpleMandrillTemplate","exported":"getSimpleMandrillTemplate"},{"kind":"local","local":"getMandrillTemplate","exported":"getMandrillTemplate"},{"kind":"local","local":"renderMandrillTemplate","exported":"renderMandrillTemplate"},{"kind":"local","local":"sendMandrillTemplate","exported":"sendMandrillTemplate"}]}}},"options":{"filename":"imports/core/api/email/server/mandrill.js","filenameRelative":"imports/core/api/email/server/mandrill.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"useNativeAsyncAwait":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"imports/core/api/email/server/mandrill.js.map","sourceFileName":"imports/core/api/email/server/mandrill.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"mandrill"},"ignored":false,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nmodule.export({\n  setupMandrill: function setupMandrill() {\n    return _setupMandrill;\n  },\n  getSimpleMandrillTemplate: function getSimpleMandrillTemplate() {\n    return _getSimpleMandrillTemplate;\n  },\n  getMandrillTemplate: function getMandrillTemplate() {\n    return _getMandrillTemplate;\n  },\n  renderMandrillTemplate: function renderMandrillTemplate() {\n    return _renderMandrillTemplate;\n  },\n  sendMandrillTemplate: function sendMandrillTemplate() {\n    return _sendMandrillTemplate;\n  }\n});\n\nvar _Mandrill = void 0;\n\nmodule.watch(require(\"meteor/wylio:mandrill\"), {\n  Mandrill: function Mandrill(v) {\n    _Mandrill = v;\n  }\n}, 0);\n\nvar _Meteor = void 0;\n\nexports.setupMandrill = _setupMandrill;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function Meteor(v) {\n    _Meteor = v;\n  }\n}, 1);\n\nvar _getEmailFooter = void 0;\n\nmodule.watch(require(\"./emailHelpers\"), {\n  getEmailFooter: function getEmailFooter(v) {\n    _getEmailFooter = v;\n  }\n}, 2);\n\nvar _setupMandrill = function _setupMandrill() {\n  var key = '';\n\n  if (_Meteor.isTest) {\n    key = _Meteor.settings.MANDRILL_API_KEY_TEST;\n  } else {\n    key = _Meteor.settings.MANDRILL_API_KEY;\n  }\n\n  _Mandrill.config({\n    username: _Meteor.settings.MANDRILL_LOGIN,\n    // the email address you log into Mandrill with. Only used to set MAIL_URL.\n    key: key,\n    // get your Mandrill key from https://mandrillapp.com/settings/index\n    port: 587,\n    // defaults to 465 for SMTP over TLS\n    host: 'smtps.mandrillapp.com' // the SMTP host\n    // baseUrl: 'https://mandrillapp.com/api/1.0/'  // update this in case Mandrill changes its API endpoint URL or version\n\n  });\n}; // Used for Meteor Accounts emails\n\n\nvar _getSimpleMandrillTemplate = function _getSimpleMandrillTemplate(options) {\n  var templateName = options.templateName,\n      allowUnsubscribe = options.allowUnsubscribe,\n      variables = options.variables;\n  return {\n    template_name: templateName,\n    template_content: [{\n      name: 'footer',\n      content: _getEmailFooter(allowUnsubscribe)\n    }],\n    merge_vars: variables\n  };\n};\n\nvar _getMandrillTemplate = function _getMandrillTemplate(_ref) {\n  var templateName = _ref.templateName,\n      allowUnsubscribe = _ref.allowUnsubscribe,\n      variables = _ref.variables,\n      recipientAddress = _ref.recipientAddress,\n      senderAddress = _ref.senderAddress,\n      senderName = _ref.senderName,\n      subject = _ref.subject,\n      sendAt = _ref.sendAt;\n  return {\n    template_name: templateName,\n    template_content: [{\n      name: 'footer',\n      content: _getEmailFooter(allowUnsubscribe)\n    }],\n    message: {\n      from_email: senderAddress,\n      from_name: senderName,\n      subject: subject,\n      to: [{\n        email: recipientAddress,\n        type: 'to'\n      }],\n      merge_vars: [{\n        rcpt: recipientAddress,\n        vars: variables\n      }]\n    },\n    send_at: sendAt ? sendAt.toISOString() : undefined\n  };\n};\n\nvar _renderMandrillTemplate = function _renderMandrillTemplate(mandrillTemplate) {\n  return _Mandrill.templates.render(mandrillTemplate);\n};\n\nvar _sendMandrillTemplate = function _sendMandrillTemplate(mandrillTemplate) {\n  return new Promise(function (resolve, reject) {\n    _Mandrill.messages.sendTemplate(mandrillTemplate, function (error, result) {\n      if (error) {\n        reject(error);\n      }\n\n      var content = JSON.parse(result.content)[0];\n      resolve(content);\n    });\n  });\n};","map":{"version":3,"sources":["imports/core/api/email/server/mandrill.js"],"names":["module","export","setupMandrill","getSimpleMandrillTemplate","getMandrillTemplate","renderMandrillTemplate","sendMandrillTemplate","Mandrill","watch","require","v","Meteor","getEmailFooter","key","isTest","settings","MANDRILL_API_KEY_TEST","MANDRILL_API_KEY","config","username","MANDRILL_LOGIN","port","host","options","templateName","allowUnsubscribe","variables","template_name","template_content","name","content","merge_vars","recipientAddress","senderAddress","senderName","subject","sendAt","message","from_email","from_name","to","email","type","rcpt","vars","send_at","toISOString","undefined","templates","render","mandrillTemplate","Promise","resolve","reject","messages","sendTemplate","error","result","JSON","parse"],"mappings":"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","file":"imports/core/api/email/server/mandrill.js.map","sourcesContent":["import { Mandrill } from 'meteor/wylio:mandrill';\nimport { Meteor } from 'meteor/meteor';\n\nimport { getEmailFooter } from './emailHelpers';\n\nexport const setupMandrill = () => {\n  let key = '';\n  if (Meteor.isTest) {\n    key = Meteor.settings.MANDRILL_API_KEY_TEST;\n  } else {\n    key = Meteor.settings.MANDRILL_API_KEY;\n  }\n\n  Mandrill.config({\n    username: Meteor.settings.MANDRILL_LOGIN, // the email address you log into Mandrill with. Only used to set MAIL_URL.\n    key, // get your Mandrill key from https://mandrillapp.com/settings/index\n    port: 587, // defaults to 465 for SMTP over TLS\n    host: 'smtps.mandrillapp.com', // the SMTP host\n    // baseUrl: 'https://mandrillapp.com/api/1.0/'  // update this in case Mandrill changes its API endpoint URL or version\n  });\n};\n\n// Used for Meteor Accounts emails\nexport const getSimpleMandrillTemplate = (options) => {\n  const { templateName, allowUnsubscribe, variables } = options;\n\n  return {\n    template_name: templateName,\n    template_content: [\n      { name: 'footer', content: getEmailFooter(allowUnsubscribe) },\n    ],\n    merge_vars: variables,\n  };\n};\n\n// Used for all other emails\nexport const getMandrillTemplate = ({\n  templateName,\n  allowUnsubscribe,\n  variables,\n  recipientAddress,\n  senderAddress,\n  senderName,\n  subject,\n  sendAt,\n}) => ({\n  template_name: templateName,\n  template_content: [\n    { name: 'footer', content: getEmailFooter(allowUnsubscribe) },\n  ],\n  message: {\n    from_email: senderAddress,\n    from_name: senderName,\n    subject,\n    to: [{ email: recipientAddress, type: 'to' }],\n    merge_vars: [{ rcpt: recipientAddress, vars: variables }],\n  },\n  send_at: sendAt ? sendAt.toISOString() : undefined,\n});\n\nexport const renderMandrillTemplate = mandrillTemplate =>\n  Mandrill.templates.render(mandrillTemplate);\n\nexport const sendMandrillTemplate = mandrillTemplate =>\n  new Promise((resolve, reject) => {\n    Mandrill.messages.sendTemplate(mandrillTemplate, (error, result) => {\n      if (error) {\n        reject(error);\n      }\n      const content = JSON.parse(result.content)[0];\n      resolve(content);\n    });\n  });\n"]},"hash":"7a43b29361256d5e882310c1d73f52f97ce5e7fd"}
