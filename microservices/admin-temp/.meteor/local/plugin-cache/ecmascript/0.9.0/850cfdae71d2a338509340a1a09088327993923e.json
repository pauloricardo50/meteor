{"metadata":{"usedHelpers":["extends","inherits","possibleConstructorReturn","createClass","classCallCheck","interopRequireDefault"],"marked":[],"modules":{"imports":[{"source":"react","imported":["default","Component"],"specifiers":[{"kind":"named","imported":"default","local":"React"},{"kind":"named","imported":"Component","local":"Component"}]},{"source":"prop-types","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"PropTypes"}]},{"source":"lodash/get","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"get"}]},{"source":"../../../core/components/Material/Toggle","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"Toggle"}]},{"source":"../../../core/components/Select","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"Select"}]},{"source":"../../../core/components/AutoForm","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"AutoForm"}]},{"source":"../../../core/arrays/PropertyFormArray","imported":["getPropertyArray","getPropertyLoanArray"],"specifiers":[{"kind":"named","imported":"getPropertyArray","local":"getPropertyArray"},{"kind":"named","imported":"getPropertyLoanArray","local":"getPropertyLoanArray"}]},{"source":"../../../core/arrays/BorrowerFormArray","imported":["getBorrowerInfoArray","getBorrowerFinanceArray"],"specifiers":[{"kind":"named","imported":"getBorrowerInfoArray","local":"getBorrowerInfoArray"},{"kind":"named","imported":"getBorrowerFinanceArray","local":"getBorrowerFinanceArray"}]},{"source":"../../../core/components/Translation","imported":["IntlNumber"],"specifiers":[{"kind":"named","imported":"IntlNumber","local":"IntlNumber"}]},{"source":"./FilesVerification","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"FilesVerification"}]},{"source":"./ClosingVerification","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"ClosingVerification"}]}],"exports":{"exported":["FormsTab"],"specifiers":[{"kind":"local","local":"FormsTab","exported":"default"}]}}},"options":{"filename":"imports/ui/pages/SingleLoanPage/FormsTab.jsx","filenameRelative":"imports/ui/pages/SingleLoanPage/FormsTab.jsx","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"useNativeAsyncAwait":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"imports/ui/pages/SingleLoanPage/FormsTab.jsx.map","sourceFileName":"imports/ui/pages/SingleLoanPage/FormsTab.jsx","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"FormsTab"},"ignored":false,"code":"\"use strict\";\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require(\"babel-runtime/helpers/createClass\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require(\"babel-runtime/helpers/possibleConstructorReturn\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require(\"babel-runtime/helpers/inherits\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _extends2 = require(\"babel-runtime/helpers/extends\");\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nmodule.export({\n  default: function _default() {\n    return FormsTab;\n  }\n});\n\nvar React = void 0,\n    _Component = void 0;\n\nmodule.watch(require(\"react\"), {\n  default: function _default(v) {\n    React = v;\n  },\n  Component: function Component(v) {\n    _Component = v;\n  }\n}, 0);\nvar PropTypes = void 0;\nmodule.watch(require(\"prop-types\"), {\n  default: function _default(v) {\n    PropTypes = v;\n  }\n}, 1);\nvar get = void 0;\nmodule.watch(require(\"lodash/get\"), {\n  default: function _default(v) {\n    get = v;\n  }\n}, 2);\nvar Toggle = void 0;\nmodule.watch(require(\"../../../core/components/Material/Toggle\"), {\n  default: function _default(v) {\n    Toggle = v;\n  }\n}, 3);\nvar Select = void 0;\nmodule.watch(require(\"../../../core/components/Select\"), {\n  default: function _default(v) {\n    Select = v;\n  }\n}, 4);\nvar AutoForm = void 0;\nmodule.watch(require(\"../../../core/components/AutoForm\"), {\n  default: function _default(v) {\n    AutoForm = v;\n  }\n}, 5);\n\nvar _getPropertyArray = void 0,\n    _getPropertyLoanArray = void 0;\n\nmodule.watch(require(\"../../../core/arrays/PropertyFormArray\"), {\n  getPropertyArray: function getPropertyArray(v) {\n    _getPropertyArray = v;\n  },\n  getPropertyLoanArray: function getPropertyLoanArray(v) {\n    _getPropertyLoanArray = v;\n  }\n}, 6);\n\nvar _getBorrowerInfoArray = void 0,\n    _getBorrowerFinanceArray = void 0;\n\nmodule.watch(require(\"../../../core/arrays/BorrowerFormArray\"), {\n  getBorrowerInfoArray: function getBorrowerInfoArray(v) {\n    _getBorrowerInfoArray = v;\n  },\n  getBorrowerFinanceArray: function getBorrowerFinanceArray(v) {\n    _getBorrowerFinanceArray = v;\n  }\n}, 7);\n\nvar _IntlNumber = void 0;\n\nmodule.watch(require(\"../../../core/components/Translation\"), {\n  IntlNumber: function IntlNumber(v) {\n    _IntlNumber = v;\n  }\n}, 8);\nvar FilesVerification = void 0;\nmodule.watch(require(\"./FilesVerification\"), {\n  default: function _default(v) {\n    FilesVerification = v;\n  }\n}, 9);\nvar ClosingVerification = void 0;\nmodule.watch(require(\"./ClosingVerification\"), {\n  default: function _default(v) {\n    ClosingVerification = v;\n  }\n}, 10);\n\nvar getBorrowerForms = function getBorrowerForms(borrowers) {\n  var array = [];\n  borrowers.forEach(function (b, i) {\n    array.push({\n      id: \"borrower.\" + b._id + \".personal\",\n      label: \"Emprunteur \" + (i + 1) + \" Perso\"\n    });\n    array.push({\n      id: \"borrower.\" + b._id + \".finance\",\n      label: \"Emprunteur \" + (i + 1) + \" Finances\"\n    });\n    array.push({\n      id: 'files',\n      label: 'Documents'\n    });\n  });\n  return array;\n};\n\nvar getLoanForms = function getLoanForms(loan) {\n  return [{\n    id: \"loan.\" + loan._id + \".property\",\n    label: 'Bien immobilier'\n  }, {\n    id: 'closing',\n    label: 'Décaissement'\n  }];\n};\n\nvar getForm = function getForm(props, value, modify) {\n  if (!value) {\n    return null;\n  }\n\n  var splittedValue = value.split('.');\n\n  switch (splittedValue[0]) {\n    case 'borrower':\n      {\n        switch (splittedValue[2]) {\n          case 'personal':\n            return React.createElement(AutoForm, {\n              key: value,\n              inputs: _getBorrowerInfoArray((0, _extends3.default)({}, props, {\n                borrowerId: splittedValue[1]\n              })),\n              formClasses: \"user-form\",\n              docId: splittedValue[1],\n              updateFunc: \"updateBorrower\",\n              pushFunc: \"pushBorrowerValue\",\n              popFunc: \"popBorrowerValue\",\n              doc: props.borrowers.find(function (b) {\n                return b._id === splittedValue[1];\n              }),\n              disabled: !modify,\n              noPlaceholders: true,\n              admin: true\n            });\n\n          case 'finance':\n            {\n              return React.createElement(AutoForm, {\n                key: value,\n                inputs: _getBorrowerFinanceArray((0, _extends3.default)({}, props, {\n                  borrowerId: splittedValue[1]\n                })),\n                borrowers: props.borrowers,\n                docId: splittedValue[1],\n                updateFunc: \"updateBorrower\",\n                pushFunc: \"pushBorrowerValue\",\n                popFunc: \"popBorrowerValue\",\n                doc: props.borrowers.find(function (b) {\n                  return b._id === splittedValue[1];\n                }),\n                disabled: !modify,\n                noPlaceholders: true,\n                admin: true\n              });\n            }\n\n          case 'files':\n            {\n              return null;\n            }\n\n          default:\n            throw new Error('invalid form id value');\n        }\n      }\n\n    case 'loan':\n      {\n        return React.createElement(\n          \"div\",\n          null,\n          React.createElement(AutoForm, {\n            key: value + \"1\",\n            inputs: _getPropertyLoanArray(props),\n            docId: props.loan._id,\n            updateFunc: \"updateLoan\",\n            pushFunc: \"pushLoanValue\",\n            popFunc: \"popLoanValue\",\n            doc: props.loan,\n            disabled: !modify,\n            noPlaceholders: true,\n            admin: true\n          }),\n          React.createElement(AutoForm, {\n            key: value + \"2\",\n            inputs: _getPropertyArray(props),\n            docId: props.property._id,\n            updateFunc: \"updateProperty\",\n            pushFunc: \"pushPropertyValue\",\n            popFunc: \"popPropertyValue\",\n            doc: props.property,\n            disabled: !modify,\n            noPlaceholders: true,\n            admin: true\n          })\n        );\n      }\n\n    case 'files':\n      return React.createElement(FilesVerification, {\n        loan: props.loan,\n        borrowers: props.borrowers,\n        property: props.property\n      });\n\n    case 'closing':\n      return React.createElement(ClosingVerification, {\n        loan: props.loan,\n        borrowers: props.borrowers,\n        property: props.property\n      });\n\n    default:\n      throw new Error('invalid form id value');\n  }\n}; // 1. Takes the form array and filters out the fields that aren't required\n// 2. if this is a conditional input, push the first value only\n// 3. Verifies if the id exists in the validationArray,\n// and adds 1 normalized by the length of the array to get a value between\n// 0 and 1\n\n\nvar reduceToPercent = function reduceToPercent(formArray, validationArray) {\n  return formArray.filter(function (i) {\n    return i.condition !== false && i.ignore !== true;\n  }).map(function (i) {\n    return i.type === 'conditionalInput' ? i.inputs[0] : i;\n  }).reduce(function (tot, i, index, array) {\n    return get(validationArray, i.id) ? tot + 1 / array.length : tot;\n  }, 0);\n};\n\nvar getPercent = function getPercent(props) {\n  var percentages = [reduceToPercent(_getPropertyLoanArray(props), props.loan.adminValidation)];\n  percentages.push(reduceToPercent(_getPropertyArray(props), props.property.adminValidation));\n  props.borrowers.forEach(function (b) {\n    percentages.push(reduceToPercent(_getBorrowerFinanceArray((0, _extends3.default)({}, props, {\n      borrowerId: b._id\n    })), b.adminValidation));\n    percentages.push(reduceToPercent(_getBorrowerInfoArray((0, _extends3.default)({}, props, {\n      borrowerId: b._id\n    })), b.adminValidation));\n  }); // const arr = getBorrowerFinanceArray(borrowers, borrowers[0]._id)\n  //   .filter(i => i.condition !== false && i.ignore !== true)\n  //   .map(i => (i.type === 'conditionalInput' ? i.inputs[0] : i));\n  // console.log(percentages);\n  // console.log(arr.map(i => i.id));\n  // console.log(arr.length);\n  // Return the average of all the percentages\n  // Use to Fixed to round out the percentage when it's 0.99999997\n\n  return percentages.length > 0 && percentages.map(function (p) {\n    return Number(p.toFixed(3));\n  }).reduce(function (p, c) {\n    return p + c;\n  }, 0) / percentages.length;\n};\n\nvar getSelectOptions = function getSelectOptions(borrowers, loan) {\n  var borrowerForms = getBorrowerForms(borrowers);\n  var loanForms = getLoanForms(loan);\n  return [].concat(_toConsumableArray(borrowerForms), _toConsumableArray(loanForms));\n};\n\nvar FormsTab = function (_Component2) {\n  (0, _inherits3.default)(FormsTab, _Component2);\n\n  function FormsTab(props) {\n    (0, _classCallCheck3.default)(this, FormsTab);\n\n    var _this = (0, _possibleConstructorReturn3.default)(this, (FormsTab.__proto__ || Object.getPrototypeOf(FormsTab)).call(this, props));\n\n    _this.handleChange = function (_, value) {\n      return _this.setState({\n        value: value\n      });\n    };\n\n    _this.handleToggle = function (event, isInputChecked) {\n      return _this.setState({\n        modify: isInputChecked\n      });\n    };\n\n    _this.state = {\n      modify: false,\n      value: \"loan.\" + props.loan._id + \".property\"\n    };\n    return _this;\n  }\n\n  (0, _createClass3.default)(FormsTab, [{\n    key: \"render\",\n    value: function render() {\n      var _props = this.props,\n          borrowers = _props.borrowers,\n          loan = _props.loan;\n      return React.createElement(\n        \"section\",\n        null,\n        React.createElement(Select, {\n          label: \"Formulaire\",\n          value: this.state.value,\n          onChange: this.handleChange,\n          options: getSelectOptions(borrowers, loan),\n          style: {\n            width: '100%',\n            maxWidth: 250\n          }\n        }),\n        React.createElement(Toggle, {\n          label: \"Peut modifier\",\n          toggled: this.state.modify,\n          onToggle: this.handleToggle,\n          style: {\n            width: 'unset'\n          }\n        }),\n        React.createElement(\n          \"div\",\n          null,\n          \"V\\xE9rification:\",\n          ' ',\n          React.createElement(_IntlNumber, {\n            value: getPercent(this.props),\n            format: \"percentage\"\n          })\n        ),\n        React.createElement(\"hr\", null),\n        getForm(this.props, this.state.value, this.state.modify)\n      );\n    }\n  }]);\n  return FormsTab;\n}(_Component);\n\nFormsTab.propTypes = {\n  loan: PropTypes.objectOf(PropTypes.any).isRequired,\n  borrowers: PropTypes.arrayOf(PropTypes.object).isRequired\n};","map":{"version":3,"sources":["imports/ui/pages/SingleLoanPage/FormsTab.jsx"],"names":["module","export","default","FormsTab","React","Component","watch","require","v","PropTypes","get","Toggle","Select","AutoForm","getPropertyArray","getPropertyLoanArray","getBorrowerInfoArray","getBorrowerFinanceArray","IntlNumber","FilesVerification","ClosingVerification","getBorrowerForms","borrowers","array","forEach","b","i","push","id","_id","label","getLoanForms","loan","getForm","props","value","modify","splittedValue","split","borrowerId","find","Error","property","reduceToPercent","formArray","validationArray","filter","condition","ignore","map","type","inputs","reduce","tot","index","length","getPercent","percentages","adminValidation","Number","p","toFixed","c","getSelectOptions","borrowerForms","loanForms","handleChange","_","setState","handleToggle","event","isInputChecked","state","width","maxWidth","propTypes","objectOf","any","isRequired","arrayOf","object"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAAA,OAAOC,MAAP,CAAc;AAACC,WAAQ;AAAA,WAAIC,QAAJ;AAAA;AAAT,CAAd;;AAAsC,IAAIC,cAAJ;AAAA,IAAUC,mBAAV;;AAAoBL,OAAOM,KAAP,CAAaC,QAAQ,OAAR,CAAb,EAA8B;AAACL,SAAD,oBAASM,CAAT,EAAW;AAACJ,YAAMI,CAAN;AAAQ,GAApB;AAAqBH,WAArB,qBAA+BG,CAA/B,EAAiC;AAACH,iBAAUG,CAAV;AAAY;AAA9C,CAA9B,EAA8E,CAA9E;AAAiF,IAAIC,kBAAJ;AAAcT,OAAOM,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACL,SAAD,oBAASM,CAAT,EAAW;AAACC,gBAAUD,CAAV;AAAY;AAAxB,CAAnC,EAA6D,CAA7D;AAAgE,IAAIE,YAAJ;AAAQV,OAAOM,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACL,SAAD,oBAASM,CAAT,EAAW;AAACE,UAAIF,CAAJ;AAAM;AAAlB,CAAnC,EAAuD,CAAvD;AAA0D,IAAIG,eAAJ;AAAWX,OAAOM,KAAP,CAAaC,QAAQ,0CAAR,CAAb,EAAiE;AAACL,SAAD,oBAASM,CAAT,EAAW;AAACG,aAAOH,CAAP;AAAS;AAArB,CAAjE,EAAwF,CAAxF;AAA2F,IAAII,eAAJ;AAAWZ,OAAOM,KAAP,CAAaC,QAAQ,iCAAR,CAAb,EAAwD;AAACL,SAAD,oBAASM,CAAT,EAAW;AAACI,aAAOJ,CAAP;AAAS;AAArB,CAAxD,EAA+E,CAA/E;AAAkF,IAAIK,iBAAJ;AAAab,OAAOM,KAAP,CAAaC,QAAQ,mCAAR,CAAb,EAA0D;AAACL,SAAD,oBAASM,CAAT,EAAW;AAACK,eAASL,CAAT;AAAW;AAAvB,CAA1D,EAAmF,CAAnF;;AAAsF,IAAIM,0BAAJ;AAAA,IAAqBC,8BAArB;;AAA0Cf,OAAOM,KAAP,CAAaC,QAAQ,wCAAR,CAAb,EAA+D;AAACO,kBAAD,4BAAkBN,CAAlB,EAAoB;AAACM,wBAAiBN,CAAjB;AAAmB,GAAxC;AAAyCO,sBAAzC,gCAA8DP,CAA9D,EAAgE;AAACO,4BAAqBP,CAArB;AAAuB;AAAxF,CAA/D,EAAyJ,CAAzJ;;AAA4J,IAAIQ,8BAAJ;AAAA,IAAyBC,iCAAzB;;AAAiDjB,OAAOM,KAAP,CAAaC,QAAQ,wCAAR,CAAb,EAA+D;AAACS,sBAAD,gCAAsBR,CAAtB,EAAwB;AAACQ,4BAAqBR,CAArB;AAAuB,GAAhD;AAAiDS,yBAAjD,mCAAyET,CAAzE,EAA2E;AAACS,+BAAwBT,CAAxB;AAA0B;AAAtG,CAA/D,EAAuK,CAAvK;;AAA0K,IAAIU,oBAAJ;;AAAelB,OAAOM,KAAP,CAAaC,QAAQ,sCAAR,CAAb,EAA6D;AAACW,YAAD,sBAAYV,CAAZ,EAAc;AAACU,kBAAWV,CAAX;AAAa;AAA5B,CAA7D,EAA2F,CAA3F;AAA8F,IAAIW,0BAAJ;AAAsBnB,OAAOM,KAAP,CAAaC,QAAQ,qBAAR,CAAb,EAA4C;AAACL,SAAD,oBAASM,CAAT,EAAW;AAACW,wBAAkBX,CAAlB;AAAoB;AAAhC,CAA5C,EAA8E,CAA9E;AAAiF,IAAIY,4BAAJ;AAAwBpB,OAAOM,KAAP,CAAaC,QAAQ,uBAAR,CAAb,EAA8C;AAACL,SAAD,oBAASM,CAAT,EAAW;AAACY,0BAAoBZ,CAApB;AAAsB;AAAlC,CAA9C,EAAkF,EAAlF;;AAwB9sC,IAAMa,mBAAmB,SAAnBA,gBAAmB,CAACC,SAAD,EAAe;AACtC,MAAMC,QAAQ,EAAd;AACAD,YAAUE,OAAV,CAAkB,UAACC,CAAD,EAAIC,CAAJ,EAAU;AAC1BH,UAAMI,IAAN,CAAW;AACTC,wBAAgBH,EAAEI,GAAlB,cADS;AAETC,8BAAqBJ,IAAI,CAAzB;AAFS,KAAX;AAIAH,UAAMI,IAAN,CAAW;AACTC,wBAAgBH,EAAEI,GAAlB,aADS;AAETC,8BAAqBJ,IAAI,CAAzB;AAFS,KAAX;AAIAH,UAAMI,IAAN,CAAW;AACTC,UAAI,OADK;AAETE,aAAO;AAFE,KAAX;AAID,GAbD;AAeA,SAAOP,KAAP;AACD,CAlBD;;AAoBA,IAAMQ,eAAe,SAAfA,YAAe;AAAA,SAAQ,CAC3B;AACEH,kBAAYI,KAAKH,GAAjB,cADF;AAEEC,WAAO;AAFT,GAD2B,EAK3B;AACEF,QAAI,SADN;AAEEE,WAAO;AAFT,GAL2B,CAAR;AAAA,CAArB;;AAWA,IAAMG,UAAU,SAAVA,OAAU,CAACC,KAAD,EAAQC,KAAR,EAAeC,MAAf,EAA0B;AACxC,MAAI,CAACD,KAAL,EAAY;AACV,WAAO,IAAP;AACD;;AAED,MAAME,gBAAgBF,MAAMG,KAAN,CAAY,GAAZ,CAAtB;;AACA,UAAQD,cAAc,CAAd,CAAR;AACA,SAAK,UAAL;AAAiB;AACf,gBAAQA,cAAc,CAAd,CAAR;AACA,eAAK,UAAL;AACE,mBACE,oBAAC,QAAD;AACE,mBAAKF,KADP;AAEE,sBAAQnB,iDACHkB,KADG;AAENK,4BAAYF,cAAc,CAAd;AAFN,iBAFV;AAME,2BAAY,WANd;AAOE,qBAAOA,cAAc,CAAd,CAPT;AAQE,0BAAW,gBARb;AASE,wBAAS,mBATX;AAUE,uBAAQ,kBAVV;AAWE,mBAAKH,MAAMZ,SAAN,CAAgBkB,IAAhB,CAAqB;AAAA,uBAAKf,EAAEI,GAAF,KAAUQ,cAAc,CAAd,CAAf;AAAA,eAArB,CAXP;AAYE,wBAAU,CAACD,MAZb;AAaE,kCAbF;AAcE;AAdF,cADF;;AAkBF,eAAK,SAAL;AAAgB;AACd,qBACE,oBAAC,QAAD;AACE,qBAAKD,KADP;AAEE,wBAAQlB,oDACHiB,KADG;AAENK,8BAAYF,cAAc,CAAd;AAFN,mBAFV;AAME,2BAAWH,MAAMZ,SANnB;AAOE,uBAAOe,cAAc,CAAd,CAPT;AAQE,4BAAW,gBARb;AASE,0BAAS,mBATX;AAUE,yBAAQ,kBAVV;AAWE,qBAAKH,MAAMZ,SAAN,CAAgBkB,IAAhB,CAAqB;AAAA,yBAAKf,EAAEI,GAAF,KAAUQ,cAAc,CAAd,CAAf;AAAA,iBAArB,CAXP;AAYE,0BAAU,CAACD,MAZb;AAaE,oCAbF;AAcE;AAdF,gBADF;AAkBD;;AACD,eAAK,OAAL;AAAc;AACZ,qBAAO,IAAP;AACD;;AACD;AACE,kBAAM,IAAIK,KAAJ,CAAU,uBAAV,CAAN;AA5CF;AA8CD;;AACD,SAAK,MAAL;AAAa;AACX,eACE;AAAA;AAAA;AACE,8BAAC,QAAD;AACE,iBAAQN,KAAR,MADF;AAEE,oBAAQpB,sBAAqBmB,KAArB,CAFV;AAGE,mBAAOA,MAAMF,IAAN,CAAWH,GAHpB;AAIE,wBAAW,YAJb;AAKE,sBAAS,eALX;AAME,qBAAQ,cANV;AAOE,iBAAKK,MAAMF,IAPb;AAQE,sBAAU,CAACI,MARb;AASE,gCATF;AAUE;AAVF,YADF;AAaE,8BAAC,QAAD;AACE,iBAAQD,KAAR,MADF;AAEE,oBAAQrB,kBAAiBoB,KAAjB,CAFV;AAGE,mBAAOA,MAAMQ,QAAN,CAAeb,GAHxB;AAIE,wBAAW,gBAJb;AAKE,sBAAS,mBALX;AAME,qBAAQ,kBANV;AAOE,iBAAKK,MAAMQ,QAPb;AAQE,sBAAU,CAACN,MARb;AASE,gCATF;AAUE;AAVF;AAbF,SADF;AA4BD;;AACD,SAAK,OAAL;AACE,aACE,oBAAC,iBAAD;AACE,cAAMF,MAAMF,IADd;AAEE,mBAAWE,MAAMZ,SAFnB;AAGE,kBAAUY,MAAMQ;AAHlB,QADF;;AAOF,SAAK,SAAL;AACE,aACE,oBAAC,mBAAD;AACE,cAAMR,MAAMF,IADd;AAEE,mBAAWE,MAAMZ,SAFnB;AAGE,kBAAUY,MAAMQ;AAHlB,QADF;;AAOF;AACE,YAAM,IAAID,KAAJ,CAAU,uBAAV,CAAN;AAhGF;AAkGD,CAxGD,C,CA0GA;AACA;AACA;AACA;AACA;;;AACA,IAAME,kBAAkB,SAAlBA,eAAkB,CAACC,SAAD,EAAYC,eAAZ;AAAA,SACtBD,UACGE,MADH,CACU;AAAA,WAAKpB,EAAEqB,SAAF,KAAgB,KAAhB,IAAyBrB,EAAEsB,MAAF,KAAa,IAA3C;AAAA,GADV,EAEGC,GAFH,CAEO;AAAA,WAAMvB,EAAEwB,IAAF,KAAW,kBAAX,GAAgCxB,EAAEyB,MAAF,CAAS,CAAT,CAAhC,GAA8CzB,CAApD;AAAA,GAFP,EAGG0B,MAHH,CAII,UAACC,GAAD,EAAM3B,CAAN,EAAS4B,KAAT,EAAgB/B,KAAhB;AAAA,WACGb,IAAImC,eAAJ,EAAqBnB,EAAEE,EAAvB,IAA6ByB,MAAM,IAAI9B,MAAMgC,MAA7C,GAAsDF,GADzD;AAAA,GAJJ,EAMI,CANJ,CADsB;AAAA,CAAxB;;AAUA,IAAMG,aAAa,SAAbA,UAAa,CAACtB,KAAD,EAAW;AAC5B,MAAMuB,cAAc,CAClBd,gBAAgB5B,sBAAqBmB,KAArB,CAAhB,EAA6CA,MAAMF,IAAN,CAAW0B,eAAxD,CADkB,CAApB;AAIAD,cAAY9B,IAAZ,CAAiBgB,gBAAgB7B,kBAAiBoB,KAAjB,CAAhB,EAAyCA,MAAMQ,QAAN,CAAegB,eAAxD,CAAjB;AAEAxB,QAAMZ,SAAN,CAAgBE,OAAhB,CAAwB,UAACC,CAAD,EAAO;AAC7BgC,gBAAY9B,IAAZ,CAAiBgB,gBACf1B,oDAA6BiB,KAA7B;AAAoCK,kBAAYd,EAAEI;AAAlD,OADe,EAEfJ,EAAEiC,eAFa,CAAjB;AAIAD,gBAAY9B,IAAZ,CAAiBgB,gBACf3B,iDAA0BkB,KAA1B;AAAiCK,kBAAYd,EAAEI;AAA/C,OADe,EAEfJ,EAAEiC,eAFa,CAAjB;AAID,GATD,EAP4B,CAkB5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,SACED,YAAYF,MAAZ,GAAqB,CAArB,IACAE,YAAYR,GAAZ,CAAgB;AAAA,WAAKU,OAAOC,EAAEC,OAAF,CAAU,CAAV,CAAP,CAAL;AAAA,GAAhB,EAA2CT,MAA3C,CAAkD,UAACQ,CAAD,EAAIE,CAAJ;AAAA,WAAUF,IAAIE,CAAd;AAAA,GAAlD,EAAmE,CAAnE,IACEL,YAAYF,MAHhB;AAKD,CA/BD;;AAiCA,IAAMQ,mBAAmB,SAAnBA,gBAAmB,CAACzC,SAAD,EAAYU,IAAZ,EAAqB;AAC5C,MAAMgC,gBAAgB3C,iBAAiBC,SAAjB,CAAtB;AACA,MAAM2C,YAAYlC,aAAaC,IAAb,CAAlB;AAEA,sCAAWgC,aAAX,sBAA6BC,SAA7B;AACD,CALD;;IAOqB9D,Q;;;AACnB,oBAAY+B,KAAZ,EAAmB;AAAA;;AAAA,kIACXA,KADW;;AAAA,UASnBgC,YATmB,GASJ,UAACC,CAAD,EAAIhC,KAAJ;AAAA,aAAc,MAAKiC,QAAL,CAAc;AAAEjC;AAAF,OAAd,CAAd;AAAA,KATI;;AAAA,UAUnBkC,YAVmB,GAUJ,UAACC,KAAD,EAAQC,cAAR;AAAA,aACb,MAAKH,QAAL,CAAc;AAAEhC,gBAAQmC;AAAV,OAAd,CADa;AAAA,KAVI;;AAGjB,UAAKC,KAAL,GAAa;AACXpC,cAAQ,KADG;AAEXD,uBAAeD,MAAMF,IAAN,CAAWH,GAA1B;AAFW,KAAb;AAHiB;AAOlB;;;;6BAMQ;AAAA,mBACqB,KAAKK,KAD1B;AAAA,UACCZ,SADD,UACCA,SADD;AAAA,UACYU,IADZ,UACYA,IADZ;AAEP,aACE;AAAA;AAAA;AACE,4BAAC,MAAD;AACE,iBAAM,YADR;AAEE,iBAAO,KAAKwC,KAAL,CAAWrC,KAFpB;AAGE,oBAAU,KAAK+B,YAHjB;AAIE,mBAASH,iBAAiBzC,SAAjB,EAA4BU,IAA5B,CAJX;AAKE,iBAAO;AAAEyC,mBAAO,MAAT;AAAiBC,sBAAU;AAA3B;AALT,UADF;AAQE,4BAAC,MAAD;AACE,iBAAM,eADR;AAEE,mBAAS,KAAKF,KAAL,CAAWpC,MAFtB;AAGE,oBAAU,KAAKiC,YAHjB;AAIE,iBAAO;AAAEI,mBAAO;AAAT;AAJT,UARF;AAeE;AAAA;AAAA;AAAA;AACgB,aADhB;AAEE,8BAAC,WAAD;AAAY,mBAAOjB,WAAW,KAAKtB,KAAhB,CAAnB;AAA2C,oBAAO;AAAlD;AAFF,SAfF;AAoBE,uCApBF;AAsBGD,gBAAQ,KAAKC,KAAb,EAAoB,KAAKsC,KAAL,CAAWrC,KAA/B,EAAsC,KAAKqC,KAAL,CAAWpC,MAAjD;AAtBH,OADF;AA0BD;;;EA1CmC/B,U;;AA6CtCF,SAASwE,SAAT,GAAqB;AACnB3C,QAAMvB,UAAUmE,QAAV,CAAmBnE,UAAUoE,GAA7B,EAAkCC,UADrB;AAEnBxD,aAAWb,UAAUsE,OAAV,CAAkBtE,UAAUuE,MAA5B,EAAoCF;AAF5B,CAArB","file":"imports/ui/pages/SingleLoanPage/FormsTab.jsx.map","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport get from 'lodash/get';\n\n// import SelectField from 'core/components/Material/SelectField';\n// import MenuItem from 'core/components/Material/MenuItem';\nimport Toggle from 'core/components/Material/Toggle';\nimport Select from 'core/components/Select';\n\nimport AutoForm from 'core/components/AutoForm';\n\nimport {\n  getPropertyArray,\n  getPropertyLoanArray,\n} from 'core/arrays/PropertyFormArray';\nimport {\n  getBorrowerInfoArray,\n  getBorrowerFinanceArray,\n} from 'core/arrays/BorrowerFormArray';\nimport { IntlNumber } from 'core/components/Translation';\n\nimport FilesVerification from './FilesVerification';\nimport ClosingVerification from './ClosingVerification';\n\nconst getBorrowerForms = (borrowers) => {\n  const array = [];\n  borrowers.forEach((b, i) => {\n    array.push({\n      id: `borrower.${b._id}.personal`,\n      label: `Emprunteur ${i + 1} Perso`,\n    });\n    array.push({\n      id: `borrower.${b._id}.finance`,\n      label: `Emprunteur ${i + 1} Finances`,\n    });\n    array.push({\n      id: 'files',\n      label: 'Documents',\n    });\n  });\n\n  return array;\n};\n\nconst getLoanForms = loan => [\n  {\n    id: `loan.${loan._id}.property`,\n    label: 'Bien immobilier',\n  },\n  {\n    id: 'closing',\n    label: 'Décaissement',\n  },\n];\n\nconst getForm = (props, value, modify) => {\n  if (!value) {\n    return null;\n  }\n\n  const splittedValue = value.split('.');\n  switch (splittedValue[0]) {\n  case 'borrower': {\n    switch (splittedValue[2]) {\n    case 'personal':\n      return (\n        <AutoForm\n          key={value}\n          inputs={getBorrowerInfoArray({\n            ...props,\n            borrowerId: splittedValue[1],\n          })}\n          formClasses=\"user-form\"\n          docId={splittedValue[1]}\n          updateFunc=\"updateBorrower\"\n          pushFunc=\"pushBorrowerValue\"\n          popFunc=\"popBorrowerValue\"\n          doc={props.borrowers.find(b => b._id === splittedValue[1])}\n          disabled={!modify}\n          noPlaceholders\n          admin\n        />\n      );\n    case 'finance': {\n      return (\n        <AutoForm\n          key={value}\n          inputs={getBorrowerFinanceArray({\n            ...props,\n            borrowerId: splittedValue[1],\n          })}\n          borrowers={props.borrowers}\n          docId={splittedValue[1]}\n          updateFunc=\"updateBorrower\"\n          pushFunc=\"pushBorrowerValue\"\n          popFunc=\"popBorrowerValue\"\n          doc={props.borrowers.find(b => b._id === splittedValue[1])}\n          disabled={!modify}\n          noPlaceholders\n          admin\n        />\n      );\n    }\n    case 'files': {\n      return null;\n    }\n    default:\n      throw new Error('invalid form id value');\n    }\n  }\n  case 'loan': {\n    return (\n      <div>\n        <AutoForm\n          key={`${value}1`}\n          inputs={getPropertyLoanArray(props)}\n          docId={props.loan._id}\n          updateFunc=\"updateLoan\"\n          pushFunc=\"pushLoanValue\"\n          popFunc=\"popLoanValue\"\n          doc={props.loan}\n          disabled={!modify}\n          noPlaceholders\n          admin\n        />\n        <AutoForm\n          key={`${value}2`}\n          inputs={getPropertyArray(props)}\n          docId={props.property._id}\n          updateFunc=\"updateProperty\"\n          pushFunc=\"pushPropertyValue\"\n          popFunc=\"popPropertyValue\"\n          doc={props.property}\n          disabled={!modify}\n          noPlaceholders\n          admin\n        />\n      </div>\n    );\n  }\n  case 'files':\n    return (\n      <FilesVerification\n        loan={props.loan}\n        borrowers={props.borrowers}\n        property={props.property}\n      />\n    );\n  case 'closing':\n    return (\n      <ClosingVerification\n        loan={props.loan}\n        borrowers={props.borrowers}\n        property={props.property}\n      />\n    );\n  default:\n    throw new Error('invalid form id value');\n  }\n};\n\n// 1. Takes the form array and filters out the fields that aren't required\n// 2. if this is a conditional input, push the first value only\n// 3. Verifies if the id exists in the validationArray,\n// and adds 1 normalized by the length of the array to get a value between\n// 0 and 1\nconst reduceToPercent = (formArray, validationArray) =>\n  formArray\n    .filter(i => i.condition !== false && i.ignore !== true)\n    .map(i => (i.type === 'conditionalInput' ? i.inputs[0] : i))\n    .reduce(\n      (tot, i, index, array) =>\n        (get(validationArray, i.id) ? tot + 1 / array.length : tot),\n      0,\n    );\n\nconst getPercent = (props) => {\n  const percentages = [\n    reduceToPercent(getPropertyLoanArray(props), props.loan.adminValidation),\n  ];\n\n  percentages.push(reduceToPercent(getPropertyArray(props), props.property.adminValidation));\n\n  props.borrowers.forEach((b) => {\n    percentages.push(reduceToPercent(\n      getBorrowerFinanceArray({ ...props, borrowerId: b._id }),\n      b.adminValidation,\n    ));\n    percentages.push(reduceToPercent(\n      getBorrowerInfoArray({ ...props, borrowerId: b._id }),\n      b.adminValidation,\n    ));\n  });\n\n  // const arr = getBorrowerFinanceArray(borrowers, borrowers[0]._id)\n  //   .filter(i => i.condition !== false && i.ignore !== true)\n  //   .map(i => (i.type === 'conditionalInput' ? i.inputs[0] : i));\n  // console.log(percentages);\n  // console.log(arr.map(i => i.id));\n  // console.log(arr.length);\n  // Return the average of all the percentages\n  // Use to Fixed to round out the percentage when it's 0.99999997\n  return (\n    percentages.length > 0 &&\n    percentages.map(p => Number(p.toFixed(3))).reduce((p, c) => p + c, 0) /\n      percentages.length\n  );\n};\n\nconst getSelectOptions = (borrowers, loan) => {\n  const borrowerForms = getBorrowerForms(borrowers);\n  const loanForms = getLoanForms(loan);\n\n  return [...borrowerForms, ...loanForms];\n};\n\nexport default class FormsTab extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      modify: false,\n      value: `loan.${props.loan._id}.property`,\n    };\n  }\n\n  handleChange = (_, value) => this.setState({ value });\n  handleToggle = (event, isInputChecked) =>\n    this.setState({ modify: isInputChecked });\n\n  render() {\n    const { borrowers, loan } = this.props;\n    return (\n      <section>\n        <Select\n          label=\"Formulaire\"\n          value={this.state.value}\n          onChange={this.handleChange}\n          options={getSelectOptions(borrowers, loan)}\n          style={{ width: '100%', maxWidth: 250 }}\n        />\n        <Toggle\n          label=\"Peut modifier\"\n          toggled={this.state.modify}\n          onToggle={this.handleToggle}\n          style={{ width: 'unset' }}\n        />\n\n        <div>\n          Vérification:{' '}\n          <IntlNumber value={getPercent(this.props)} format=\"percentage\" />\n        </div>\n\n        <hr />\n\n        {getForm(this.props, this.state.value, this.state.modify)}\n      </section>\n    );\n  }\n}\n\nFormsTab.propTypes = {\n  loan: PropTypes.objectOf(PropTypes.any).isRequired,\n  borrowers: PropTypes.arrayOf(PropTypes.object).isRequired,\n};\n"]},"hash":"850cfdae71d2a338509340a1a09088327993923e"}
