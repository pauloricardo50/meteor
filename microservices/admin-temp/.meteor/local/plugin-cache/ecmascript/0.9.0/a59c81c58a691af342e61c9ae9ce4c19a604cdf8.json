{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"file-saver","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"fileSaver"}]},{"source":"meteor/meteor","imported":["Meteor"],"specifiers":[{"kind":"named","imported":"Meteor","local":"Meteor"}]},{"source":"meteor/themeteorchef:bert","imported":["Bert"],"specifiers":[{"kind":"named","imported":"Bert","local":"Bert"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"imports/core/utils/download-pdf.js","filenameRelative":"imports/core/utils/download-pdf.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"useNativeAsyncAwait":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"imports/core/utils/download-pdf.js.map","sourceFileName":"imports/core/utils/download-pdf.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"download-pdf"},"ignored":false,"code":"\"use strict\";\n\nvar fileSaver = void 0;\nmodule.watch(require(\"file-saver\"), {\n  default: function _default(v) {\n    fileSaver = v;\n  }\n}, 0);\n\nvar _Meteor = void 0;\n\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function Meteor(v) {\n    _Meteor = v;\n  }\n}, 1);\n\nvar _Bert = void 0;\n\nmodule.watch(require(\"meteor/themeteorchef:bert\"), {\n  Bert: function Bert(v) {\n    _Bert = v;\n  }\n}, 2);\n\nvar decodeBase64 = function decodeBase64(string) {\n  return atob(string);\n};\n\nvar getLength = function getLength(value) {\n  return value.length;\n};\n\nvar buildByteArray = function buildByteArray(string, stringLength) {\n  var buffer = new ArrayBuffer(stringLength);\n  var array = new Uint8Array(buffer);\n\n  for (var i = 0; i < stringLength; i++) {\n    array[i] = string.charCodeAt(i);\n  }\n\n  return array;\n};\n\nvar createBlob = function createBlob(byteArray) {\n  return new Blob([byteArray], {\n    type: 'application/pdf'\n  });\n};\n\nvar base64ToBlob = function base64ToBlob(base64String) {\n  var decodedString = decodeBase64(base64String);\n  var decodedStringLength = getLength(decodedString);\n  var byteArray = buildByteArray(decodedString, decodedStringLength);\n  return byteArray ? createBlob(byteArray) : null;\n};\n\nvar downloadPDF = function downloadPDF(event, loanId, type) {\n  event.preventDefault();\n  var target = event.target;\n  var initialLabel = target.innerHTML;\n  target.innerHTML = '<em>Downloading...</em>';\n  target.classList.add('downloading');\n\n  _Meteor.call('pdf.download', {\n    loanId: loanId,\n    type: type\n  }, function (error, response) {\n    if (error) {\n      _Bert.alert(error.reason, 'danger');\n    } else {\n      var blob = base64ToBlob(response.base64);\n      fileSaver.saveAs(blob, response.fileName);\n      target.innerHTML = initialLabel;\n      target.classList.remove('downloading');\n    }\n  });\n};\n\nmodule.exportDefault(downloadPDF);","map":{"version":3,"sources":["imports/core/utils/download-pdf.js"],"names":["fileSaver","module","watch","require","default","v","Meteor","Bert","decodeBase64","atob","string","getLength","value","length","buildByteArray","stringLength","buffer","ArrayBuffer","array","Uint8Array","i","charCodeAt","createBlob","Blob","byteArray","type","base64ToBlob","base64String","decodedString","decodedStringLength","downloadPDF","event","loanId","preventDefault","target","initialLabel","innerHTML","classList","add","call","error","response","alert","reason","blob","base64","saveAs","fileName","remove","exportDefault"],"mappings":";;AAAA,IAAIA,kBAAJ;AAAcC,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,SAAD,oBAASC,CAAT,EAAW;AAACL,gBAAUK,CAAV;AAAY;AAAxB,CAAnC,EAA6D,CAA7D;;AAAgE,IAAIC,gBAAJ;;AAAWL,OAAOC,KAAP,CAAaC,QAAQ,eAAR,CAAb,EAAsC;AAACG,QAAD,kBAAQD,CAAR,EAAU;AAACC,cAAOD,CAAP;AAAS;AAApB,CAAtC,EAA4D,CAA5D;;AAA+D,IAAIE,cAAJ;;AAASN,OAAOC,KAAP,CAAaC,QAAQ,2BAAR,CAAb,EAAkD;AAACI,MAAD,gBAAMF,CAAN,EAAQ;AAACE,YAAKF,CAAL;AAAO;AAAhB,CAAlD,EAAoE,CAApE;;AAIjK,IAAMG,eAAe,SAAfA,YAAe;AAAA,SAAUC,KAAKC,MAAL,CAAV;AAAA,CAArB;;AAEA,IAAMC,YAAY,SAAZA,SAAY;AAAA,SAASC,MAAMC,MAAf;AAAA,CAAlB;;AAEA,IAAMC,iBAAiB,SAAjBA,cAAiB,CAACJ,MAAD,EAASK,YAAT,EAA0B;AAC/C,MAAMC,SAAS,IAAIC,WAAJ,CAAgBF,YAAhB,CAAf;AACA,MAAMG,QAAQ,IAAIC,UAAJ,CAAeH,MAAf,CAAd;;AACA,OAAK,IAAII,IAAI,CAAb,EAAgBA,IAAIL,YAApB,EAAkCK,GAAlC,EAAuC;AACrCF,UAAME,CAAN,IAAWV,OAAOW,UAAP,CAAkBD,CAAlB,CAAX;AACD;;AACD,SAAOF,KAAP;AACD,CAPD;;AASA,IAAMI,aAAa,SAAbA,UAAa;AAAA,SACjB,IAAIC,IAAJ,CAAS,CAACC,SAAD,CAAT,EAAsB;AAAEC,UAAM;AAAR,GAAtB,CADiB;AAAA,CAAnB;;AAGA,IAAMC,eAAe,SAAfA,YAAe,CAACC,YAAD,EAAkB;AACrC,MAAMC,gBAAgBpB,aAAamB,YAAb,CAAtB;AACA,MAAME,sBAAsBlB,UAAUiB,aAAV,CAA5B;AACA,MAAMJ,YAAYV,eAAec,aAAf,EAA8BC,mBAA9B,CAAlB;AACA,SAAOL,YAAYF,WAAWE,SAAX,CAAZ,GAAoC,IAA3C;AACD,CALD;;AAOA,IAAMM,cAAc,SAAdA,WAAc,CAACC,KAAD,EAAQC,MAAR,EAAgBP,IAAhB,EAAyB;AAC3CM,QAAME,cAAN;AAD2C,MAEnCC,MAFmC,GAExBH,KAFwB,CAEnCG,MAFmC;AAG3C,MAAMC,eAAeD,OAAOE,SAA5B;AACAF,SAAOE,SAAP,GAAmB,yBAAnB;AACAF,SAAOG,SAAP,CAAiBC,GAAjB,CAAqB,aAArB;;AACAhC,UAAOiC,IAAP,CAAY,cAAZ,EAA4B;AAAEP,kBAAF;AAAUP;AAAV,GAA5B,EAA8C,UAACe,KAAD,EAAQC,QAAR,EAAqB;AACjE,QAAID,KAAJ,EAAW;AACTjC,YAAKmC,KAAL,CAAWF,MAAMG,MAAjB,EAAyB,QAAzB;AACD,KAFD,MAEO;AACL,UAAMC,OAAOlB,aAAae,SAASI,MAAtB,CAAb;AACA7C,gBAAU8C,MAAV,CAAiBF,IAAjB,EAAuBH,SAASM,QAAhC;AACAb,aAAOE,SAAP,GAAmBD,YAAnB;AACAD,aAAOG,SAAP,CAAiBW,MAAjB,CAAwB,aAAxB;AACD;AACF,GATD;AAUD,CAhBD;;AA3BA/C,OAAOgD,aAAP,CA6CenB,WA7Cf","file":"imports/core/utils/download-pdf.js.map","sourcesContent":["import fileSaver from 'file-saver';\nimport { Meteor } from 'meteor/meteor';\nimport { Bert } from 'meteor/themeteorchef:bert';\n\nconst decodeBase64 = string => atob(string);\n\nconst getLength = value => value.length;\n\nconst buildByteArray = (string, stringLength) => {\n  const buffer = new ArrayBuffer(stringLength);\n  const array = new Uint8Array(buffer);\n  for (let i = 0; i < stringLength; i++) {\n    array[i] = string.charCodeAt(i);\n  }\n  return array;\n};\n\nconst createBlob = byteArray =>\n  new Blob([byteArray], { type: 'application/pdf' });\n\nconst base64ToBlob = (base64String) => {\n  const decodedString = decodeBase64(base64String);\n  const decodedStringLength = getLength(decodedString);\n  const byteArray = buildByteArray(decodedString, decodedStringLength);\n  return byteArray ? createBlob(byteArray) : null;\n};\n\nconst downloadPDF = (event, loanId, type) => {\n  event.preventDefault();\n  const { target } = event;\n  const initialLabel = target.innerHTML;\n  target.innerHTML = '<em>Downloading...</em>';\n  target.classList.add('downloading');\n  Meteor.call('pdf.download', { loanId, type }, (error, response) => {\n    if (error) {\n      Bert.alert(error.reason, 'danger');\n    } else {\n      const blob = base64ToBlob(response.base64);\n      fileSaver.saveAs(blob, response.fileName);\n      target.innerHTML = initialLabel;\n      target.classList.remove('downloading');\n    }\n  });\n};\n\nexport default downloadPDF;\n"]},"hash":"a59c81c58a691af342e61c9ae9ce4c19a604cdf8"}
