{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"meteor/meteor","imported":["Meteor"],"specifiers":[{"kind":"named","imported":"Meteor","local":"Meteor"}]},{"source":"meteor/accounts-base","imported":["Accounts"],"specifiers":[{"kind":"named","imported":"Accounts","local":"Accounts"}]},{"source":"..","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"UserService"}]},{"source":"../..","imported":["SecurityService","createMutator"],"specifiers":[{"kind":"named","imported":"SecurityService","local":"SecurityService"},{"kind":"named","imported":"createMutator","local":"createMutator"}]},{"source":"../mutationDefinitions","imported":["*"],"specifiers":[{"kind":"namespace","local":"defs"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"imports/core/api/users/server/mutations.js","filenameRelative":"imports/core/api/users/server/mutations.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"useNativeAsyncAwait":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"imports/core/api/users/server/mutations.js.map","sourceFileName":"imports/core/api/users/server/mutations.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"mutations"},"ignored":false,"code":"\"use strict\";\n\nvar _Meteor = void 0;\n\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function Meteor(v) {\n    _Meteor = v;\n  }\n}, 0);\n\nvar _Accounts = void 0;\n\nmodule.watch(require(\"meteor/accounts-base\"), {\n  Accounts: function Accounts(v) {\n    _Accounts = v;\n  }\n}, 1);\nvar UserService = void 0;\nmodule.watch(require(\"..\"), {\n  default: function _default(v) {\n    UserService = v;\n  }\n}, 2);\n\nvar _SecurityService = void 0,\n    _createMutator = void 0;\n\nmodule.watch(require(\"../..\"), {\n  SecurityService: function SecurityService(v) {\n    _SecurityService = v;\n  },\n  createMutator: function createMutator(v) {\n    _createMutator = v;\n  }\n}, 3);\nvar defs = void 0;\nmodule.watch(require(\"../mutationDefinitions\"), {\n  \"*\": function _(v) {\n    defs = v;\n  }\n}, 4);\n\n_createMutator(defs.DOES_USER_EXIST, function (_ref) {\n  var email = _ref.email;\n  return _Accounts.findUserByEmail(email) != null;\n});\n\n_createMutator(defs.SEND_VERIFICATION_LINK, function (_ref2) {\n  var userId = _ref2.userId;\n\n  if (userId) {\n    _SecurityService.checkCurrentUserIsAdmin();\n  } else {\n    _SecurityService.checkLoggedIn();\n  }\n\n  var id = userId || _Meteor.userId();\n\n  if (_Meteor.isDevelopment) {\n    console.log(\"Not sending verification link in development for userId: \" + id);\n    return false;\n  }\n\n  return _Accounts.sendVerificationEmail(id);\n});\n\n_createMutator(defs.ASSIGN_ADMIN_TO_USER, function (_ref3) {\n  var userId = _ref3.userId,\n      adminId = _ref3.adminId;\n\n  _SecurityService.users.isAllowedToUpdate(userId);\n\n  return UserService.update({\n    userId: userId,\n    user: {\n      assignedTo: adminId\n    }\n  });\n}); // SecurityService.tasks.isAllowedToUpdate(taskId);\n// return UserService.assignUser({ userId, assignedTo });\n// createMutator(\n//   defs.ASSIGN_USER,\n//   ({ userId, assignedTo }) =>\n//     // SecurityService.users.isAllowedToUpdate(userId);\n//     UserService.assignUser({ userId, assignedTo }),\n//   // const user = { assignedTo };\n//   // return UserService.update({ userId, user });\n// );\n// createMutator(defs.USER_UPDATE, ({ userId, user }) => {\n//   SecurityService.users.isAllowedToUpdate();\n//   return UserService.insert({ userId, user });\n// });","map":{"version":3,"sources":["imports/core/api/users/server/mutations.js"],"names":["Meteor","module","watch","require","v","Accounts","UserService","default","SecurityService","createMutator","defs","DOES_USER_EXIST","email","findUserByEmail","SEND_VERIFICATION_LINK","userId","checkCurrentUserIsAdmin","checkLoggedIn","id","isDevelopment","console","log","sendVerificationEmail","ASSIGN_ADMIN_TO_USER","adminId","users","isAllowedToUpdate","update","user","assignedTo"],"mappings":";;AAAA,IAAIA,gBAAJ;;AAAWC,OAAOC,KAAP,CAAaC,QAAQ,eAAR,CAAb,EAAsC;AAACH,QAAD,kBAAQI,CAAR,EAAU;AAACJ,cAAOI,CAAP;AAAS;AAApB,CAAtC,EAA4D,CAA5D;;AAA+D,IAAIC,kBAAJ;;AAAaJ,OAAOC,KAAP,CAAaC,QAAQ,sBAAR,CAAb,EAA6C;AAACE,UAAD,oBAAUD,CAAV,EAAY;AAACC,gBAASD,CAAT;AAAW;AAAxB,CAA7C,EAAuE,CAAvE;AAA0E,IAAIE,oBAAJ;AAAgBL,OAAOC,KAAP,CAAaC,QAAQ,IAAR,CAAb,EAA2B;AAACI,SAAD,oBAASH,CAAT,EAAW;AAACE,kBAAYF,CAAZ;AAAc;AAA1B,CAA3B,EAAuD,CAAvD;;AAA0D,IAAII,yBAAJ;AAAA,IAAoBC,uBAApB;;AAAkCR,OAAOC,KAAP,CAAaC,QAAQ,OAAR,CAAb,EAA8B;AAACK,iBAAD,2BAAiBJ,CAAjB,EAAmB;AAACI,uBAAgBJ,CAAhB;AAAkB,GAAtC;AAAuCK,eAAvC,yBAAqDL,CAArD,EAAuD;AAACK,qBAAcL,CAAd;AAAgB;AAAxE,CAA9B,EAAwG,CAAxG;AAA2G,IAAIM,aAAJ;AAAST,OAAOC,KAAP,CAAaC,QAAQ,wBAAR,CAAb,EAA+C;AAAC,KAAD,aAAKC,CAAL,EAAO;AAACM,WAAKN,CAAL;AAAO;AAAf,CAA/C,EAAgE,CAAhE;;AAOjYK,eACEC,KAAKC,eADP,EAEE;AAAA,MAAGC,KAAH,QAAGA,KAAH;AAAA,SAAeP,UAASQ,eAAT,CAAyBD,KAAzB,KAAmC,IAAlD;AAAA,CAFF;;AAKAH,eAAcC,KAAKI,sBAAnB,EAA2C,iBAAgB;AAAA,MAAbC,MAAa,SAAbA,MAAa;;AACzD,MAAIA,MAAJ,EAAY;AACVP,qBAAgBQ,uBAAhB;AACD,GAFD,MAEO;AACLR,qBAAgBS,aAAhB;AACD;;AACD,MAAMC,KAAKH,UAAUf,QAAOe,MAAP,EAArB;;AAEA,MAAIf,QAAOmB,aAAX,EAA0B;AACxBC,YAAQC,GAAR,+DAAwEH,EAAxE;AACA,WAAO,KAAP;AACD;;AAED,SAAOb,UAASiB,qBAAT,CAA+BJ,EAA/B,CAAP;AACD,CAdD;;AAgBAT,eAAcC,KAAKa,oBAAnB,EAAyC,iBAAyB;AAAA,MAAtBR,MAAsB,SAAtBA,MAAsB;AAAA,MAAdS,OAAc,SAAdA,OAAc;;AAChEhB,mBAAgBiB,KAAhB,CAAsBC,iBAAtB,CAAwCX,MAAxC;;AACA,SAAOT,YAAYqB,MAAZ,CAAmB;AAAEZ,kBAAF;AAAUa,UAAM;AAAEC,kBAAYL;AAAd;AAAhB,GAAnB,CAAP;AACD,CAHD,E,CAIA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA","file":"imports/core/api/users/server/mutations.js.map","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Accounts } from 'meteor/accounts-base';\n\nimport UserService from 'core/api/users';\nimport { SecurityService, createMutator } from '../..';\nimport * as defs from '../mutationDefinitions';\n\ncreateMutator(\n  defs.DOES_USER_EXIST,\n  ({ email }) => Accounts.findUserByEmail(email) != null,\n);\n\ncreateMutator(defs.SEND_VERIFICATION_LINK, ({ userId }) => {\n  if (userId) {\n    SecurityService.checkCurrentUserIsAdmin();\n  } else {\n    SecurityService.checkLoggedIn();\n  }\n  const id = userId || Meteor.userId();\n\n  if (Meteor.isDevelopment) {\n    console.log(`Not sending verification link in development for userId: ${id}`);\n    return false;\n  }\n\n  return Accounts.sendVerificationEmail(id);\n});\n\ncreateMutator(defs.ASSIGN_ADMIN_TO_USER, ({ userId, adminId }) => {\n  SecurityService.users.isAllowedToUpdate(userId);\n  return UserService.update({ userId, user: { assignedTo: adminId } });\n});\n// SecurityService.tasks.isAllowedToUpdate(taskId);\n// return UserService.assignUser({ userId, assignedTo });\n\n// createMutator(\n//   defs.ASSIGN_USER,\n//   ({ userId, assignedTo }) =>\n//     // SecurityService.users.isAllowedToUpdate(userId);\n//     UserService.assignUser({ userId, assignedTo }),\n//   // const user = { assignedTo };\n//   // return UserService.update({ userId, user });\n// );\n\n// createMutator(defs.USER_UPDATE, ({ userId, user }) => {\n//   SecurityService.users.isAllowedToUpdate();\n//   return UserService.insert({ userId, user });\n// });\n"]},"hash":"a681e81c525f20ce0b8ceedae831752998271106"}
