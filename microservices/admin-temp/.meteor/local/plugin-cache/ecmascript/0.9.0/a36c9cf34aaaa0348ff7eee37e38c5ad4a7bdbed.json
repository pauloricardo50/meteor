{"metadata":{"usedHelpers":["toConsumableArray","interopRequireDefault"],"marked":[],"modules":{"imports":[],"exports":{"exported":["cleanOptions","options","ensureFields","cleanFilters","filters","ensureFields","fieldExists","fields","key"],"specifiers":[{"kind":"local","local":"cleanOptions","exported":"cleanOptions"},{"kind":"local","local":"options","exported":"options"},{"kind":"local","local":"ensureFields","exported":"ensureFields"},{"kind":"local","local":"cleanFilters","exported":"cleanFilters"},{"kind":"local","local":"filters","exported":"filters"},{"kind":"local","local":"ensureFields","exported":"ensureFields"},{"kind":"local","local":"fieldExists","exported":"fieldExists"},{"kind":"local","local":"fields","exported":"fields"},{"kind":"local","local":"key","exported":"key"}]}}},"options":{"filename":"packages/cultofcoders:grapher/lib/exposure/lib/cleanSelectors.js","filenameRelative":"packages/cultofcoders:grapher/lib/exposure/lib/cleanSelectors.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"packages/cultofcoders:grapher/lib/exposure/lib/cleanSelectors.js.map","sourceFileName":"packages/cultofcoders:grapher/lib/exposure/lib/cleanSelectors.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"cleanSelectors"},"ignored":false,"code":"var _toConsumableArray2 = require(\"babel-runtime/helpers/toConsumableArray\");\n\nvar _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nmodule.export({\n    cleanOptions: function () {\n        return cleanOptions;\n    },\n    cleanFilters: function () {\n        return cleanFilters;\n    },\n    fieldExists: function () {\n        return fieldExists;\n    }\n});\n\nfunction cleanOptions(options, ensureFields) {\n    if (!options) {\n        return;\n    }\n\n    if (options.fields) {\n        var _ref;\n\n        options.fields = (_ref = _).pick.apply(_ref, [options.fields].concat((0, _toConsumableArray3.default)(ensureFields)));\n    }\n\n    if (options.sort) {\n        var _ref2;\n\n        options.sort = (_ref2 = _).pick.apply(_ref2, [options.sort].concat((0, _toConsumableArray3.default)(ensureFields)));\n    }\n}\n\nvar deepFilterFieldsArray = ['$and', '$or', '$nor'];\nvar deepFilterFieldsObject = ['$not'];\nvar special = [].concat(deepFilterFieldsArray, deepFilterFieldsObject);\n\nfunction cleanFilters(filters, ensureFields) {\n    if (!filters) {\n        return;\n    }\n\n    _.each(filters, function (value, key) {\n        if (!_.contains(special, key)) {\n            if (!fieldExists(ensureFields, key)) {\n                delete filters[key];\n            }\n        }\n    });\n\n    deepFilterFieldsArray.forEach(function (field) {\n        if (filters[field]) {\n            filters[field].forEach(function (element) {\n                return cleanFilters(element, ensureFields);\n            });\n        }\n    });\n    deepFilterFieldsObject.forEach(function (field) {\n        if (filters[field]) {\n            cleanFilters(filters[field], ensureFields);\n        }\n    });\n}\n\nfunction fieldExists(fields, key) {\n    for (var i = 0; i < fields.length; i++) {\n        if (fields[i] === key || key.indexOf(fields[i] + '.') === 0) {\n            return true;\n        }\n    }\n\n    return false;\n}","map":{"version":3,"sources":["packages/cultofcoders:grapher/lib/exposure/lib/cleanSelectors.js"],"names":["module","export","cleanOptions","cleanFilters","fieldExists","options","ensureFields","fields","pick","sort","deepFilterFieldsArray","deepFilterFieldsObject","special","filters","_","each","value","key","contains","forEach","field","element","i","length","indexOf"],"mappings":";;;;;;AAAAA,OAAOC,MAAP,CAAc;AAACC,kBAAa;AAAA,eAAIA,YAAJ;AAAA,KAAd;AAA+BC,kBAAa;AAAA,eAAIA,YAAJ;AAAA,KAA5C;AAA6DC,iBAAY;AAAA,eAAIA,WAAJ;AAAA;AAAzE,CAAd;;AAAO,SAASF,YAAT,CAAsBG,OAAtB,EAA+BC,YAA/B,EAA6C;AAChD,QAAI,CAACD,OAAL,EAAc;AACV;AACH;;AAED,QAAIA,QAAQE,MAAZ,EAAoB;AAAA;;AAChBF,gBAAQE,MAAR,GAAiB,WAAEC,IAAF,cAAOH,QAAQE,MAAf,0CAA0BD,YAA1B,GAAjB;AACH;;AAED,QAAID,QAAQI,IAAZ,EAAkB;AAAA;;AACdJ,gBAAQI,IAAR,GAAe,YAAED,IAAF,eAAOH,QAAQI,IAAf,0CAAwBH,YAAxB,GAAf;AACH;AACJ;;AAED,IAAMI,wBAAwB,CAAC,MAAD,EAAS,KAAT,EAAgB,MAAhB,CAA9B;AACA,IAAMC,yBAAyB,CAAC,MAAD,CAA/B;AACA,IAAMC,oBAAcF,qBAAd,EAAwCC,sBAAxC,CAAN;;AAEO,SAASR,YAAT,CAAsBU,OAAtB,EAA+BP,YAA/B,EAA6C;AAChD,QAAI,CAACO,OAAL,EAAc;AACV;AACH;;AAEDC,MAAEC,IAAF,CAAOF,OAAP,EAAgB,UAACG,KAAD,EAAQC,GAAR,EAAgB;AAC5B,YAAI,CAACH,EAAEI,QAAF,CAAWN,OAAX,EAAoBK,GAApB,CAAL,EAA+B;AAC3B,gBAAI,CAACb,YAAYE,YAAZ,EAA0BW,GAA1B,CAAL,EAAqC;AACjC,uBAAOJ,QAAQI,GAAR,CAAP;AACH;AACJ;AACJ,KAND;;AAQAP,0BAAsBS,OAAtB,CAA8B,iBAAS;AACnC,YAAIN,QAAQO,KAAR,CAAJ,EAAoB;AAChBP,oBAAQO,KAAR,EAAeD,OAAf,CAAuB;AAAA,uBAAWhB,aAAakB,OAAb,EAAsBf,YAAtB,CAAX;AAAA,aAAvB;AACH;AACJ,KAJD;AAMAK,2BAAuBQ,OAAvB,CAA+B,iBAAS;AACpC,YAAIN,QAAQO,KAAR,CAAJ,EAAoB;AAChBjB,yBAAaU,QAAQO,KAAR,CAAb,EAA6Bd,YAA7B;AACH;AACJ,KAJD;AAKH;;AAUM,SAASF,WAAT,CAAqBG,MAArB,EAA6BU,GAA7B,EAAkC;AACrC,SAAK,IAAIK,IAAI,CAAb,EAAgBA,IAAIf,OAAOgB,MAA3B,EAAmCD,GAAnC,EAAwC;AACpC,YAAIf,OAAOe,CAAP,MAAcL,GAAd,IAAqBA,IAAIO,OAAJ,CAAYjB,OAAOe,CAAP,IAAY,GAAxB,MAAiC,CAA1D,EAA6D;AACzD,mBAAO,IAAP;AACH;AACJ;;AAED,WAAO,KAAP;AACH","file":"packages/cultofcoders:grapher/lib/exposure/lib/cleanSelectors.js.map","sourcesContent":["export function cleanOptions(options, ensureFields) {\n    if (!options) {\n        return;\n    }\n\n    if (options.fields) {\n        options.fields = _.pick(options.fields, ...ensureFields);\n    }\n\n    if (options.sort) {\n        options.sort = _.pick(options.sort, ...ensureFields);\n    }\n}\n\nconst deepFilterFieldsArray = ['$and', '$or', '$nor'];\nconst deepFilterFieldsObject = ['$not'];\nconst special = [...deepFilterFieldsArray, ...deepFilterFieldsObject];\n\nexport function cleanFilters(filters, ensureFields) {\n    if (!filters) {\n        return;\n    }\n\n    _.each(filters, (value, key) => {\n        if (!_.contains(special, key)) {\n            if (!fieldExists(ensureFields, key)) {\n                delete filters[key];\n            }\n        }\n    });\n\n    deepFilterFieldsArray.forEach(field => {\n        if (filters[field]) {\n            filters[field].forEach(element => cleanFilters(element, ensureFields));\n        }\n    });\n\n    deepFilterFieldsObject.forEach(field => {\n        if (filters[field]) {\n            cleanFilters(filters[field], ensureFields);\n        }\n    });\n}\n\n/**\n * This will check if a field exists in a set of fields\n * If fields contains [\"profile\"], then \"profile.something\" will return true\n *\n * @param fields\n * @param key\n * @returns {boolean}\n */\nexport function fieldExists(fields, key) {\n    for (let i = 0; i < fields.length; i++) {\n        if (fields[i] === key || key.indexOf(fields[i] + '.') === 0) {\n            return true;\n        }\n    }\n\n    return false;\n}\n"]},"hash":"a36c9cf34aaaa0348ff7eee37e38c5ad4a7bdbed"}
