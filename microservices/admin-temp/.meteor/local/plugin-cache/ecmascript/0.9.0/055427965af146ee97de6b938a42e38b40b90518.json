{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"meteor/meteor","imported":["Meteor"],"specifiers":[{"kind":"named","imported":"Meteor","local":"Meteor"}]},{"source":"react","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"React"}]},{"source":"../../../core/components/DropdownMenu","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"DropdownMenu"}]},{"source":"../../../core/api","imported":["callMutation","mutations"],"specifiers":[{"kind":"named","imported":"callMutation","local":"callMutation"},{"kind":"named","imported":"mutations","local":"mutations"}]},{"source":"../../../core/api/tasks/tasksConstants","imported":["TASK_STATUS"],"specifiers":[{"kind":"named","imported":"TASK_STATUS","local":"TASK_STATUS"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"imports/ui/pages/TasksPage/TasksAssignedUserDropdown.jsx","filenameRelative":"imports/ui/pages/TasksPage/TasksAssignedUserDropdown.jsx","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"useNativeAsyncAwait":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"imports/ui/pages/TasksPage/TasksAssignedUserDropdown.jsx.map","sourceFileName":"imports/ui/pages/TasksPage/TasksAssignedUserDropdown.jsx","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"TasksAssignedUserDropdown"},"ignored":false,"code":"\"use strict\";\n\nvar _Meteor = void 0;\n\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function Meteor(v) {\n    _Meteor = v;\n  }\n}, 0);\nvar React = void 0;\nmodule.watch(require(\"react\"), {\n  default: function _default(v) {\n    React = v;\n  }\n}, 1);\nvar DropdownMenu = void 0;\nmodule.watch(require(\"../../../core/components/DropdownMenu\"), {\n  default: function _default(v) {\n    DropdownMenu = v;\n  }\n}, 2);\n\nvar _callMutation = void 0,\n    _mutations = void 0;\n\nmodule.watch(require(\"../../../core/api\"), {\n  callMutation: function callMutation(v) {\n    _callMutation = v;\n  },\n  mutations: function mutations(v) {\n    _mutations = v;\n  }\n}, 3);\n\nvar _TASK_STATUS = void 0;\n\nmodule.watch(require(\"../../../core/api/tasks/tasksConstants\"), {\n  TASK_STATUS: function TASK_STATUS(v) {\n    _TASK_STATUS = v;\n  }\n}, 4);\n\nvar changeAssignedUser = function changeAssignedUser(_ref) {\n  var user = _ref.user,\n      taskId = _ref.taskId,\n      taskAssignedTo = _ref.taskAssignedTo,\n      taskUserId = _ref.taskUserId,\n      initialAssignment = _ref.initialAssignment;\n\n  // if (initialAssignment && taskUserId) {\n  if (!taskAssignedTo) {\n    _callMutation(_mutations.ASSIGN_ADMIN_TO_USER, {\n      userId: taskUserId,\n      adminId: user._id\n    }).then(function (nbOfAffectedRows) {\n      if (nbOfAffectedRows > 0) {\n        _callMutation(_mutations.TASK_CHANGE_ASSIGNED_TO, {\n          taskId: taskId,\n          newAssignee: user._id\n        });\n      }\n    }).then(function (nbOfAffectedRows) {\n      if (nbOfAffectedRows > 0) {\n        _callMutation(_mutations.TASK_CHANGE_STATUS, {\n          taskId: taskId,\n          newStatus: _TASK_STATUS.COMPLETED\n        });\n      }\n    });\n  } else {\n    _callMutation(_mutations.TASK_CHANGE_ASSIGNED_TO, {\n      taskId: taskId,\n      newAssignee: user._id\n    });\n  }\n};\n\nvar getMenuItems = function getMenuItems(users, taskAssignedTo, taskId, taskUserId, initialAssignment) {\n  var options = users.map(function (user) {\n    return {\n      id: user._id,\n      show: user._id !== taskAssignedTo,\n      // role\n      label: user.emails[0].address,\n      link: false,\n      onClick: function onClick() {\n        changeAssignedUser({\n          user: user,\n          taskId: taskId,\n          taskAssignedTo: taskAssignedTo,\n          taskUserId: taskUserId,\n          initialAssignment: initialAssignment\n        });\n      }\n    };\n  });\n  return options;\n};\n\nvar TasksAssignedUserDropdown = function TasksAssignedUserDropdown(props) {\n  // const { data, isLoading, error, taskId, taskUser, styles } = props;\n  var data = props.data,\n      isLoading = props.isLoading,\n      error = props.error,\n      taskId = props.taskId,\n      taskAssignedTo = props.taskAssignedTo,\n      taskUserId = props.taskUserId,\n      initialAssignment = props.initialAssignment,\n      styles = props.styles;\n\n  if (isLoading) {\n    return null;\n  }\n\n  if (error) {\n    return React.createElement(\n      \"div\",\n      null,\n      \"Error: \",\n      error.reason\n    );\n  }\n\n  return React.createElement(DropdownMenu, {\n    iconType: \"personAdd\",\n    options: getMenuItems(data, taskAssignedTo, taskId, taskUserId, initialAssignment),\n    style: styles\n  });\n};\n\nmodule.exportDefault(TasksAssignedUserDropdown);","map":{"version":3,"sources":["imports/ui/pages/TasksPage/TasksAssignedUserDropdown.jsx"],"names":["Meteor","module","watch","require","v","React","default","DropdownMenu","callMutation","mutations","TASK_STATUS","changeAssignedUser","user","taskId","taskAssignedTo","taskUserId","initialAssignment","ASSIGN_ADMIN_TO_USER","userId","adminId","_id","then","nbOfAffectedRows","TASK_CHANGE_ASSIGNED_TO","newAssignee","TASK_CHANGE_STATUS","newStatus","COMPLETED","getMenuItems","users","options","map","id","show","label","emails","address","link","onClick","TasksAssignedUserDropdown","props","data","isLoading","error","styles","reason","exportDefault"],"mappings":"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","file":"imports/ui/pages/TasksPage/TasksAssignedUserDropdown.jsx.map","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport React from 'react';\nimport DropdownMenu from 'core/components/DropdownMenu/';\nimport { callMutation, mutations } from 'core/api';\nimport { TASK_STATUS } from 'core/api/tasks/tasksConstants';\n\nconst changeAssignedUser = ({\n  user,\n  taskId,\n  taskAssignedTo,\n  taskUserId,\n  initialAssignment,\n}) => {\n  // if (initialAssignment && taskUserId) {\n  if (!taskAssignedTo) {\n    callMutation(mutations.ASSIGN_ADMIN_TO_USER, {\n      userId: taskUserId,\n      adminId: user._id,\n    })\n      .then((nbOfAffectedRows) => {\n        if (nbOfAffectedRows > 0) {\n          callMutation(mutations.TASK_CHANGE_ASSIGNED_TO, {\n            taskId,\n            newAssignee: user._id,\n          });\n        }\n      })\n      .then((nbOfAffectedRows) => {\n        if (nbOfAffectedRows > 0) {\n          callMutation(mutations.TASK_CHANGE_STATUS, {\n            taskId,\n            newStatus: TASK_STATUS.COMPLETED,\n          });\n        }\n      });\n  } else {\n    callMutation(mutations.TASK_CHANGE_ASSIGNED_TO, {\n      taskId,\n      newAssignee: user._id,\n    });\n  }\n};\n\nconst getMenuItems = (\n  users,\n  taskAssignedTo,\n  taskId,\n  taskUserId,\n  initialAssignment,\n) => {\n  const options = users.map(user => ({\n    id: user._id,\n    show: user._id !== taskAssignedTo, // role\n    label: user.emails[0].address,\n    link: false,\n    onClick: () => {\n      changeAssignedUser({\n        user,\n        taskId,\n        taskAssignedTo,\n        taskUserId,\n        initialAssignment,\n      });\n    },\n  }));\n  return options;\n};\n\nconst TasksAssignedUserDropdown = (props) => {\n  // const { data, isLoading, error, taskId, taskUser, styles } = props;\n  const {\n    data,\n    isLoading,\n    error,\n    taskId,\n    taskAssignedTo,\n    taskUserId,\n    initialAssignment,\n    styles,\n  } = props;\n\n  if (isLoading) {\n    return null;\n  }\n  if (error) {\n    return <div>Error: {error.reason}</div>;\n  }\n\n  return (\n    <DropdownMenu\n      iconType=\"personAdd\"\n      options={getMenuItems(\n        data,\n        taskAssignedTo,\n        taskId,\n        taskUserId,\n        initialAssignment,\n      )}\n      style={styles}\n    />\n  );\n};\n\nexport default TasksAssignedUserDropdown;\n"]},"hash":"055427965af146ee97de6b938a42e38b40b90518"}
