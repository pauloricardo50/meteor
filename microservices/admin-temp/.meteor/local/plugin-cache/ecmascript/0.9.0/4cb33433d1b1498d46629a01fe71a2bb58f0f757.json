{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"../..","imported":["SecurityService","createMutator"],"specifiers":[{"kind":"named","imported":"SecurityService","local":"SecurityService"},{"kind":"named","imported":"createMutator","local":"createMutator"}]},{"source":"../TaskService","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"TaskService"}]},{"source":"../mutationDefinitions","imported":["*"],"specifiers":[{"kind":"namespace","local":"defs"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"imports/core/api/tasks/server/mutations.js","filenameRelative":"imports/core/api/tasks/server/mutations.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"useNativeAsyncAwait":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"imports/core/api/tasks/server/mutations.js.map","sourceFileName":"imports/core/api/tasks/server/mutations.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"mutations"},"ignored":false,"code":"\"use strict\";\n\nvar _SecurityService = void 0,\n    _createMutator = void 0;\n\nmodule.watch(require(\"../..\"), {\n  SecurityService: function SecurityService(v) {\n    _SecurityService = v;\n  },\n  createMutator: function createMutator(v) {\n    _createMutator = v;\n  }\n}, 0);\nvar TaskService = void 0;\nmodule.watch(require(\"../TaskService\"), {\n  default: function _default(v) {\n    TaskService = v;\n  }\n}, 1);\nvar defs = void 0;\nmodule.watch(require(\"../mutationDefinitions\"), {\n  \"*\": function _(v) {\n    defs = v;\n  }\n}, 2);\n\n_createMutator(defs.TASK_INSERT, function (_ref) {\n  var type = _ref.type,\n      loanId = _ref.loanId;\n\n  _SecurityService.tasks.isAllowedToInsert();\n\n  return TaskService.insert({\n    type: type,\n    loanId: loanId\n  });\n});\n\n_createMutator(defs.TASK_UPDATE, function (_ref2) {\n  var taskId = _ref2.taskId,\n      task = _ref2.task;\n\n  _SecurityService.tasks.isAllowedToUpdate();\n\n  return TaskService.insert({\n    taskId: taskId,\n    task: task\n  });\n});\n\n_createMutator(defs.TASK_COMPLETE, function (_ref3) {\n  var taskId = _ref3.taskId;\n\n  _SecurityService.tasks.isAllowedToUpdate(taskId);\n\n  return TaskService.complete({\n    taskId: taskId\n  });\n});\n\n_createMutator(defs.TASK_COMPLETE_BY_TYPE, function (_ref4) {\n  var type = _ref4.type,\n      loanId = _ref4.loanId,\n      newStatus = _ref4.newStatus;\n\n  _SecurityService.tasks.isAllowedToUpdate();\n\n  return TaskService.completeByType({\n    type: type,\n    loanId: loanId,\n    newStatus: newStatus\n  });\n});\n\n_createMutator(defs.TASK_CHANGE_STATUS, function (_ref5) {\n  var taskId = _ref5.taskId,\n      newStatus = _ref5.newStatus;\n\n  _SecurityService.tasks.isAllowedToUpdate(taskId);\n\n  return TaskService.changeStatus({\n    taskId: taskId,\n    newStatus: newStatus\n  });\n});\n\n_createMutator(defs.TASK_CHANGE_ASSIGNED_TO, function (_ref6) {\n  var taskId = _ref6.taskId,\n      newAssignee = _ref6.newAssignee;\n\n  _SecurityService.tasks.isAllowedToUpdate(taskId);\n\n  return TaskService.changeAssignedTo({\n    taskId: taskId,\n    newAssignee: newAssignee\n  });\n});\n\n_createMutator(defs.TASK_IS_RELATED_TO, function (_ref7) {\n  var task = _ref7.task,\n      userId = _ref7.userId;\n\n  _SecurityService.tasks.isAllowedToUpdate(task._id);\n\n  return TaskService.isRelatedTo({\n    task: task,\n    userId: userId\n  });\n});","map":{"version":3,"sources":["imports/core/api/tasks/server/mutations.js"],"names":["SecurityService","createMutator","module","watch","require","v","TaskService","default","defs","TASK_INSERT","type","loanId","tasks","isAllowedToInsert","insert","TASK_UPDATE","taskId","task","isAllowedToUpdate","TASK_COMPLETE","complete","TASK_COMPLETE_BY_TYPE","newStatus","completeByType","TASK_CHANGE_STATUS","changeStatus","TASK_CHANGE_ASSIGNED_TO","newAssignee","changeAssignedTo","TASK_IS_RELATED_TO","userId","_id","isRelatedTo"],"mappings":"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","file":"imports/core/api/tasks/server/mutations.js.map","sourcesContent":["import { SecurityService, createMutator } from '../..';\nimport TaskService from '../TaskService';\nimport * as defs from '../mutationDefinitions';\n\ncreateMutator(defs.TASK_INSERT, ({ type, loanId }) => {\n  SecurityService.tasks.isAllowedToInsert();\n  return TaskService.insert({ type, loanId });\n});\n\ncreateMutator(defs.TASK_UPDATE, ({ taskId, task }) => {\n  SecurityService.tasks.isAllowedToUpdate();\n  return TaskService.insert({ taskId, task });\n});\n\ncreateMutator(defs.TASK_COMPLETE, ({ taskId }) => {\n  SecurityService.tasks.isAllowedToUpdate(taskId);\n  return TaskService.complete({ taskId });\n});\n\ncreateMutator(defs.TASK_COMPLETE_BY_TYPE, ({ type, loanId, newStatus }) => {\n  SecurityService.tasks.isAllowedToUpdate();\n  return TaskService.completeByType({ type, loanId, newStatus });\n});\n\ncreateMutator(defs.TASK_CHANGE_STATUS, ({ taskId, newStatus }) => {\n  SecurityService.tasks.isAllowedToUpdate(taskId);\n  return TaskService.changeStatus({ taskId, newStatus });\n});\n\ncreateMutator(defs.TASK_CHANGE_ASSIGNED_TO, ({ taskId, newAssignee }) => {\n  SecurityService.tasks.isAllowedToUpdate(taskId);\n  return TaskService.changeAssignedTo({ taskId, newAssignee });\n});\n\ncreateMutator(defs.TASK_IS_RELATED_TO, ({ task, userId }) => {\n  SecurityService.tasks.isAllowedToUpdate(task._id);\n  return TaskService.isRelatedTo({ task, userId });\n});\n"]},"hash":"4cb33433d1b1498d46629a01fe71a2bb58f0f757"}
