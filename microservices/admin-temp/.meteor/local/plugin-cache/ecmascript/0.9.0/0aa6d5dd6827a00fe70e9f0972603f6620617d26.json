{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"file-saver","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"fileSaver"}]},{"source":"meteor/meteor","imported":["Meteor"],"specifiers":[{"kind":"named","imported":"Meteor","local":"Meteor"}]},{"source":"meteor/themeteorchef:bert","imported":["Bert"],"specifiers":[{"kind":"named","imported":"Bert","local":"Bert"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"imports/core/utils/download-pdf.js","filenameRelative":"imports/core/utils/download-pdf.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"imports/core/utils/download-pdf.js.map","sourceFileName":"imports/core/utils/download-pdf.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"download-pdf"},"ignored":false,"code":"\"use strict\";\n\nvar fileSaver = void 0;\nmodule.watch(require(\"file-saver\"), {\n  \"default\": function () {\n    function _default(v) {\n      fileSaver = v;\n    }\n\n    return _default;\n  }()\n}, 0);\n\nvar _Meteor = void 0;\n\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function () {\n    function Meteor(v) {\n      _Meteor = v;\n    }\n\n    return Meteor;\n  }()\n}, 1);\n\nvar _Bert = void 0;\n\nmodule.watch(require(\"meteor/themeteorchef:bert\"), {\n  Bert: function () {\n    function Bert(v) {\n      _Bert = v;\n    }\n\n    return Bert;\n  }()\n}, 2);\n\nvar decodeBase64 = function () {\n  function decodeBase64(string) {\n    return atob(string);\n  }\n\n  return decodeBase64;\n}();\n\nvar getLength = function () {\n  function getLength(value) {\n    return value.length;\n  }\n\n  return getLength;\n}();\n\nvar buildByteArray = function () {\n  function buildByteArray(string, stringLength) {\n    var buffer = new ArrayBuffer(stringLength);\n    var array = new Uint8Array(buffer);\n\n    for (var i = 0; i < stringLength; i++) {\n      array[i] = string.charCodeAt(i);\n    }\n\n    return array;\n  }\n\n  return buildByteArray;\n}();\n\nvar createBlob = function () {\n  function createBlob(byteArray) {\n    return new Blob([byteArray], {\n      type: 'application/pdf'\n    });\n  }\n\n  return createBlob;\n}();\n\nvar base64ToBlob = function () {\n  function base64ToBlob(base64String) {\n    var decodedString = decodeBase64(base64String);\n    var decodedStringLength = getLength(decodedString);\n    var byteArray = buildByteArray(decodedString, decodedStringLength);\n    return byteArray ? createBlob(byteArray) : null;\n  }\n\n  return base64ToBlob;\n}();\n\nvar downloadPDF = function () {\n  function downloadPDF(event, loanId, type) {\n    event.preventDefault();\n    var target = event.target;\n    var initialLabel = target.innerHTML;\n    target.innerHTML = '<em>Downloading...</em>';\n    target.classList.add('downloading');\n\n    _Meteor.call('pdf.download', {\n      loanId: loanId,\n      type: type\n    }, function (error, response) {\n      if (error) {\n        _Bert.alert(error.reason, 'danger');\n      } else {\n        var blob = base64ToBlob(response.base64);\n        fileSaver.saveAs(blob, response.fileName);\n        target.innerHTML = initialLabel;\n        target.classList.remove('downloading');\n      }\n    });\n  }\n\n  return downloadPDF;\n}();\n\nmodule.exportDefault(downloadPDF);","map":{"version":3,"sources":["imports/core/utils/download-pdf.js"],"names":["fileSaver","module","watch","require","v","Meteor","Bert","decodeBase64","atob","string","getLength","value","length","buildByteArray","stringLength","buffer","ArrayBuffer","array","Uint8Array","i","charCodeAt","createBlob","Blob","byteArray","type","base64ToBlob","base64String","decodedString","decodedStringLength","downloadPDF","event","loanId","preventDefault","target","initialLabel","innerHTML","classList","add","call","error","response","alert","reason","blob","base64","saveAs","fileName","remove","exportDefault"],"mappings":";;AAAA,IAAIA,kBAAJ;AAAcC,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAAA;AAAA,sBAASC,CAAT,EAAW;AAACJ,kBAAUI,CAAV;AAAY;;AAAxB;AAAA;AAAA,CAAnC,EAA6D,CAA7D;;AAAgE,IAAIC,gBAAJ;;AAAWJ,OAAOC,KAAP,CAAaC,QAAQ,eAAR,CAAb,EAAsC;AAACE,QAAD;AAAA,oBAAQD,CAAR,EAAU;AAACC,gBAAOD,CAAP;AAAS;;AAApB;AAAA;AAAA,CAAtC,EAA4D,CAA5D;;AAA+D,IAAIE,cAAJ;;AAASL,OAAOC,KAAP,CAAaC,QAAQ,2BAAR,CAAb,EAAkD;AAACG,MAAD;AAAA,kBAAMF,CAAN,EAAQ;AAACE,cAAKF,CAAL;AAAO;;AAAhB;AAAA;AAAA,CAAlD,EAAoE,CAApE;;AAIjK,IAAMG;AAAe,WAAfA,YAAe;AAAA,WAAUC,KAAKC,MAAL,CAAV;AAAA;;AAAf;AAAA,GAAN;;AAEA,IAAMC;AAAY,WAAZA,SAAY;AAAA,WAASC,MAAMC,MAAf;AAAA;;AAAZ;AAAA,GAAN;;AAEA,IAAMC;AAAiB,WAAjBA,cAAiB,CAACJ,MAAD,EAASK,YAAT,EAA0B;AAC/C,QAAMC,SAAS,IAAIC,WAAJ,CAAgBF,YAAhB,CAAf;AACA,QAAMG,QAAQ,IAAIC,UAAJ,CAAeH,MAAf,CAAd;;AACA,SAAK,IAAII,IAAI,CAAb,EAAgBA,IAAIL,YAApB,EAAkCK,GAAlC,EAAuC;AACrCF,YAAME,CAAN,IAAWV,OAAOW,UAAP,CAAkBD,CAAlB,CAAX;AACD;;AACD,WAAOF,KAAP;AACD;;AAPK;AAAA,GAAN;;AASA,IAAMI;AAAa,WAAbA,UAAa;AAAA,WACjB,IAAIC,IAAJ,CAAS,CAACC,SAAD,CAAT,EAAsB;AAAEC,YAAM;AAAR,KAAtB,CADiB;AAAA;;AAAb;AAAA,GAAN;;AAGA,IAAMC;AAAe,WAAfA,YAAe,CAACC,YAAD,EAAkB;AACrC,QAAMC,gBAAgBpB,aAAamB,YAAb,CAAtB;AACA,QAAME,sBAAsBlB,UAAUiB,aAAV,CAA5B;AACA,QAAMJ,YAAYV,eAAec,aAAf,EAA8BC,mBAA9B,CAAlB;AACA,WAAOL,YAAYF,WAAWE,SAAX,CAAZ,GAAoC,IAA3C;AACD;;AALK;AAAA,GAAN;;AAOA,IAAMM;AAAc,WAAdA,WAAc,CAACC,KAAD,EAAQC,MAAR,EAAgBP,IAAhB,EAAyB;AAC3CM,UAAME,cAAN;AAD2C,QAEnCC,MAFmC,GAExBH,KAFwB,CAEnCG,MAFmC;AAG3C,QAAMC,eAAeD,OAAOE,SAA5B;AACAF,WAAOE,SAAP,GAAmB,yBAAnB;AACAF,WAAOG,SAAP,CAAiBC,GAAjB,CAAqB,aAArB;;AACAhC,YAAOiC,IAAP,CAAY,cAAZ,EAA4B;AAAEP,oBAAF;AAAUP;AAAV,KAA5B,EAA8C,UAACe,KAAD,EAAQC,QAAR,EAAqB;AACjE,UAAID,KAAJ,EAAW;AACTjC,cAAKmC,KAAL,CAAWF,MAAMG,MAAjB,EAAyB,QAAzB;AACD,OAFD,MAEO;AACL,YAAMC,OAAOlB,aAAae,SAASI,MAAtB,CAAb;AACA5C,kBAAU6C,MAAV,CAAiBF,IAAjB,EAAuBH,SAASM,QAAhC;AACAb,eAAOE,SAAP,GAAmBD,YAAnB;AACAD,eAAOG,SAAP,CAAiBW,MAAjB,CAAwB,aAAxB;AACD;AACF,KATD;AAUD;;AAhBK;AAAA,GAAN;;AA3BA9C,OAAO+C,aAAP,CA6CenB,WA7Cf","file":"imports/core/utils/download-pdf.js.map","sourcesContent":["import fileSaver from 'file-saver';\nimport { Meteor } from 'meteor/meteor';\nimport { Bert } from 'meteor/themeteorchef:bert';\n\nconst decodeBase64 = string => atob(string);\n\nconst getLength = value => value.length;\n\nconst buildByteArray = (string, stringLength) => {\n  const buffer = new ArrayBuffer(stringLength);\n  const array = new Uint8Array(buffer);\n  for (let i = 0; i < stringLength; i++) {\n    array[i] = string.charCodeAt(i);\n  }\n  return array;\n};\n\nconst createBlob = byteArray =>\n  new Blob([byteArray], { type: 'application/pdf' });\n\nconst base64ToBlob = (base64String) => {\n  const decodedString = decodeBase64(base64String);\n  const decodedStringLength = getLength(decodedString);\n  const byteArray = buildByteArray(decodedString, decodedStringLength);\n  return byteArray ? createBlob(byteArray) : null;\n};\n\nconst downloadPDF = (event, loanId, type) => {\n  event.preventDefault();\n  const { target } = event;\n  const initialLabel = target.innerHTML;\n  target.innerHTML = '<em>Downloading...</em>';\n  target.classList.add('downloading');\n  Meteor.call('pdf.download', { loanId, type }, (error, response) => {\n    if (error) {\n      Bert.alert(error.reason, 'danger');\n    } else {\n      const blob = base64ToBlob(response.base64);\n      fileSaver.saveAs(blob, response.fileName);\n      target.innerHTML = initialLabel;\n      target.classList.remove('downloading');\n    }\n  });\n};\n\nexport default downloadPDF;\n"]},"hash":"0aa6d5dd6827a00fe70e9f0972603f6620617d26"}
