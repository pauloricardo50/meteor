{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"meteor/meteor","imported":["Meteor"],"specifiers":[{"kind":"named","imported":"Meteor","local":"Meteor"}]},{"source":"meteor/alanning:roles","imported":["Roles"],"specifiers":[{"kind":"named","imported":"Roles","local":"Roles"}]},{"source":"meteor/check","imported":["check"],"specifiers":[{"kind":"named","imported":"check","local":"check"}]},{"source":"../properties","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"Properties"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"imports/core/api/properties/server/publications.js","filenameRelative":"imports/core/api/properties/server/publications.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"useNativeAsyncAwait":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"imports/core/api/properties/server/publications.js.map","sourceFileName":"imports/core/api/properties/server/publications.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"publications"},"ignored":false,"code":"\"use strict\";\n\nvar _Meteor = void 0;\n\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function Meteor(v) {\n    _Meteor = v;\n  }\n}, 0);\n\nvar _Roles = void 0;\n\nmodule.watch(require(\"meteor/alanning:roles\"), {\n  Roles: function Roles(v) {\n    _Roles = v;\n  }\n}, 1);\n\nvar _check = void 0;\n\nmodule.watch(require(\"meteor/check\"), {\n  check: function check(v) {\n    _check = v;\n  }\n}, 2);\nvar Properties = void 0;\nmodule.watch(require(\"../properties\"), {\n  default: function _default(v) {\n    Properties = v;\n  }\n}, 3);\n\n// Get all properties for the current user\n_Meteor.publish('properties', function publish() {\n  // Verify if user is logged In\n  if (!_Meteor.userId()) {\n    return this.ready();\n  }\n\n  return Properties.find({\n    userId: _Meteor.userId()\n  });\n}); // Get all properties for the current user\n\n\n_Meteor.publish('userProperties', function publish(userId, propertyIds) {\n  _check(userId, String);\n\n  _check(propertyIds, [String]);\n\n  if (_Roles.userIsInRole(_Meteor.userId(), 'admin') || _Roles.userIsInRole(_Meteor.userId(), 'dev')) {\n    // Return all properties owned by this user, or pointed at by a loan\n    return Properties.find({\n      $or: [{\n        userId: userId\n      }, {\n        _id: {\n          $in: propertyIds\n        }\n      }]\n    });\n  } // Return an empy cursor if not logged in\n\n\n  return this.ready();\n}); // Get a property\n\n\n_Meteor.publish('property', function publish(propertyId) {\n  _check(propertyId, String);\n\n  if (_Roles.userIsInRole(_Meteor.userId(), 'admin') || _Roles.userIsInRole(_Meteor.userId(), 'dev')) {\n    return Properties.find({\n      _id: propertyId\n    });\n  } // Return an empy cursor if not logged in\n\n\n  return this.ready();\n});\n\n_Meteor.publish('allProperties', function publish() {\n  // Verify if user is an admin\n  if (_Roles.userIsInRole(_Meteor.userId(), 'admin') || _Roles.userIsInRole(_Meteor.userId(), 'dev')) {\n    // Return all\n    return Properties.find();\n  }\n\n  return this.ready();\n});","map":{"version":3,"sources":["imports/core/api/properties/server/publications.js"],"names":["Meteor","module","watch","require","v","Roles","check","Properties","default","publish","userId","ready","find","propertyIds","String","userIsInRole","$or","_id","$in","propertyId"],"mappings":";;AAAA,IAAIA,gBAAJ;;AAAWC,OAAOC,KAAP,CAAaC,QAAQ,eAAR,CAAb,EAAsC;AAACH,QAAD,kBAAQI,CAAR,EAAU;AAACJ,cAAOI,CAAP;AAAS;AAApB,CAAtC,EAA4D,CAA5D;;AAA+D,IAAIC,eAAJ;;AAAUJ,OAAOC,KAAP,CAAaC,QAAQ,uBAAR,CAAb,EAA8C;AAACE,OAAD,iBAAOD,CAAP,EAAS;AAACC,aAAMD,CAAN;AAAQ;AAAlB,CAA9C,EAAkE,CAAlE;;AAAqE,IAAIE,eAAJ;;AAAUL,OAAOC,KAAP,CAAaC,QAAQ,cAAR,CAAb,EAAqC;AAACG,OAAD,iBAAOF,CAAP,EAAS;AAACE,aAAMF,CAAN;AAAQ;AAAlB,CAArC,EAAyD,CAAzD;AAA4D,IAAIG,mBAAJ;AAAeN,OAAOC,KAAP,CAAaC,QAAQ,eAAR,CAAb,EAAsC;AAACK,SAAD,oBAASJ,CAAT,EAAW;AAACG,iBAAWH,CAAX;AAAa;AAAzB,CAAtC,EAAiE,CAAjE;;AAM9O;AACAJ,QAAOS,OAAP,CAAe,YAAf,EAA6B,SAASA,OAAT,GAAmB;AAC9C;AACA,MAAI,CAACT,QAAOU,MAAP,EAAL,EAAsB;AACpB,WAAO,KAAKC,KAAL,EAAP;AACD;;AAED,SAAOJ,WAAWK,IAAX,CAAgB;AAAEF,YAAQV,QAAOU,MAAP;AAAV,GAAhB,CAAP;AACD,CAPD,E,CASA;;;AACAV,QAAOS,OAAP,CAAe,gBAAf,EAAiC,SAASA,OAAT,CAAiBC,MAAjB,EAAyBG,WAAzB,EAAsC;AACrEP,SAAMI,MAAN,EAAcI,MAAd;;AACAR,SAAMO,WAAN,EAAmB,CAACC,MAAD,CAAnB;;AACA,MACET,OAAMU,YAAN,CAAmBf,QAAOU,MAAP,EAAnB,EAAoC,OAApC,KACAL,OAAMU,YAAN,CAAmBf,QAAOU,MAAP,EAAnB,EAAoC,KAApC,CAFF,EAGE;AACA;AACA,WAAOH,WAAWK,IAAX,CAAgB;AACrBI,WAAK,CAAC;AAAEN;AAAF,OAAD,EAAa;AAAEO,aAAK;AAAEC,eAAKL;AAAP;AAAP,OAAb;AADgB,KAAhB,CAAP;AAGD,GAXoE,CAarE;;;AACA,SAAO,KAAKF,KAAL,EAAP;AACD,CAfD,E,CAiBA;;;AACAX,QAAOS,OAAP,CAAe,UAAf,EAA2B,SAASA,OAAT,CAAiBU,UAAjB,EAA6B;AACtDb,SAAMa,UAAN,EAAkBL,MAAlB;;AAEA,MACET,OAAMU,YAAN,CAAmBf,QAAOU,MAAP,EAAnB,EAAoC,OAApC,KACAL,OAAMU,YAAN,CAAmBf,QAAOU,MAAP,EAAnB,EAAoC,KAApC,CAFF,EAGE;AACA,WAAOH,WAAWK,IAAX,CAAgB;AAAEK,WAAKE;AAAP,KAAhB,CAAP;AACD,GARqD,CAUtD;;;AACA,SAAO,KAAKR,KAAL,EAAP;AACD,CAZD;;AAcAX,QAAOS,OAAP,CAAe,eAAf,EAAgC,SAASA,OAAT,GAAmB;AACjD;AACA,MACEJ,OAAMU,YAAN,CAAmBf,QAAOU,MAAP,EAAnB,EAAoC,OAApC,KACAL,OAAMU,YAAN,CAAmBf,QAAOU,MAAP,EAAnB,EAAoC,KAApC,CAFF,EAGE;AACA;AACA,WAAOH,WAAWK,IAAX,EAAP;AACD;;AAED,SAAO,KAAKD,KAAL,EAAP;AACD,CAXD","file":"imports/core/api/properties/server/publications.js.map","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Roles } from 'meteor/alanning:roles';\nimport { check } from 'meteor/check';\n\nimport Properties from '../properties';\n\n// Get all properties for the current user\nMeteor.publish('properties', function publish() {\n  // Verify if user is logged In\n  if (!Meteor.userId()) {\n    return this.ready();\n  }\n\n  return Properties.find({ userId: Meteor.userId() });\n});\n\n// Get all properties for the current user\nMeteor.publish('userProperties', function publish(userId, propertyIds) {\n  check(userId, String);\n  check(propertyIds, [String]);\n  if (\n    Roles.userIsInRole(Meteor.userId(), 'admin') ||\n    Roles.userIsInRole(Meteor.userId(), 'dev')\n  ) {\n    // Return all properties owned by this user, or pointed at by a loan\n    return Properties.find({\n      $or: [{ userId }, { _id: { $in: propertyIds } }],\n    });\n  }\n\n  // Return an empy cursor if not logged in\n  return this.ready();\n});\n\n// Get a property\nMeteor.publish('property', function publish(propertyId) {\n  check(propertyId, String);\n\n  if (\n    Roles.userIsInRole(Meteor.userId(), 'admin') ||\n    Roles.userIsInRole(Meteor.userId(), 'dev')\n  ) {\n    return Properties.find({ _id: propertyId });\n  }\n\n  // Return an empy cursor if not logged in\n  return this.ready();\n});\n\nMeteor.publish('allProperties', function publish() {\n  // Verify if user is an admin\n  if (\n    Roles.userIsInRole(Meteor.userId(), 'admin') ||\n    Roles.userIsInRole(Meteor.userId(), 'dev')\n  ) {\n    // Return all\n    return Properties.find();\n  }\n\n  return this.ready();\n});\n"]},"hash":"be9f545f697a7f541bd8d050d970cb8260bf69c1"}
