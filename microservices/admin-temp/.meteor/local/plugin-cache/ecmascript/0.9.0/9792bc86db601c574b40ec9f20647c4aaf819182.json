{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"meteor/mongo","imported":["Mongo"],"specifiers":[{"kind":"named","imported":"Mongo","local":"Mongo"}]},{"source":"./constants.js","imported":["LINK_STORAGE"],"specifiers":[{"kind":"named","imported":"LINK_STORAGE","local":"LINK_STORAGE"}]},{"source":"./linker.js","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"Linker"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"packages/cultofcoders:grapher/lib/links/extension.js","filenameRelative":"packages/cultofcoders:grapher/lib/links/extension.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"packages/cultofcoders:grapher/lib/links/extension.js.map","sourceFileName":"packages/cultofcoders:grapher/lib/links/extension.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"extension"},"ignored":false,"code":"var Mongo = void 0;\nmodule.watch(require(\"meteor/mongo\"), {\n    Mongo: function (v) {\n        Mongo = v;\n    }\n}, 0);\nvar LINK_STORAGE = void 0;\nmodule.watch(require(\"./constants.js\"), {\n    LINK_STORAGE: function (v) {\n        LINK_STORAGE = v;\n    }\n}, 1);\nvar Linker = void 0;\nmodule.watch(require(\"./linker.js\"), {\n    \"default\": function (v) {\n        Linker = v;\n    }\n}, 2);\n\n_.extend(Mongo.Collection.prototype, {\n    /**\n     * The data we add should be valid for config.schema.js\n     */addLinks: function (data) {\n        var _this = this;\n\n        if (!this[LINK_STORAGE]) {\n            this[LINK_STORAGE] = {};\n        }\n\n        _.each(data, function (linkConfig, linkName) {\n            var _$extend;\n\n            if (_this[LINK_STORAGE][linkName]) {\n                throw new Meteor.Error(\"You cannot add the link with name: \" + linkName + \" because it was already added to \" + _this._name + \" collection\");\n            }\n\n            var linker = new Linker(_this, linkName, linkConfig);\n\n            _.extend(_this[LINK_STORAGE], (_$extend = {}, _$extend[linkName] = linker, _$extend));\n        });\n    },\n    getLinks: function () {\n        return this[LINK_STORAGE];\n    },\n    getLinker: function (name) {\n        if (this[LINK_STORAGE]) {\n            return this[LINK_STORAGE][name];\n        }\n    },\n    hasLink: function (name) {\n        if (!this[LINK_STORAGE]) {\n            return false;\n        }\n\n        return !!this[LINK_STORAGE][name];\n    },\n    getLink: function (objectOrId, name) {\n        var linkData = this[LINK_STORAGE];\n\n        if (!linkData) {\n            throw new Meteor.Error(\"There are no links defined for collection: \" + this._name);\n        }\n\n        if (!linkData[name]) {\n            throw new Meteor.Error(\"There is no link \" + name + \" for collection: \" + this._name);\n        }\n\n        var linker = linkData[name];\n        var object = objectOrId;\n\n        if (typeof objectOrId == 'string') {\n            if (!linker.isVirtual()) {\n                var _fields;\n\n                object = this.findOne(objectOrId, {\n                    fields: (_fields = {}, _fields[linker.linkStorageField] = 1, _fields)\n                });\n            } else {\n                object = {\n                    _id: objectOrId\n                };\n            }\n\n            if (!object) {\n                throw new Meteor.Error(\"We could not find any object with _id: \\\"\" + objectOrId + \"\\\" within the collection: \" + this._name);\n            }\n        }\n\n        return linkData[name].createLink(object);\n    }\n});","map":{"version":3,"sources":["packages/cultofcoders:grapher/lib/links/extension.js"],"names":["Mongo","module","watch","require","v","LINK_STORAGE","Linker","_","extend","Collection","prototype","addLinks","data","each","linkConfig","linkName","Meteor","Error","_name","linker","getLinks","getLinker","name","hasLink","getLink","objectOrId","linkData","object","isVirtual","findOne","fields","linkStorageField","_id","createLink"],"mappings":"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","file":"packages/cultofcoders:grapher/lib/links/extension.js.map","sourcesContent":["import { Mongo } from 'meteor/mongo';\nimport {LINK_STORAGE} from './constants.js';\nimport Linker from './linker.js';\n\n_.extend(Mongo.Collection.prototype, {\n    /**\n     * The data we add should be valid for config.schema.js\n     */\n    addLinks(data) {\n        if (!this[LINK_STORAGE]) {\n            this[LINK_STORAGE] = {};\n        }\n\n        _.each(data, (linkConfig, linkName) => {\n            if (this[LINK_STORAGE][linkName]) {\n                throw new Meteor.Error(`You cannot add the link with name: ${linkName} because it was already added to ${this._name} collection`)\n            }\n\n            const linker = new Linker(this, linkName, linkConfig);\n\n            _.extend(this[LINK_STORAGE], {\n                [linkName]: linker\n            });\n        });\n    },\n    \n    getLinks() {\n        return this[LINK_STORAGE];\n    },\n\n    getLinker(name) {\n        if (this[LINK_STORAGE]) {\n            return this[LINK_STORAGE][name];\n        }\n    },\n\n    hasLink(name) {\n        if (!this[LINK_STORAGE]) {\n            return false;\n        }\n\n        return !!this[LINK_STORAGE][name];\n    },\n\n    getLink(objectOrId, name) {\n        let linkData = this[LINK_STORAGE];\n\n        if (!linkData) {\n            throw new Meteor.Error(`There are no links defined for collection: ${this._name}`);\n        }\n\n        if (!linkData[name]) {\n            throw new Meteor.Error(`There is no link ${name} for collection: ${this._name}`);\n        }\n\n        const linker = linkData[name];\n        let object = objectOrId;\n        if (typeof(objectOrId) == 'string') {\n            if (!linker.isVirtual()) {\n                object = this.findOne(objectOrId, {\n                    fields: {\n                        [linker.linkStorageField]: 1\n                    }\n                });\n            } else {\n                object = {_id: objectOrId};\n            }\n\n            if (!object) {\n                throw new Meteor.Error(`We could not find any object with _id: \"${objectOrId}\" within the collection: ${this._name}`);\n            }\n        }\n\n        return linkData[name].createLink(object);\n    }\n});\n\n"]},"hash":"9792bc86db601c574b40ec9f20647c4aaf819182"}
