{"metadata":{"usedHelpers":["extends","defineProperty","interopRequireDefault"],"marked":[],"modules":{"imports":[{"source":"moment","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"moment"}]},{"source":"../config/constants","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"constants"}]},{"source":"../api/constants","imported":["USAGE_TYPE","LOAN_STRATEGY_PRESET","OFFER_TYPE"],"specifiers":[{"kind":"named","imported":"USAGE_TYPE","local":"USAGE_TYPE"},{"kind":"named","imported":"LOAN_STRATEGY_PRESET","local":"LOAN_STRATEGY_PRESET"},{"kind":"named","imported":"OFFER_TYPE","local":"OFFER_TYPE"}]},{"source":"./finance-math","imported":["getIncomeRatio"],"specifiers":[{"kind":"named","imported":"getIncomeRatio","local":"getIncomeRatio"}]},{"source":"../arrays/steps","imported":["propertyPercent","filesPercent"],"specifiers":[{"kind":"named","imported":"propertyPercent","local":"propertyPercent"},{"kind":"named","imported":"filesPercent","local":"filesPercent"}]},{"source":"../api/files/files","imported":["loanFiles","propertyFiles"],"specifiers":[{"kind":"named","imported":"loanFiles","local":"loanFiles"},{"kind":"named","imported":"propertyFiles","local":"propertyFiles"}]}],"exports":{"exported":["getProjectValue","getLoanValue","loanStrategySuccess","strategiesChosen","getInterestsWithOffer","getMonthlyWithOffer","getMonthlyWithExtractedOffer","getPropAndWork","getTotalUsed","getBorrowRatio","getLenderCount","disableForms","getFees","isLoanValid","getPropertyCompletion","validateRatios","validateRatiosCompletely","getMaintenance","strategyDone","getAuctionEndTime"],"specifiers":[{"kind":"local","local":"getProjectValue","exported":"getProjectValue"},{"kind":"local","local":"getLoanValue","exported":"getLoanValue"},{"kind":"local","local":"loanStrategySuccess","exported":"loanStrategySuccess"},{"kind":"local","local":"strategiesChosen","exported":"strategiesChosen"},{"kind":"local","local":"getInterestsWithOffer","exported":"getInterestsWithOffer"},{"kind":"local","local":"getMonthlyWithOffer","exported":"getMonthlyWithOffer"},{"kind":"local","local":"getMonthlyWithExtractedOffer","exported":"getMonthlyWithExtractedOffer"},{"kind":"local","local":"getPropAndWork","exported":"getPropAndWork"},{"kind":"local","local":"getTotalUsed","exported":"getTotalUsed"},{"kind":"local","local":"getBorrowRatio","exported":"getBorrowRatio"},{"kind":"local","local":"getLenderCount","exported":"getLenderCount"},{"kind":"local","local":"disableForms","exported":"disableForms"},{"kind":"local","local":"getFees","exported":"getFees"},{"kind":"local","local":"isLoanValid","exported":"isLoanValid"},{"kind":"local","local":"getPropertyCompletion","exported":"getPropertyCompletion"},{"kind":"local","local":"validateRatios","exported":"validateRatios"},{"kind":"local","local":"validateRatiosCompletely","exported":"validateRatiosCompletely"},{"kind":"local","local":"getMaintenance","exported":"getMaintenance"},{"kind":"local","local":"strategyDone","exported":"strategyDone"},{"kind":"local","local":"getAuctionEndTime","exported":"getAuctionEndTime"}]}}},"options":{"filename":"imports/core/utils/loanFunctions.js","filenameRelative":"imports/core/utils/loanFunctions.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"useNativeAsyncAwait":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"imports/core/utils/loanFunctions.js.map","sourceFileName":"imports/core/utils/loanFunctions.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"loanFunctions"},"ignored":false,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getProjectValue = undefined;\n\nvar _defineProperty2 = require(\"babel-runtime/helpers/defineProperty\");\n\nvar _defineProperty3 = _interopRequireDefault(_defineProperty2);\n\nvar _extends2 = require(\"babel-runtime/helpers/extends\");\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nmodule.export({\n  getProjectValue: function getProjectValue() {\n    return _getProjectValue;\n  },\n  getLoanValue: function getLoanValue() {\n    return _getLoanValue;\n  },\n  loanStrategySuccess: function loanStrategySuccess() {\n    return _loanStrategySuccess;\n  },\n  strategiesChosen: function strategiesChosen() {\n    return _strategiesChosen;\n  },\n  getInterestsWithOffer: function getInterestsWithOffer() {\n    return _getInterestsWithOffer;\n  },\n  getMonthlyWithOffer: function getMonthlyWithOffer() {\n    return _getMonthlyWithOffer;\n  },\n  getMonthlyWithExtractedOffer: function getMonthlyWithExtractedOffer() {\n    return _getMonthlyWithExtractedOffer;\n  },\n  getPropAndWork: function getPropAndWork() {\n    return _getPropAndWork;\n  },\n  getTotalUsed: function getTotalUsed() {\n    return _getTotalUsed;\n  },\n  getBorrowRatio: function getBorrowRatio() {\n    return _getBorrowRatio;\n  },\n  getLenderCount: function getLenderCount() {\n    return _getLenderCount;\n  },\n  disableForms: function disableForms() {\n    return _disableForms;\n  },\n  getFees: function getFees() {\n    return _getFees;\n  },\n  isLoanValid: function isLoanValid() {\n    return _isLoanValid;\n  },\n  getPropertyCompletion: function getPropertyCompletion() {\n    return _getPropertyCompletion;\n  },\n  validateRatios: function validateRatios() {\n    return _validateRatios;\n  },\n  validateRatiosCompletely: function validateRatiosCompletely() {\n    return _validateRatiosCompletely;\n  },\n  getMaintenance: function getMaintenance() {\n    return _getMaintenance;\n  },\n  strategyDone: function strategyDone() {\n    return _strategyDone;\n  },\n  getAuctionEndTime: function getAuctionEndTime() {\n    return _getAuctionEndTime;\n  }\n});\nvar moment = void 0;\nmodule.watch(require(\"moment\"), {\n  default: function _default(v) {\n    moment = v;\n  }\n}, 0);\nvar constants = void 0;\nmodule.watch(require(\"../config/constants\"), {\n  default: function _default(v) {\n    constants = v;\n  }\n}, 1);\n\nvar _USAGE_TYPE = void 0,\n    _LOAN_STRATEGY_PRESET = void 0,\n    _OFFER_TYPE = void 0;\n\nmodule.watch(require(\"../api/constants\"), {\n  USAGE_TYPE: function USAGE_TYPE(v) {\n    _USAGE_TYPE = v;\n  },\n  LOAN_STRATEGY_PRESET: function LOAN_STRATEGY_PRESET(v) {\n    _LOAN_STRATEGY_PRESET = v;\n  },\n  OFFER_TYPE: function OFFER_TYPE(v) {\n    _OFFER_TYPE = v;\n  }\n}, 2);\nexports.getProjectValue = _getProjectValue;\n\nvar _getIncomeRatio = void 0;\n\nmodule.watch(require(\"./finance-math\"), {\n  getIncomeRatio: function getIncomeRatio(v) {\n    _getIncomeRatio = v;\n  }\n}, 3);\n\nvar _propertyPercent = void 0,\n    _filesPercent = void 0;\n\nmodule.watch(require(\"../arrays/steps\"), {\n  propertyPercent: function propertyPercent(v) {\n    _propertyPercent = v;\n  },\n  filesPercent: function filesPercent(v) {\n    _filesPercent = v;\n  }\n}, 4);\n\nvar _loanFiles = void 0,\n    _propertyFiles = void 0;\n\nmodule.watch(require(\"../api/files/files\"), {\n  loanFiles: function loanFiles(v) {\n    _loanFiles = v;\n  },\n  propertyFiles: function propertyFiles(v) {\n    _propertyFiles = v;\n  }\n}, 5);\n\nvar _getProjectValue = function _getProjectValue(_ref) {\n  var loan = _ref.loan,\n      property = _ref.property;\n\n  if (!property || !property.value) {\n    return 0;\n  } else if (property.value <= 0) {\n    return 0;\n  }\n\n  var value = property.value * (1 + constants.notaryFees) + (loan.general.propertyWork || 0);\n\n  if (loan.general.usageType === _USAGE_TYPE.PRIMARY) {\n    value += (loan.general.insuranceFortuneUsed || 0) * constants.lppFees;\n  }\n\n  return Math.max(0, Math.round(value));\n};\n\nvar _getLoanValue = function _getLoanValue(_ref2, roundedTo10000) {\n  var loan = _ref2.loan,\n      property = _ref2.property;\n\n  if (!loan || !loan.general) {\n    return 0;\n  }\n\n  var value = _getProjectValue({\n    loan: loan,\n    property: property\n  }) - (loan.general.fortuneUsed || 0);\n\n  if (loan.general.usageType === _USAGE_TYPE.PRIMARY) {\n    value -= loan.general.insuranceFortuneUsed || 0;\n  } // Do this when picking tranches\n\n\n  if (roundedTo10000) {\n    value = Math.round(value / 10000) * 10000;\n  } // Check negative values\n\n\n  return Math.max(0, Math.round(value));\n};\n\nvar _loanStrategySuccess = function _loanStrategySuccess() {\n  var loanTranches = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var loanValue = arguments[1];\n\n  if (!Number.isInteger(loanValue)) {\n    throw new Error('loanValue must be an integer');\n  }\n\n  if (loanTranches.length < 1) {\n    return false;\n  } // User has to choose a preset\n\n\n  var trancheSum = loanTranches.reduce(function (tot, tranche) {\n    return tranche.value + tot;\n  }, 0);\n\n  if (trancheSum === loanValue) {\n    // If the sum of all tranches is equal to the loan, success!\n    return true;\n  }\n\n  return false;\n};\n\nvar _strategiesChosen = function _strategiesChosen(_ref3) {\n  var loan = _ref3.loan,\n      property = _ref3.property;\n  return _loanStrategySuccess(loan.general.loanTranches, _getLoanValue({\n    loan: loan,\n    property: property\n  })) && loan.logic.amortizationStrategyPreset && loan.logic.hasValidatedCashStrategy;\n};\n\nvar _getInterestsWithOffer = function _getInterestsWithOffer(_ref4) {\n  var loan = _ref4.loan,\n      offer = _ref4.offer;\n  var isStandard = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n\n  if (!offer) {\n    return 0;\n  }\n\n  var tranches = loan.general.loanTranches;\n  var interestRates = isStandard ? offer.standardOffer : offer.counterpartOffer;\n  var interests = 0;\n  tranches.every(function (tranche) {\n    var rate = interestRates[tranche.type]; // If the lender doesn't have this interest rate, return false\n\n    if (!rate) {\n      interests = -1; // break loop\n\n      return false;\n    }\n\n    interests += tranche.value * rate;\n    return true;\n  });\n  return interests >= 0 ? Math.round(interests / 12) : interests;\n};\n\nvar _getMonthlyWithOffer = function _getMonthlyWithOffer(_ref5) {\n  var loan = _ref5.loan,\n      property = _ref5.property,\n      offer = _ref5.offer;\n  var isStandard = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n  var fortuneUsed = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n  var insuranceFortuneUsed = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n\n  // Return undefined if the counterpartOffer doesn't exist\n  if (!isStandard && !offer.counterpartOffer) {\n    return undefined;\n  } // Make a copy of the loan\n\n\n  var r = (0, _extends3.default)({}, loan, {\n    general: (0, _extends3.default)({}, loan.general, {\n      fortuneUsed: fortuneUsed || loan.general.fortuneUsed,\n      insuranceFortuneUsed: insuranceFortuneUsed || loan.general.insuranceFortuneUsed\n    })\n  }); // Modify it to include additional parameters\n  // r.general.fortuneUsed = fortuneUsed || r.general.fortuneUsed;\n  // r.general.insuranceFortuneUsed =\n  //   insuranceFortuneUsed || r.general.insuranceFortuneUsed;\n\n  var loanValue = _getLoanValue({\n    loan: r,\n    property: property\n  });\n\n  var maintenance = constants.maintenanceReal * (property.value + (r.general.propertyWork || 0));\n  var amortization = isStandard ? offer.standardOffer.amortization : offer.counterpartOffer.amortization;\n  amortization = amortization || constants.amortization;\n\n  var interests = _getInterestsWithOffer({\n    loan: r,\n    offer: offer\n  }, isStandard);\n\n  return interests >= 0 ? Math.round((maintenance + loanValue * amortization + interests) / 12) || 0 : 0;\n};\n\nvar _getMonthlyWithExtractedOffer = function _getMonthlyWithExtractedOffer(_ref6) {\n  var loan = _ref6.loan,\n      offer = _ref6.offer,\n      property = _ref6.property;\n  return _getMonthlyWithOffer({\n    loan: loan,\n    property: property,\n    offer: (0, _defineProperty3.default)({}, offer.type === _OFFER_TYPE.STANDARD ? 'standardOffer' : 'counterpartOffer', offer)\n  }, offer.type === _OFFER_TYPE.STANDARD);\n};\n\nvar _getPropAndWork = function _getPropAndWork(_ref7) {\n  var loan = _ref7.loan,\n      property = _ref7.property;\n  return property && property.value + (loan && loan.general && loan.general.propertyWork || 0) || 0;\n};\n\nvar _getTotalUsed = function _getTotalUsed(_ref8) {\n  var loan = _ref8.loan;\n  return Math.round(loan.general.fortuneUsed + (loan.general.insuranceFortuneUsed || 0));\n};\n\nvar _getBorrowRatio = function _getBorrowRatio(_ref9) {\n  var loan = _ref9.loan,\n      property = _ref9.property;\n\n  var loanValue = _getLoanValue({\n    loan: loan,\n    property: property\n  });\n\n  var propAndWork = _getPropAndWork({\n    loan: loan,\n    property: property\n  });\n\n  return loanValue / propAndWork;\n};\n\nvar _getLenderCount = function _getLenderCount(_ref10) {\n  var loan = _ref10.loan,\n      borrowers = _ref10.borrowers,\n      property = _ref10.property;\n\n  var incomeRatio = _getIncomeRatio({\n    loan: loan,\n    borrowers: borrowers,\n    property: property\n  });\n\n  var borrowRatio = _getBorrowRatio({\n    loan: loan,\n    property: property\n  });\n\n  if (incomeRatio > 0.38) {\n    return 0;\n  } else if (incomeRatio > 1 / 3) {\n    return 4;\n  } else if (borrowRatio <= 0.65) {\n    return 20;\n  } else if (borrowRatio > 0.65 && borrowRatio <= 0.9) {\n    return 10;\n  }\n\n  return 0;\n};\n\nvar _disableForms = function _disableForms(_ref11) {\n  var loan = _ref11.loan;\n  return !!(loan.logic && (loan.logic.step > 1 || loan.logic.verification && (loan.logic.verification.requested || loan.logic.verification.validated !== undefined)));\n};\n\nvar _getFees = function _getFees(_ref12) {\n  var loan = _ref12.loan,\n      property = _ref12.property;\n  var notaryFees = property.value * constants.notaryFees;\n  var insuranceFees = 0;\n\n  if (loan.general.usageType === _USAGE_TYPE.PRIMARY) {\n    insuranceFees = loan.general.insuranceFortuneUsed * constants.lppFees;\n  }\n\n  return notaryFees + (insuranceFees || 0);\n};\n\nvar _isLoanValid = function _isLoanValid(_ref13) {\n  var loan = _ref13.loan,\n      borrowers = _ref13.borrowers,\n      property = _ref13.property;\n\n  var incomeRatio = _getIncomeRatio({\n    loan: loan,\n    borrowers: borrowers,\n    property: property\n  });\n\n  var borrowRatio = _getBorrowRatio({\n    loan: loan,\n    borrowers: borrowers,\n    property: property\n  });\n\n  var fees = _getFees({\n    loan: loan,\n    property: property\n  });\n\n  var propAndWork = _getPropAndWork({\n    loan: loan,\n    property: property\n  });\n\n  var cashRequired = constants.minCash * propAndWork + fees;\n\n  if (incomeRatio > 0.38) {\n    throw new Error('income');\n  } else if (loan.general.fortuneUsed < cashRequired) {\n    throw new Error('cash');\n  } else if (borrowRatio > 0.8) {\n    throw new Error('ownFunds');\n  }\n\n  return true;\n};\n\nvar _getPropertyCompletion = function _getPropertyCompletion(_ref14) {\n  var loan = _ref14.loan,\n      borrowers = _ref14.borrowers,\n      property = _ref14.property;\n\n  var formsProgress = _propertyPercent(loan, borrowers, property);\n\n  var filesProgress = _filesPercent(property, _propertyFiles, 'auction');\n\n  return (formsProgress + filesProgress) / 2;\n};\n\nvar _validateRatios = function _validateRatios(incomeRatio, borrowRatio) {\n  var allowInsurance = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  var borrowRatioWanted = arguments[3];\n  // To prevent rounding errors\n  var incomeRatioSafe = incomeRatio - 0.001;\n  var borrowRatioSafe = borrowRatio - 0.001;\n\n  if (borrowRatioWanted && borrowRatioWanted !== 0.8) {\n    if (borrowRatioSafe > borrowRatioWanted) {\n      throw new Error('fortune');\n    }\n  }\n\n  if (incomeRatioSafe > 0.38) {\n    throw new Error('income');\n  } else if (!allowInsurance && borrowRatioSafe > 0.8) {\n    throw new Error('fortune');\n  } else if (borrowRatioSafe > 0.9) {\n    throw new Error('fortune');\n  } else if (incomeRatioSafe > 1 / 3) {\n    throw new Error('incomeTight');\n  } else if (borrowRatioSafe > 0.8) {\n    throw new Error('fortuneTight');\n  }\n\n  return true;\n};\n\nvar _validateRatiosCompletely = function _validateRatiosCompletely(incomeRatio, borrowRatio) {\n  var allowInsurance = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  var borrowRatioWanted = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0.9;\n\n  try {\n    _validateRatios(incomeRatio, borrowRatio, borrowRatioWanted, allowInsurance);\n\n    return {\n      isValid: true,\n      message: 'valid',\n      message2: '',\n      icon: 'check',\n      className: 'success'\n    };\n  } catch (error) {\n    var isTight = error.message.indexOf('Tight') >= 0;\n    return {\n      isValid: false,\n      message: \"\" + error.message,\n      message2: error.message + \"2\",\n      icon: isTight ? 'warning' : 'close',\n      className: isTight ? 'warning' : 'error'\n    };\n  }\n};\n\nvar _getMaintenance = function _getMaintenance(_ref15) {\n  var property = _ref15.property;\n  return property.value * 0.01 / 12;\n};\n\nvar _strategyDone = function _strategyDone(_ref16) {\n  var loan = _ref16.loan,\n      property = _ref16.property;\n  var general = loan.general,\n      logic = loan.logic;\n\n  if (general.insuranceFortuneUsed > 0 && !logic.insuranceUsePreset) {\n    return false;\n  }\n\n  if (!logic.amortizationStrategyPreset) {\n    return false;\n  }\n\n  if (!logic.loanStrategyPreset) {\n    return false;\n  }\n\n  if (logic.loanStrategyPreset === _LOAN_STRATEGY_PRESET.MANUAL && !_loanStrategySuccess(general.loanTranches, _getLoanValue({\n    loan: loan,\n    property: property\n  }, true))) {\n    return false;\n  }\n\n  return true;\n};\n\nvar _getAuctionEndTime = function _getAuctionEndTime(startTime) {\n  var time = moment(startTime);\n\n  if (time.isoWeekday() === 6) {\n    // On saturdays, go to Tuesday\n    time.add(3, 'd');\n  } else if (time.isoWeekday() === 7) {\n    // On saturdays, go to Tuesday\n    time.add(2, 'd');\n  } else if (time.hour() >= 0 && time.hour() < 7) {\n    // If the start time is between midnight and 7:00,\n    // set endtime to be tomorrow night\n    time.add(1, 'd');\n  } else {\n    // Else, set endtime in 2 days from now\n    time.add(2, 'd');\n  } // Skip weekends\n\n\n  if (time.isoWeekday() === 6 || time.isoWeekday() === 7) {\n    // Saturday or Sunday\n    time.add(2, 'd');\n  } // Auctions always end at midnight\n\n\n  time.hours(23);\n  time.minutes(59);\n  time.seconds(59);\n  time.milliseconds(0);\n  return time.toDate();\n};","map":{"version":3,"sources":["imports/core/utils/loanFunctions.js"],"names":["module","export","getProjectValue","getLoanValue","loanStrategySuccess","strategiesChosen","getInterestsWithOffer","getMonthlyWithOffer","getMonthlyWithExtractedOffer","getPropAndWork","getTotalUsed","getBorrowRatio","getLenderCount","disableForms","getFees","isLoanValid","getPropertyCompletion","validateRatios","validateRatiosCompletely","getMaintenance","strategyDone","getAuctionEndTime","moment","watch","require","default","v","constants","USAGE_TYPE","LOAN_STRATEGY_PRESET","OFFER_TYPE","getIncomeRatio","propertyPercent","filesPercent","loanFiles","propertyFiles","loan","property","value","notaryFees","general","propertyWork","usageType","PRIMARY","insuranceFortuneUsed","lppFees","Math","max","round","roundedTo10000","fortuneUsed","loanTranches","loanValue","Number","isInteger","Error","length","trancheSum","reduce","tot","tranche","logic","amortizationStrategyPreset","hasValidatedCashStrategy","offer","isStandard","tranches","interestRates","standardOffer","counterpartOffer","interests","every","rate","type","undefined","r","maintenance","maintenanceReal","amortization","STANDARD","propAndWork","borrowers","incomeRatio","borrowRatio","step","verification","requested","validated","insuranceFees","fees","cashRequired","minCash","formsProgress","filesProgress","allowInsurance","borrowRatioWanted","incomeRatioSafe","borrowRatioSafe","isValid","message","message2","icon","className","error","isTight","indexOf","insuranceUsePreset","loanStrategyPreset","MANUAL","startTime","time","isoWeekday","add","hour","hours","minutes","seconds","milliseconds","toDate"],"mappings":"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","file":"imports/core/utils/loanFunctions.js.map","sourcesContent":["import moment from 'moment';\n\nimport constants from '../config/constants';\nimport { USAGE_TYPE, LOAN_STRATEGY_PRESET, OFFER_TYPE } from '../api/constants';\nimport { getIncomeRatio } from './finance-math';\nimport { propertyPercent, filesPercent } from '../arrays/steps';\nimport { loanFiles, propertyFiles } from '../api/files/files';\n\nexport const getProjectValue = ({ loan, property }) => {\n  if (!property || !property.value) {\n    return 0;\n  } else if (property.value <= 0) {\n    return 0;\n  }\n\n  let value =\n    property.value * (1 + constants.notaryFees) +\n    (loan.general.propertyWork || 0);\n\n  if (loan.general.usageType === USAGE_TYPE.PRIMARY) {\n    value += (loan.general.insuranceFortuneUsed || 0) * constants.lppFees;\n  }\n\n  return Math.max(0, Math.round(value));\n};\n\nexport const getLoanValue = ({ loan, property }, roundedTo10000) => {\n  if (!loan || !loan.general) {\n    return 0;\n  }\n\n  let value =\n    getProjectValue({ loan, property }) - (loan.general.fortuneUsed || 0);\n\n  if (loan.general.usageType === USAGE_TYPE.PRIMARY) {\n    value -= loan.general.insuranceFortuneUsed || 0;\n  }\n\n  // Do this when picking tranches\n  if (roundedTo10000) {\n    value = Math.round(value / 10000) * 10000;\n  }\n\n  // Check negative values\n  return Math.max(0, Math.round(value));\n};\n\nexport const loanStrategySuccess = (loanTranches = [], loanValue) => {\n  if (!Number.isInteger(loanValue)) {\n    throw new Error('loanValue must be an integer');\n  }\n  if (loanTranches.length < 1) {\n    return false;\n  }\n\n  // User has to choose a preset\n  const trancheSum = loanTranches.reduce(\n    (tot, tranche) => tranche.value + tot,\n    0,\n  );\n  if (trancheSum === loanValue) {\n    // If the sum of all tranches is equal to the loan, success!\n    return true;\n  }\n\n  return false;\n};\n\nexport const strategiesChosen = ({ loan, property }) =>\n  loanStrategySuccess(\n    loan.general.loanTranches,\n    getLoanValue({ loan, property }),\n  ) &&\n  loan.logic.amortizationStrategyPreset &&\n  loan.logic.hasValidatedCashStrategy;\n\n/**\n * getInterestsWithOffer - Get the aggregate monthly interest rate for a\n * loan and an offer\n *\n * @param {type}    loan              Description\n * @param {type}    offer                    Description\n * @param {boolean} [withCounterparts=false] Description\n *\n * @return {Number} min 0\n */\nexport const getInterestsWithOffer = ({ loan, offer }, isStandard = true) => {\n  if (!offer) {\n    return 0;\n  }\n\n  const tranches = loan.general.loanTranches;\n  const interestRates = isStandard\n    ? offer.standardOffer\n    : offer.counterpartOffer;\n\n  let interests = 0;\n  tranches.every((tranche) => {\n    const rate = interestRates[tranche.type];\n\n    // If the lender doesn't have this interest rate, return false\n    if (!rate) {\n      interests = -1;\n      // break loop\n      return false;\n    }\n\n    interests += tranche.value * rate;\n    return true;\n  });\n\n  return interests >= 0 ? Math.round(interests / 12) : interests;\n};\n\nexport const getMonthlyWithOffer = (\n  { loan, property, offer },\n  isStandard = true,\n  fortuneUsed = 0,\n  insuranceFortuneUsed = 0,\n) => {\n  // Return undefined if the counterpartOffer doesn't exist\n  if (!isStandard && !offer.counterpartOffer) {\n    return undefined;\n  }\n\n  // Make a copy of the loan\n  const r = {\n    ...loan,\n    general: {\n      ...loan.general,\n      fortuneUsed: fortuneUsed || loan.general.fortuneUsed,\n      insuranceFortuneUsed:\n        insuranceFortuneUsed || loan.general.insuranceFortuneUsed,\n    },\n  };\n\n  // Modify it to include additional parameters\n  // r.general.fortuneUsed = fortuneUsed || r.general.fortuneUsed;\n  // r.general.insuranceFortuneUsed =\n  //   insuranceFortuneUsed || r.general.insuranceFortuneUsed;\n  const loanValue = getLoanValue({ loan: r, property });\n\n  const maintenance =\n    constants.maintenanceReal *\n    (property.value + (r.general.propertyWork || 0));\n\n  let amortization = isStandard\n    ? offer.standardOffer.amortization\n    : offer.counterpartOffer.amortization;\n  amortization = amortization || constants.amortization;\n\n  const interests = getInterestsWithOffer({ loan: r, offer }, isStandard);\n\n  return interests >= 0\n    ? Math.round((maintenance + loanValue * amortization + interests) / 12) || 0\n    : 0;\n};\n\nexport const getMonthlyWithExtractedOffer = ({ loan, offer, property }) =>\n  getMonthlyWithOffer(\n    {\n      loan,\n      property,\n      offer: {\n        [offer.type === OFFER_TYPE.STANDARD\n          ? 'standardOffer'\n          : 'counterpartOffer']: offer,\n      },\n    },\n    offer.type === OFFER_TYPE.STANDARD,\n  );\n\nexport const getPropAndWork = ({ loan, property }) =>\n  (property &&\n    property.value +\n      ((loan && loan.general && loan.general.propertyWork) || 0)) ||\n  0;\n\nexport const getTotalUsed = ({ loan }) =>\n  Math.round(loan.general.fortuneUsed + (loan.general.insuranceFortuneUsed || 0));\n\nexport const getBorrowRatio = ({ loan, property }) => {\n  const loanValue = getLoanValue({ loan, property });\n  const propAndWork = getPropAndWork({ loan, property });\n\n  return loanValue / propAndWork;\n};\n\nexport const getLenderCount = ({ loan, borrowers, property }) => {\n  const incomeRatio = getIncomeRatio({ loan, borrowers, property });\n  const borrowRatio = getBorrowRatio({ loan, property });\n  if (incomeRatio > 0.38) {\n    return 0;\n  } else if (incomeRatio > 1 / 3) {\n    return 4;\n  } else if (borrowRatio <= 0.65) {\n    return 20;\n  } else if (borrowRatio > 0.65 && borrowRatio <= 0.9) {\n    return 10;\n  }\n\n  return 0;\n};\n\nexport const disableForms = ({ loan }) =>\n  !!(\n    loan.logic &&\n    (loan.logic.step > 1 ||\n      (loan.logic.verification &&\n        (loan.logic.verification.requested ||\n          loan.logic.verification.validated !== undefined)))\n  );\n\nexport const getFees = ({ loan, property }) => {\n  const notaryFees = property.value * constants.notaryFees;\n  let insuranceFees = 0;\n\n  if (loan.general.usageType === USAGE_TYPE.PRIMARY) {\n    insuranceFees = loan.general.insuranceFortuneUsed * constants.lppFees;\n  }\n\n  return notaryFees + (insuranceFees || 0);\n};\n\nexport const isLoanValid = ({ loan, borrowers, property }) => {\n  const incomeRatio = getIncomeRatio({ loan, borrowers, property });\n  const borrowRatio = getBorrowRatio({ loan, borrowers, property });\n  const fees = getFees({ loan, property });\n  const propAndWork = getPropAndWork({ loan, property });\n\n  const cashRequired = constants.minCash * propAndWork + fees;\n\n  if (incomeRatio > 0.38) {\n    throw new Error('income');\n  } else if (loan.general.fortuneUsed < cashRequired) {\n    throw new Error('cash');\n  } else if (borrowRatio > 0.8) {\n    throw new Error('ownFunds');\n  }\n\n  return true;\n};\n\nexport const getPropertyCompletion = ({ loan, borrowers, property }) => {\n  const formsProgress = propertyPercent(loan, borrowers, property);\n  const filesProgress = filesPercent(property, propertyFiles, 'auction');\n\n  return (formsProgress + filesProgress) / 2;\n};\nexport const validateRatios = (\n  incomeRatio,\n  borrowRatio,\n  allowInsurance = true,\n  borrowRatioWanted,\n) => {\n  // To prevent rounding errors\n  const incomeRatioSafe = incomeRatio - 0.001;\n  const borrowRatioSafe = borrowRatio - 0.001;\n\n  if (borrowRatioWanted && borrowRatioWanted !== 0.8) {\n    if (borrowRatioSafe > borrowRatioWanted) {\n      throw new Error('fortune');\n    }\n  }\n\n  if (incomeRatioSafe > 0.38) {\n    throw new Error('income');\n  } else if (!allowInsurance && borrowRatioSafe > 0.8) {\n    throw new Error('fortune');\n  } else if (borrowRatioSafe > 0.9) {\n    throw new Error('fortune');\n  } else if (incomeRatioSafe > 1 / 3) {\n    throw new Error('incomeTight');\n  } else if (borrowRatioSafe > 0.8) {\n    throw new Error('fortuneTight');\n  }\n\n  return true;\n};\n\nexport const validateRatiosCompletely = (\n  incomeRatio,\n  borrowRatio,\n  allowInsurance = true,\n  borrowRatioWanted = 0.9,\n) => {\n  try {\n    validateRatios(incomeRatio, borrowRatio, borrowRatioWanted, allowInsurance);\n    return {\n      isValid: true,\n      message: 'valid',\n      message2: '',\n      icon: 'check',\n      className: 'success',\n    };\n  } catch (error) {\n    const isTight = error.message.indexOf('Tight') >= 0;\n    return {\n      isValid: false,\n      message: `${error.message}`,\n      message2: `${error.message}2`,\n      icon: isTight ? 'warning' : 'close',\n      className: isTight ? 'warning' : 'error',\n    };\n  }\n};\n\n// Returns the maintenance to pay every month, i.e. 1% of the property divided by 12 months\nexport const getMaintenance = ({ property }) => property.value * 0.01 / 12;\n\nexport const strategyDone = ({ loan, property }) => {\n  const { general, logic } = loan;\n  if (general.insuranceFortuneUsed > 0 && !logic.insuranceUsePreset) {\n    return false;\n  }\n\n  if (!logic.amortizationStrategyPreset) {\n    return false;\n  }\n\n  if (!logic.loanStrategyPreset) {\n    return false;\n  }\n\n  if (\n    logic.loanStrategyPreset === LOAN_STRATEGY_PRESET.MANUAL &&\n    !loanStrategySuccess(\n      general.loanTranches,\n      getLoanValue({ loan, property }, true),\n    )\n  ) {\n    return false;\n  }\n\n  return true;\n};\n\n// Gives the end time of an auction, given the start time\nexport const getAuctionEndTime = (startTime) => {\n  const time = moment(startTime);\n\n  if (time.isoWeekday() === 6) {\n    // On saturdays, go to Tuesday\n    time.add(3, 'd');\n  } else if (time.isoWeekday() === 7) {\n    // On saturdays, go to Tuesday\n    time.add(2, 'd');\n  } else if (time.hour() >= 0 && time.hour() < 7) {\n    // If the start time is between midnight and 7:00,\n    // set endtime to be tomorrow night\n    time.add(1, 'd');\n  } else {\n    // Else, set endtime in 2 days from now\n    time.add(2, 'd');\n  }\n\n  // Skip weekends\n  if (time.isoWeekday() === 6 || time.isoWeekday() === 7) {\n    // Saturday or Sunday\n    time.add(2, 'd');\n  }\n\n  // Auctions always end at midnight\n  time.hours(23);\n  time.minutes(59);\n  time.seconds(59);\n  time.milliseconds(0);\n\n  return time.toDate();\n};\n"]},"hash":"15cc12e7b8e5d0d787b7cc0dd32541579b1fe8a9"}
