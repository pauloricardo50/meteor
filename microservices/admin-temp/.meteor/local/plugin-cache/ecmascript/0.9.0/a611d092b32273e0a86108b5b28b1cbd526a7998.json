{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"meteor/meteor","imported":["Meteor"],"specifiers":[{"kind":"named","imported":"Meteor","local":"Meteor"}]},{"source":"meteor/ddp-rate-limiter","imported":["DDPRateLimiter"],"specifiers":[{"kind":"named","imported":"DDPRateLimiter","local":"DDPRateLimiter"}]},{"source":"meteor/underscore","imported":["_"],"specifiers":[{"kind":"named","imported":"_","local":"_"}]}],"exports":{"exported":["rateLimit","options"],"specifiers":[{"kind":"local","local":"rateLimit","exported":"default"},{"kind":"local","local":"options","exported":"default"}]}}},"options":{"filename":"imports/core/utils/rate-limit.js","filenameRelative":"imports/core/utils/rate-limit.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"useNativeAsyncAwait":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"imports/core/utils/rate-limit.js.map","sourceFileName":"imports/core/utils/rate-limit.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"rate-limit"},"ignored":false,"code":"\"use strict\";\n\nmodule.export({\n  default: function _default() {\n    return rateLimit;\n  }\n});\n\nvar _Meteor = void 0;\n\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function Meteor(v) {\n    _Meteor = v;\n  }\n}, 0);\n\nvar _DDPRateLimiter = void 0;\n\nmodule.watch(require(\"meteor/ddp-rate-limiter\"), {\n  DDPRateLimiter: function DDPRateLimiter(v) {\n    _DDPRateLimiter = v;\n  }\n}, 1);\n\nvar _2 = void 0;\n\nmodule.watch(require(\"meteor/underscore\"), {\n  _: function _(v) {\n    _2 = v;\n  }\n}, 2);\n\n// DDPRateLimiter.setErrorMessage(({ timeToReset }) => {\n//   const time = Math.ceil(timeToReset / 1000);\n//   const seconds = time === 1 ? 'second' : 'seconds';\n//   return `Easy on the gas, buddy. Too many loans. Try again in ${time} ${seconds}.`;\n// });\nvar fetchMethodNames = function fetchMethodNames(methods) {\n  return _2.pluck(methods, 'name');\n};\n\nvar assignLimits = function assignLimits(_ref) {\n  var methods = _ref.methods,\n      _ref$limit = _ref.limit,\n      limit = _ref$limit === undefined ? 5 : _ref$limit,\n      _ref$timeRange = _ref.timeRange,\n      timeRange = _ref$timeRange === undefined ? 1000 : _ref$timeRange;\n  var methodNames = fetchMethodNames(methods);\n\n  if (_Meteor.isServer) {\n    _DDPRateLimiter.addRule({\n      name: function name(_name) {\n        return _2.contains(methodNames, _name);\n      },\n      connectionId: function connectionId() {\n        return true;\n      }\n    }, limit, timeRange);\n  }\n};\n\nfunction rateLimit(options) {\n  return assignLimits(options);\n}","map":{"version":3,"sources":["imports/core/utils/rate-limit.js"],"names":["module","export","default","rateLimit","Meteor","watch","require","v","DDPRateLimiter","_","fetchMethodNames","pluck","methods","assignLimits","limit","timeRange","methodNames","isServer","addRule","name","contains","connectionId","options"],"mappings":";;AAAAA,OAAOC,MAAP,CAAc;AAACC,WAAQ;AAAA,WAAIC,SAAJ;AAAA;AAAT,CAAd;;AAAuC,IAAIC,gBAAJ;;AAAWJ,OAAOK,KAAP,CAAaC,QAAQ,eAAR,CAAb,EAAsC;AAACF,QAAD,kBAAQG,CAAR,EAAU;AAACH,cAAOG,CAAP;AAAS;AAApB,CAAtC,EAA4D,CAA5D;;AAA+D,IAAIC,wBAAJ;;AAAmBR,OAAOK,KAAP,CAAaC,QAAQ,yBAAR,CAAb,EAAgD;AAACE,gBAAD,0BAAgBD,CAAhB,EAAkB;AAACC,sBAAeD,CAAf;AAAiB;AAApC,CAAhD,EAAsF,CAAtF;;AAAyF,IAAIE,WAAJ;;AAAMT,OAAOK,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACG,GAAD,aAAGF,CAAH,EAAK;AAACE,SAAEF,CAAF;AAAI;AAAV,CAA1C,EAAsD,CAAtD;;AAInO;AACA;AACA;AACA;AACA;AAEA,IAAMG,mBAAmB,SAAnBA,gBAAmB;AAAA,SAAWD,GAAEE,KAAF,CAAQC,OAAR,EAAiB,MAAjB,CAAX;AAAA,CAAzB;;AAEA,IAAMC,eAAe,SAAfA,YAAe,OAA8C;AAAA,MAA3CD,OAA2C,QAA3CA,OAA2C;AAAA,wBAAlCE,KAAkC;AAAA,MAAlCA,KAAkC,8BAA1B,CAA0B;AAAA,4BAAvBC,SAAuB;AAAA,MAAvBA,SAAuB,kCAAX,IAAW;AACjE,MAAMC,cAAcN,iBAAiBE,OAAjB,CAApB;;AAEA,MAAIR,QAAOa,QAAX,EAAqB;AACnBT,oBAAeU,OAAf,CACE;AACEC,UADF,gBACOA,KADP,EACa;AACT,eAAOV,GAAEW,QAAF,CAAWJ,WAAX,EAAwBG,KAAxB,CAAP;AACD,OAHH;AAIEE,kBAJF,0BAIiB;AACb,eAAO,IAAP;AACD;AANH,KADF,EASEP,KATF,EAUEC,SAVF;AAYD;AACF,CAjBD;;AAmBe,SAASZ,SAAT,CAAmBmB,OAAnB,EAA4B;AACzC,SAAOT,aAAaS,OAAb,CAAP;AACD","file":"imports/core/utils/rate-limit.js.map","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { DDPRateLimiter } from 'meteor/ddp-rate-limiter';\nimport { _ } from 'meteor/underscore';\n\n// DDPRateLimiter.setErrorMessage(({ timeToReset }) => {\n//   const time = Math.ceil(timeToReset / 1000);\n//   const seconds = time === 1 ? 'second' : 'seconds';\n//   return `Easy on the gas, buddy. Too many loans. Try again in ${time} ${seconds}.`;\n// });\n\nconst fetchMethodNames = methods => _.pluck(methods, 'name');\n\nconst assignLimits = ({ methods, limit = 5, timeRange = 1000 }) => {\n  const methodNames = fetchMethodNames(methods);\n\n  if (Meteor.isServer) {\n    DDPRateLimiter.addRule(\n      {\n        name(name) {\n          return _.contains(methodNames, name);\n        },\n        connectionId() {\n          return true;\n        },\n      },\n      limit,\n      timeRange,\n    );\n  }\n};\n\nexport default function rateLimit(options) {\n  return assignLimits(options);\n}\n"]},"hash":"a611d092b32273e0a86108b5b28b1cbd526a7998"}
