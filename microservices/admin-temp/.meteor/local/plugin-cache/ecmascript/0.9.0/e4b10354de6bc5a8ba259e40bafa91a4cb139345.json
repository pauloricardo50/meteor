{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"meteor/meteor","imported":["Meteor"],"specifiers":[{"kind":"named","imported":"Meteor","local":"Meteor"}]},{"source":"../../security","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"SecurityService"}]},{"source":"../../mutations","imported":["createMutator"],"specifiers":[{"kind":"named","imported":"createMutator","local":"createMutator"}]},{"source":"../LoanService","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"LoanService"}]},{"source":"../mutationDefinitions","imported":["*"],"specifiers":[{"kind":"namespace","local":"defs"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"imports/core/api/loans/server/mutations.js","filenameRelative":"imports/core/api/loans/server/mutations.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"useNativeAsyncAwait":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"imports/core/api/loans/server/mutations.js.map","sourceFileName":"imports/core/api/loans/server/mutations.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"mutations"},"ignored":false,"code":"\"use strict\";\n\nvar _Meteor = void 0;\n\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function Meteor(v) {\n    _Meteor = v;\n  }\n}, 0);\nvar SecurityService = void 0;\nmodule.watch(require(\"../../security\"), {\n  default: function _default(v) {\n    SecurityService = v;\n  }\n}, 1);\n\nvar _createMutator = void 0;\n\nmodule.watch(require(\"../../mutations\"), {\n  createMutator: function createMutator(v) {\n    _createMutator = v;\n  }\n}, 2);\nvar LoanService = void 0;\nmodule.watch(require(\"../LoanService\"), {\n  default: function _default(v) {\n    LoanService = v;\n  }\n}, 3);\nvar defs = void 0;\nmodule.watch(require(\"../mutationDefinitions\"), {\n  \"*\": function _(v) {\n    defs = v;\n  }\n}, 4);\n\n_createMutator(defs.LOAN_INSERT, function (_ref) {\n  var object = _ref.object,\n      userId = _ref.userId;\n  var userIdIsDefined = userId !== undefined;\n\n  if (userIdIsDefined) {\n    SecurityService.checkCurrentUserIsAdmin();\n  } else {\n    SecurityService.loans.isAllowedToInsert();\n  }\n\n  return LoanService.insert({\n    object: object,\n    userId: userIdIsDefined ? userId : _Meteor.userId()\n  });\n});\n\n_createMutator(defs.LOAN_UPDATE, function (_ref2) {\n  var loanId = _ref2.loanId,\n      object = _ref2.object;\n  SecurityService.loans.isAllowedToUpdate(loanId);\n  return LoanService.update({\n    loanId: loanId,\n    loan: loan\n  });\n});\n\n_createMutator(defs.LOAN_DELETE, function (_ref3) {\n  var loanId = _ref3.loanId;\n  SecurityService.loans.isAllowedToDelete(loanId);\n  return LoanService.delete({\n    loanId: loanId\n  });\n});\n\n_createMutator(defs.INCREMENT_LOAN_STEP, function (_ref4) {\n  var loanId = _ref4.loanId;\n  SecurityService.loans.isAllowedToUpdate(loanId);\n  return LoanService.incrementStep({\n    loanId: loanId\n  });\n});\n\n_createMutator(defs.REQUEST_LOAN_VERIFICATION, function (_ref5) {\n  var loanId = _ref5.loanId;\n  SecurityService.loans.isAllowedToUpdate(loanId);\n  return LoanService.askVerification({\n    loanId: loanId\n  });\n});\n\n_createMutator(defs.START_AUCTION, function (_ref6) {\n  var loanId = _ref6.loanId;\n  SecurityService.loans.isAllowedToUpdate(loanId);\n  return LoanService.startAuction({\n    loanId: loanId\n  });\n});\n\n_createMutator(defs.END_AUCTION, function (_ref7) {\n  var loanId = _ref7.loanId;\n  SecurityService.checkCurrentUserIsAdmin();\n  return LoanService.startAuction({\n    loanId: loanId\n  });\n});\n\n_createMutator(defs.CANCEL_AUCTION, function (_ref8) {\n  var loanId = _ref8.loanId;\n  SecurityService.checkCurrentUserIsAdmin();\n  return LoanService.startAuction({\n    loanId: loanId\n  });\n});\n\n_createMutator(defs.CONFIRM_CLOSING, function (_ref9) {\n  var loanId = _ref9.loanId,\n      object = _ref9.object;\n  SecurityService.checkCurrentUserIsAdmin();\n  return LoanService.confirmClosing({\n    loanId: loanId,\n    object: object\n  });\n});\n\n_createMutator(defs.LOAN_CHANGE_ADMIN_NOTE, function (_ref10) {\n  var loanId = _ref10.loanId,\n      adminNote = _ref10.adminNote;\n  SecurityService.checkCurrentUserIsAdmin();\n  return LoanService.update({\n    loanId: loanId,\n    loan: {\n      adminNote: adminNote\n    }\n  });\n});","map":{"version":3,"sources":["imports/core/api/loans/server/mutations.js"],"names":["Meteor","module","watch","require","v","SecurityService","default","createMutator","LoanService","defs","LOAN_INSERT","object","userId","userIdIsDefined","undefined","checkCurrentUserIsAdmin","loans","isAllowedToInsert","insert","LOAN_UPDATE","loanId","isAllowedToUpdate","update","loan","LOAN_DELETE","isAllowedToDelete","delete","INCREMENT_LOAN_STEP","incrementStep","REQUEST_LOAN_VERIFICATION","askVerification","START_AUCTION","startAuction","END_AUCTION","CANCEL_AUCTION","CONFIRM_CLOSING","confirmClosing","LOAN_CHANGE_ADMIN_NOTE","adminNote"],"mappings":"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","file":"imports/core/api/loans/server/mutations.js.map","sourcesContent":["import { Meteor } from 'meteor/meteor';\n\nimport SecurityService from '../../security';\nimport { createMutator } from '../../mutations';\nimport LoanService from '../LoanService';\nimport * as defs from '../mutationDefinitions';\n\ncreateMutator(defs.LOAN_INSERT, ({ object, userId }) => {\n  const userIdIsDefined = userId !== undefined;\n  if (userIdIsDefined) {\n    SecurityService.checkCurrentUserIsAdmin();\n  } else {\n    SecurityService.loans.isAllowedToInsert();\n  }\n\n  return LoanService.insert({\n    object,\n    userId: userIdIsDefined ? userId : Meteor.userId(),\n  });\n});\n\ncreateMutator(defs.LOAN_UPDATE, ({ loanId, object }) => {\n  SecurityService.loans.isAllowedToUpdate(loanId);\n  return LoanService.update({ loanId, loan });\n});\n\ncreateMutator(defs.LOAN_DELETE, ({ loanId }) => {\n  SecurityService.loans.isAllowedToDelete(loanId);\n  return LoanService.delete({ loanId });\n});\n\ncreateMutator(defs.INCREMENT_LOAN_STEP, ({ loanId }) => {\n  SecurityService.loans.isAllowedToUpdate(loanId);\n  return LoanService.incrementStep({ loanId });\n});\n\ncreateMutator(defs.REQUEST_LOAN_VERIFICATION, ({ loanId }) => {\n  SecurityService.loans.isAllowedToUpdate(loanId);\n  return LoanService.askVerification({ loanId });\n});\n\ncreateMutator(defs.START_AUCTION, ({ loanId }) => {\n  SecurityService.loans.isAllowedToUpdate(loanId);\n  return LoanService.startAuction({ loanId });\n});\n\ncreateMutator(defs.END_AUCTION, ({ loanId }) => {\n  SecurityService.checkCurrentUserIsAdmin();\n  return LoanService.startAuction({ loanId });\n});\n\ncreateMutator(defs.CANCEL_AUCTION, ({ loanId }) => {\n  SecurityService.checkCurrentUserIsAdmin();\n  return LoanService.startAuction({ loanId });\n});\n\ncreateMutator(defs.CONFIRM_CLOSING, ({ loanId, object }) => {\n  SecurityService.checkCurrentUserIsAdmin();\n  return LoanService.confirmClosing({ loanId, object });\n});\n\ncreateMutator(defs.LOAN_CHANGE_ADMIN_NOTE, ({ loanId, adminNote }) => {\n  SecurityService.checkCurrentUserIsAdmin();\n  return LoanService.update({ loanId, loan: { adminNote } });\n});\n"]},"hash":"e4b10354de6bc5a8ba259e40bafa91a4cb139345"}
