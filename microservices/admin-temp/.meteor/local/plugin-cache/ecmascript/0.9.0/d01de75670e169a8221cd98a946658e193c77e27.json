{"metadata":{"usedHelpers":["inherits","possibleConstructorReturn","classCallCheck","interopRequireDefault"],"marked":[],"modules":{"imports":[{"source":"meteor/meteor","imported":["Meteor"],"specifiers":[{"kind":"named","imported":"Meteor","local":"Meteor"}]},{"source":"lodash.clonedeep","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"cloneDeep"}]},{"source":"./BaseResultCacher","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"BaseResultCacher"}]}],"exports":{"exported":["MemoryResultCacher"],"specifiers":[{"kind":"local","local":"MemoryResultCacher","exported":"default"}]}}},"options":{"filename":"packages/cultofcoders:grapher/lib/namedQuery/cache/MemoryResultCacher.js","filenameRelative":"packages/cultofcoders:grapher/lib/namedQuery/cache/MemoryResultCacher.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"packages/cultofcoders:grapher/lib/namedQuery/cache/MemoryResultCacher.js.map","sourceFileName":"packages/cultofcoders:grapher/lib/namedQuery/cache/MemoryResultCacher.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"MemoryResultCacher"},"ignored":false,"code":"var _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _possibleConstructorReturn2 = require(\"babel-runtime/helpers/possibleConstructorReturn\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require(\"babel-runtime/helpers/inherits\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nmodule.export({\n    \"default\": function () {\n        return MemoryResultCacher;\n    }\n});\nvar Meteor = void 0;\nmodule.watch(require(\"meteor/meteor\"), {\n    Meteor: function (v) {\n        Meteor = v;\n    }\n}, 0);\nvar cloneDeep = void 0;\nmodule.watch(require(\"lodash.clonedeep\"), {\n    \"default\": function (v) {\n        cloneDeep = v;\n    }\n}, 1);\nvar BaseResultCacher = void 0;\nmodule.watch(require(\"./BaseResultCacher\"), {\n    \"default\": function (v) {\n        BaseResultCacher = v;\n    }\n}, 2);\nvar DEFAULT_TTL = 60000; /**\n                          * This is a very basic in-memory result caching functionality\n                          */\n\nvar MemoryResultCacher = function (_BaseResultCacher) {\n    (0, _inherits3.default)(MemoryResultCacher, _BaseResultCacher);\n\n    function MemoryResultCacher() {\n        var config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n        (0, _classCallCheck3.default)(this, MemoryResultCacher);\n\n        var _this = (0, _possibleConstructorReturn3.default)(this, _BaseResultCacher.call(this, config));\n\n        _this.store = {};\n        return _this;\n    } /**\n       * @param cacheId\n       * @param query\n       * @param countCursor\n       * @returns {*}\n       */\n\n    MemoryResultCacher.prototype.fetch = function () {\n        function fetch(cacheId, _ref) {\n            var query = _ref.query,\n                countCursor = _ref.countCursor;\n            var cacheData = this.store[cacheId];\n\n            if (cacheData !== undefined) {\n                return cloneDeep(cacheData);\n            }\n\n            var data = BaseResultCacher.fetchData({\n                query: query,\n                countCursor: countCursor\n            });\n            this.storeData(cacheId, data);\n            return data;\n        }\n\n        return fetch;\n    }(); /**\n          * @param cacheId\n          * @param data\n          */\n\n    MemoryResultCacher.prototype.storeData = function () {\n        function storeData(cacheId, data) {\n            var _this2 = this;\n\n            var ttl = this.config.ttl || DEFAULT_TTL;\n            this.store[cacheId] = cloneDeep(data);\n            Meteor.setTimeout(function () {\n                delete _this2.store[cacheId];\n            }, ttl);\n        }\n\n        return storeData;\n    }();\n\n    return MemoryResultCacher;\n}(BaseResultCacher);","map":{"version":3,"sources":["packages/cultofcoders:grapher/lib/namedQuery/cache/MemoryResultCacher.js"],"names":["module","export","MemoryResultCacher","Meteor","watch","require","v","cloneDeep","BaseResultCacher","DEFAULT_TTL","config","store","fetch","cacheId","query","countCursor","cacheData","undefined","data","fetchData","storeData","ttl","setTimeout"],"mappings":";;;;;;;;;;;;;;AAAAA,OAAOC,MAAP,CAAc;AAAC,eAAQ;AAAA,eAAIC,kBAAJ;AAAA;AAAT,CAAd;AAAgD,IAAIC,eAAJ;AAAWH,OAAOI,KAAP,CAAaC,QAAQ,eAAR,CAAb,EAAsC;AAACF,UAAD,YAAQG,CAAR,EAAU;AAACH,iBAAOG,CAAP;AAAS;AAApB,CAAtC,EAA4D,CAA5D;AAA+D,IAAIC,kBAAJ;AAAcP,OAAOI,KAAP,CAAaC,QAAQ,kBAAR,CAAb,EAAyC;AAAA,yBAASC,CAAT,EAAW;AAACC,oBAAUD,CAAV;AAAY;AAAxB,CAAzC,EAAmE,CAAnE;AAAsE,IAAIE,yBAAJ;AAAqBR,OAAOI,KAAP,CAAaC,QAAQ,oBAAR,CAAb,EAA2C;AAAA,yBAASC,CAAT,EAAW;AAACE,2BAAiBF,CAAjB;AAAmB;AAA/B,CAA3C,EAA4E,CAA5E;AAInO,IAAMG,cAAc,KAApB,C,CAEA;;;;IAGqBP,kB;;;AACjB,kCAAyB;AAAA,YAAbQ,MAAa,uEAAJ,EAAI;AAAA;;AAAA,mEACrB,6BAAMA,MAAN,CADqB;;AAErB,cAAKC,KAAL,GAAa,EAAb;AAFqB;AAGxB,K,CAED;;;;;;;iCAMAC,K;uBAAMC,O,QAA+B;AAAA,gBAArBC,KAAqB,QAArBA,KAAqB;AAAA,gBAAdC,WAAc,QAAdA,WAAc;AACjC,gBAAMC,YAAY,KAAKL,KAAL,CAAWE,OAAX,CAAlB;;AACA,gBAAIG,cAAcC,SAAlB,EAA6B;AACzB,uBAAOV,UAAUS,SAAV,CAAP;AACH;;AAED,gBAAME,OAAOV,iBAAiBW,SAAjB,CAA2B;AAACL,4BAAD;AAAQC;AAAR,aAA3B,CAAb;AACA,iBAAKK,SAAL,CAAeP,OAAf,EAAwBK,IAAxB;AAEA,mBAAOA,IAAP;AACH;;;SAGD;;;;;iCAIAE,S;2BAAUP,O,EAASK,I,EAAM;AAAA;;AACrB,gBAAMG,MAAM,KAAKX,MAAL,CAAYW,GAAZ,IAAmBZ,WAA/B;AACA,iBAAKE,KAAL,CAAWE,OAAX,IAAsBN,UAAUW,IAAV,CAAtB;AAEAf,mBAAOmB,UAAP,CAAkB,YAAM;AACpB,uBAAO,OAAKX,KAAL,CAAWE,OAAX,CAAP;AACH,aAFD,EAEGQ,GAFH;AAGH;;;;;;EApC2Cb,gB","file":"packages/cultofcoders:grapher/lib/namedQuery/cache/MemoryResultCacher.js.map","sourcesContent":["import {Meteor} from 'meteor/meteor';\nimport cloneDeep from 'lodash.clonedeep';\nimport BaseResultCacher from './BaseResultCacher';\n\nconst DEFAULT_TTL = 60000;\n\n/**\n * This is a very basic in-memory result caching functionality\n */\nexport default class MemoryResultCacher extends BaseResultCacher {\n    constructor(config = {}) {\n        super(config);\n        this.store = {};\n    }\n\n    /**\n     * @param cacheId\n     * @param query\n     * @param countCursor\n     * @returns {*}\n     */\n    fetch(cacheId, {query, countCursor}) {\n        const cacheData = this.store[cacheId];\n        if (cacheData !== undefined) {\n            return cloneDeep(cacheData);\n        }\n\n        const data = BaseResultCacher.fetchData({query, countCursor});\n        this.storeData(cacheId, data);\n\n        return data;\n    }\n\n\n    /**\n     * @param cacheId\n     * @param data\n     */\n    storeData(cacheId, data) {\n        const ttl = this.config.ttl || DEFAULT_TTL;\n        this.store[cacheId] = cloneDeep(data);\n\n        Meteor.setTimeout(() => {\n            delete this.store[cacheId];\n        }, ttl)\n    }\n}\n"]},"hash":"d01de75670e169a8221cd98a946658e193c77e27"}
