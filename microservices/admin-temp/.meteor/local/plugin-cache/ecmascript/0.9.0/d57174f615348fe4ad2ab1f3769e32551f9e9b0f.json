{"metadata":{"usedHelpers":["classCallCheck","interopRequireDefault"],"marked":[],"modules":{"imports":[{"source":"meteor/vsivsi:job-collection","imported":["Job"],"specifiers":[{"kind":"named","imported":"Job","local":"Job"}]},{"source":"./jobs","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"Jobs"}]},{"source":"./jobConstants","imported":["SCHEDULE_METHOD"],"specifiers":[{"kind":"named","imported":"SCHEDULE_METHOD","local":"SCHEDULE_METHOD"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"imports/core/api/jobs/server/JobService.js","filenameRelative":"imports/core/api/jobs/server/JobService.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],{"spec":false,"loose":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"useNativeAsyncAwait":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"imports/core/api/jobs/server/JobService.js.map","sourceFileName":"imports/core/api/jobs/server/JobService.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"JobService"},"ignored":false,"code":"\"use strict\";\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar _Job = void 0;\n\nmodule.watch(require(\"meteor/vsivsi:job-collection\"), {\n  Job: function Job(v) {\n    _Job = v;\n  }\n}, 0);\nvar Jobs = void 0;\nmodule.watch(require(\"./jobs\"), {\n  default: function _default(v) {\n    Jobs = v;\n  }\n}, 1);\n\nvar _SCHEDULE_METHOD = void 0;\n\nmodule.watch(require(\"./jobConstants\"), {\n  SCHEDULE_METHOD: function SCHEDULE_METHOD(v) {\n    _SCHEDULE_METHOD = v;\n  }\n}, 2);\n\nvar JobService = function JobService() {\n  var _this = this;\n\n  (0, _classCallCheck3.default)(this, JobService);\n\n  this.scheduleMethod = function (_ref) {\n    var method = _ref.method,\n        params = _ref.params,\n        date = _ref.date;\n    var jobId = new _Job(Jobs, _SCHEDULE_METHOD, {\n      method: method,\n      params: params\n    }).after(date).save();\n    return jobId;\n  };\n\n  this.scheduleMutation = function (_ref2) {\n    var name = _ref2.mutation.name,\n        params = _ref2.params,\n        date = _ref2.date;\n    return _this.scheduleMethod({\n      method: name,\n      params: params,\n      date: date\n    });\n  };\n\n  this.cancelJob = function (_ref3) {\n    var jobId = _ref3.jobId;\n    return Jobs.cancelJobs([jobId]);\n  };\n\n  this.removeJob = function (_ref4) {\n    var jobId = _ref4.jobId;\n    return Jobs.removeJobs([jobId]);\n  };\n\n  this.cancelExistingJob = function (_ref5) {\n    var method = _ref5.method,\n        params = _ref5.params;\n    var job = Jobs.findOne({\n      'data.method': method,\n      'data.params': params\n    });\n\n    if (job && job._id) {\n      _this.cancelJob({\n        jobId: job._id\n      });\n    }\n  };\n\n  this.cancelExistingMutationJob = function (_ref6) {\n    var name = _ref6.mutation.name,\n        params = _ref6.params;\n\n    _this.cancelExistingJob({\n      method: name,\n      params: params\n    });\n  };\n};\n\nmodule.exportDefault(new JobService());","map":{"version":3,"sources":["imports/core/api/jobs/server/JobService.js"],"names":["Job","module","watch","require","v","Jobs","default","SCHEDULE_METHOD","JobService","scheduleMethod","method","params","date","jobId","after","save","scheduleMutation","name","mutation","cancelJob","cancelJobs","removeJob","removeJobs","cancelExistingJob","job","findOne","_id","cancelExistingMutationJob","exportDefault"],"mappings":";;;;;;;;AAAA,IAAIA,aAAJ;;AAAQC,OAAOC,KAAP,CAAaC,QAAQ,8BAAR,CAAb,EAAqD;AAACH,KAAD,eAAKI,CAAL,EAAO;AAACJ,WAAII,CAAJ;AAAM;AAAd,CAArD,EAAqE,CAArE;AAAwE,IAAIC,aAAJ;AAASJ,OAAOC,KAAP,CAAaC,QAAQ,QAAR,CAAb,EAA+B;AAACG,SAAD,oBAASF,CAAT,EAAW;AAACC,WAAKD,CAAL;AAAO;AAAnB,CAA/B,EAAoD,CAApD;;AAAuD,IAAIG,yBAAJ;;AAAoBN,OAAOC,KAAP,CAAaC,QAAQ,gBAAR,CAAb,EAAuC;AAACI,iBAAD,2BAAiBH,CAAjB,EAAmB;AAACG,uBAAgBH,CAAhB;AAAkB;AAAtC,CAAvC,EAA+E,CAA/E;;IAI9JI,U;;;;;OACJC,c,GAAiB,gBAA8B;AAAA,QAA3BC,MAA2B,QAA3BA,MAA2B;AAAA,QAAnBC,MAAmB,QAAnBA,MAAmB;AAAA,QAAXC,IAAW,QAAXA,IAAW;AAC7C,QAAMC,QAAQ,IAAIb,IAAJ,CAAQK,IAAR,EAAcE,gBAAd,EAA+B;AAAEG,oBAAF;AAAUC;AAAV,KAA/B,EACXG,KADW,CACLF,IADK,EAEXG,IAFW,EAAd;AAGA,WAAOF,KAAP;AACD,G;;OAEDG,gB,GAAmB;AAAA,QAAeC,IAAf,SAAGC,QAAH,CAAeD,IAAf;AAAA,QAAuBN,MAAvB,SAAuBA,MAAvB;AAAA,QAA+BC,IAA/B,SAA+BA,IAA/B;AAAA,WACjB,MAAKH,cAAL,CAAoB;AAAEC,cAAQO,IAAV;AAAgBN,oBAAhB;AAAwBC;AAAxB,KAApB,CADiB;AAAA,G;;OAGnBO,S,GAAY;AAAA,QAAGN,KAAH,SAAGA,KAAH;AAAA,WAAeR,KAAKe,UAAL,CAAgB,CAACP,KAAD,CAAhB,CAAf;AAAA,G;;OAEZQ,S,GAAY;AAAA,QAAGR,KAAH,SAAGA,KAAH;AAAA,WAAeR,KAAKiB,UAAL,CAAgB,CAACT,KAAD,CAAhB,CAAf;AAAA,G;;OAEZU,iB,GAAoB,iBAAwB;AAAA,QAArBb,MAAqB,SAArBA,MAAqB;AAAA,QAAbC,MAAa,SAAbA,MAAa;AAC1C,QAAMa,MAAMnB,KAAKoB,OAAL,CAAa;AAAE,qBAAef,MAAjB;AAAyB,qBAAeC;AAAxC,KAAb,CAAZ;;AACA,QAAIa,OAAOA,IAAIE,GAAf,EAAoB;AAClB,YAAKP,SAAL,CAAe;AAAEN,eAAOW,IAAIE;AAAb,OAAf;AACD;AACF,G;;OAEDC,yB,GAA4B,iBAAoC;AAAA,QAArBV,IAAqB,SAAjCC,QAAiC,CAArBD,IAAqB;AAAA,QAAbN,MAAa,SAAbA,MAAa;;AAC9D,UAAKY,iBAAL,CAAuB;AAAEb,cAAQO,IAAV;AAAgBN;AAAhB,KAAvB;AACD,G;;;AA5BHV,OAAO2B,aAAP,CA+Be,IAAIpB,UAAJ,EA/Bf","file":"imports/core/api/jobs/server/JobService.js.map","sourcesContent":["import { Job } from 'meteor/vsivsi:job-collection';\nimport Jobs from './jobs';\nimport { SCHEDULE_METHOD } from './jobConstants';\n\nclass JobService {\n  scheduleMethod = ({ method, params, date }) => {\n    const jobId = new Job(Jobs, SCHEDULE_METHOD, { method, params })\n      .after(date)\n      .save();\n    return jobId;\n  };\n\n  scheduleMutation = ({ mutation: { name }, params, date }) =>\n    this.scheduleMethod({ method: name, params, date });\n\n  cancelJob = ({ jobId }) => Jobs.cancelJobs([jobId]);\n\n  removeJob = ({ jobId }) => Jobs.removeJobs([jobId]);\n\n  cancelExistingJob = ({ method, params }) => {\n    const job = Jobs.findOne({ 'data.method': method, 'data.params': params });\n    if (job && job._id) {\n      this.cancelJob({ jobId: job._id });\n    }\n  };\n\n  cancelExistingMutationJob = ({ mutation: { name }, params }) => {\n    this.cancelExistingJob({ method: name, params });\n  };\n}\n\nexport default new JobService();\n"]},"hash":"d57174f615348fe4ad2ab1f3769e32551f9e9b0f"}
