{"metadata":{"usedHelpers":["typeof"],"marked":[],"modules":{"imports":[],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"packages/vsivsi:job-collection/job/src/job_class.coffee","filenameRelative":"packages/vsivsi:job-collection/job/src/job_class.coffee","env":{},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"packages/vsivsi:job-collection/job/src/job_class.coffee.map","sourceFileName":"packages/vsivsi:job-collection/job/src/job_class.coffee","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"job_class"},"ignored":false,"code":"var _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar JobQueue,\n    _clearInterval,\n    _setImmediate,\n    _setInterval,\n    concatReduce,\n    isBoolean,\n    isFunction,\n    isInteger,\n    isNonEmptyString,\n    isNonEmptyStringOrArrayOfNonEmptyStrings,\n    methodCall,\n    optionsHelp,\n    reduceCallbacks,\n    splitLongArray,\n    slice = [].slice,\n    indexOf = [].indexOf || function (item) {\n  for (var i = 0, l = this.length; i < l; i++) {\n    if (i in this && this[i] === item) return i;\n  }\n\n  return -1;\n};\n\nmethodCall = function (root, method, params, cb, after) {\n  var apply, name, ref, ref1, ref2, ref3;\n\n  if (after == null) {\n    after = function (ret) {\n      return ret;\n    };\n  }\n\n  apply = (ref = (ref1 = Job._ddp_apply) != null ? ref1[(ref2 = root.root) != null ? ref2 : root] : void 0) != null ? ref : Job._ddp_apply;\n\n  if (typeof apply !== 'function') {\n    throw new Error(\"Job remote method call error, no valid invocation method found.\");\n  }\n\n  name = ((ref3 = root.root) != null ? ref3 : root) + \"_\" + method;\n\n  if (cb && typeof cb === 'function') {\n    return apply(name, params, function (_this) {\n      return function (err, res) {\n        if (err) {\n          return cb(err);\n        }\n\n        return cb(null, after(res));\n      };\n    }(this));\n  } else {\n    return after(apply(name, params));\n  }\n};\n\noptionsHelp = function (options, cb) {\n  var ref;\n\n  if (cb != null && typeof cb !== 'function') {\n    options = cb;\n    cb = void 0;\n  } else {\n    if (!((typeof options === \"undefined\" ? \"undefined\" : _typeof(options)) === 'object' && options instanceof Array && options.length < 2)) {\n      throw new Error('options... in optionsHelp must be an Array with zero or one elements');\n    }\n\n    options = (ref = options != null ? options[0] : void 0) != null ? ref : {};\n  }\n\n  if ((typeof options === \"undefined\" ? \"undefined\" : _typeof(options)) !== 'object') {\n    throw new Error('in optionsHelp options not an object or bad callback');\n  }\n\n  return [options, cb];\n};\n\nsplitLongArray = function (arr, max) {\n  var i, k, ref, results;\n\n  if (!(arr instanceof Array && max > 0)) {\n    throw new Error('splitLongArray: bad params');\n  }\n\n  results = [];\n\n  for (i = k = 0, ref = Math.ceil(arr.length / max); 0 <= ref ? k < ref : k > ref; i = 0 <= ref ? ++k : --k) {\n    results.push(arr.slice(i * max, (i + 1) * max));\n  }\n\n  return results;\n};\n\nreduceCallbacks = function (cb, num, reduce, init) {\n  var cbCount, cbErr, cbRetVal;\n\n  if (reduce == null) {\n    reduce = function (a, b) {\n      return a || b;\n    };\n  }\n\n  if (init == null) {\n    init = false;\n  }\n\n  if (cb == null) {\n    return void 0;\n  }\n\n  if (!(typeof cb === 'function' && num > 0 && typeof reduce === 'function')) {\n    throw new Error('Bad params given to reduceCallbacks');\n  }\n\n  cbRetVal = init;\n  cbCount = 0;\n  cbErr = null;\n  return function (err, res) {\n    if (!cbErr) {\n      if (err) {\n        cbErr = err;\n        return cb(err);\n      } else {\n        cbCount++;\n        cbRetVal = reduce(cbRetVal, res);\n\n        if (cbCount === num) {\n          return cb(null, cbRetVal);\n        } else if (cbCount > num) {\n          throw new Error(\"reduceCallbacks callback invoked more than requested \" + num + \" times\");\n        }\n      }\n    }\n  };\n};\n\nconcatReduce = function (a, b) {\n  if (!(a instanceof Array)) {\n    a = [a];\n  }\n\n  return a.concat(b);\n};\n\nisInteger = function (i) {\n  return typeof i === 'number' && Math.floor(i) === i;\n};\n\nisBoolean = function (b) {\n  return typeof b === 'boolean';\n};\n\nisFunction = function (f) {\n  return typeof f === 'function';\n};\n\nisNonEmptyString = function (s) {\n  return typeof s === 'string' && s.length > 0;\n};\n\nisNonEmptyStringOrArrayOfNonEmptyStrings = function (sa) {\n  var s;\n  return isNonEmptyString(sa) || sa instanceof Array && sa.length !== 0 && function () {\n    var k, len, results;\n    results = [];\n\n    for (k = 0, len = sa.length; k < len; k++) {\n      s = sa[k];\n\n      if (isNonEmptyString(s)) {\n        results.push(s);\n      }\n    }\n\n    return results;\n  }().length === sa.length;\n};\n\n_setImmediate = function () {\n  var args, func;\n  func = arguments[0], args = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n\n  if ((typeof Meteor !== \"undefined\" && Meteor !== null ? Meteor.setTimeout : void 0) != null) {\n    return Meteor.setTimeout.apply(Meteor, [func, 0].concat(slice.call(args)));\n  } else if (typeof setImmediate !== \"undefined\" && setImmediate !== null) {\n    return setImmediate.apply(null, [func].concat(slice.call(args)));\n  } else {\n    return setTimeout.apply(null, [func, 0].concat(slice.call(args)));\n  }\n};\n\n_setInterval = function () {\n  var args, func, timeOut;\n  func = arguments[0], timeOut = arguments[1], args = 3 <= arguments.length ? slice.call(arguments, 2) : [];\n\n  if ((typeof Meteor !== \"undefined\" && Meteor !== null ? Meteor.setInterval : void 0) != null) {\n    return Meteor.setInterval.apply(Meteor, [func, timeOut].concat(slice.call(args)));\n  } else {\n    return setInterval.apply(null, [func, timeOut].concat(slice.call(args)));\n  }\n};\n\n_clearInterval = function (id) {\n  if ((typeof Meteor !== \"undefined\" && Meteor !== null ? Meteor.clearInterval : void 0) != null) {\n    return Meteor.clearInterval(id);\n  } else {\n    return clearInterval(id);\n  }\n};\n\nJobQueue = function () {\n  function JobQueue() {\n    var k, options, ref, ref1, ref2, ref3, ref4, root1, type1, worker;\n    root1 = arguments[0], type1 = arguments[1], options = 4 <= arguments.length ? slice.call(arguments, 2, k = arguments.length - 1) : (k = 2, []), worker = arguments[k++];\n    this.root = root1;\n    this.type = type1;\n    this.worker = worker;\n\n    if (!(this instanceof JobQueue)) {\n      return function (func, args, ctor) {\n        ctor.prototype = func.prototype;\n        var child = new ctor(),\n            result = func.apply(child, args);\n        return Object(result) === result ? result : child;\n      }(JobQueue, [this.root, this.type].concat(slice.call(options), [this.worker]), function () {});\n    }\n\n    ref = optionsHelp(options, this.worker), options = ref[0], this.worker = ref[1];\n\n    if (!isNonEmptyString(this.root)) {\n      throw new Error(\"JobQueue: Invalid root, must be nonempty string\");\n    }\n\n    if (!isNonEmptyStringOrArrayOfNonEmptyStrings(this.type)) {\n      throw new Error(\"JobQueue: Invalid type, must be nonempty string or array of nonempty strings\");\n    }\n\n    if (!isFunction(this.worker)) {\n      throw new Error(\"JobQueue: Invalid worker, must be a function\");\n    }\n\n    this.errorCallback = (ref1 = options.errorCallback) != null ? ref1 : function (e) {\n      return console.error(\"JobQueue: \", e);\n    };\n\n    if (!isFunction(this.errorCallback)) {\n      throw new Error(\"JobQueue: Invalid errorCallback, must be a function\");\n    }\n\n    this.pollInterval = options.pollInterval != null && !options.pollInterval ? Job.forever : !(options.pollInterval != null && isInteger(options.pollInterval)) ? 5000 : options.pollInterval;\n\n    if (!(isInteger(this.pollInterval) && this.pollInterval >= 0)) {\n      throw new Error(\"JobQueue: Invalid pollInterval, must be a positive integer\");\n    }\n\n    this.concurrency = (ref2 = options.concurrency) != null ? ref2 : 1;\n\n    if (!(isInteger(this.concurrency) && this.concurrency >= 0)) {\n      throw new Error(\"JobQueue: Invalid concurrency, must be a positive integer\");\n    }\n\n    this.payload = (ref3 = options.payload) != null ? ref3 : 1;\n\n    if (!(isInteger(this.payload) && this.payload >= 0)) {\n      throw new Error(\"JobQueue: Invalid payload, must be a positive integer\");\n    }\n\n    this.prefetch = (ref4 = options.prefetch) != null ? ref4 : 0;\n\n    if (!(isInteger(this.prefetch) && this.prefetch >= 0)) {\n      throw new Error(\"JobQueue: Invalid prefetch, must be a positive integer\");\n    }\n\n    this.workTimeout = options.workTimeout;\n\n    if (this.workTimeout != null && !(isInteger(this.workTimeout) && this.workTimeout >= 0)) {\n      throw new Error(\"JobQueue: Invalid workTimeout, must be a positive integer\");\n    }\n\n    this.callbackStrict = options.callbackStrict;\n\n    if (this.callbackStrict != null && !isBoolean(this.callbackStrict)) {\n      throw new Error(\"JobQueue: Invalid callbackStrict, must be a boolean\");\n    }\n\n    this._workers = {};\n    this._tasks = [];\n    this._taskNumber = 0;\n    this._stoppingGetWork = void 0;\n    this._stoppingTasks = void 0;\n    this._interval = null;\n    this._getWorkOutstanding = false;\n    this.paused = true;\n    this.resume();\n  }\n\n  JobQueue.prototype._getWork = function () {\n    var numJobsToGet, options;\n\n    if (!(this._getWorkOutstanding || this.paused)) {\n      numJobsToGet = this.prefetch + this.payload * (this.concurrency - this.running()) - this.length();\n\n      if (numJobsToGet > 0) {\n        this._getWorkOutstanding = true;\n        options = {\n          maxJobs: numJobsToGet\n        };\n\n        if (this.workTimeout != null) {\n          options.workTimeout = this.workTimeout;\n        }\n\n        return Job.getWork(this.root, this.type, options, function (_this) {\n          return function (err, jobs) {\n            var j, k, len;\n            _this._getWorkOutstanding = false;\n\n            if (err) {\n              return _this.errorCallback(new Error(\"Received error from getWork(): \" + err));\n            } else if (jobs != null && jobs instanceof Array) {\n              if (jobs.length > numJobsToGet) {\n                _this.errorCallback(new Error(\"getWork() returned jobs (\" + jobs.length + \") in excess of maxJobs (\" + numJobsToGet + \")\"));\n              }\n\n              for (k = 0, len = jobs.length; k < len; k++) {\n                j = jobs[k];\n\n                _this._tasks.push(j);\n\n                if (_this._stoppingGetWork == null) {\n                  _setImmediate(_this._process.bind(_this));\n                }\n              }\n\n              if (_this._stoppingGetWork != null) {\n                return _this._stoppingGetWork();\n              }\n            } else {\n              return _this.errorCallback(new Error(\"Nonarray response from server from getWork()\"));\n            }\n          };\n        }(this));\n      }\n    }\n  };\n\n  JobQueue.prototype._only_once = function (fn) {\n    var called;\n    called = false;\n    return function (_this) {\n      return function () {\n        if (called) {\n          _this.errorCallback(new Error(\"Worker callback called multiple times\"));\n\n          if (_this.callbackStrict) {\n            throw new Error(\"JobQueue: worker callback was invoked multiple times\");\n          }\n        }\n\n        called = true;\n        return fn.apply(_this, arguments);\n      };\n    }(this);\n  };\n\n  JobQueue.prototype._process = function () {\n    var cb, job, next;\n\n    if (!this.paused && this.running() < this.concurrency && this.length()) {\n      if (this.payload > 1) {\n        job = this._tasks.splice(0, this.payload);\n      } else {\n        job = this._tasks.shift();\n      }\n\n      job._taskId = \"Task_\" + this._taskNumber++;\n      this._workers[job._taskId] = job;\n\n      next = function (_this) {\n        return function () {\n          delete _this._workers[job._taskId];\n\n          if (_this._stoppingTasks != null && _this.running() === 0 && _this.length() === 0) {\n            return _this._stoppingTasks();\n          } else {\n            _setImmediate(_this._process.bind(_this));\n\n            return _setImmediate(_this._getWork.bind(_this));\n          }\n        };\n      }(this);\n\n      cb = this._only_once(next);\n      return this.worker(job, cb);\n    }\n  };\n\n  JobQueue.prototype._stopGetWork = function (callback) {\n    _clearInterval(this._interval);\n\n    this._interval = null;\n\n    if (this._getWorkOutstanding) {\n      return this._stoppingGetWork = callback;\n    } else {\n      return _setImmediate(callback);\n    }\n  };\n\n  JobQueue.prototype._waitForTasks = function (callback) {\n    if (this.running() !== 0) {\n      return this._stoppingTasks = callback;\n    } else {\n      return _setImmediate(callback);\n    }\n  };\n\n  JobQueue.prototype._failJobs = function (tasks, callback) {\n    var count, job, k, len, results;\n\n    if (tasks.length === 0) {\n      _setImmediate(callback);\n    }\n\n    count = 0;\n    results = [];\n\n    for (k = 0, len = tasks.length; k < len; k++) {\n      job = tasks[k];\n      results.push(job.fail(\"Worker shutdown\", function (_this) {\n        return function (err, res) {\n          count++;\n\n          if (count === tasks.length) {\n            return callback();\n          }\n        };\n      }(this)));\n    }\n\n    return results;\n  };\n\n  JobQueue.prototype._hard = function (callback) {\n    this.paused = true;\n    return this._stopGetWork(function (_this) {\n      return function () {\n        var i, r, ref, tasks;\n        tasks = _this._tasks;\n        _this._tasks = [];\n        ref = _this._workers;\n\n        for (i in meteorBabelHelpers.sanitizeForInObject(ref)) {\n          r = ref[i];\n          tasks = tasks.concat(r);\n        }\n\n        return _this._failJobs(tasks, callback);\n      };\n    }(this));\n  };\n\n  JobQueue.prototype._stop = function (callback) {\n    this.paused = true;\n    return this._stopGetWork(function (_this) {\n      return function () {\n        var tasks;\n        tasks = _this._tasks;\n        _this._tasks = [];\n        return _this._waitForTasks(function () {\n          return _this._failJobs(tasks, callback);\n        });\n      };\n    }(this));\n  };\n\n  JobQueue.prototype._soft = function (callback) {\n    return this._stopGetWork(function (_this) {\n      return function () {\n        return _this._waitForTasks(callback);\n      };\n    }(this));\n  };\n\n  JobQueue.prototype.length = function () {\n    return this._tasks.length;\n  };\n\n  JobQueue.prototype.running = function () {\n    return Object.keys(this._workers).length;\n  };\n\n  JobQueue.prototype.idle = function () {\n    return this.length() + this.running() === 0;\n  };\n\n  JobQueue.prototype.full = function () {\n    return this.running() === this.concurrency;\n  };\n\n  JobQueue.prototype.pause = function () {\n    if (this.paused) {\n      return;\n    }\n\n    if (!(this.pollInterval >= Job.forever)) {\n      _clearInterval(this._interval);\n\n      this._interval = null;\n    }\n\n    this.paused = true;\n    return this;\n  };\n\n  JobQueue.prototype.resume = function () {\n    var k, ref, w;\n\n    if (!this.paused) {\n      return;\n    }\n\n    this.paused = false;\n\n    _setImmediate(this._getWork.bind(this));\n\n    if (!(this.pollInterval >= Job.forever)) {\n      this._interval = _setInterval(this._getWork.bind(this), this.pollInterval);\n    }\n\n    for (w = k = 1, ref = this.concurrency; 1 <= ref ? k <= ref : k >= ref; w = 1 <= ref ? ++k : --k) {\n      _setImmediate(this._process.bind(this));\n    }\n\n    return this;\n  };\n\n  JobQueue.prototype.trigger = function () {\n    if (this.paused) {\n      return;\n    }\n\n    _setImmediate(this._getWork.bind(this));\n\n    return this;\n  };\n\n  JobQueue.prototype.shutdown = function () {\n    var cb, k, options, ref;\n    options = 2 <= arguments.length ? slice.call(arguments, 0, k = arguments.length - 1) : (k = 0, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n\n    if (options.level == null) {\n      options.level = 'normal';\n    }\n\n    if (options.quiet == null) {\n      options.quiet = false;\n    }\n\n    if (cb == null) {\n      if (!options.quiet) {\n        console.warn(\"using default shutdown callback!\");\n      }\n\n      cb = function (_this) {\n        return function () {\n          return console.warn(\"Shutdown complete\");\n        };\n      }(this);\n    }\n\n    switch (options.level) {\n      case 'hard':\n        if (!options.quiet) {\n          console.warn(\"Shutting down hard\");\n        }\n\n        return this._hard(cb);\n\n      case 'soft':\n        if (!options.quiet) {\n          console.warn(\"Shutting down soft\");\n        }\n\n        return this._soft(cb);\n\n      default:\n        if (!options.quiet) {\n          console.warn(\"Shutting down normally\");\n        }\n\n        return this._stop(cb);\n    }\n  };\n\n  return JobQueue;\n}();\n\nJob = function () {\n  Job.forever = 9007199254740992;\n  Job.foreverDate = new Date(8640000000000000);\n  Job.jobPriorities = {\n    low: 10,\n    normal: 0,\n    medium: -5,\n    high: -10,\n    critical: -15\n  };\n  Job.jobRetryBackoffMethods = ['constant', 'exponential'];\n  Job.jobStatuses = ['waiting', 'paused', 'ready', 'running', 'failed', 'cancelled', 'completed'];\n  Job.jobLogLevels = ['info', 'success', 'warning', 'danger'];\n  Job.jobStatusCancellable = ['running', 'ready', 'waiting', 'paused'];\n  Job.jobStatusPausable = ['ready', 'waiting'];\n  Job.jobStatusRemovable = ['cancelled', 'completed', 'failed'];\n  Job.jobStatusRestartable = ['cancelled', 'failed'];\n  Job.ddpMethods = ['startJobs', 'stopJobs', 'startJobServer', 'shutdownJobServer', 'jobRemove', 'jobPause', 'jobResume', 'jobReady', 'jobCancel', 'jobRestart', 'jobSave', 'jobRerun', 'getWork', 'getJob', 'jobLog', 'jobProgress', 'jobDone', 'jobFail'];\n  Job.ddpPermissionLevels = ['admin', 'manager', 'creator', 'worker'];\n  Job.ddpMethodPermissions = {\n    'startJobs': ['startJobs', 'admin'],\n    'stopJobs': ['stopJobs', 'admin'],\n    'startJobServer': ['startJobServer', 'admin'],\n    'shutdownJobServer': ['shutdownJobServer', 'admin'],\n    'jobRemove': ['jobRemove', 'admin', 'manager'],\n    'jobPause': ['jobPause', 'admin', 'manager'],\n    'jobResume': ['jobResume', 'admin', 'manager'],\n    'jobCancel': ['jobCancel', 'admin', 'manager'],\n    'jobReady': ['jobReady', 'admin', 'manager'],\n    'jobRestart': ['jobRestart', 'admin', 'manager'],\n    'jobSave': ['jobSave', 'admin', 'creator'],\n    'jobRerun': ['jobRerun', 'admin', 'creator'],\n    'getWork': ['getWork', 'admin', 'worker'],\n    'getJob': ['getJob', 'admin', 'worker'],\n    'jobLog': ['jobLog', 'admin', 'worker'],\n    'jobProgress': ['jobProgress', 'admin', 'worker'],\n    'jobDone': ['jobDone', 'admin', 'worker'],\n    'jobFail': ['jobFail', 'admin', 'worker']\n  };\n  Job._ddp_apply = void 0;\n\n  Job._setDDPApply = function (apply, collectionName) {\n    if (typeof apply === 'function') {\n      if (typeof collectionName === 'string') {\n        if (this._ddp_apply == null) {\n          this._ddp_apply = {};\n        }\n\n        if (typeof this._ddp_apply === 'function') {\n          throw new Error(\"Job.setDDP must specify a collection name each time if called more than once.\");\n        }\n\n        return this._ddp_apply[collectionName] = apply;\n      } else if (!this._ddp_apply) {\n        return this._ddp_apply = apply;\n      } else {\n        throw new Error(\"Job.setDDP must specify a collection name each time if called more than once.\");\n      }\n    } else {\n      throw new Error(\"Bad function in Job.setDDPApply()\");\n    }\n  };\n\n  Job.setDDP = function (ddp, collectionNames, Fiber) {\n    var collName, k, len, results;\n\n    if (ddp == null) {\n      ddp = null;\n    }\n\n    if (collectionNames == null) {\n      collectionNames = null;\n    }\n\n    if (Fiber == null) {\n      Fiber = null;\n    }\n\n    if (!(typeof collectionNames === 'string' || collectionNames instanceof Array)) {\n      Fiber = collectionNames;\n      collectionNames = [void 0];\n    } else if (typeof collectionNames === 'string') {\n      collectionNames = [collectionNames];\n    }\n\n    results = [];\n\n    for (k = 0, len = collectionNames.length; k < len; k++) {\n      collName = collectionNames[k];\n\n      if (!(ddp != null && ddp.close != null && ddp.subscribe != null)) {\n        if (ddp === null && (typeof Meteor !== \"undefined\" && Meteor !== null ? Meteor.apply : void 0) != null) {\n          results.push(this._setDDPApply(Meteor.apply, collName));\n        } else {\n          throw new Error(\"Bad ddp object in Job.setDDP()\");\n        }\n      } else if (ddp.observe == null) {\n        results.push(this._setDDPApply(ddp.apply.bind(ddp), collName));\n      } else {\n        if (Fiber == null) {\n          results.push(this._setDDPApply(ddp.call.bind(ddp), collName));\n        } else {\n          results.push(this._setDDPApply(function (name, params, cb) {\n            var fib;\n            fib = Fiber.current;\n            ddp.call(name, params, function (err, res) {\n              if (cb != null && typeof cb === 'function') {\n                return cb(err, res);\n              } else {\n                if (err) {\n                  return fib.throwInto(err);\n                } else {\n                  return fib.run(res);\n                }\n              }\n            });\n\n            if (cb != null && typeof cb === 'function') {} else {\n              return Fiber[\"yield\"]();\n            }\n          }, collName));\n        }\n      }\n    }\n\n    return results;\n  };\n\n  Job.getWork = function () {\n    var cb, k, options, ref, root, type;\n    root = arguments[0], type = arguments[1], options = 4 <= arguments.length ? slice.call(arguments, 2, k = arguments.length - 1) : (k = 2, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n\n    if (typeof type === 'string') {\n      type = [type];\n    }\n\n    if (options.workTimeout != null) {\n      if (!(isInteger(options.workTimeout) && options.workTimeout > 0)) {\n        throw new Error('getWork: workTimeout must be a positive integer');\n      }\n    }\n\n    return methodCall(root, \"getWork\", [type, options], cb, function (_this) {\n      return function (res) {\n        var doc, jobs;\n\n        jobs = function () {\n          var l, len, results;\n          results = [];\n\n          for (l = 0, len = res.length; l < len; l++) {\n            doc = res[l];\n            results.push(new Job(root, doc));\n          }\n\n          return results;\n        }() || [];\n\n        if (options.maxJobs != null) {\n          return jobs;\n        } else {\n          return jobs[0];\n        }\n      };\n    }(this));\n  };\n\n  Job.processJobs = JobQueue;\n\n  Job.makeJob = function () {\n    var depFlag;\n    depFlag = false;\n    return function (root, doc) {\n      if (!depFlag) {\n        depFlag = true;\n        console.warn(\"Job.makeJob(root, jobDoc) has been deprecated and will be removed in a future release, use 'new Job(root, jobDoc)' instead.\");\n      }\n\n      return new Job(root, doc);\n    };\n  }();\n\n  Job.getJob = function () {\n    var cb, id, k, options, ref, root;\n    root = arguments[0], id = arguments[1], options = 4 <= arguments.length ? slice.call(arguments, 2, k = arguments.length - 1) : (k = 2, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n\n    if (options.getLog == null) {\n      options.getLog = false;\n    }\n\n    return methodCall(root, \"getJob\", [id, options], cb, function (_this) {\n      return function (doc) {\n        if (doc) {\n          return new Job(root, doc);\n        } else {\n          return void 0;\n        }\n      };\n    }(this));\n  };\n\n  Job.getJobs = function () {\n    var cb, chunkOfIds, chunksOfIds, ids, k, l, len, myCb, options, ref, retVal, root;\n    root = arguments[0], ids = arguments[1], options = 4 <= arguments.length ? slice.call(arguments, 2, k = arguments.length - 1) : (k = 2, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n\n    if (options.getLog == null) {\n      options.getLog = false;\n    }\n\n    retVal = [];\n    chunksOfIds = splitLongArray(ids, 32);\n    myCb = reduceCallbacks(cb, chunksOfIds.length, concatReduce, []);\n\n    for (l = 0, len = chunksOfIds.length; l < len; l++) {\n      chunkOfIds = chunksOfIds[l];\n      retVal = retVal.concat(methodCall(root, \"getJob\", [chunkOfIds, options], myCb, function (_this) {\n        return function (doc) {\n          var d, len1, m, results;\n\n          if (doc) {\n            results = [];\n\n            for (m = 0, len1 = doc.length; m < len1; m++) {\n              d = doc[m];\n              results.push(new Job(root, d.type, d.data, d));\n            }\n\n            return results;\n          } else {\n            return null;\n          }\n        };\n      }(this)));\n    }\n\n    return retVal;\n  };\n\n  Job.pauseJobs = function () {\n    var cb, chunkOfIds, chunksOfIds, ids, k, l, len, myCb, options, ref, retVal, root;\n    root = arguments[0], ids = arguments[1], options = 4 <= arguments.length ? slice.call(arguments, 2, k = arguments.length - 1) : (k = 2, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    retVal = false;\n    chunksOfIds = splitLongArray(ids, 256);\n    myCb = reduceCallbacks(cb, chunksOfIds.length);\n\n    for (l = 0, len = chunksOfIds.length; l < len; l++) {\n      chunkOfIds = chunksOfIds[l];\n      retVal = methodCall(root, \"jobPause\", [chunkOfIds, options], myCb) || retVal;\n    }\n\n    return retVal;\n  };\n\n  Job.resumeJobs = function () {\n    var cb, chunkOfIds, chunksOfIds, ids, k, l, len, myCb, options, ref, retVal, root;\n    root = arguments[0], ids = arguments[1], options = 4 <= arguments.length ? slice.call(arguments, 2, k = arguments.length - 1) : (k = 2, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    retVal = false;\n    chunksOfIds = splitLongArray(ids, 256);\n    myCb = reduceCallbacks(cb, chunksOfIds.length);\n\n    for (l = 0, len = chunksOfIds.length; l < len; l++) {\n      chunkOfIds = chunksOfIds[l];\n      retVal = methodCall(root, \"jobResume\", [chunkOfIds, options], myCb) || retVal;\n    }\n\n    return retVal;\n  };\n\n  Job.readyJobs = function () {\n    var cb, chunkOfIds, chunksOfIds, ids, k, l, len, myCb, options, ref, retVal, root;\n    root = arguments[0], ids = arguments[1], options = 4 <= arguments.length ? slice.call(arguments, 2, k = arguments.length - 1) : (k = 2, []), cb = arguments[k++];\n\n    if (ids == null) {\n      ids = [];\n    }\n\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n\n    if (options.force == null) {\n      options.force = false;\n    }\n\n    retVal = false;\n    chunksOfIds = splitLongArray(ids, 256);\n\n    if (!(chunksOfIds.length > 0)) {\n      chunksOfIds = [[]];\n    }\n\n    myCb = reduceCallbacks(cb, chunksOfIds.length);\n\n    for (l = 0, len = chunksOfIds.length; l < len; l++) {\n      chunkOfIds = chunksOfIds[l];\n      retVal = methodCall(root, \"jobReady\", [chunkOfIds, options], myCb) || retVal;\n    }\n\n    return retVal;\n  };\n\n  Job.cancelJobs = function () {\n    var cb, chunkOfIds, chunksOfIds, ids, k, l, len, myCb, options, ref, retVal, root;\n    root = arguments[0], ids = arguments[1], options = 4 <= arguments.length ? slice.call(arguments, 2, k = arguments.length - 1) : (k = 2, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n\n    if (options.antecedents == null) {\n      options.antecedents = true;\n    }\n\n    retVal = false;\n    chunksOfIds = splitLongArray(ids, 256);\n    myCb = reduceCallbacks(cb, chunksOfIds.length);\n\n    for (l = 0, len = chunksOfIds.length; l < len; l++) {\n      chunkOfIds = chunksOfIds[l];\n      retVal = methodCall(root, \"jobCancel\", [chunkOfIds, options], myCb) || retVal;\n    }\n\n    return retVal;\n  };\n\n  Job.restartJobs = function () {\n    var cb, chunkOfIds, chunksOfIds, ids, k, l, len, myCb, options, ref, retVal, root;\n    root = arguments[0], ids = arguments[1], options = 4 <= arguments.length ? slice.call(arguments, 2, k = arguments.length - 1) : (k = 2, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n\n    if (options.retries == null) {\n      options.retries = 1;\n    }\n\n    if (options.dependents == null) {\n      options.dependents = true;\n    }\n\n    retVal = false;\n    chunksOfIds = splitLongArray(ids, 256);\n    myCb = reduceCallbacks(cb, chunksOfIds.length);\n\n    for (l = 0, len = chunksOfIds.length; l < len; l++) {\n      chunkOfIds = chunksOfIds[l];\n      retVal = methodCall(root, \"jobRestart\", [chunkOfIds, options], myCb) || retVal;\n    }\n\n    return retVal;\n  };\n\n  Job.removeJobs = function () {\n    var cb, chunkOfIds, chunksOfIds, ids, k, l, len, myCb, options, ref, retVal, root;\n    root = arguments[0], ids = arguments[1], options = 4 <= arguments.length ? slice.call(arguments, 2, k = arguments.length - 1) : (k = 2, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    retVal = false;\n    chunksOfIds = splitLongArray(ids, 256);\n    myCb = reduceCallbacks(cb, chunksOfIds.length);\n\n    for (l = 0, len = chunksOfIds.length; l < len; l++) {\n      chunkOfIds = chunksOfIds[l];\n      retVal = methodCall(root, \"jobRemove\", [chunkOfIds, options], myCb) || retVal;\n    }\n\n    return retVal;\n  };\n\n  Job.startJobs = function () {\n    var cb, k, options, ref, root;\n    root = arguments[0], options = 3 <= arguments.length ? slice.call(arguments, 1, k = arguments.length - 1) : (k = 1, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    return methodCall(root, \"startJobs\", [options], cb);\n  };\n\n  Job.stopJobs = function () {\n    var cb, k, options, ref, root;\n    root = arguments[0], options = 3 <= arguments.length ? slice.call(arguments, 1, k = arguments.length - 1) : (k = 1, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n\n    if (options.timeout == null) {\n      options.timeout = 60 * 1000;\n    }\n\n    return methodCall(root, \"stopJobs\", [options], cb);\n  };\n\n  Job.startJobServer = function () {\n    var cb, k, options, ref, root;\n    root = arguments[0], options = 3 <= arguments.length ? slice.call(arguments, 1, k = arguments.length - 1) : (k = 1, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    return methodCall(root, \"startJobServer\", [options], cb);\n  };\n\n  Job.shutdownJobServer = function () {\n    var cb, k, options, ref, root;\n    root = arguments[0], options = 3 <= arguments.length ? slice.call(arguments, 1, k = arguments.length - 1) : (k = 1, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n\n    if (options.timeout == null) {\n      options.timeout = 60 * 1000;\n    }\n\n    return methodCall(root, \"shutdownJobServer\", [options], cb);\n  };\n\n  function Job(rootVal, type, data) {\n    var doc, ref, time;\n\n    if (!(this instanceof Job)) {\n      return new Job(rootVal, type, data);\n    }\n\n    this.root = rootVal;\n    this._root = rootVal;\n\n    if (((ref = this.root) != null ? ref.root : void 0) != null && typeof this.root.root === 'string') {\n      this.root = this._root.root;\n    }\n\n    if (data == null && (type != null ? type.data : void 0) != null && (type != null ? type.type : void 0) != null) {\n      if (type instanceof Job) {\n        return type;\n      }\n\n      doc = type;\n      data = doc.data;\n      type = doc.type;\n    } else {\n      doc = {};\n    }\n\n    if (!((typeof doc === \"undefined\" ? \"undefined\" : _typeof(doc)) === 'object' && (typeof data === \"undefined\" ? \"undefined\" : _typeof(data)) === 'object' && typeof type === 'string' && typeof this.root === 'string')) {\n      throw new Error(\"new Job: bad parameter(s), \" + this.root + \" (\" + _typeof(this.root) + \"), \" + type + \" (\" + (typeof type === \"undefined\" ? \"undefined\" : _typeof(type)) + \"), \" + data + \" (\" + (typeof data === \"undefined\" ? \"undefined\" : _typeof(data)) + \"), \" + doc + \" (\" + (typeof doc === \"undefined\" ? \"undefined\" : _typeof(doc)) + \")\");\n    } else if (doc.type != null && doc.data != null) {\n      this._doc = doc;\n    } else {\n      time = new Date();\n      this._doc = {\n        runId: null,\n        type: type,\n        data: data,\n        status: 'waiting',\n        updated: time,\n        created: time\n      };\n      this.priority().retry().repeat().after().progress().depends().log(\"Constructed\");\n    }\n\n    return this;\n  }\n\n  Job.prototype._echo = function (message, level) {\n    if (level == null) {\n      level = null;\n    }\n\n    switch (level) {\n      case 'danger':\n        console.error(message);\n        break;\n\n      case 'warning':\n        console.warn(message);\n        break;\n\n      case 'success':\n        console.log(message);\n        break;\n\n      default:\n        console.info(message);\n    }\n  };\n\n  Job.prototype.depends = function (jobs) {\n    var depends, j, k, len;\n\n    if (jobs) {\n      if (jobs instanceof Job) {\n        jobs = [jobs];\n      }\n\n      if (jobs instanceof Array) {\n        depends = this._doc.depends;\n\n        for (k = 0, len = jobs.length; k < len; k++) {\n          j = jobs[k];\n\n          if (!(j instanceof Job && j._doc._id != null)) {\n            throw new Error('Each provided object must be a saved Job instance (with an _id)');\n          }\n\n          depends.push(j._doc._id);\n        }\n      } else {\n        throw new Error('Bad input parameter: depends() accepts a falsy value, or Job or array of Jobs');\n      }\n    } else {\n      depends = [];\n    }\n\n    this._doc.depends = depends;\n    this._doc.resolved = [];\n    return this;\n  };\n\n  Job.prototype.priority = function (level) {\n    var priority;\n\n    if (level == null) {\n      level = 0;\n    }\n\n    if (typeof level === 'string') {\n      priority = Job.jobPriorities[level];\n\n      if (priority == null) {\n        throw new Error('Invalid string priority level provided');\n      }\n    } else if (isInteger(level)) {\n      priority = level;\n    } else {\n      throw new Error('priority must be an integer or valid priority level');\n      priority = 0;\n    }\n\n    this._doc.priority = priority;\n    return this;\n  };\n\n  Job.prototype.retry = function (options) {\n    var base, ref;\n\n    if (options == null) {\n      options = 0;\n    }\n\n    if (isInteger(options) && options >= 0) {\n      options = {\n        retries: options\n      };\n    }\n\n    if ((typeof options === \"undefined\" ? \"undefined\" : _typeof(options)) !== 'object') {\n      throw new Error('bad parameter: accepts either an integer >= 0 or an options object');\n    }\n\n    if (options.retries != null) {\n      if (!(isInteger(options.retries) && options.retries >= 0)) {\n        throw new Error('bad option: retries must be an integer >= 0');\n      }\n\n      options.retries++;\n    } else {\n      options.retries = Job.forever;\n    }\n\n    if (options.until != null) {\n      if (!(options.until instanceof Date)) {\n        throw new Error('bad option: until must be a Date object');\n      }\n    } else {\n      options.until = Job.foreverDate;\n    }\n\n    if (options.wait != null) {\n      if (!(isInteger(options.wait) && options.wait >= 0)) {\n        throw new Error('bad option: wait must be an integer >= 0');\n      }\n    } else {\n      options.wait = 5 * 60 * 1000;\n    }\n\n    if (options.backoff != null) {\n      if (ref = options.backoff, indexOf.call(Job.jobRetryBackoffMethods, ref) < 0) {\n        throw new Error('bad option: invalid retry backoff method');\n      }\n    } else {\n      options.backoff = 'constant';\n    }\n\n    this._doc.retries = options.retries;\n    this._doc.repeatRetries = options.retries;\n    this._doc.retryWait = options.wait;\n\n    if ((base = this._doc).retried == null) {\n      base.retried = 0;\n    }\n\n    this._doc.retryBackoff = options.backoff;\n    this._doc.retryUntil = options.until;\n    return this;\n  };\n\n  Job.prototype.repeat = function (options) {\n    var base, ref;\n\n    if (options == null) {\n      options = 0;\n    }\n\n    if (isInteger(options) && options >= 0) {\n      options = {\n        repeats: options\n      };\n    }\n\n    if ((typeof options === \"undefined\" ? \"undefined\" : _typeof(options)) !== 'object') {\n      throw new Error('bad parameter: accepts either an integer >= 0 or an options object');\n    }\n\n    if (options.wait != null && options.schedule != null) {\n      throw new Error('bad options: wait and schedule options are mutually exclusive');\n    }\n\n    if (options.repeats != null) {\n      if (!(isInteger(options.repeats) && options.repeats >= 0)) {\n        throw new Error('bad option: repeats must be an integer >= 0');\n      }\n    } else {\n      options.repeats = Job.forever;\n    }\n\n    if (options.until != null) {\n      if (!(options.until instanceof Date)) {\n        throw new Error('bad option: until must be a Date object');\n      }\n    } else {\n      options.until = Job.foreverDate;\n    }\n\n    if (options.wait != null) {\n      if (!(isInteger(options.wait) && options.wait >= 0)) {\n        throw new Error('bad option: wait must be an integer >= 0');\n      }\n    } else {\n      options.wait = 5 * 60 * 1000;\n    }\n\n    if (options.schedule != null) {\n      if (_typeof(options.schedule) !== 'object') {\n        throw new Error('bad option, schedule option must be an object');\n      }\n\n      if (!(((ref = options.schedule) != null ? ref.schedules : void 0) != null && options.schedule.schedules instanceof Array)) {\n        throw new Error('bad option, schedule object requires a schedules attribute of type Array.');\n      }\n\n      if (options.schedule.exceptions != null && !(options.schedule.exceptions instanceof Array)) {\n        throw new Error('bad option, schedule object exceptions attribute must be an Array');\n      }\n\n      options.wait = {\n        schedules: options.schedule.schedules,\n        exceptions: options.schedule.exceptions\n      };\n    }\n\n    this._doc.repeats = options.repeats;\n    this._doc.repeatWait = options.wait;\n\n    if ((base = this._doc).repeated == null) {\n      base.repeated = 0;\n    }\n\n    this._doc.repeatUntil = options.until;\n    return this;\n  };\n\n  Job.prototype.delay = function (wait) {\n    if (wait == null) {\n      wait = 0;\n    }\n\n    if (!(isInteger(wait) && wait >= 0)) {\n      throw new Error('Bad parameter, delay requires a non-negative integer.');\n    }\n\n    return this.after(new Date(new Date().valueOf() + wait));\n  };\n\n  Job.prototype.after = function (time) {\n    var after;\n\n    if (time == null) {\n      time = new Date(0);\n    }\n\n    if ((typeof time === \"undefined\" ? \"undefined\" : _typeof(time)) === 'object' && time instanceof Date) {\n      after = time;\n    } else {\n      throw new Error('Bad parameter, after requires a valid Date object');\n    }\n\n    this._doc.after = after;\n    return this;\n  };\n\n  Job.prototype.log = function () {\n    var base, cb, k, message, options, ref, ref1;\n    message = arguments[0], options = 3 <= arguments.length ? slice.call(arguments, 1, k = arguments.length - 1) : (k = 1, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n\n    if (options.level == null) {\n      options.level = 'info';\n    }\n\n    if (typeof message !== 'string') {\n      throw new Error('Log message must be a string');\n    }\n\n    if (!(typeof options.level === 'string' && (ref1 = options.level, indexOf.call(Job.jobLogLevels, ref1) >= 0))) {\n      throw new Error('Log level options must be one of Job.jobLogLevels');\n    }\n\n    if (options.echo != null) {\n      if (options.echo && Job.jobLogLevels.indexOf(options.level) >= Job.jobLogLevels.indexOf(options.echo)) {\n        this._echo(\"LOG: \" + options.level + \", \" + this._doc._id + \" \" + this._doc.runId + \": \" + message, options.level);\n      }\n\n      delete options.echo;\n    }\n\n    if (this._doc._id != null) {\n      return methodCall(this._root, \"jobLog\", [this._doc._id, this._doc.runId, message, options], cb);\n    } else {\n      if ((base = this._doc).log == null) {\n        base.log = [];\n      }\n\n      this._doc.log.push({\n        time: new Date(),\n        runId: null,\n        level: options.level,\n        message: message\n      });\n\n      if (cb != null && typeof cb === 'function') {\n        _setImmediate(cb, null, true);\n      }\n\n      return this;\n    }\n  };\n\n  Job.prototype.progress = function () {\n    var cb, completed, k, options, progress, ref, total;\n    completed = arguments[0], total = arguments[1], options = 4 <= arguments.length ? slice.call(arguments, 2, k = arguments.length - 1) : (k = 2, []), cb = arguments[k++];\n\n    if (completed == null) {\n      completed = 0;\n    }\n\n    if (total == null) {\n      total = 1;\n    }\n\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n\n    if (typeof completed === 'number' && typeof total === 'number' && completed >= 0 && total > 0 && total >= completed) {\n      progress = {\n        completed: completed,\n        total: total,\n        percent: 100 * completed / total\n      };\n\n      if (options.echo) {\n        delete options.echo;\n\n        this._echo(\"PROGRESS: \" + this._doc._id + \" \" + this._doc.runId + \": \" + progress.completed + \" out of \" + progress.total + \" (\" + progress.percent + \"%)\");\n      }\n\n      if (this._doc._id != null && this._doc.runId != null) {\n        return methodCall(this._root, \"jobProgress\", [this._doc._id, this._doc.runId, completed, total, options], cb, function (_this) {\n          return function (res) {\n            if (res) {\n              _this._doc.progress = progress;\n            }\n\n            return res;\n          };\n        }(this));\n      } else if (this._doc._id == null) {\n        this._doc.progress = progress;\n\n        if (cb != null && typeof cb === 'function') {\n          _setImmediate(cb, null, true);\n        }\n\n        return this;\n      }\n    } else {\n      throw new Error(\"job.progress: something is wrong with progress params: \" + this.id + \", \" + completed + \" out of \" + total);\n    }\n\n    return null;\n  };\n\n  Job.prototype.save = function () {\n    var cb, k, options, ref;\n    options = 2 <= arguments.length ? slice.call(arguments, 0, k = arguments.length - 1) : (k = 0, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    return methodCall(this._root, \"jobSave\", [this._doc, options], cb, function (_this) {\n      return function (id) {\n        if (id) {\n          _this._doc._id = id;\n        }\n\n        return id;\n      };\n    }(this));\n  };\n\n  Job.prototype.refresh = function () {\n    var cb, k, options, ref;\n    options = 2 <= arguments.length ? slice.call(arguments, 0, k = arguments.length - 1) : (k = 0, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n\n    if (options.getLog == null) {\n      options.getLog = false;\n    }\n\n    if (this._doc._id != null) {\n      return methodCall(this._root, \"getJob\", [this._doc._id, options], cb, function (_this) {\n        return function (doc) {\n          if (doc != null) {\n            _this._doc = doc;\n            return _this;\n          } else {\n            return false;\n          }\n        };\n      }(this));\n    } else {\n      throw new Error(\"Can't call .refresh() on an unsaved job\");\n    }\n  };\n\n  Job.prototype.done = function () {\n    var cb, k, options, ref, result;\n    result = arguments[0], options = 3 <= arguments.length ? slice.call(arguments, 1, k = arguments.length - 1) : (k = 1, []), cb = arguments[k++];\n\n    if (result == null) {\n      result = {};\n    }\n\n    if (typeof result === 'function') {\n      cb = result;\n      result = {};\n    }\n\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n\n    if (!(result != null && (typeof result === \"undefined\" ? \"undefined\" : _typeof(result)) === 'object')) {\n      result = {\n        value: result\n      };\n    }\n\n    if (this._doc._id != null && this._doc.runId != null) {\n      return methodCall(this._root, \"jobDone\", [this._doc._id, this._doc.runId, result, options], cb);\n    } else {\n      throw new Error(\"Can't call .done() on an unsaved or non-running job\");\n    }\n\n    return null;\n  };\n\n  Job.prototype.fail = function () {\n    var cb, k, options, ref, result;\n    result = arguments[0], options = 3 <= arguments.length ? slice.call(arguments, 1, k = arguments.length - 1) : (k = 1, []), cb = arguments[k++];\n\n    if (result == null) {\n      result = \"No error information provided\";\n    }\n\n    if (typeof result === 'function') {\n      cb = result;\n      result = \"No error information provided\";\n    }\n\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n\n    if (!(result != null && (typeof result === \"undefined\" ? \"undefined\" : _typeof(result)) === 'object')) {\n      result = {\n        value: result\n      };\n    }\n\n    if (options.fatal == null) {\n      options.fatal = false;\n    }\n\n    if (this._doc._id != null && this._doc.runId != null) {\n      return methodCall(this._root, \"jobFail\", [this._doc._id, this._doc.runId, result, options], cb);\n    } else {\n      throw new Error(\"Can't call .fail() on an unsaved or non-running job\");\n    }\n\n    return null;\n  };\n\n  Job.prototype.pause = function () {\n    var cb, k, options, ref;\n    options = 2 <= arguments.length ? slice.call(arguments, 0, k = arguments.length - 1) : (k = 0, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n\n    if (this._doc._id != null) {\n      return methodCall(this._root, \"jobPause\", [this._doc._id, options], cb);\n    } else {\n      this._doc.status = 'paused';\n\n      if (cb != null && typeof cb === 'function') {\n        _setImmediate(cb, null, true);\n      }\n\n      return this;\n    }\n\n    return null;\n  };\n\n  Job.prototype.resume = function () {\n    var cb, k, options, ref;\n    options = 2 <= arguments.length ? slice.call(arguments, 0, k = arguments.length - 1) : (k = 0, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n\n    if (this._doc._id != null) {\n      return methodCall(this._root, \"jobResume\", [this._doc._id, options], cb);\n    } else {\n      this._doc.status = 'waiting';\n\n      if (cb != null && typeof cb === 'function') {\n        _setImmediate(cb, null, true);\n      }\n\n      return this;\n    }\n\n    return null;\n  };\n\n  Job.prototype.ready = function () {\n    var cb, k, options, ref;\n    options = 2 <= arguments.length ? slice.call(arguments, 0, k = arguments.length - 1) : (k = 0, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n\n    if (options.force == null) {\n      options.force = false;\n    }\n\n    if (this._doc._id != null) {\n      return methodCall(this._root, \"jobReady\", [this._doc._id, options], cb);\n    } else {\n      throw new Error(\"Can't call .ready() on an unsaved job\");\n    }\n\n    return null;\n  };\n\n  Job.prototype.cancel = function () {\n    var cb, k, options, ref;\n    options = 2 <= arguments.length ? slice.call(arguments, 0, k = arguments.length - 1) : (k = 0, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n\n    if (options.antecedents == null) {\n      options.antecedents = true;\n    }\n\n    if (this._doc._id != null) {\n      return methodCall(this._root, \"jobCancel\", [this._doc._id, options], cb);\n    } else {\n      throw new Error(\"Can't call .cancel() on an unsaved job\");\n    }\n\n    return null;\n  };\n\n  Job.prototype.restart = function () {\n    var cb, k, options, ref;\n    options = 2 <= arguments.length ? slice.call(arguments, 0, k = arguments.length - 1) : (k = 0, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n\n    if (options.retries == null) {\n      options.retries = 1;\n    }\n\n    if (options.dependents == null) {\n      options.dependents = true;\n    }\n\n    if (this._doc._id != null) {\n      return methodCall(this._root, \"jobRestart\", [this._doc._id, options], cb);\n    } else {\n      throw new Error(\"Can't call .restart() on an unsaved job\");\n    }\n\n    return null;\n  };\n\n  Job.prototype.rerun = function () {\n    var cb, k, options, ref;\n    options = 2 <= arguments.length ? slice.call(arguments, 0, k = arguments.length - 1) : (k = 0, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n\n    if (options.repeats == null) {\n      options.repeats = 0;\n    }\n\n    if (options.wait == null) {\n      options.wait = this._doc.repeatWait;\n    }\n\n    if (this._doc._id != null) {\n      return methodCall(this._root, \"jobRerun\", [this._doc._id, options], cb);\n    } else {\n      throw new Error(\"Can't call .rerun() on an unsaved job\");\n    }\n\n    return null;\n  };\n\n  Job.prototype.remove = function () {\n    var cb, k, options, ref;\n    options = 2 <= arguments.length ? slice.call(arguments, 0, k = arguments.length - 1) : (k = 0, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n\n    if (this._doc._id != null) {\n      return methodCall(this._root, \"jobRemove\", [this._doc._id, options], cb);\n    } else {\n      throw new Error(\"Can't call .remove() on an unsaved job\");\n    }\n\n    return null;\n  };\n\n  Object.defineProperties(Job.prototype, {\n    doc: {\n      get: function () {\n        return this._doc;\n      },\n      set: function () {\n        return console.warn(\"Job.doc cannot be directly assigned.\");\n      }\n    },\n    type: {\n      get: function () {\n        return this._doc.type;\n      },\n      set: function () {\n        return console.warn(\"Job.type cannot be directly assigned.\");\n      }\n    },\n    data: {\n      get: function () {\n        return this._doc.data;\n      },\n      set: function () {\n        return console.warn(\"Job.data cannot be directly assigned.\");\n      }\n    }\n  });\n  return Job;\n}();\n\nif ((typeof module !== \"undefined\" && module !== null ? module.exports : void 0) != null) {\n  module.exports = Job;\n}","map":{"version":3,"sources":["packages/vsivsi:job-collection/job/src/job_class.coffee"],"names":["JobQueue","_clearInterval","_setImmediate","_setInterval","concatReduce","isBoolean","isFunction","isInteger","isNonEmptyString","isNonEmptyStringOrArrayOfNonEmptyStrings","methodCall","optionsHelp","reduceCallbacks","splitLongArray","slice","indexOf","item","i","l","length","root","method","params","cb","after","apply","name","ref","ref1","ref2","ref3","ret","Job","_ddp_apply","Error","_this","err","res","options","Array","arr","max","k","results","Math","ceil","push","num","reduce","init","cbCount","cbErr","cbRetVal","a","b","concat","floor","f","s","sa","len","args","func","arguments","call","Meteor","setTimeout","setImmediate","timeOut","setInterval","id","clearInterval","ref4","root1","type1","worker","type","ctor","prototype","child","result","Object","errorCallback","e","console","error","pollInterval","forever","concurrency","payload","prefetch","workTimeout","callbackStrict","_workers","_tasks","_taskNumber","_stoppingGetWork","_stoppingTasks","_interval","_getWorkOutstanding","paused","resume","_getWork","numJobsToGet","running","maxJobs","getWork","jobs","j","_process","bind","_only_once","fn","called","job","next","splice","shift","_taskId","_stopGetWork","callback","_waitForTasks","_failJobs","tasks","count","fail","_hard","r","_stop","_soft","keys","idle","full","pause","w","trigger","shutdown","level","quiet","warn","foreverDate","Date","jobPriorities","low","normal","medium","high","critical","jobRetryBackoffMethods","jobStatuses","jobLogLevels","jobStatusCancellable","jobStatusPausable","jobStatusRemovable","jobStatusRestartable","ddpMethods","ddpPermissionLevels","ddpMethodPermissions","_setDDPApply","collectionName","setDDP","ddp","collectionNames","Fiber","collName","close","subscribe","observe","fib","current","throwInto","run","doc","processJobs","makeJob","depFlag","getJob","getLog","getJobs","chunkOfIds","chunksOfIds","ids","myCb","retVal","d","len1","m","data","pauseJobs","resumeJobs","readyJobs","force","cancelJobs","antecedents","restartJobs","retries","dependents","removeJobs","startJobs","stopJobs","timeout","startJobServer","shutdownJobServer","rootVal","time","_root","_doc","runId","status","updated","created","priority","retry","repeat","progress","depends","log","_echo","message","info","_id","resolved","base","until","wait","backoff","repeatRetries","retryWait","retried","retryBackoff","retryUntil","repeats","schedule","schedules","exceptions","repeatWait","repeated","repeatUntil","delay","valueOf","echo","completed","total","percent","save","refresh","done","value","fatal","ready","cancel","restart","rerun","remove","defineProperties","get","set","module","exports"],"mappings":"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","file":"packages/vsivsi:job-collection/job/src/job_class.coffee.map","sourcesContent":["var JobQueue, _clearInterval, _setImmediate, _setInterval, concatReduce, isBoolean, isFunction, isInteger, isNonEmptyString, isNonEmptyStringOrArrayOfNonEmptyStrings, methodCall, optionsHelp, reduceCallbacks, splitLongArray,     \n  slice = [].slice,\n  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\nmethodCall = function(root, method, params, cb, after) {\n  var apply, name, ref, ref1, ref2, ref3;\n  if (after == null) {\n    after = (function(ret) {\n      return ret;\n    });\n  }\n  apply = (ref = (ref1 = Job._ddp_apply) != null ? ref1[(ref2 = root.root) != null ? ref2 : root] : void 0) != null ? ref : Job._ddp_apply;\n  if (typeof apply !== 'function') {\n    throw new Error(\"Job remote method call error, no valid invocation method found.\");\n  }\n  name = ((ref3 = root.root) != null ? ref3 : root) + \"_\" + method;\n  if (cb && typeof cb === 'function') {\n    return apply(name, params, (function(_this) {\n      return function(err, res) {\n        if (err) {\n          return cb(err);\n        }\n        return cb(null, after(res));\n      };\n    })(this));\n  } else {\n    return after(apply(name, params));\n  }\n};\n\noptionsHelp = function(options, cb) {\n  var ref;\n  if ((cb != null) && typeof cb !== 'function') {\n    options = cb;\n    cb = void 0;\n  } else {\n    if (!(typeof options === 'object' && options instanceof Array && options.length < 2)) {\n      throw new Error('options... in optionsHelp must be an Array with zero or one elements');\n    }\n    options = (ref = options != null ? options[0] : void 0) != null ? ref : {};\n  }\n  if (typeof options !== 'object') {\n    throw new Error('in optionsHelp options not an object or bad callback');\n  }\n  return [options, cb];\n};\n\nsplitLongArray = function(arr, max) {\n  var i, k, ref, results;\n  if (!(arr instanceof Array && max > 0)) {\n    throw new Error('splitLongArray: bad params');\n  }\n  results = [];\n  for (i = k = 0, ref = Math.ceil(arr.length / max); 0 <= ref ? k < ref : k > ref; i = 0 <= ref ? ++k : --k) {\n    results.push(arr.slice(i * max, (i + 1) * max));\n  }\n  return results;\n};\n\nreduceCallbacks = function(cb, num, reduce, init) {\n  var cbCount, cbErr, cbRetVal;\n  if (reduce == null) {\n    reduce = (function(a, b) {\n      return a || b;\n    });\n  }\n  if (init == null) {\n    init = false;\n  }\n  if (cb == null) {\n    return void 0;\n  }\n  if (!(typeof cb === 'function' && num > 0 && typeof reduce === 'function')) {\n    throw new Error('Bad params given to reduceCallbacks');\n  }\n  cbRetVal = init;\n  cbCount = 0;\n  cbErr = null;\n  return function(err, res) {\n    if (!cbErr) {\n      if (err) {\n        cbErr = err;\n        return cb(err);\n      } else {\n        cbCount++;\n        cbRetVal = reduce(cbRetVal, res);\n        if (cbCount === num) {\n          return cb(null, cbRetVal);\n        } else if (cbCount > num) {\n          throw new Error(\"reduceCallbacks callback invoked more than requested \" + num + \" times\");\n        }\n      }\n    }\n  };\n};\n\nconcatReduce = function(a, b) {\n  if (!(a instanceof Array)) {\n    a = [a];\n  }\n  return a.concat(b);\n};\n\nisInteger = function(i) {\n  return typeof i === 'number' && Math.floor(i) === i;\n};\n\nisBoolean = function(b) {\n  return typeof b === 'boolean';\n};\n\nisFunction = function(f) {\n  return typeof f === 'function';\n};\n\nisNonEmptyString = function(s) {\n  return typeof s === 'string' && s.length > 0;\n};\n\nisNonEmptyStringOrArrayOfNonEmptyStrings = function(sa) {\n  var s;\n  return isNonEmptyString(sa) || sa instanceof Array && sa.length !== 0 && ((function() {\n    var k, len, results;\n    results = [];\n    for (k = 0, len = sa.length; k < len; k++) {\n      s = sa[k];\n      if (isNonEmptyString(s)) {\n        results.push(s);\n      }\n    }\n    return results;\n  })()).length === sa.length;\n};\n\n_setImmediate = function() {\n  var args, func;\n  func = arguments[0], args = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n  if ((typeof Meteor !== \"undefined\" && Meteor !== null ? Meteor.setTimeout : void 0) != null) {\n    return Meteor.setTimeout.apply(Meteor, [func, 0].concat(slice.call(args)));\n  } else if (typeof setImmediate !== \"undefined\" && setImmediate !== null) {\n    return setImmediate.apply(null, [func].concat(slice.call(args)));\n  } else {\n    return setTimeout.apply(null, [func, 0].concat(slice.call(args)));\n  }\n};\n\n_setInterval = function() {\n  var args, func, timeOut;\n  func = arguments[0], timeOut = arguments[1], args = 3 <= arguments.length ? slice.call(arguments, 2) : [];\n  if ((typeof Meteor !== \"undefined\" && Meteor !== null ? Meteor.setInterval : void 0) != null) {\n    return Meteor.setInterval.apply(Meteor, [func, timeOut].concat(slice.call(args)));\n  } else {\n    return setInterval.apply(null, [func, timeOut].concat(slice.call(args)));\n  }\n};\n\n_clearInterval = function(id) {\n  if ((typeof Meteor !== \"undefined\" && Meteor !== null ? Meteor.clearInterval : void 0) != null) {\n    return Meteor.clearInterval(id);\n  } else {\n    return clearInterval(id);\n  }\n};\n\nJobQueue = (function() {\n  function JobQueue() {\n    var k, options, ref, ref1, ref2, ref3, ref4, root1, type1, worker;\n    root1 = arguments[0], type1 = arguments[1], options = 4 <= arguments.length ? slice.call(arguments, 2, k = arguments.length - 1) : (k = 2, []), worker = arguments[k++];\n    this.root = root1;\n    this.type = type1;\n    this.worker = worker;\n    if (!(this instanceof JobQueue)) {\n      return (function(func, args, ctor) {\n        ctor.prototype = func.prototype;\n        var child = new ctor, result = func.apply(child, args);\n        return Object(result) === result ? result : child;\n      })(JobQueue, [this.root, this.type].concat(slice.call(options), [this.worker]), function(){});\n    }\n    ref = optionsHelp(options, this.worker), options = ref[0], this.worker = ref[1];\n    if (!isNonEmptyString(this.root)) {\n      throw new Error(\"JobQueue: Invalid root, must be nonempty string\");\n    }\n    if (!isNonEmptyStringOrArrayOfNonEmptyStrings(this.type)) {\n      throw new Error(\"JobQueue: Invalid type, must be nonempty string or array of nonempty strings\");\n    }\n    if (!isFunction(this.worker)) {\n      throw new Error(\"JobQueue: Invalid worker, must be a function\");\n    }\n    this.errorCallback = (ref1 = options.errorCallback) != null ? ref1 : function(e) {\n      return console.error(\"JobQueue: \", e);\n    };\n    if (!isFunction(this.errorCallback)) {\n      throw new Error(\"JobQueue: Invalid errorCallback, must be a function\");\n    }\n    this.pollInterval = (options.pollInterval != null) && !options.pollInterval ? Job.forever : !((options.pollInterval != null) && isInteger(options.pollInterval)) ? 5000 : options.pollInterval;\n    if (!(isInteger(this.pollInterval) && this.pollInterval >= 0)) {\n      throw new Error(\"JobQueue: Invalid pollInterval, must be a positive integer\");\n    }\n    this.concurrency = (ref2 = options.concurrency) != null ? ref2 : 1;\n    if (!(isInteger(this.concurrency) && this.concurrency >= 0)) {\n      throw new Error(\"JobQueue: Invalid concurrency, must be a positive integer\");\n    }\n    this.payload = (ref3 = options.payload) != null ? ref3 : 1;\n    if (!(isInteger(this.payload) && this.payload >= 0)) {\n      throw new Error(\"JobQueue: Invalid payload, must be a positive integer\");\n    }\n    this.prefetch = (ref4 = options.prefetch) != null ? ref4 : 0;\n    if (!(isInteger(this.prefetch) && this.prefetch >= 0)) {\n      throw new Error(\"JobQueue: Invalid prefetch, must be a positive integer\");\n    }\n    this.workTimeout = options.workTimeout;\n    if ((this.workTimeout != null) && !(isInteger(this.workTimeout) && this.workTimeout >= 0)) {\n      throw new Error(\"JobQueue: Invalid workTimeout, must be a positive integer\");\n    }\n    this.callbackStrict = options.callbackStrict;\n    if ((this.callbackStrict != null) && !isBoolean(this.callbackStrict)) {\n      throw new Error(\"JobQueue: Invalid callbackStrict, must be a boolean\");\n    }\n    this._workers = {};\n    this._tasks = [];\n    this._taskNumber = 0;\n    this._stoppingGetWork = void 0;\n    this._stoppingTasks = void 0;\n    this._interval = null;\n    this._getWorkOutstanding = false;\n    this.paused = true;\n    this.resume();\n  }\n\n  JobQueue.prototype._getWork = function() {\n    var numJobsToGet, options;\n    if (!(this._getWorkOutstanding || this.paused)) {\n      numJobsToGet = this.prefetch + this.payload * (this.concurrency - this.running()) - this.length();\n      if (numJobsToGet > 0) {\n        this._getWorkOutstanding = true;\n        options = {\n          maxJobs: numJobsToGet\n        };\n        if (this.workTimeout != null) {\n          options.workTimeout = this.workTimeout;\n        }\n        return Job.getWork(this.root, this.type, options, (function(_this) {\n          return function(err, jobs) {\n            var j, k, len;\n            _this._getWorkOutstanding = false;\n            if (err) {\n              return _this.errorCallback(new Error(\"Received error from getWork(): \" + err));\n            } else if ((jobs != null) && jobs instanceof Array) {\n              if (jobs.length > numJobsToGet) {\n                _this.errorCallback(new Error(\"getWork() returned jobs (\" + jobs.length + \") in excess of maxJobs (\" + numJobsToGet + \")\"));\n              }\n              for (k = 0, len = jobs.length; k < len; k++) {\n                j = jobs[k];\n                _this._tasks.push(j);\n                if (_this._stoppingGetWork == null) {\n                  _setImmediate(_this._process.bind(_this));\n                }\n              }\n              if (_this._stoppingGetWork != null) {\n                return _this._stoppingGetWork();\n              }\n            } else {\n              return _this.errorCallback(new Error(\"Nonarray response from server from getWork()\"));\n            }\n          };\n        })(this));\n      }\n    }\n  };\n\n  JobQueue.prototype._only_once = function(fn) {\n    var called;\n    called = false;\n    return (function(_this) {\n      return function() {\n        if (called) {\n          _this.errorCallback(new Error(\"Worker callback called multiple times\"));\n          if (_this.callbackStrict) {\n            throw new Error(\"JobQueue: worker callback was invoked multiple times\");\n          }\n        }\n        called = true;\n        return fn.apply(_this, arguments);\n      };\n    })(this);\n  };\n\n  JobQueue.prototype._process = function() {\n    var cb, job, next;\n    if (!this.paused && this.running() < this.concurrency && this.length()) {\n      if (this.payload > 1) {\n        job = this._tasks.splice(0, this.payload);\n      } else {\n        job = this._tasks.shift();\n      }\n      job._taskId = \"Task_\" + (this._taskNumber++);\n      this._workers[job._taskId] = job;\n      next = (function(_this) {\n        return function() {\n          delete _this._workers[job._taskId];\n          if ((_this._stoppingTasks != null) && _this.running() === 0 && _this.length() === 0) {\n            return _this._stoppingTasks();\n          } else {\n            _setImmediate(_this._process.bind(_this));\n            return _setImmediate(_this._getWork.bind(_this));\n          }\n        };\n      })(this);\n      cb = this._only_once(next);\n      return this.worker(job, cb);\n    }\n  };\n\n  JobQueue.prototype._stopGetWork = function(callback) {\n    _clearInterval(this._interval);\n    this._interval = null;\n    if (this._getWorkOutstanding) {\n      return this._stoppingGetWork = callback;\n    } else {\n      return _setImmediate(callback);\n    }\n  };\n\n  JobQueue.prototype._waitForTasks = function(callback) {\n    if (this.running() !== 0) {\n      return this._stoppingTasks = callback;\n    } else {\n      return _setImmediate(callback);\n    }\n  };\n\n  JobQueue.prototype._failJobs = function(tasks, callback) {\n    var count, job, k, len, results;\n    if (tasks.length === 0) {\n      _setImmediate(callback);\n    }\n    count = 0;\n    results = [];\n    for (k = 0, len = tasks.length; k < len; k++) {\n      job = tasks[k];\n      results.push(job.fail(\"Worker shutdown\", (function(_this) {\n        return function(err, res) {\n          count++;\n          if (count === tasks.length) {\n            return callback();\n          }\n        };\n      })(this)));\n    }\n    return results;\n  };\n\n  JobQueue.prototype._hard = function(callback) {\n    this.paused = true;\n    return this._stopGetWork((function(_this) {\n      return function() {\n        var i, r, ref, tasks;\n        tasks = _this._tasks;\n        _this._tasks = [];\n        ref = _this._workers;\n        for (i in ref) {\n          r = ref[i];\n          tasks = tasks.concat(r);\n        }\n        return _this._failJobs(tasks, callback);\n      };\n    })(this));\n  };\n\n  JobQueue.prototype._stop = function(callback) {\n    this.paused = true;\n    return this._stopGetWork((function(_this) {\n      return function() {\n        var tasks;\n        tasks = _this._tasks;\n        _this._tasks = [];\n        return _this._waitForTasks(function() {\n          return _this._failJobs(tasks, callback);\n        });\n      };\n    })(this));\n  };\n\n  JobQueue.prototype._soft = function(callback) {\n    return this._stopGetWork((function(_this) {\n      return function() {\n        return _this._waitForTasks(callback);\n      };\n    })(this));\n  };\n\n  JobQueue.prototype.length = function() {\n    return this._tasks.length;\n  };\n\n  JobQueue.prototype.running = function() {\n    return Object.keys(this._workers).length;\n  };\n\n  JobQueue.prototype.idle = function() {\n    return this.length() + this.running() === 0;\n  };\n\n  JobQueue.prototype.full = function() {\n    return this.running() === this.concurrency;\n  };\n\n  JobQueue.prototype.pause = function() {\n    if (this.paused) {\n      return;\n    }\n    if (!(this.pollInterval >= Job.forever)) {\n      _clearInterval(this._interval);\n      this._interval = null;\n    }\n    this.paused = true;\n    return this;\n  };\n\n  JobQueue.prototype.resume = function() {\n    var k, ref, w;\n    if (!this.paused) {\n      return;\n    }\n    this.paused = false;\n    _setImmediate(this._getWork.bind(this));\n    if (!(this.pollInterval >= Job.forever)) {\n      this._interval = _setInterval(this._getWork.bind(this), this.pollInterval);\n    }\n    for (w = k = 1, ref = this.concurrency; 1 <= ref ? k <= ref : k >= ref; w = 1 <= ref ? ++k : --k) {\n      _setImmediate(this._process.bind(this));\n    }\n    return this;\n  };\n\n  JobQueue.prototype.trigger = function() {\n    if (this.paused) {\n      return;\n    }\n    _setImmediate(this._getWork.bind(this));\n    return this;\n  };\n\n  JobQueue.prototype.shutdown = function() {\n    var cb, k, options, ref;\n    options = 2 <= arguments.length ? slice.call(arguments, 0, k = arguments.length - 1) : (k = 0, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    if (options.level == null) {\n      options.level = 'normal';\n    }\n    if (options.quiet == null) {\n      options.quiet = false;\n    }\n    if (cb == null) {\n      if (!options.quiet) {\n        console.warn(\"using default shutdown callback!\");\n      }\n      cb = (function(_this) {\n        return function() {\n          return console.warn(\"Shutdown complete\");\n        };\n      })(this);\n    }\n    switch (options.level) {\n      case 'hard':\n        if (!options.quiet) {\n          console.warn(\"Shutting down hard\");\n        }\n        return this._hard(cb);\n      case 'soft':\n        if (!options.quiet) {\n          console.warn(\"Shutting down soft\");\n        }\n        return this._soft(cb);\n      default:\n        if (!options.quiet) {\n          console.warn(\"Shutting down normally\");\n        }\n        return this._stop(cb);\n    }\n  };\n\n  return JobQueue;\n\n})();\n\nJob = (function() {\n  Job.forever = 9007199254740992;\n\n  Job.foreverDate = new Date(8640000000000000);\n\n  Job.jobPriorities = {\n    low: 10,\n    normal: 0,\n    medium: -5,\n    high: -10,\n    critical: -15\n  };\n\n  Job.jobRetryBackoffMethods = ['constant', 'exponential'];\n\n  Job.jobStatuses = ['waiting', 'paused', 'ready', 'running', 'failed', 'cancelled', 'completed'];\n\n  Job.jobLogLevels = ['info', 'success', 'warning', 'danger'];\n\n  Job.jobStatusCancellable = ['running', 'ready', 'waiting', 'paused'];\n\n  Job.jobStatusPausable = ['ready', 'waiting'];\n\n  Job.jobStatusRemovable = ['cancelled', 'completed', 'failed'];\n\n  Job.jobStatusRestartable = ['cancelled', 'failed'];\n\n  Job.ddpMethods = ['startJobs', 'stopJobs', 'startJobServer', 'shutdownJobServer', 'jobRemove', 'jobPause', 'jobResume', 'jobReady', 'jobCancel', 'jobRestart', 'jobSave', 'jobRerun', 'getWork', 'getJob', 'jobLog', 'jobProgress', 'jobDone', 'jobFail'];\n\n  Job.ddpPermissionLevels = ['admin', 'manager', 'creator', 'worker'];\n\n  Job.ddpMethodPermissions = {\n    'startJobs': ['startJobs', 'admin'],\n    'stopJobs': ['stopJobs', 'admin'],\n    'startJobServer': ['startJobServer', 'admin'],\n    'shutdownJobServer': ['shutdownJobServer', 'admin'],\n    'jobRemove': ['jobRemove', 'admin', 'manager'],\n    'jobPause': ['jobPause', 'admin', 'manager'],\n    'jobResume': ['jobResume', 'admin', 'manager'],\n    'jobCancel': ['jobCancel', 'admin', 'manager'],\n    'jobReady': ['jobReady', 'admin', 'manager'],\n    'jobRestart': ['jobRestart', 'admin', 'manager'],\n    'jobSave': ['jobSave', 'admin', 'creator'],\n    'jobRerun': ['jobRerun', 'admin', 'creator'],\n    'getWork': ['getWork', 'admin', 'worker'],\n    'getJob': ['getJob', 'admin', 'worker'],\n    'jobLog': ['jobLog', 'admin', 'worker'],\n    'jobProgress': ['jobProgress', 'admin', 'worker'],\n    'jobDone': ['jobDone', 'admin', 'worker'],\n    'jobFail': ['jobFail', 'admin', 'worker']\n  };\n\n  Job._ddp_apply = void 0;\n\n  Job._setDDPApply = function(apply, collectionName) {\n    if (typeof apply === 'function') {\n      if (typeof collectionName === 'string') {\n        if (this._ddp_apply == null) {\n          this._ddp_apply = {};\n        }\n        if (typeof this._ddp_apply === 'function') {\n          throw new Error(\"Job.setDDP must specify a collection name each time if called more than once.\");\n        }\n        return this._ddp_apply[collectionName] = apply;\n      } else if (!this._ddp_apply) {\n        return this._ddp_apply = apply;\n      } else {\n        throw new Error(\"Job.setDDP must specify a collection name each time if called more than once.\");\n      }\n    } else {\n      throw new Error(\"Bad function in Job.setDDPApply()\");\n    }\n  };\n\n  Job.setDDP = function(ddp, collectionNames, Fiber) {\n    var collName, k, len, results;\n    if (ddp == null) {\n      ddp = null;\n    }\n    if (collectionNames == null) {\n      collectionNames = null;\n    }\n    if (Fiber == null) {\n      Fiber = null;\n    }\n    if (!((typeof collectionNames === 'string') || (collectionNames instanceof Array))) {\n      Fiber = collectionNames;\n      collectionNames = [void 0];\n    } else if (typeof collectionNames === 'string') {\n      collectionNames = [collectionNames];\n    }\n    results = [];\n    for (k = 0, len = collectionNames.length; k < len; k++) {\n      collName = collectionNames[k];\n      if (!((ddp != null) && (ddp.close != null) && (ddp.subscribe != null))) {\n        if (ddp === null && ((typeof Meteor !== \"undefined\" && Meteor !== null ? Meteor.apply : void 0) != null)) {\n          results.push(this._setDDPApply(Meteor.apply, collName));\n        } else {\n          throw new Error(\"Bad ddp object in Job.setDDP()\");\n        }\n      } else if (ddp.observe == null) {\n        results.push(this._setDDPApply(ddp.apply.bind(ddp), collName));\n      } else {\n        if (Fiber == null) {\n          results.push(this._setDDPApply(ddp.call.bind(ddp), collName));\n        } else {\n          results.push(this._setDDPApply((function(name, params, cb) {\n            var fib;\n            fib = Fiber.current;\n            ddp.call(name, params, function(err, res) {\n              if ((cb != null) && typeof cb === 'function') {\n                return cb(err, res);\n              } else {\n                if (err) {\n                  return fib.throwInto(err);\n                } else {\n                  return fib.run(res);\n                }\n              }\n            });\n            if ((cb != null) && typeof cb === 'function') {\n\n            } else {\n              return Fiber[\"yield\"]();\n            }\n          }), collName));\n        }\n      }\n    }\n    return results;\n  };\n\n  Job.getWork = function() {\n    var cb, k, options, ref, root, type;\n    root = arguments[0], type = arguments[1], options = 4 <= arguments.length ? slice.call(arguments, 2, k = arguments.length - 1) : (k = 2, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    if (typeof type === 'string') {\n      type = [type];\n    }\n    if (options.workTimeout != null) {\n      if (!(isInteger(options.workTimeout) && options.workTimeout > 0)) {\n        throw new Error('getWork: workTimeout must be a positive integer');\n      }\n    }\n    return methodCall(root, \"getWork\", [type, options], cb, (function(_this) {\n      return function(res) {\n        var doc, jobs;\n        jobs = ((function() {\n          var l, len, results;\n          results = [];\n          for (l = 0, len = res.length; l < len; l++) {\n            doc = res[l];\n            results.push(new Job(root, doc));\n          }\n          return results;\n        })()) || [];\n        if (options.maxJobs != null) {\n          return jobs;\n        } else {\n          return jobs[0];\n        }\n      };\n    })(this));\n  };\n\n  Job.processJobs = JobQueue;\n\n  Job.makeJob = (function() {\n    var depFlag;\n    depFlag = false;\n    return function(root, doc) {\n      if (!depFlag) {\n        depFlag = true;\n        console.warn(\"Job.makeJob(root, jobDoc) has been deprecated and will be removed in a future release, use 'new Job(root, jobDoc)' instead.\");\n      }\n      return new Job(root, doc);\n    };\n  })();\n\n  Job.getJob = function() {\n    var cb, id, k, options, ref, root;\n    root = arguments[0], id = arguments[1], options = 4 <= arguments.length ? slice.call(arguments, 2, k = arguments.length - 1) : (k = 2, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    if (options.getLog == null) {\n      options.getLog = false;\n    }\n    return methodCall(root, \"getJob\", [id, options], cb, (function(_this) {\n      return function(doc) {\n        if (doc) {\n          return new Job(root, doc);\n        } else {\n          return void 0;\n        }\n      };\n    })(this));\n  };\n\n  Job.getJobs = function() {\n    var cb, chunkOfIds, chunksOfIds, ids, k, l, len, myCb, options, ref, retVal, root;\n    root = arguments[0], ids = arguments[1], options = 4 <= arguments.length ? slice.call(arguments, 2, k = arguments.length - 1) : (k = 2, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    if (options.getLog == null) {\n      options.getLog = false;\n    }\n    retVal = [];\n    chunksOfIds = splitLongArray(ids, 32);\n    myCb = reduceCallbacks(cb, chunksOfIds.length, concatReduce, []);\n    for (l = 0, len = chunksOfIds.length; l < len; l++) {\n      chunkOfIds = chunksOfIds[l];\n      retVal = retVal.concat(methodCall(root, \"getJob\", [chunkOfIds, options], myCb, (function(_this) {\n        return function(doc) {\n          var d, len1, m, results;\n          if (doc) {\n            results = [];\n            for (m = 0, len1 = doc.length; m < len1; m++) {\n              d = doc[m];\n              results.push(new Job(root, d.type, d.data, d));\n            }\n            return results;\n          } else {\n            return null;\n          }\n        };\n      })(this)));\n    }\n    return retVal;\n  };\n\n  Job.pauseJobs = function() {\n    var cb, chunkOfIds, chunksOfIds, ids, k, l, len, myCb, options, ref, retVal, root;\n    root = arguments[0], ids = arguments[1], options = 4 <= arguments.length ? slice.call(arguments, 2, k = arguments.length - 1) : (k = 2, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    retVal = false;\n    chunksOfIds = splitLongArray(ids, 256);\n    myCb = reduceCallbacks(cb, chunksOfIds.length);\n    for (l = 0, len = chunksOfIds.length; l < len; l++) {\n      chunkOfIds = chunksOfIds[l];\n      retVal = methodCall(root, \"jobPause\", [chunkOfIds, options], myCb) || retVal;\n    }\n    return retVal;\n  };\n\n  Job.resumeJobs = function() {\n    var cb, chunkOfIds, chunksOfIds, ids, k, l, len, myCb, options, ref, retVal, root;\n    root = arguments[0], ids = arguments[1], options = 4 <= arguments.length ? slice.call(arguments, 2, k = arguments.length - 1) : (k = 2, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    retVal = false;\n    chunksOfIds = splitLongArray(ids, 256);\n    myCb = reduceCallbacks(cb, chunksOfIds.length);\n    for (l = 0, len = chunksOfIds.length; l < len; l++) {\n      chunkOfIds = chunksOfIds[l];\n      retVal = methodCall(root, \"jobResume\", [chunkOfIds, options], myCb) || retVal;\n    }\n    return retVal;\n  };\n\n  Job.readyJobs = function() {\n    var cb, chunkOfIds, chunksOfIds, ids, k, l, len, myCb, options, ref, retVal, root;\n    root = arguments[0], ids = arguments[1], options = 4 <= arguments.length ? slice.call(arguments, 2, k = arguments.length - 1) : (k = 2, []), cb = arguments[k++];\n    if (ids == null) {\n      ids = [];\n    }\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    if (options.force == null) {\n      options.force = false;\n    }\n    retVal = false;\n    chunksOfIds = splitLongArray(ids, 256);\n    if (!(chunksOfIds.length > 0)) {\n      chunksOfIds = [[]];\n    }\n    myCb = reduceCallbacks(cb, chunksOfIds.length);\n    for (l = 0, len = chunksOfIds.length; l < len; l++) {\n      chunkOfIds = chunksOfIds[l];\n      retVal = methodCall(root, \"jobReady\", [chunkOfIds, options], myCb) || retVal;\n    }\n    return retVal;\n  };\n\n  Job.cancelJobs = function() {\n    var cb, chunkOfIds, chunksOfIds, ids, k, l, len, myCb, options, ref, retVal, root;\n    root = arguments[0], ids = arguments[1], options = 4 <= arguments.length ? slice.call(arguments, 2, k = arguments.length - 1) : (k = 2, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    if (options.antecedents == null) {\n      options.antecedents = true;\n    }\n    retVal = false;\n    chunksOfIds = splitLongArray(ids, 256);\n    myCb = reduceCallbacks(cb, chunksOfIds.length);\n    for (l = 0, len = chunksOfIds.length; l < len; l++) {\n      chunkOfIds = chunksOfIds[l];\n      retVal = methodCall(root, \"jobCancel\", [chunkOfIds, options], myCb) || retVal;\n    }\n    return retVal;\n  };\n\n  Job.restartJobs = function() {\n    var cb, chunkOfIds, chunksOfIds, ids, k, l, len, myCb, options, ref, retVal, root;\n    root = arguments[0], ids = arguments[1], options = 4 <= arguments.length ? slice.call(arguments, 2, k = arguments.length - 1) : (k = 2, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    if (options.retries == null) {\n      options.retries = 1;\n    }\n    if (options.dependents == null) {\n      options.dependents = true;\n    }\n    retVal = false;\n    chunksOfIds = splitLongArray(ids, 256);\n    myCb = reduceCallbacks(cb, chunksOfIds.length);\n    for (l = 0, len = chunksOfIds.length; l < len; l++) {\n      chunkOfIds = chunksOfIds[l];\n      retVal = methodCall(root, \"jobRestart\", [chunkOfIds, options], myCb) || retVal;\n    }\n    return retVal;\n  };\n\n  Job.removeJobs = function() {\n    var cb, chunkOfIds, chunksOfIds, ids, k, l, len, myCb, options, ref, retVal, root;\n    root = arguments[0], ids = arguments[1], options = 4 <= arguments.length ? slice.call(arguments, 2, k = arguments.length - 1) : (k = 2, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    retVal = false;\n    chunksOfIds = splitLongArray(ids, 256);\n    myCb = reduceCallbacks(cb, chunksOfIds.length);\n    for (l = 0, len = chunksOfIds.length; l < len; l++) {\n      chunkOfIds = chunksOfIds[l];\n      retVal = methodCall(root, \"jobRemove\", [chunkOfIds, options], myCb) || retVal;\n    }\n    return retVal;\n  };\n\n  Job.startJobs = function() {\n    var cb, k, options, ref, root;\n    root = arguments[0], options = 3 <= arguments.length ? slice.call(arguments, 1, k = arguments.length - 1) : (k = 1, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    return methodCall(root, \"startJobs\", [options], cb);\n  };\n\n  Job.stopJobs = function() {\n    var cb, k, options, ref, root;\n    root = arguments[0], options = 3 <= arguments.length ? slice.call(arguments, 1, k = arguments.length - 1) : (k = 1, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    if (options.timeout == null) {\n      options.timeout = 60 * 1000;\n    }\n    return methodCall(root, \"stopJobs\", [options], cb);\n  };\n\n  Job.startJobServer = function() {\n    var cb, k, options, ref, root;\n    root = arguments[0], options = 3 <= arguments.length ? slice.call(arguments, 1, k = arguments.length - 1) : (k = 1, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    return methodCall(root, \"startJobServer\", [options], cb);\n  };\n\n  Job.shutdownJobServer = function() {\n    var cb, k, options, ref, root;\n    root = arguments[0], options = 3 <= arguments.length ? slice.call(arguments, 1, k = arguments.length - 1) : (k = 1, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    if (options.timeout == null) {\n      options.timeout = 60 * 1000;\n    }\n    return methodCall(root, \"shutdownJobServer\", [options], cb);\n  };\n\n  function Job(rootVal, type, data) {\n    var doc, ref, time;\n    if (!(this instanceof Job)) {\n      return new Job(rootVal, type, data);\n    }\n    this.root = rootVal;\n    this._root = rootVal;\n    if ((((ref = this.root) != null ? ref.root : void 0) != null) && typeof this.root.root === 'string') {\n      this.root = this._root.root;\n    }\n    if ((data == null) && ((type != null ? type.data : void 0) != null) && ((type != null ? type.type : void 0) != null)) {\n      if (type instanceof Job) {\n        return type;\n      }\n      doc = type;\n      data = doc.data;\n      type = doc.type;\n    } else {\n      doc = {};\n    }\n    if (!(typeof doc === 'object' && typeof data === 'object' && typeof type === 'string' && typeof this.root === 'string')) {\n      throw new Error(\"new Job: bad parameter(s), \" + this.root + \" (\" + (typeof this.root) + \"), \" + type + \" (\" + (typeof type) + \"), \" + data + \" (\" + (typeof data) + \"), \" + doc + \" (\" + (typeof doc) + \")\");\n    } else if ((doc.type != null) && (doc.data != null)) {\n      this._doc = doc;\n    } else {\n      time = new Date();\n      this._doc = {\n        runId: null,\n        type: type,\n        data: data,\n        status: 'waiting',\n        updated: time,\n        created: time\n      };\n      this.priority().retry().repeat().after().progress().depends().log(\"Constructed\");\n    }\n    return this;\n  }\n\n  Job.prototype._echo = function(message, level) {\n    if (level == null) {\n      level = null;\n    }\n    switch (level) {\n      case 'danger':\n        console.error(message);\n        break;\n      case 'warning':\n        console.warn(message);\n        break;\n      case 'success':\n        console.log(message);\n        break;\n      default:\n        console.info(message);\n    }\n  };\n\n  Job.prototype.depends = function(jobs) {\n    var depends, j, k, len;\n    if (jobs) {\n      if (jobs instanceof Job) {\n        jobs = [jobs];\n      }\n      if (jobs instanceof Array) {\n        depends = this._doc.depends;\n        for (k = 0, len = jobs.length; k < len; k++) {\n          j = jobs[k];\n          if (!(j instanceof Job && (j._doc._id != null))) {\n            throw new Error('Each provided object must be a saved Job instance (with an _id)');\n          }\n          depends.push(j._doc._id);\n        }\n      } else {\n        throw new Error('Bad input parameter: depends() accepts a falsy value, or Job or array of Jobs');\n      }\n    } else {\n      depends = [];\n    }\n    this._doc.depends = depends;\n    this._doc.resolved = [];\n    return this;\n  };\n\n  Job.prototype.priority = function(level) {\n    var priority;\n    if (level == null) {\n      level = 0;\n    }\n    if (typeof level === 'string') {\n      priority = Job.jobPriorities[level];\n      if (priority == null) {\n        throw new Error('Invalid string priority level provided');\n      }\n    } else if (isInteger(level)) {\n      priority = level;\n    } else {\n      throw new Error('priority must be an integer or valid priority level');\n      priority = 0;\n    }\n    this._doc.priority = priority;\n    return this;\n  };\n\n  Job.prototype.retry = function(options) {\n    var base, ref;\n    if (options == null) {\n      options = 0;\n    }\n    if (isInteger(options) && options >= 0) {\n      options = {\n        retries: options\n      };\n    }\n    if (typeof options !== 'object') {\n      throw new Error('bad parameter: accepts either an integer >= 0 or an options object');\n    }\n    if (options.retries != null) {\n      if (!(isInteger(options.retries) && options.retries >= 0)) {\n        throw new Error('bad option: retries must be an integer >= 0');\n      }\n      options.retries++;\n    } else {\n      options.retries = Job.forever;\n    }\n    if (options.until != null) {\n      if (!(options.until instanceof Date)) {\n        throw new Error('bad option: until must be a Date object');\n      }\n    } else {\n      options.until = Job.foreverDate;\n    }\n    if (options.wait != null) {\n      if (!(isInteger(options.wait) && options.wait >= 0)) {\n        throw new Error('bad option: wait must be an integer >= 0');\n      }\n    } else {\n      options.wait = 5 * 60 * 1000;\n    }\n    if (options.backoff != null) {\n      if (ref = options.backoff, indexOf.call(Job.jobRetryBackoffMethods, ref) < 0) {\n        throw new Error('bad option: invalid retry backoff method');\n      }\n    } else {\n      options.backoff = 'constant';\n    }\n    this._doc.retries = options.retries;\n    this._doc.repeatRetries = options.retries;\n    this._doc.retryWait = options.wait;\n    if ((base = this._doc).retried == null) {\n      base.retried = 0;\n    }\n    this._doc.retryBackoff = options.backoff;\n    this._doc.retryUntil = options.until;\n    return this;\n  };\n\n  Job.prototype.repeat = function(options) {\n    var base, ref;\n    if (options == null) {\n      options = 0;\n    }\n    if (isInteger(options) && options >= 0) {\n      options = {\n        repeats: options\n      };\n    }\n    if (typeof options !== 'object') {\n      throw new Error('bad parameter: accepts either an integer >= 0 or an options object');\n    }\n    if ((options.wait != null) && (options.schedule != null)) {\n      throw new Error('bad options: wait and schedule options are mutually exclusive');\n    }\n    if (options.repeats != null) {\n      if (!(isInteger(options.repeats) && options.repeats >= 0)) {\n        throw new Error('bad option: repeats must be an integer >= 0');\n      }\n    } else {\n      options.repeats = Job.forever;\n    }\n    if (options.until != null) {\n      if (!(options.until instanceof Date)) {\n        throw new Error('bad option: until must be a Date object');\n      }\n    } else {\n      options.until = Job.foreverDate;\n    }\n    if (options.wait != null) {\n      if (!(isInteger(options.wait) && options.wait >= 0)) {\n        throw new Error('bad option: wait must be an integer >= 0');\n      }\n    } else {\n      options.wait = 5 * 60 * 1000;\n    }\n    if (options.schedule != null) {\n      if (typeof options.schedule !== 'object') {\n        throw new Error('bad option, schedule option must be an object');\n      }\n      if (!((((ref = options.schedule) != null ? ref.schedules : void 0) != null) && options.schedule.schedules instanceof Array)) {\n        throw new Error('bad option, schedule object requires a schedules attribute of type Array.');\n      }\n      if ((options.schedule.exceptions != null) && !(options.schedule.exceptions instanceof Array)) {\n        throw new Error('bad option, schedule object exceptions attribute must be an Array');\n      }\n      options.wait = {\n        schedules: options.schedule.schedules,\n        exceptions: options.schedule.exceptions\n      };\n    }\n    this._doc.repeats = options.repeats;\n    this._doc.repeatWait = options.wait;\n    if ((base = this._doc).repeated == null) {\n      base.repeated = 0;\n    }\n    this._doc.repeatUntil = options.until;\n    return this;\n  };\n\n  Job.prototype.delay = function(wait) {\n    if (wait == null) {\n      wait = 0;\n    }\n    if (!(isInteger(wait) && wait >= 0)) {\n      throw new Error('Bad parameter, delay requires a non-negative integer.');\n    }\n    return this.after(new Date(new Date().valueOf() + wait));\n  };\n\n  Job.prototype.after = function(time) {\n    var after;\n    if (time == null) {\n      time = new Date(0);\n    }\n    if (typeof time === 'object' && time instanceof Date) {\n      after = time;\n    } else {\n      throw new Error('Bad parameter, after requires a valid Date object');\n    }\n    this._doc.after = after;\n    return this;\n  };\n\n  Job.prototype.log = function() {\n    var base, cb, k, message, options, ref, ref1;\n    message = arguments[0], options = 3 <= arguments.length ? slice.call(arguments, 1, k = arguments.length - 1) : (k = 1, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    if (options.level == null) {\n      options.level = 'info';\n    }\n    if (typeof message !== 'string') {\n      throw new Error('Log message must be a string');\n    }\n    if (!(typeof options.level === 'string' && (ref1 = options.level, indexOf.call(Job.jobLogLevels, ref1) >= 0))) {\n      throw new Error('Log level options must be one of Job.jobLogLevels');\n    }\n    if (options.echo != null) {\n      if (options.echo && Job.jobLogLevels.indexOf(options.level) >= Job.jobLogLevels.indexOf(options.echo)) {\n        this._echo(\"LOG: \" + options.level + \", \" + this._doc._id + \" \" + this._doc.runId + \": \" + message, options.level);\n      }\n      delete options.echo;\n    }\n    if (this._doc._id != null) {\n      return methodCall(this._root, \"jobLog\", [this._doc._id, this._doc.runId, message, options], cb);\n    } else {\n      if ((base = this._doc).log == null) {\n        base.log = [];\n      }\n      this._doc.log.push({\n        time: new Date(),\n        runId: null,\n        level: options.level,\n        message: message\n      });\n      if ((cb != null) && typeof cb === 'function') {\n        _setImmediate(cb, null, true);\n      }\n      return this;\n    }\n  };\n\n  Job.prototype.progress = function() {\n    var cb, completed, k, options, progress, ref, total;\n    completed = arguments[0], total = arguments[1], options = 4 <= arguments.length ? slice.call(arguments, 2, k = arguments.length - 1) : (k = 2, []), cb = arguments[k++];\n    if (completed == null) {\n      completed = 0;\n    }\n    if (total == null) {\n      total = 1;\n    }\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    if (typeof completed === 'number' && typeof total === 'number' && completed >= 0 && total > 0 && total >= completed) {\n      progress = {\n        completed: completed,\n        total: total,\n        percent: 100 * completed / total\n      };\n      if (options.echo) {\n        delete options.echo;\n        this._echo(\"PROGRESS: \" + this._doc._id + \" \" + this._doc.runId + \": \" + progress.completed + \" out of \" + progress.total + \" (\" + progress.percent + \"%)\");\n      }\n      if ((this._doc._id != null) && (this._doc.runId != null)) {\n        return methodCall(this._root, \"jobProgress\", [this._doc._id, this._doc.runId, completed, total, options], cb, (function(_this) {\n          return function(res) {\n            if (res) {\n              _this._doc.progress = progress;\n            }\n            return res;\n          };\n        })(this));\n      } else if (this._doc._id == null) {\n        this._doc.progress = progress;\n        if ((cb != null) && typeof cb === 'function') {\n          _setImmediate(cb, null, true);\n        }\n        return this;\n      }\n    } else {\n      throw new Error(\"job.progress: something is wrong with progress params: \" + this.id + \", \" + completed + \" out of \" + total);\n    }\n    return null;\n  };\n\n  Job.prototype.save = function() {\n    var cb, k, options, ref;\n    options = 2 <= arguments.length ? slice.call(arguments, 0, k = arguments.length - 1) : (k = 0, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    return methodCall(this._root, \"jobSave\", [this._doc, options], cb, (function(_this) {\n      return function(id) {\n        if (id) {\n          _this._doc._id = id;\n        }\n        return id;\n      };\n    })(this));\n  };\n\n  Job.prototype.refresh = function() {\n    var cb, k, options, ref;\n    options = 2 <= arguments.length ? slice.call(arguments, 0, k = arguments.length - 1) : (k = 0, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    if (options.getLog == null) {\n      options.getLog = false;\n    }\n    if (this._doc._id != null) {\n      return methodCall(this._root, \"getJob\", [this._doc._id, options], cb, (function(_this) {\n        return function(doc) {\n          if (doc != null) {\n            _this._doc = doc;\n            return _this;\n          } else {\n            return false;\n          }\n        };\n      })(this));\n    } else {\n      throw new Error(\"Can't call .refresh() on an unsaved job\");\n    }\n  };\n\n  Job.prototype.done = function() {\n    var cb, k, options, ref, result;\n    result = arguments[0], options = 3 <= arguments.length ? slice.call(arguments, 1, k = arguments.length - 1) : (k = 1, []), cb = arguments[k++];\n    if (result == null) {\n      result = {};\n    }\n    if (typeof result === 'function') {\n      cb = result;\n      result = {};\n    }\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    if (!((result != null) && typeof result === 'object')) {\n      result = {\n        value: result\n      };\n    }\n    if ((this._doc._id != null) && (this._doc.runId != null)) {\n      return methodCall(this._root, \"jobDone\", [this._doc._id, this._doc.runId, result, options], cb);\n    } else {\n      throw new Error(\"Can't call .done() on an unsaved or non-running job\");\n    }\n    return null;\n  };\n\n  Job.prototype.fail = function() {\n    var cb, k, options, ref, result;\n    result = arguments[0], options = 3 <= arguments.length ? slice.call(arguments, 1, k = arguments.length - 1) : (k = 1, []), cb = arguments[k++];\n    if (result == null) {\n      result = \"No error information provided\";\n    }\n    if (typeof result === 'function') {\n      cb = result;\n      result = \"No error information provided\";\n    }\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    if (!((result != null) && typeof result === 'object')) {\n      result = {\n        value: result\n      };\n    }\n    if (options.fatal == null) {\n      options.fatal = false;\n    }\n    if ((this._doc._id != null) && (this._doc.runId != null)) {\n      return methodCall(this._root, \"jobFail\", [this._doc._id, this._doc.runId, result, options], cb);\n    } else {\n      throw new Error(\"Can't call .fail() on an unsaved or non-running job\");\n    }\n    return null;\n  };\n\n  Job.prototype.pause = function() {\n    var cb, k, options, ref;\n    options = 2 <= arguments.length ? slice.call(arguments, 0, k = arguments.length - 1) : (k = 0, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    if (this._doc._id != null) {\n      return methodCall(this._root, \"jobPause\", [this._doc._id, options], cb);\n    } else {\n      this._doc.status = 'paused';\n      if ((cb != null) && typeof cb === 'function') {\n        _setImmediate(cb, null, true);\n      }\n      return this;\n    }\n    return null;\n  };\n\n  Job.prototype.resume = function() {\n    var cb, k, options, ref;\n    options = 2 <= arguments.length ? slice.call(arguments, 0, k = arguments.length - 1) : (k = 0, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    if (this._doc._id != null) {\n      return methodCall(this._root, \"jobResume\", [this._doc._id, options], cb);\n    } else {\n      this._doc.status = 'waiting';\n      if ((cb != null) && typeof cb === 'function') {\n        _setImmediate(cb, null, true);\n      }\n      return this;\n    }\n    return null;\n  };\n\n  Job.prototype.ready = function() {\n    var cb, k, options, ref;\n    options = 2 <= arguments.length ? slice.call(arguments, 0, k = arguments.length - 1) : (k = 0, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    if (options.force == null) {\n      options.force = false;\n    }\n    if (this._doc._id != null) {\n      return methodCall(this._root, \"jobReady\", [this._doc._id, options], cb);\n    } else {\n      throw new Error(\"Can't call .ready() on an unsaved job\");\n    }\n    return null;\n  };\n\n  Job.prototype.cancel = function() {\n    var cb, k, options, ref;\n    options = 2 <= arguments.length ? slice.call(arguments, 0, k = arguments.length - 1) : (k = 0, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    if (options.antecedents == null) {\n      options.antecedents = true;\n    }\n    if (this._doc._id != null) {\n      return methodCall(this._root, \"jobCancel\", [this._doc._id, options], cb);\n    } else {\n      throw new Error(\"Can't call .cancel() on an unsaved job\");\n    }\n    return null;\n  };\n\n  Job.prototype.restart = function() {\n    var cb, k, options, ref;\n    options = 2 <= arguments.length ? slice.call(arguments, 0, k = arguments.length - 1) : (k = 0, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    if (options.retries == null) {\n      options.retries = 1;\n    }\n    if (options.dependents == null) {\n      options.dependents = true;\n    }\n    if (this._doc._id != null) {\n      return methodCall(this._root, \"jobRestart\", [this._doc._id, options], cb);\n    } else {\n      throw new Error(\"Can't call .restart() on an unsaved job\");\n    }\n    return null;\n  };\n\n  Job.prototype.rerun = function() {\n    var cb, k, options, ref;\n    options = 2 <= arguments.length ? slice.call(arguments, 0, k = arguments.length - 1) : (k = 0, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    if (options.repeats == null) {\n      options.repeats = 0;\n    }\n    if (options.wait == null) {\n      options.wait = this._doc.repeatWait;\n    }\n    if (this._doc._id != null) {\n      return methodCall(this._root, \"jobRerun\", [this._doc._id, options], cb);\n    } else {\n      throw new Error(\"Can't call .rerun() on an unsaved job\");\n    }\n    return null;\n  };\n\n  Job.prototype.remove = function() {\n    var cb, k, options, ref;\n    options = 2 <= arguments.length ? slice.call(arguments, 0, k = arguments.length - 1) : (k = 0, []), cb = arguments[k++];\n    ref = optionsHelp(options, cb), options = ref[0], cb = ref[1];\n    if (this._doc._id != null) {\n      return methodCall(this._root, \"jobRemove\", [this._doc._id, options], cb);\n    } else {\n      throw new Error(\"Can't call .remove() on an unsaved job\");\n    }\n    return null;\n  };\n\n  Object.defineProperties(Job.prototype, {\n    doc: {\n      get: function() {\n        return this._doc;\n      },\n      set: function() {\n        return console.warn(\"Job.doc cannot be directly assigned.\");\n      }\n    },\n    type: {\n      get: function() {\n        return this._doc.type;\n      },\n      set: function() {\n        return console.warn(\"Job.type cannot be directly assigned.\");\n      }\n    },\n    data: {\n      get: function() {\n        return this._doc.data;\n      },\n      set: function() {\n        return console.warn(\"Job.data cannot be directly assigned.\");\n      }\n    }\n  });\n\n  return Job;\n\n})();\n\nif ((typeof module !== \"undefined\" && module !== null ? module.exports : void 0) != null) {\n  module.exports = Job;\n}\n"]},"hash":"7f76e9ac65d9f458c12a7b2383f5e8ac1ee7774f"}
