name: deploy
root: ./
on_project_exit: tmux kill-session deploy
windows:
  - deploy:
      layout: tiled
      panes:
        - app:
            - cd ../microservices/app
            - >-
              meteor build ../../.swisscom-deployment/./staging/app/.
              --server-only --architecture os.linux.x86_64
            - cd ../../.swisscom-deployment/./staging/app
            - mv ./app.tar.gz ./e-potek-app-staging.tar.gz
            - cf push
            - cd ..
            - rm -rf ./app
        - admin:
            - cd ../microservices/admin
            - >-
              meteor build ../../.swisscom-deployment/./staging/admin/.
              --server-only --architecture os.linux.x86_64
            - cd ../../.swisscom-deployment/./staging/admin
            - mv ./admin.tar.gz ./e-potek-admin-staging.tar.gz
            - cf push
            - cd ..
            - rm -rf ./admin
        - www:
            - cd ../microservices/www
            - >-
              meteor build ../../.swisscom-deployment/./staging/www/.
              --server-only --architecture os.linux.x86_64
            - cd ../../.swisscom-deployment/./staging/www
            - mv ./www.tar.gz ./e-potek-www-staging.tar.gz
            - cf push
            - cd ..
            - rm -rf ./www
